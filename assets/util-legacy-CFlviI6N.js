System.register(["./index-legacy-BIw6wWtP.js"],(function(e,t){"use strict";var n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h,k,y,A,I,b,T,v,S,x,O,B,C,q,P,E,M,L,N,V,R,F,W,D,_,K,U,z,X,G,j,H,Q,Z,$,Y,J,ee,te,ne,re,oe,ie,se,ae,ce,ue,le,de,me,pe,fe,ge,we,he,ke,ye,Ae,Ie,be,Te,ve,Se,xe,Oe,Be,Ce,qe,Pe,Ee,Me,Le,Ne,Ve,Re,Fe,We,De,_e,Ke,Ue,ze,Xe,Ge,je,He,Qe,Ze;return{setters:[e=>{n=e.v,r=e.o,o=e.A,i=e.b9,s=e.ba,a=e.m,c=e.j,u=e.d,l=e.k,d=e.t,m=e.n,p=e.p,f=e.bb,g=e.bc,w=e.x,h=e.c,k=e.l,y=e.T,A=e.bd,I=e.be,b=e.aD,T=e.bf,v=e.E,S=e.D,x=e.bg,O=e.aK,B=e.bh,C=e.bi,q=e.s,P=e.bj,E=e.bk,M=e.bl,L=e.bm,N=e.bn,V=e.bo,R=e.bp,F=e.bq,W=e.br,D=e.bs,_=e.bt,K=e.bu,U=e.bv,z=e.bw,X=e.bx,G=e.w,j=e.G,H=e.H,Q=e.z,Z=e.C,$=e.by,Y=e.bz,J=e.bA,ee=e.bB,te=e.bC,ne=e.bD,re=e.aN,oe=e.bE,ie=e.bF,se=e.aM,ae=e.bG,ce=e.bH,ue=e.bI,le=e.bJ,de=e.bK,me=e.I,pe=e.b,fe=e.L,ge=e.N,we=e.X,he=e.f,ke=e.O,ye=e.M,Ae=e.Q,Ie=e.R,be=e.S,Te=e.aI,ve=e.aF,Se=e.b1,xe=e.P,Oe=e.bL,Be=e._,Ce=e.$,qe=e.a0,Pe=e.bM,Ee=e.bN,Me=e.bO,Le=e.bP,Ne=e.bQ,Ve=e.bR,Re=e.bS,Fe=e.a8,We=e.bT,De=e.bU,_e=e.bV,Ke=e.bW,Ue=e.bX,ze=e.bY,Xe=e.bZ,Ge=e.b_,je=e.b$,He=e.c0,Qe=e.aL,Ze=e.u}],execute:function(){var t=document.createElement("style");function $e(e,t){const c=((e,t)=>{const a=n(),c=()=>{a.value=s(e).height};return r((()=>{if(o(c),t)for(let e=1;e<=3;e++)setTimeout(c,100*e)})),i((()=>o(c))),a})(e,!0);return e=>a("div",{class:t("placeholder"),style:{height:c.value?`${c.value}px`:void 0}},[e()])}t.textContent=':root{--van-action-sheet-max-height: 80%;--van-action-sheet-header-height: 1.28rem;--van-action-sheet-header-font-size: var(--van-font-size-lg);--van-action-sheet-description-color: var(--van-text-color-2);--van-action-sheet-description-font-size: var(--van-font-size-md);--van-action-sheet-description-line-height: var(--van-line-height-md);--van-action-sheet-item-background: var(--van-background-color-light);--van-action-sheet-item-font-size: var(--van-font-size-lg);--van-action-sheet-item-line-height: var(--van-line-height-lg);--van-action-sheet-item-text-color: var(--van-text-color);--van-action-sheet-item-disabled-text-color: var(--van-text-color-3);--van-action-sheet-subname-color: var(--van-text-color-2);--van-action-sheet-subname-font-size: var(--van-font-size-sm);--van-action-sheet-subname-line-height: var(--van-line-height-sm);--van-action-sheet-close-icon-size: .58667rem;--van-action-sheet-close-icon-color: var(--van-gray-5);--van-action-sheet-close-icon-padding: 0 var(--van-padding-md);--van-action-sheet-cancel-text-color: var(--van-gray-7);--van-action-sheet-cancel-padding-top: var(--van-padding-xs);--van-action-sheet-cancel-padding-color: var(--van-background-color);--van-action-sheet-loading-icon-size: .58667rem}.van-action-sheet{display:flex;flex-direction:column;max-height:var(--van-action-sheet-max-height);overflow:hidden;color:var(--van-action-sheet-item-text-color)}.van-action-sheet__content{flex:1 auto;overflow-y:auto;-webkit-overflow-scrolling:touch}.van-action-sheet__item,.van-action-sheet__cancel{display:block;width:100%;padding:.37333rem var(--van-padding-md);font-size:var(--van-action-sheet-item-font-size);background:var(--van-action-sheet-item-background);border:none;cursor:pointer}.van-action-sheet__item:active,.van-action-sheet__cancel:active{background-color:var(--van-active-color)}.van-action-sheet__item{line-height:var(--van-action-sheet-item-line-height)}.van-action-sheet__item--loading,.van-action-sheet__item--disabled{color:var(--van-action-sheet-item-disabled-text-color)}.van-action-sheet__item--loading:active,.van-action-sheet__item--disabled:active{background-color:var(--van-action-sheet-item-background)}.van-action-sheet__item--disabled{cursor:not-allowed}.van-action-sheet__item--loading{cursor:default}.van-action-sheet__cancel{flex-shrink:0;box-sizing:border-box;color:var(--van-action-sheet-cancel-text-color)}.van-action-sheet__subname{margin-top:var(--van-padding-xs);color:var(--van-action-sheet-subname-color);font-size:var(--van-action-sheet-subname-font-size);line-height:var(--van-action-sheet-subname-line-height)}.van-action-sheet__gap{display:block;height:var(--van-action-sheet-cancel-padding-top);background:var(--van-action-sheet-cancel-padding-color)}.van-action-sheet__header{flex-shrink:0;font-weight:var(--van-font-weight-bold);font-size:var(--van-action-sheet-header-font-size);line-height:var(--van-action-sheet-header-height);text-align:center}.van-action-sheet__description{position:relative;flex-shrink:0;padding:.53333rem var(--van-padding-md);color:var(--van-action-sheet-description-color);font-size:var(--van-action-sheet-description-font-size);line-height:var(--van-action-sheet-description-line-height);text-align:center}.van-action-sheet__description:after{position:absolute;box-sizing:border-box;content:" ";pointer-events:none;right:var(--van-padding-md);bottom:0;left:var(--van-padding-md);border-bottom:.02667rem solid var(--van-border-color);transform:scaleY(.5)}.van-action-sheet__loading-icon .van-loading__spinner{width:var(--van-action-sheet-loading-icon-size);height:var(--van-action-sheet-loading-icon-size)}.van-action-sheet__close{position:absolute;top:0;right:0;padding:var(--van-action-sheet-close-icon-padding);color:var(--van-action-sheet-close-icon-color);font-size:var(--van-action-sheet-close-icon-size);line-height:inherit}:root{--van-notice-bar-height: 1.06667rem;--van-notice-bar-padding: 0 var(--van-padding-md);--van-notice-bar-wrapable-padding: var(--van-padding-xs) var(--van-padding-md);--van-notice-bar-text-color: var(--van-orange-dark);--van-notice-bar-font-size: var(--van-font-size-md);--van-notice-bar-line-height: .64rem;--van-notice-bar-background-color: var(--van-orange-light);--van-notice-bar-icon-size: .42667rem;--van-notice-bar-icon-min-width: .64rem}.van-notice-bar{position:relative;display:flex;align-items:center;height:var(--van-notice-bar-height);padding:var(--van-notice-bar-padding);color:var(--van-notice-bar-text-color);font-size:var(--van-notice-bar-font-size);line-height:var(--van-notice-bar-line-height);background:var(--van-notice-bar-background-color)}.van-notice-bar__left-icon,.van-notice-bar__right-icon{min-width:var(--van-notice-bar-icon-min-width);font-size:var(--van-notice-bar-icon-size)}.van-notice-bar__right-icon{text-align:right;cursor:pointer}.van-notice-bar__wrap{position:relative;display:flex;flex:1;align-items:center;height:100%;overflow:hidden}.van-notice-bar__content{position:absolute;white-space:nowrap;transition-timing-function:linear}.van-notice-bar__content.van-ellipsis{max-width:100%}.van-notice-bar--wrapable{height:auto;padding:var(--van-notice-bar-wrapable-padding)}.van-notice-bar--wrapable .van-notice-bar__wrap{height:auto}.van-notice-bar--wrapable .van-notice-bar__content{position:relative;white-space:normal;word-wrap:break-word}.icon-slippage[data-v-d45994be]{font-size:.48rem}.icon-slippage[data-v-d45994be]:active{opacity:.5}.popup-content[data-v-d45994be]{--van-cell-background-color: #fff}.radio-group[data-v-d45994be]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.26667rem;width:100%}.radio-group .radio-input[data-v-d45994be]{width:0;height:0;font-size:0;opacity:0}.radio-group .radio-input:checked+.radio-item[data-v-d45994be]{background:#3f80f7;color:#fff}.radio-group .radio-item[data-v-d45994be]{background:#f5f6f7;border-radius:.21333rem;min-width:2.29333rem;font-size:.37333rem;color:#666;letter-spacing:0;font-weight:400;text-align:center;height:.85333rem;line-height:.85333rem}.slippage-label[data-v-d45994be]{font-size:.37333rem;color:#333;letter-spacing:0;text-align:center;font-weight:400;text-align:left;display:flex;align-items:center}.slippage-label .iconfont[data-v-d45994be]:active{opacity:.5}.slippage-input[data-v-d45994be]{width:100%;display:flex;align-items:center;font-size:.42667rem;color:#333;font-weight:400}.slippage-input .input[data-v-d45994be]{font-size:.37333rem;background:#fff;border:.02667rem solid #DCDEE0;border-radius:.21333rem;height:.96rem;padding:0 .37333rem;flex:1}.slippage-input .input[data-v-d45994be]:focus-within{border-color:#3f80f7}.slippage-input .input[data-v-d45994be] .van-field__body{height:100%}.slippage-input span[data-v-d45994be]{margin-left:.13333rem}.form-submit[data-v-d45994be]{margin-top:1.06667rem}.icon-edit[data-v-d45994be]{font-size:.42667rem;margin-left:.13333rem;color:#3f80f7}\n',document.head.appendChild(t),e({b:async function(e,t){let n=Ze().solanaWallet;const r=await async function({connection:e,makeTxVersion:t,payer:n,innerTransactions:r,recentBlockhash:o,addLookupTableInfo:i}){if(t!==Go.V0&&t!==Go.LEGACY)throw Error(" make tx version args error");const s=o??(await e.getLatestBlockhash()).blockhash,a=[];for(const c of r)a.push($o({makeTxVersion:t,instructions:c.instructions,payer:n,recentBlockhash:s,signers:c.signers,lookupTableInfos:Object.values({...i??{},...c.lookupTableAddress??{}})}));return a}({connection:Qe,makeTxVersion:su,payer:n?.publicKey,innerTransactions:e,addLookupTableInfo:au});return console.log("willSendTx",r),r},f:async function(e){const t=await Qe.getAccountInfo(new re(e));if(null===t)throw Error(" get id info error ");const n=Li.decode(t.data),r=n.marketId,o=await Qe.getAccountInfo(r);if(null===o)throw Error(" get market info error");const i=Vc.decode(o.data),s=n.lpMint,a=await Qe.getAccountInfo(s);if(null===a)throw Error(" get lp mint info error");const c=Ko.decode(a.data);return{id:e,baseMint:n.baseMint.toString(),quoteMint:n.quoteMint.toString(),lpMint:n.lpMint.toString(),baseDecimals:n.baseDecimal.toNumber(),quoteDecimals:n.quoteDecimal.toNumber(),lpDecimals:c.decimals,version:4,programId:t.owner.toString(),authority:ru.getAssociatedAuthority({programId:t.owner}).publicKey.toString(),openOrders:n.openOrders.toString(),targetOrders:n.targetOrders.toString(),baseVault:n.baseVault.toString(),quoteVault:n.quoteVault.toString(),withdrawQueue:n.withdrawQueue.toString(),lpVault:n.lpVault.toString(),marketVersion:3,marketProgramId:n.marketProgramId.toString(),marketId:n.marketId.toString(),marketAuthority:Wc.getAssociatedAuthority({programId:n.marketProgramId,marketId:n.marketId}).publicKey.toString(),marketBaseVault:i.baseVault.toString(),marketQuoteVault:i.quoteVault.toString(),marketBids:i.bids.toString(),marketAsks:i.asks.toString(),marketEventQueue:i.eventQueue.toString(),lookupTableAccount:re.default.toString()}},g:async function(e,t){return(await e.getTokenAccountsByOwner(t,{programId:se})).value.map((e=>({pubkey:e.pubkey,programId:e.account.owner,accountInfo:Uo.decode(e.account.data)})))},j:function e(t){return"string"==typeof t?Gn(t):Array.isArray(t)?t.map((t=>e(t))):"object"!=typeof(n=t)||null===n||[mo,re,ao,Pe.BN,Ir,lo,wo,fo].some((e=>"object"==typeof e&&n instanceof e))?t:Object.fromEntries(Object.entries(t).map((([t,n])=>[t,e(n)])));var n}});const[Ye,Je]=c("action-bar"),et=Symbol(Ye),tt={placeholder:Boolean,safeAreaInsetBottom:d};var nt=u({name:Ye,props:tt,setup(e,{slots:t}){const r=n(),o=$e(r,Je),{linkChildren:i}=l(et);i();const s=()=>{var n;return a("div",{ref:r,class:[Je(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[null==(n=t.default)?void 0:n.call(t)])};return()=>e.placeholder?o(s):s()}});const rt=m(nt),[ot,it]=c("action-bar-button"),st=p({},f,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var at=u({name:ot,props:st,setup(e,{slots:t}){const n=g(),{parent:r,index:o}=w(et),i=h((()=>{if(r){const e=r.children[o.value-1];return!(e&&"isButton"in e)}})),s=h((()=>{if(r){const e=r.children[o.value+1];return!(e&&"isButton"in e)}}));return k({isButton:!0}),()=>{const{type:r,icon:o,text:c,color:u,loading:l,disabled:d}=e;return a(y,{class:it([r,{last:s.value,first:i.value}]),size:"large",type:r,icon:o,color:u,loading:l,disabled:d,onClick:n},{default:()=>[t.default?t.default():c]})}}});const ct=m(at),[ut,lt]=c("action-sheet"),dt=p({},A,{title:String,round:d,actions:I(),closeIcon:b("cross"),closeable:d,cancelText:String,description:String,closeOnPopstate:d,closeOnClickAction:Boolean,safeAreaInsetBottom:d}),mt=[...T,"round","closeOnPopstate","safeAreaInsetBottom"];var pt=u({name:ut,props:dt,emits:["select","cancel","update:show"],setup(e,{slots:t,emit:n}){const r=e=>n("update:show",e),i=()=>{r(!1),n("cancel")},s=()=>{if(e.title)return a("div",{class:lt("header")},[e.title,e.closeable&&a(O,{name:e.closeIcon,class:[lt("close"),B],onClick:i},null)])},c=()=>{if(t.cancel||e.cancelText)return[a("div",{class:lt("gap")},null),a("button",{type:"button",class:lt("cancel"),onClick:i},[t.cancel?t.cancel():e.cancelText])]},u=(e,n)=>e.loading?a(C,{class:lt("loading-icon")},null):t.action?t.action({action:e,index:n}):[a("span",{class:lt("name")},[e.name]),e.subname&&a("div",{class:lt("subname")},[e.subname])],l=(t,i)=>{const{color:s,loading:c,callback:l,disabled:d,className:m}=t;return a("button",{type:"button",style:{color:s},class:[lt("item",{loading:c,disabled:d}),m],onClick:()=>{d||c||(l&&l(t),e.closeOnClickAction&&r(!1),o((()=>n("select",t,i))))}},[u(t,i)])},d=()=>{if(e.description||t.description){const n=t.description?t.description():e.description;return a("div",{class:lt("description")},[n])}};return()=>a(x,v({class:lt(),position:"bottom","onUpdate:show":r},S(e,mt)),{default:()=>{var n;return[s(),d(),a("div",{class:lt("content")},[e.actions.map(l),null==(n=t.default)?void 0:n.call(t)]),c()]}})}});e("A",m(pt));const[ft,gt,wt]=c("dialog"),ht=p({},A,{title:String,theme:String,width:q,message:[String,Function],callback:Function,allowHtml:Boolean,className:P,transition:b("van-dialog-bounce"),messageAlign:String,closeOnPopstate:d,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:d,closeOnClickOverlay:Boolean}),kt=[...T,"transition","closeOnPopstate"];var yt=u({name:ft,props:ht,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:t,slots:r}){const o=n(),i=E({confirm:!1,cancel:!1}),s=e=>t("update:show",e),c=t=>{var n;s(!1),null==(n=e.callback)||n.call(e,t)},u=n=>()=>{e.show&&(t(n),e.beforeClose?(i[n]=!0,W(e.beforeClose,{args:[n],done(){c(n),i[n]=!1},canceled(){i[n]=!1}})):c(n))},l=u("cancel"),d=u("confirm"),m=L((n=>{var r,i;n.target===(null==(i=null==(r=o.value)?void 0:r.popupRef)?void 0:i.value)&&({Enter:e.showConfirmButton?d:N,Escape:e.showCancelButton?l:N}[n.key](),t("keydown",n))}),["enter","esc"]),p=()=>{const t=r.title?r.title():e.title;if(t)return a("div",{class:gt("header",{isolated:!e.message&&!r.default})},[t])},f=t=>{const{message:n,allowHtml:r,messageAlign:o}=e,i=gt("message",{"has-title":t,[o]:o}),s=V(n)?n():n;return r&&"string"==typeof s?a("div",{class:i,innerHTML:s},null):a("div",{class:i},[s])},g=()=>{if(r.default)return a("div",{class:gt("content")},[r.default()]);const{title:t,message:n,allowHtml:o}=e;if(n){const e=!(!t&&!r.title);return a("div",{key:o?1:0,class:gt("content",{isolated:!e})},[f(e)])}},w=()=>r.footer?r.footer():"round-button"===e.theme?a(rt,{class:gt("footer")},{default:()=>[e.showCancelButton&&a(ct,{type:"warning",text:e.cancelButtonText||wt("cancel"),class:gt("cancel"),color:e.cancelButtonColor,loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:l},null),e.showConfirmButton&&a(ct,{type:"danger",text:e.confirmButtonText||wt("confirm"),class:gt("confirm"),color:e.confirmButtonColor,loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:d},null)]}):a("div",{class:[F,gt("footer")]},[e.showCancelButton&&a(y,{size:"large",text:e.cancelButtonText||wt("cancel"),class:gt("cancel"),style:{color:e.cancelButtonColor},loading:i.cancel,disabled:e.cancelButtonDisabled,onClick:l},null),e.showConfirmButton&&a(y,{size:"large",text:e.confirmButtonText||wt("confirm"),class:[gt("confirm"),{[R]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:i.confirm,disabled:e.confirmButtonDisabled,onClick:d},null)]);return()=>{const{width:t,title:n,theme:r,message:i,className:c}=e;return a(x,v({ref:o,role:"dialog",class:[gt([r]),c],style:{width:M(t)},tabindex:0,"aria-labelledby":n||i,onKeydown:m,"onUpdate:show":s},S(e,kt)),{default:()=>[p(),g(),w()]})}}});let At;function It(e){return D?new Promise(((t,n)=>{At||function(){const e={setup(){const{state:e,toggle:t}=K();return()=>a(yt,v(e,{"onUpdate:show":t}),null)}};({instance:At}=_(e))}(),At.open(p({},It.currentOptions,e,{callback:e=>{("confirm"===e?t:n)(e)}}))})):Promise.resolve()}It.defaultOptions={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1},It.currentOptions=p({},It.defaultOptions),It.alert=It,It.confirm=e=>It(p({showCancelButton:!0},e)),It.close=()=>{At&&At.toggle(!1)},It.setDefaultOptions=e=>{p(It.currentOptions,e)},It.resetDefaultOptions=()=>{It.currentOptions=p({},It.defaultOptions)},It.Component=m(yt),It.install=e=>{e.use(It.Component),e.config.globalProperties.$dialog=It};const[bt,Tt]=c("notice-bar"),vt={text:String,mode:String,color:String,delay:U(1),speed:U(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var St=u({name:bt,props:vt,emits:["close","replay"],setup(e,{emit:t,slots:r}){let o,c=0,u=0;const l=n(),d=n(),m=E({show:!0,offset:0,duration:0}),p=n=>{"closeable"===e.mode&&(m.show=!1,t("close",n))},f=()=>{if(r["right-icon"])return r["right-icon"]();const t="closeable"===e.mode?"cross":"link"===e.mode?"arrow":void 0;return t?a(O,{name:t,class:Tt("right-icon"),onClick:p},null):void 0},g=()=>{m.offset=c,m.duration=0,Z((()=>{Q((()=>{m.offset=-u,m.duration=(u+c)/+e.speed,t("replay")}))}))},w=()=>{const t=!1===e.scrollable&&!e.wrapable,n={transform:m.offset?`translateX(${m.offset}px)`:"",transitionDuration:`${m.duration}s`};return a("div",{ref:l,role:"marquee",class:Tt("wrap")},[a("div",{ref:d,style:n,class:[Tt("content"),{"van-ellipsis":t}],onTransitionend:g},[r.default?r.default():e.text])])},h=()=>{const{delay:t,speed:n,scrollable:r}=e,i=$(t)?1e3*+t:0;c=0,u=0,m.offset=0,m.duration=0,clearTimeout(o),o=setTimeout((()=>{if(!l.value||!d.value||!1===r)return;const e=s(l).width,t=s(d).width;(r||t>e)&&Q((()=>{c=e,u=t,m.offset=-u,m.duration=u/+n}))}),i)};return i(h),z(h),X("pageshow",h),k({reset:h}),G((()=>[e.text,e.scrollable]),h),()=>{const{color:t,wrapable:n,background:o}=e;return j(a("div",{role:"alert",class:Tt({wrapable:n}),style:{color:t,background:o}},[r["left-icon"]?r["left-icon"]():e.leftIcon?a(O,{class:Tt("left-icon"),name:e.leftIcon},null):void 0,w(),f()]),[[H,m.show]])}}});e("N",m(St));const xt=e=>({decode:e.decode.bind(e),encode:e.encode.bind(e)}),Ot=(Bt=8,e=>{const t=Y(Bt,e),{encode:n,decode:r}=xt(t),o=t;return o.decode=(e,t)=>{const n=r(e,t);return J(ee.from(n))},o.encode=(e,t,r)=>{const o=te(e,Bt);return n(o,t,r)},o});var Bt;const Ct=e=>{const t=ne(e),{encode:n,decode:r}=xt(t),o=t;return o.decode=(e,t)=>!!r(e,t),o.encode=(e,t,r)=>{const o=Number(e);return n(o,t,r)},o},qt=e=>{const t=Y(32,e),{encode:n,decode:r}=xt(t),o=t;return o.decode=(e,t)=>{const n=r(e,t);return new re(n)},o.encode=(e,t,r)=>{const o=e.toBuffer();return n(o,t,r)},o};class Pt extends Error{constructor(e){super(e)}}class Et extends Pt{constructor(){super(...arguments),this.name="TokenAccountNotFoundError"}}class Mt extends Pt{constructor(){super(...arguments),this.name="TokenInvalidAccountOwnerError"}}class Lt extends Pt{constructor(){super(...arguments),this.name="TokenInvalidAccountSizeError"}}class Nt extends Pt{constructor(){super(...arguments),this.name="TokenInvalidMintError"}}var Vt;function Rt(e,t,n){if(n.length){e.push({pubkey:t,isSigner:!1,isWritable:!1});for(const t of n)e.push({pubkey:t instanceof re?t:t.publicKey,isSigner:!0,isWritable:!1})}else e.push({pubkey:t,isSigner:!0,isWritable:!1});return e}!function(e){e[e.InitializeMint=0]="InitializeMint",e[e.InitializeAccount=1]="InitializeAccount",e[e.InitializeMultisig=2]="InitializeMultisig",e[e.Transfer=3]="Transfer",e[e.Approve=4]="Approve",e[e.Revoke=5]="Revoke",e[e.SetAuthority=6]="SetAuthority",e[e.MintTo=7]="MintTo",e[e.Burn=8]="Burn",e[e.CloseAccount=9]="CloseAccount",e[e.FreezeAccount=10]="FreezeAccount",e[e.ThawAccount=11]="ThawAccount",e[e.TransferChecked=12]="TransferChecked",e[e.ApproveChecked=13]="ApproveChecked",e[e.MintToChecked=14]="MintToChecked",e[e.BurnChecked=15]="BurnChecked",e[e.InitializeAccount2=16]="InitializeAccount2",e[e.SyncNative=17]="SyncNative",e[e.InitializeAccount3=18]="InitializeAccount3",e[e.InitializeMultisig2=19]="InitializeMultisig2",e[e.InitializeMint2=20]="InitializeMint2",e[e.GetAccountDataSize=21]="GetAccountDataSize",e[e.InitializeImmutableOwner=22]="InitializeImmutableOwner",e[e.AmountToUiAmount=23]="AmountToUiAmount",e[e.UiAmountToAmount=24]="UiAmountToAmount",e[e.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",e[e.TransferFeeExtension=26]="TransferFeeExtension",e[e.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",e[e.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",e[e.Reallocate=29]="Reallocate",e[e.MemoTransferExtension=30]="MemoTransferExtension",e[e.CreateNativeMint=31]="CreateNativeMint",e[e.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",e[e.InterestBearingMintExtension=33]="InterestBearingMintExtension",e[e.CpiGuardExtension=34]="CpiGuardExtension",e[e.InitializePermanentDelegate=35]="InitializePermanentDelegate",e[e.TransferHookExtension=36]="TransferHookExtension",e[e.MetadataPointerExtension=39]="MetadataPointerExtension"}(Vt||(Vt={}));const Ft=oe([ne("instruction")]);var Wt;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Mint=1]="Mint",e[e.Account=2]="Account"}(Wt||(Wt={}));const Dt=oe([ne("m"),ne("n"),Ct("isInitialized"),qt("signer1"),qt("signer2"),qt("signer3"),qt("signer4"),qt("signer5"),qt("signer6"),qt("signer7"),qt("signer8"),qt("signer9"),qt("signer10"),qt("signer11")]).span;var _t;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initialized=1]="Initialized",e[e.Frozen=2]="Frozen"}(_t||(_t={}));const Kt=oe([qt("mint"),qt("owner"),Ot("amount"),ae("delegateOption"),qt("delegate"),ne("state"),ae("isNativeOption"),Ot("isNative"),Ot("delegatedAmount"),ae("closeAuthorityOption"),qt("closeAuthority")]),Ut=Kt.span,zt=oe([ae("mintAuthorityOption"),qt("mintAuthority"),Ot("supply"),ne("decimals"),Ct("isInitialized"),ae("freezeAuthorityOption"),qt("freezeAuthority")]),Xt=zt.span;function Gt(e,t,n=se){if(!t)throw new Et;if(!t.owner.equals(n))throw new Mt;if(t.data.length<Xt)throw new Lt;const r=zt.decode(t.data.slice(0,Xt));let o=ee.alloc(0);if(t.data.length>Xt){if(t.data.length<=Ut)throw new Lt;if(t.data.length===Dt)throw new Lt;if(t.data[Ut]!=Wt.Mint)throw new Nt;o=t.data.slice(Ut+1)}return{address:e,mintAuthority:r.mintAuthorityOption?r.mintAuthority:null,supply:r.supply,decimals:r.decimals,isInitialized:r.isInitialized,freezeAuthority:r.freezeAuthorityOption?r.freezeAuthority:null,tlvData:o}}function jt(e){return oe([Ot("epoch"),Ot("maximumFee"),ce("transferFeeBasisPoints")],e)}BigInt(1e4);const Ht=oe([qt("transferFeeConfigAuthority"),qt("withdrawWithheldAuthority"),Ot("withheldAmount"),jt("olderTransferFee"),jt("newerTransferFee")]);function Qt(e){const t=function(e,t){let n=0;for(;$t(n)<=t.length;){const r=t.readUInt16LE(n),o=t.readUInt16LE(n+2),i=$t(n);if(r==e)return t.slice(i,i+o);n=i+o}return null}(Zt.TransferFeeConfig,e.tlvData);return null!==t?Ht.decode(t):null}var Zt;function $t(e){return e+2+2}Ht.span,oe([Ot("withheldAmount")]).span,function(e){e[e.Uninitialized=0]="Uninitialized",e[e.TransferFeeConfig=1]="TransferFeeConfig",e[e.TransferFeeAmount=2]="TransferFeeAmount",e[e.MintCloseAuthority=3]="MintCloseAuthority",e[e.ConfidentialTransferMint=4]="ConfidentialTransferMint",e[e.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",e[e.DefaultAccountState=6]="DefaultAccountState",e[e.ImmutableOwner=7]="ImmutableOwner",e[e.MemoTransfer=8]="MemoTransfer",e[e.NonTransferable=9]="NonTransferable",e[e.InterestBearingConfig=10]="InterestBearingConfig",e[e.CpiGuard=11]="CpiGuard",e[e.PermanentDelegate=12]="PermanentDelegate",e[e.NonTransferableAccount=13]="NonTransferableAccount",e[e.TransferHook=14]="TransferHook",e[e.TransferHookAccount=15]="TransferHookAccount",e[e.MetadataPointer=18]="MetadataPointer",e[e.TokenMetadata=19]="TokenMetadata"}(Zt||(Zt={}));const Yt=oe([ne("instruction")]);function Jt(e,t,n,r,o=se,i=le){return function(e,t,n,r,o,i=se,s=le){const a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:de.programId,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1}];return new ie({keys:a,programId:s,data:o})}(e,t,n,r,ee.alloc(0),o,i)}const en=oe([ne("instruction"),Ot("amount")]),tn=oe([ne("instruction"),Ot("amount")]),nn=oe([ne("instruction"),ne("decimals"),qt("mintAuthority"),ne("freezeAuthorityOption"),qt("freezeAuthority")]),rn={class:"popup-title"},on={class:"slippage-label"},sn=["onClick"],an={style:{width:"100%"}},cn={class:"radio-group"},un={key:0,style:{flex:"1"}},ln=["id","value"],dn=["for"],mn={class:"slippage-input"},pn=(e=>(Be("data-v-d45994be"),e=e(),Ce(),e))((()=>ge("span",null,"%",-1))),fn={class:"form-submit"},gn=u({__name:"slippage",props:{slippage:null},emits:["update:slippage"],setup(e,{emit:t}){const r=e,{t:o}=me();let i=n(!1),s=n(["0.1","0.5","1"]),c=n(r.slippage||"1");function u(){t("update:slippage",c.value),i.value=!1}function l(){It.alert({title:o("slippage"),message:o("slippageTips"),confirmButtonText:o("iKnown"),confirmButtonColor:"#3F80F7",messageAlign:"left"}).then((()=>{}))}function d(){i.value&&Number(c.value)<0&&(c.value="0")}function m(e){return Number(e)<=49.99}return G(i,(e=>{e&&(c.value=r.slippage||"1")})),(e,t)=>{const n=ve,r=y,p=Se,f=x;return pe(),fe(Ae,null,[ge("i",{class:"iconfont icon-edit clickable",onClick:t[0]||(t[0]=we((e=>Te(i)?i.value=!0:i=!0),["stop"]))}),a(f,{show:ye(i),"onUpdate:show":t[4]||(t[4]=e=>Te(i)?i.value=e:i=e),class:"popup-container",closeable:!0,"close-on-click-overlay":!1,"close-on-popstate":!1,round:"",position:"center",teleport:"#app",style:{width:"90%","min-height":"20vh"}},{default:he((()=>[ge("h3",rn,ke(ye(o)("setSlippage")),1),a(p,{class:"popup-content",onSubmit:u},{default:he((()=>[ge("div",on,[ge("span",null,ke(ye(o)("slippage")),1),ge("i",{class:"iconfont icon-changjianwentixiangguanwenti",onClick:we(l,["stop"]),style:{"font-size":"0.38rem","margin-left":"0.05rem",color:"#3F80F7"}},null,8,sn)]),a(n,{name:"slippage",modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),label:"",style:{"--van-cell-horizontal-padding":"0"},rules:[{required:!0,message:ye(o)("enterSlippage")},{validator:m,message:ye(o)("slippageMaxTip")}],border:!1},{input:he((()=>[ge("div",an,[ge("div",cn,[(pe(!0),fe(Ae,null,Ie(s.value,((e,n)=>(pe(),fe(Ae,{key:n},[0!==n?(pe(),fe("span",un)):xe("",!0),j(ge("input",{type:"radio",id:`radio-${e}`,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),value:e,class:"radio-input"},null,8,ln),[[Oe,c.value]]),ge("label",{for:`radio-${e}`,class:"radio-item"},ke(e)+"%",9,dn)],64)))),128))]),ge("div",mn,[a(n,{class:"input",name:"slippage",type:"number",min:"0",max:"49.99",modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),onBlur:d,clearable:""},null,8,["modelValue"]),pn])])])),_:1},8,["modelValue","rules"]),ge("div",fn,[a(r,{class:"btn",block:"",round:"","native-type":"submit",size:"normal",type:"primary"},{default:he((()=>[be(ke(ye(o)("confirm1")),1)])),_:1})])])),_:1})])),_:1},8,["show"])],64)}}});e("S",qe(gn,[["__scopeId","data-v-d45994be"]]));var wn=1e6,hn=1e6,kn="[big.js] ",yn=kn+"Invalid ",An=yn+"decimal places",In=kn+"Division by zero",bn={},Tn=void 0,vn=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Sn(e,t,n,r){var o=e.c;if(n===Tn&&(n=e.constructor.RM),0!==n&&1!==n&&2!==n&&3!==n)throw Error("[big.js] Invalid rounding mode");if(t<1)r=3===n&&(r||!!o[0])||0===t&&(1===n&&o[0]>=5||2===n&&(o[0]>5||5===o[0]&&(r||o[1]!==Tn))),o.length=1,r?(e.e=e.e-t+1,o[0]=1):o[0]=e.e=0;else if(t<o.length){if(r=1===n&&o[t]>=5||2===n&&(o[t]>5||5===o[t]&&(r||o[t+1]!==Tn||1&o[t-1]))||3===n&&(r||!!o[0]),o.length=t,r)for(;++o[--t]>9;)if(o[t]=0,0===t){++e.e,o.unshift(1);break}for(t=o.length;!o[--t];)o.pop()}return e}function xn(e,t,n){var r=e.e,o=e.c.join(""),i=o.length;if(t)o=o.charAt(0)+(i>1?"."+o.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)o="0"+o;o="0."+o}else if(r>0)if(++r>i)for(r-=i;r--;)o+="0";else r<i&&(o=o.slice(0,r)+"."+o.slice(r));else i>1&&(o=o.charAt(0)+"."+o.slice(1));return e.s<0&&n?"-"+o:o}bn.abs=function(){var e=new this.constructor(this);return e.s=1,e},bn.cmp=function(e){var t,n=this,r=n.c,o=(e=new n.constructor(e)).c,i=n.s,s=e.s,a=n.e,c=e.e;if(!r[0]||!o[0])return r[0]?i:o[0]?-s:0;if(i!=s)return i;if(t=i<0,a!=c)return a>c^t?1:-1;for(s=(a=r.length)<(c=o.length)?a:c,i=-1;++i<s;)if(r[i]!=o[i])return r[i]>o[i]^t?1:-1;return a==c?0:a>c^t?1:-1},bn.div=function(e){var t=this,n=t.constructor,r=t.c,o=(e=new n(e)).c,i=t.s==e.s?1:-1,s=n.DP;if(s!==~~s||s<0||s>wn)throw Error(An);if(!o[0])throw Error(In);if(!r[0])return e.s=i,e.c=[e.e=0],e;var a,c,u,l,d,m=o.slice(),p=a=o.length,f=r.length,g=r.slice(0,a),w=g.length,h=e,k=h.c=[],y=0,A=s+(h.e=t.e-e.e)+1;for(h.s=i,i=A<0?0:A,m.unshift(0);w++<a;)g.push(0);do{for(u=0;u<10;u++){if(a!=(w=g.length))l=a>w?1:-1;else for(d=-1,l=0;++d<a;)if(o[d]!=g[d]){l=o[d]>g[d]?1:-1;break}if(!(l<0))break;for(c=w==a?o:m;w;){if(g[--w]<c[w]){for(d=w;d&&!g[--d];)g[d]=9;--g[d],g[w]+=10}g[w]-=c[w]}for(;!g[0];)g.shift()}k[y++]=l?u:++u,g[0]&&l?g[w]=r[p]||0:g=[r[p]]}while((p++<f||g[0]!==Tn)&&i--);return k[0]||1==y||(k.shift(),h.e--,A--),y>A&&Sn(h,A,n.RM,g[0]!==Tn),h},bn.eq=function(e){return 0===this.cmp(e)},bn.gt=function(e){return this.cmp(e)>0},bn.gte=function(e){return this.cmp(e)>-1},bn.lt=function(e){return this.cmp(e)<0},bn.lte=function(e){return this.cmp(e)<1},bn.minus=bn.sub=function(e){var t,n,r,o,i=this,s=i.constructor,a=i.s,c=(e=new s(e)).s;if(a!=c)return e.s=-c,i.plus(e);var u=i.c.slice(),l=i.e,d=e.c,m=e.e;if(!u[0]||!d[0])return d[0]?e.s=-c:u[0]?e=new s(i):e.s=1,e;if(a=l-m){for((o=a<0)?(a=-a,r=u):(m=l,r=d),r.reverse(),c=a;c--;)r.push(0);r.reverse()}else for(n=((o=u.length<d.length)?u:d).length,a=c=0;c<n;c++)if(u[c]!=d[c]){o=u[c]<d[c];break}if(o&&(r=u,u=d,d=r,e.s=-e.s),(c=(n=d.length)-(t=u.length))>0)for(;c--;)u[t++]=0;for(c=t;n>a;){if(u[--n]<d[n]){for(t=n;t&&!u[--t];)u[t]=9;--u[t],u[n]+=10}u[n]-=d[n]}for(;0===u[--c];)u.pop();for(;0===u[0];)u.shift(),--m;return u[0]||(e.s=1,u=[m=0]),e.c=u,e.e=m,e},bn.mod=function(e){var t,n=this,r=n.constructor,o=n.s,i=(e=new r(e)).s;if(!e.c[0])throw Error(In);return n.s=e.s=1,t=1==e.cmp(n),n.s=o,e.s=i,t?new r(n):(o=r.DP,i=r.RM,r.DP=r.RM=0,n=n.div(e),r.DP=o,r.RM=i,this.minus(n.times(e)))},bn.neg=function(){var e=new this.constructor(this);return e.s=-e.s,e},bn.plus=bn.add=function(e){var t,n,r,o=this,i=o.constructor;if(e=new i(e),o.s!=e.s)return e.s=-e.s,o.minus(e);var s=o.e,a=o.c,c=e.e,u=e.c;if(!a[0]||!u[0])return u[0]||(a[0]?e=new i(o):e.s=o.s),e;if(a=a.slice(),t=s-c){for(t>0?(c=s,r=u):(t=-t,r=a),r.reverse();t--;)r.push(0);r.reverse()}for(a.length-u.length<0&&(r=u,u=a,a=r),t=u.length,n=0;t;a[t]%=10)n=(a[--t]=a[t]+u[t]+n)/10|0;for(n&&(a.unshift(n),++c),t=a.length;0===a[--t];)a.pop();return e.c=a,e.e=c,e},bn.pow=function(e){var t=this,n=new t.constructor("1"),r=n,o=e<0;if(e!==~~e||e<-1e6||e>hn)throw Error(yn+"exponent");for(o&&(e=-e);1&e&&(r=r.times(t)),e>>=1;)t=t.times(t);return o?n.div(r):r},bn.prec=function(e,t){if(e!==~~e||e<1||e>wn)throw Error(yn+"precision");return Sn(new this.constructor(this),e,t)},bn.round=function(e,t){if(e===Tn)e=0;else if(e!==~~e||e<-wn||e>wn)throw Error(An);return Sn(new this.constructor(this),e+this.e+1,t)},bn.sqrt=function(){var e,t,n,r=this,o=r.constructor,i=r.s,s=r.e,a=new o("0.5");if(!r.c[0])return new o(r);if(i<0)throw Error(kn+"No square root");0===(i=Math.sqrt(r+""))||i===1/0?((t=r.c.join("")).length+s&1||(t+="0"),s=((s+1)/2|0)-(s<0||1&s),e=new o(((i=Math.sqrt(t))==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+s)):e=new o(i+""),s=e.e+(o.DP+=4);do{n=e,e=a.times(n.plus(r.div(n)))}while(n.c.slice(0,s).join("")!==e.c.slice(0,s).join(""));return Sn(e,(o.DP-=4)+e.e+1,o.RM)},bn.times=bn.mul=function(e){var t,n=this,r=n.constructor,o=n.c,i=(e=new r(e)).c,s=o.length,a=i.length,c=n.e,u=e.e;if(e.s=n.s==e.s?1:-1,!o[0]||!i[0])return e.c=[e.e=0],e;for(e.e=c+u,s<a&&(t=o,o=i,i=t,u=s,s=a,a=u),t=new Array(u=s+a);u--;)t[u]=0;for(c=a;c--;){for(a=0,u=s+c;u>c;)a=t[u]+i[c]*o[u-c-1]+a,t[u--]=a%10,a=a/10|0;t[u]=a}for(a?++e.e:t.shift(),c=t.length;!t[--c];)t.pop();return e.c=t,e},bn.toExponential=function(e,t){var n=this,r=n.c[0];if(e!==Tn){if(e!==~~e||e<0||e>wn)throw Error(An);for(n=Sn(new n.constructor(n),++e,t);n.c.length<e;)n.c.push(0)}return xn(n,!0,!!r)},bn.toFixed=function(e,t){var n=this,r=n.c[0];if(e!==Tn){if(e!==~~e||e<0||e>wn)throw Error(An);for(e=e+(n=Sn(new n.constructor(n),e+n.e+1,t)).e+1;n.c.length<e;)n.c.push(0)}return xn(n,!1,!!r)},bn[Symbol.for("nodejs.util.inspect.custom")]=bn.toJSON=bn.toString=function(){var e=this,t=e.constructor;return xn(e,e.e<=t.NE||e.e>=t.PE,!!e.c[0])},bn.toNumber=function(){var e=Number(xn(this,!0,!0));if(!0===this.constructor.strict&&!this.eq(e.toString()))throw Error(kn+"Imprecise conversion");return e},bn.toPrecision=function(e,t){var n=this,r=n.constructor,o=n.c[0];if(e!==Tn){if(e!==~~e||e<1||e>wn)throw Error(yn+"precision");for(n=Sn(new r(n),e,t);n.c.length<e;)n.c.push(0)}return xn(n,e<=n.e||n.e<=r.NE||n.e>=r.PE,!!o)},bn.valueOf=function(){var e=this,t=e.constructor;if(!0===t.strict)throw Error(kn+"valueOf disallowed");return xn(e,e.e<=t.NE||e.e>=t.PE,!0)};var On=function e(){function t(n){var r=this;if(!(r instanceof t))return n===Tn?e():new t(n);if(n instanceof t)r.s=n.s,r.e=n.e,r.c=n.c.slice();else{if("string"!=typeof n){if(!0===t.strict&&"bigint"!=typeof n)throw TypeError(yn+"value");n=0===n&&1/n<0?"-0":String(n)}!function(e,t){var n,r,o;if(!vn.test(t))throw Error(yn+"number");for(e.s="-"==t.charAt(0)?(t=t.slice(1),-1):1,(n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),o=t.length,r=0;r<o&&"0"==t.charAt(r);)++r;if(r==o)e.c=[e.e=0];else{for(;o>0&&"0"==t.charAt(--o););for(e.e=n-r-1,e.c=[],n=0;r<=o;)e.c[n++]=+t.charAt(r++)}}(r,n)}r.constructor=t}return t.prototype=bn,t.DP=20,t.RM=1,t.NE=-7,t.PE=21,t.strict=!1,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}();const Bn="1.1.0-beta.6";let Cn=!1,qn=!1;const Pn={debug:1,default:2,info:2,warning:3,error:4,off:5},En={};let Mn;const Ln=function(){try{const e=[];if(["NFD","NFC","NFKD","NFKC"].forEach((t=>{try{if("test"!=="test".normalize(t))throw new Error("bad normalize")}catch(n){e.push(t)}})),e.length)throw new Error("missing "+e.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(e){if(e instanceof Error)return e.message}return""}();var Nn,Vn;!function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.OFF="OFF"}(Nn||(Nn={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",e.NETWORK_ERROR="NETWORK_ERROR",e.RPC_ERROR="RPC_ERROR",e.TIMEOUT="TIMEOUT",e.BUFFER_OVERRUN="BUFFER_OVERRUN",e.NUMERIC_FAULT="NUMERIC_FAULT",e.MISSING_NEW="MISSING_NEW",e.INVALID_ARGUMENT="INVALID_ARGUMENT",e.MISSING_ARGUMENT="MISSING_ARGUMENT",e.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",e.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS"}(Vn||(Vn={}));const Rn="0123456789abcdef";function Fn(e,t=!1){let n=e;try{if(e instanceof Uint8Array){let t="";for(let n=0;n<e.length;n++)t+=Rn[e[n]>>4],t+=Rn[15&e[n]];n=`Uint8Array(0x${t})`}else if(e instanceof re)n=`PublicKey(${e.toBase58()})`;else if(e instanceof Object&&!t){const t={};Object.entries(e).forEach((([e,n])=>{t[e]=Fn(n,!0)})),n=JSON.stringify(t)}else t||(n=JSON.stringify(e))}catch(r){n=JSON.stringify(e.toString())}return n}class Wn{constructor(e){this.version=Bn,this.moduleName=e}_log(e,t){const n=e.toLowerCase();null==Pn[n]&&this.throwArgumentError("invalid log level name","logLevel",e),(En[this.moduleName]||Pn.default)>Pn[n]||console.log(...t)}debug(...e){this._log(Wn.levels.DEBUG,["[DEBUG]",...e])}info(...e){this._log(Wn.levels.INFO,["[INFO]",...e])}warn(...e){this._log(Wn.levels.WARNING,["[WARN]",...e])}makeError(e,t,n){if(qn)return this.makeError("censored error",t,{});t||(t=Wn.errors.UNKNOWN_ERROR),n||(n={});const r=[];Object.entries(n).forEach((([e,t])=>{r.push(`${e}=${Fn(t)})`)})),r.push(`code=${t}`),r.push(`module=${this.moduleName}`),r.push(`version=${this.version}`);const o=e;r.length&&(e+=" ("+r.join(", ")+")");const i=new Error(e);return i.reason=o,i.code=t,Object.entries(n).forEach((([e,t])=>{i[e]=t})),i}throwError(e,t,n){throw this.makeError(e,t,n)}throwArgumentError(e,t,n){return this.throwError(e,Wn.errors.INVALID_ARGUMENT,{argument:t,value:n})}assert(e,t,n,r){e||this.throwError(t,n,r)}assertArgument(e,t,n,r){e||this.throwArgumentError(t,n,r)}checkNormalize(e){Ln&&this.throwError("platform missing String.prototype.normalize",Wn.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:Ln})}checkSafeUint53(e,t){"number"==typeof e&&(null==t&&(t="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(t,Wn.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(t,Wn.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,t,n){n=n?": "+n:"",e<t&&this.throwError("missing argument"+n,Wn.errors.MISSING_ARGUMENT,{count:e,expectedCount:t}),e>t&&this.throwError("too many arguments"+n,Wn.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:t})}checkNew(e,t){e!==Object&&null!=e||this.throwError("missing new",Wn.errors.MISSING_NEW,{name:t.name})}checkAbstract(e,t){e===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",Wn.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):e!==Object&&null!=e||this.throwError("missing new",Wn.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return Mn||(Mn=new Wn(Bn)),Mn}static setCensorship(e,t){if(!e&&t&&this.globalLogger().throwError("cannot permanently disable censorship",Wn.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),Cn){if(!e)return;this.globalLogger().throwError("error censorship permanent",Wn.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}qn=!!e,Cn=!!t}static setLogLevel(e,t){const n=Pn[t.toLowerCase()];null!=n?En[e]=n:Wn.globalLogger().warn("invalid log level - "+t)}static from(e){return new Wn(e)}}Wn.errors=Vn,Wn.levels=Nn;const Dn=Wn.from("common/pubkey"),_n=de.programId,Kn=new re("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Un=new re("SysvarRent111111111111111111111111111111111"),zn=new re("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Xn=new re("Sysvar1nstructions1111111111111111111111111");function Gn(e){if(e instanceof re)return e;if("string"==typeof e)try{return new re(e)}catch{return Dn.throwArgumentError("invalid public key","publicKey",e)}return Dn.throwArgumentError("invalid public key","publicKey",e)}function jn(e,t){const[n,r]=re.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function Hn(e,t){return{pubkey:e,isWritable:!0,isSigner:t}}function Qn(e,t){return{pubkey:e,isWritable:!1,isSigner:t}}function Zn(e,t=1,n=[]){const r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}const $n=Wn.from("common/web3");async function Yn(e,t,n){const{batchRequest:r,commitment:o}={batchRequest:!1,...n},i=Zn(t,100);let s=new Array(i.length).fill([]);if(r){const t=Zn(i.map((t=>({methodName:"getMultipleAccounts",args:e._buildArgs([t.map((e=>e.toBase58()))],o,"base64")}))),10);s=(await(await Promise.all(t.map((async t=>await e._rpcBatchRequest(t))))).flat()).map((e=>e.error?$n.throwError("failed to get info for multiple accounts",Wn.errors.RPC_ERROR,{message:e.error.message}):e.result.value.map((e=>{if(e){const{data:t,executable:n,lamports:r,owner:o,rentEpoch:i}=e;return 2!==t.length&&"base64"!==t[1]?$n.throwError("info must be base64 encoded",Wn.errors.RPC_ERROR):{data:ee.from(t[0],"base64"),executable:n,lamports:r,owner:new re(o),rentEpoch:i}}return null}))))}else try{s=await Promise.all(i.map((t=>e.getMultipleAccountsInfo(t,o))))}catch(a){if(a instanceof Error)return $n.throwError("failed to get info for multiple accounts",Wn.errors.RPC_ERROR,{message:a.message})}return s.flat()}async function Jn(e,t,n){const r=await Yn(e,t.map((e=>e.pubkey)),n);return t.map(((e,t)=>({...e,accountInfo:r[t]})))}function er(e,t){if(e.length<1)return $n.throwArgumentError("no instructions provided","instructions",e);if(t.length<1)return $n.throwArgumentError("no signers provided","signers",t);const n=new Me({recentBlockhash:"11111111111111111111111111111111",feePayer:t[0]});n.add(...e);try{return ee.from(n.serialize({verifySignatures:!1})).toString("base64").length<ir}catch(r){return!1}}async function tr(e,t,n,r=!0){const o=new re("RaydiumSimuLateTransaction11111111111111111"),i=[];let s=new Me;s.feePayer=o;for(const l of t)er([...s.instructions,l],[o])||(i.push(s),s=new Me,s.feePayer=o),s.add(l);s.instructions.length>0&&i.push(s);let a=[];try{if(a=await async function(e,t,n){let r=[];if(n){const n=await e.getLatestBlockhash(),o=[];for(const e of t){e.recentBlockhash=n.blockhash,e.lastValidBlockHeight=n.lastValidBlockHeight;const t=e._compile().serialize(),r=e._serialize(t).toString("base64");o.push(r)}const i=o.map((t=>({methodName:"simulateTransaction",args:e._buildArgs([t],void 0,"base64")}))),s=[],a=20;for(let e=0;e<Math.ceil(i.length/a);e++)s.push(i.slice(e*a,(e+1)*a));r=await(await Promise.all(s.map((async t=>(await e._rpcBatchRequest(t)).map((e=>e.result.value)))))).flat()}else try{r=await Promise.all(t.map((async t=>await(await e.simulateTransaction(t)).value)))}catch(o){if(o instanceof Error)return $n.throwError("failed to get info for multiple accounts",Wn.errors.RPC_ERROR,{message:o.message})}return r}(e,i,r),a.find((e=>null!==e.err)))throw Error("rpc simulateTransaction error")}catch(u){if(u instanceof Error)return $n.throwError("failed to simulate for instructions",Wn.errors.RPC_ERROR,{message:u.message})}const c=[];for(const l of a)if($n.debug("simulate result:",l),l.logs){const e=l.logs.filter((e=>e&&e.includes(n)));$n.debug("filteredLog:",c),$n.assertArgument(0!==e.length,"simulate log not match keyword","keyword",n),c.push(...e)}return c}function nr(e,t){const n=new RegExp(`"${t}":(\\d+)`,"g").exec(e);return n&&2===n.length?n[1]:$n.throwArgumentError("simulate log fail to match key","key",t)}async function rr({connection:e,makeTxVersion:t,innerTransaction:n,lookupTableCache:r,computeBudgetConfig:o,payer:i}){const s=r??{},a=[...new Set(n.map((e=>(e.lookupTableAddress??[]).map((e=>e.toString())))).flat())],c=[];for(const p of a)void 0===s[p]&&c.push(new re(p));const u=await async function({connection:e,address:t}){const n=await Yn(e,[...new Set(t.map((e=>e.toString())))].map((e=>new re(e)))),r={};for(let o=0;o<t.length;o++){const e=n[o],i=t[o];e&&(r[i.toString()]=new Ve({key:i,state:Ve.deserialize(e.data)}))}return r}({connection:e,address:c});for(const[p,f]of Object.entries(u))s[p]=f;const l=o?function(e){const t=[],n=[];return e.microLamports&&(t.push(Ee.setComputeUnitPrice({microLamports:e.microLamports})),n.push(jo.setComputeUnitPrice)),e.units&&(t.push(Ee.setComputeUnitLimit({units:e.units})),n.push(jo.setComputeUnitLimit)),{address:{},innerTransaction:{instructions:t,signers:[],instructionTypes:n}}}(o).innerTransaction:void 0,d=[];let m=[];for(const p of n){if(0===p.instructions.length)continue;const e=[...m,p],n=l?[l,...e]:e;if(m.length<12&&(or({makeTxVersion:t,innerIns:n,payer:i,lookupTableAddressAccount:s})||or({makeTxVersion:t,innerIns:e,payer:i,lookupTableAddressAccount:s})))m.push(p);else{if(0===m.length)throw Error(" item ins too big ");let e;if(t===Go.V0){e={};for(const t of[...new Set(m.map((e=>e.lookupTableAddress??[])).flat().map((e=>e.toString())))])void 0!==s[t]&&(e[t]=s[t])}if(or({makeTxVersion:t,innerIns:l?[l,...m]:m,payer:i,lookupTableAddressAccount:s})){const t=l?[l,...m]:m;d.push({instructionTypes:t.map((e=>e.instructionTypes)).flat(),instructions:t.map((e=>e.instructions)).flat(),signers:m.map((e=>e.signers)).flat(),lookupTableAddress:e})}else d.push({instructionTypes:m.map((e=>e.instructionTypes)).flat(),instructions:m.map((e=>e.instructions)).flat(),signers:m.map((e=>e.signers)).flat(),lookupTableAddress:e});m=[p]}}if(m.length>0){let e;if(t===Go.V0){e={};for(const t of[...new Set(m.map((e=>e.lookupTableAddress??[])).flat().map((e=>e.toString())))])void 0!==s[t]&&(e[t]=s[t])}if(or({makeTxVersion:t,innerIns:l?[l,...m]:m,payer:i,lookupTableAddressAccount:s})){const t=l?[l,...m]:m;d.push({instructionTypes:t.map((e=>e.instructionTypes)).flat(),instructions:t.map((e=>e.instructions)).flat(),signers:m.map((e=>e.signers)).flat(),lookupTableAddress:e})}else d.push({instructionTypes:m.map((e=>e.instructionTypes)).flat(),instructions:m.map((e=>e.instructions)).flat(),signers:m.map((e=>e.signers)).flat(),lookupTableAddress:e})}return d}function or({makeTxVersion:e,innerIns:t,payer:n,lookupTableAddressAccount:r}){const o=t.map((e=>e.instructions)).flat(),i=[...new Set(t.map((e=>e.signers)).flat().map((e=>e.publicKey.toString())))].map((e=>new re(e))),s=t.map((e=>e.lookupTableAddress??[])).flat().map((e=>e.toString())),a={},c=r??{};for(const u of s)void 0!==c[u]&&(a[u]=c[u]);return e===Go.V0?function({instructions:e,payer:t,lookupTableAddressAccount:n}){const r=new Le({payerKey:t,recentBlockhash:Ne.generate().publicKey.toString(),instructions:e}).compileToV0Message(Object.values(n??{}));try{return ee.from(r.serialize()).toString("base64").length<ir}catch(o){return!1}}({instructions:o,payer:n,lookupTableAddressAccount:a}):function({instructions:e,payer:t,signers:n}){return er(e,[t,...n])}({instructions:o,payer:n,signers:i})}const ir=1644;var sr;!function(e){e[e.ROUND_DOWN=0]="ROUND_DOWN",e[e.ROUND_HALF_UP=1]="ROUND_HALF_UP",e[e.ROUND_UP=2]="ROUND_UP"}(sr||(sr={}));const ar=new Re(0),cr=new Re(1);new Re(2),new Re(3),new Re(5);const ur=new Re(10),lr=new Re(100);new Re(1e3),new Re(1e4);const dr=Wn.from("entity/bignumber"),mr=9007199254740991;function pr(e){return e instanceof Re?e:"string"==typeof e?e.match(/^-?[0-9]+$/)?new Re(e):dr.throwArgumentError("invalid BigNumberish string","value",e):"number"==typeof e?e%1?dr.throwArgumentError("BigNumberish number underflow","value",e):e>=mr||e<=-mr?dr.throwArgumentError("BigNumberish number overflow","value",e):new Re(String(e)):"bigint"==typeof e?new Re(e.toString()):dr.throwArgumentError("invalid BigNumberish value","value",e)}function fr(e){return ur.pow(pr(e))}function gr(e,t){const n=e.divmod(t);return n.mod.isZero()?n.div:n.div.isNeg()?n.div.isubn(1):n.div.iaddn(1)}const wr="SOL",hr="Solana",kr=9,yr="So11111111111111111111111111111111111111112",Ar=9;class Ir{constructor(e,t="UNKNOWN",n="UNKNOWN"){this.decimals=e,this.symbol=t,this.name=n}}Ir.SOL=new Ir(kr,wr,hr);class br extends Ir{constructor(e,t,n,r="UNKNOWN",o="UNKNOWN"){super(n,r,o),this.programId=Gn(e),this.mint=Gn(t)}equals(e){return this===e||this.mint.equals(e.mint)}}function Tr(e,t){return e instanceof br&&t instanceof br?e.equals(t):!(e instanceof br||t instanceof br)&&e===t}e("T",br),br.WSOL=new br(se,yr,Ar,wr,hr);var vr,Sr=1e9,xr=!0,Or="[DecimalError] ",Br="[DecimalError] Invalid argument: ",Cr="[DecimalError] Exponent out of range: ",qr=Math.floor,Pr=Math.pow,Er=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Mr=1e7,Lr=9007199254740991,Nr=qr(1286742750677284.5),Vr={};function Rr(e,t){var n,r,o,i,s,a,c,u,l=e.constructor,d=l.precision;if(!e.s||!t.s)return t.s||(t=new l(e)),xr?jr(t,d):t;if(c=e.d,u=t.d,s=e.e,o=t.e,c=c.slice(),i=s-o){for(i<0?(r=c,i=-i,a=u.length):(r=u,o=s,a=c.length),i>(a=(s=Math.ceil(d/7))>a?s+1:a+1)&&(i=a,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((a=c.length)-(i=u.length)<0&&(i=a,r=u,u=c,c=r),n=0;i;)n=(c[--i]=c[i]+u[i]+n)/Mr|0,c[i]%=Mr;for(n&&(c.unshift(n),++o),a=c.length;0==c[--a];)c.pop();return t.d=c,t.e=o,xr?jr(t,d):t}function Fr(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Br+e)}function Wr(e){var t,n,r,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)(n=7-(r=e[t]+"").length)&&(i+=zr(n)),i+=r;(n=7-(r=(s=e[t])+"").length)&&(i+=zr(n))}else if(0===s)return"0";for(;s%10==0;)s/=10;return i+s}Vr.absoluteValue=Vr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},Vr.comparedTo=Vr.cmp=function(e){var t,n,r,o,i=this;if(e=new i.constructor(e),i.s!==e.s)return i.s||-e.s;if(i.e!==e.e)return i.e>e.e^i.s<0?1:-1;for(t=0,n=(r=i.d.length)<(o=e.d.length)?r:o;t<n;++t)if(i.d[t]!==e.d[t])return i.d[t]>e.d[t]^i.s<0?1:-1;return r===o?0:r>o^i.s<0?1:-1},Vr.decimalPlaces=Vr.dp=function(){var e=this,t=e.d.length-1,n=7*(t-e.e);if(t=e.d[t])for(;t%10==0;t/=10)n--;return n<0?0:n},Vr.dividedBy=Vr.div=function(e){return Dr(this,new this.constructor(e))},Vr.dividedToIntegerBy=Vr.idiv=function(e){var t=this.constructor;return jr(Dr(this,new t(e),0,1),t.precision)},Vr.equals=Vr.eq=function(e){return!this.cmp(e)},Vr.exponent=function(){return Kr(this)},Vr.greaterThan=Vr.gt=function(e){return this.cmp(e)>0},Vr.greaterThanOrEqualTo=Vr.gte=function(e){return this.cmp(e)>=0},Vr.isInteger=Vr.isint=function(){return this.e>this.d.length-2},Vr.isNegative=Vr.isneg=function(){return this.s<0},Vr.isPositive=Vr.ispos=function(){return this.s>0},Vr.isZero=function(){return 0===this.s},Vr.lessThan=Vr.lt=function(e){return this.cmp(e)<0},Vr.lessThanOrEqualTo=Vr.lte=function(e){return this.cmp(e)<1},Vr.logarithm=Vr.log=function(e){var t,n=this,r=n.constructor,o=r.precision,i=o+5;if(void 0===e)e=new r(10);else if((e=new r(e)).s<1||e.eq(vr))throw Error("[DecimalError] NaN");if(n.s<1)throw Error(Or+(n.s?"NaN":"-Infinity"));return n.eq(vr)?new r(0):(xr=!1,t=Dr(Xr(n,i),Xr(e,i),i),xr=!0,jr(t,o))},Vr.minus=Vr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Hr(t,e):Rr(t,(e.s=-e.s,e))},Vr.modulo=Vr.mod=function(e){var t,n=this,r=n.constructor,o=r.precision;if(!(e=new r(e)).s)throw Error("[DecimalError] NaN");return n.s?(xr=!1,t=Dr(n,e,0,1).times(e),xr=!0,n.minus(t)):jr(new r(n),o)},Vr.naturalExponential=Vr.exp=function(){return _r(this)},Vr.naturalLogarithm=Vr.ln=function(){return Xr(this)},Vr.negated=Vr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},Vr.plus=Vr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Rr(t,e):Hr(t,(e.s=-e.s,e))},Vr.precision=Vr.sd=function(e){var t,n,r,o=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(Br+e);if(t=Kr(o)+1,n=7*(r=o.d.length-1)+1,r=o.d[r]){for(;r%10==0;r/=10)n--;for(r=o.d[0];r>=10;r/=10)n++}return e&&t>n?t:n},Vr.squareRoot=Vr.sqrt=function(){var e,t,n,r,o,i,s,a=this,c=a.constructor;if(a.s<1){if(!a.s)return new c(0);throw Error("[DecimalError] NaN")}for(e=Kr(a),xr=!1,0==(o=Math.sqrt(+a))||o==1/0?(((t=Wr(a.d)).length+e)%2==0&&(t+="0"),o=Math.sqrt(t),e=qr((e+1)/2)-(e<0||e%2),r=new c(t=o==1/0?"5e"+e:(t=o.toExponential()).slice(0,t.indexOf("e")+1)+e)):r=new c(o.toString()),o=s=(n=c.precision)+3;;)if(r=(i=r).plus(Dr(a,i,s+2)).times(.5),Wr(i.d).slice(0,s)===(t=Wr(r.d)).slice(0,s)){if(t=t.slice(s-3,s+1),o==s&&"4999"==t){if(jr(i,n+1,0),i.times(i).eq(a)){r=i;break}}else if("9999"!=t)break;s+=4}return xr=!0,jr(r,n)},Vr.times=Vr.mul=function(e){var t,n,r,o,i,s,a,c,u,l=this,d=l.constructor,m=l.d,p=(e=new d(e)).d;if(!l.s||!e.s)return new d(0);for(e.s*=l.s,n=l.e+e.e,(c=m.length)<(u=p.length)&&(i=m,m=p,p=i,s=c,c=u,u=s),i=[],r=s=c+u;r--;)i.push(0);for(r=u;--r>=0;){for(t=0,o=c+r;o>r;)a=i[o]+p[r]*m[o-r-1]+t,i[o--]=a%Mr|0,t=a/Mr|0;i[o]=(i[o]+t)%Mr|0}for(;!i[--s];)i.pop();return t?++n:i.shift(),e.d=i,e.e=n,xr?jr(e,d.precision):e},Vr.toDecimalPlaces=Vr.todp=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(Fr(e,0,Sr),void 0===t?t=r.rounding:Fr(t,0,8),jr(n,e+Kr(n)+1,t))},Vr.toExponential=function(e,t){var n,r=this,o=r.constructor;return void 0===e?n=Qr(r,!0):(Fr(e,0,Sr),void 0===t?t=o.rounding:Fr(t,0,8),n=Qr(r=jr(new o(r),e+1,t),!0,e+1)),n},Vr.toFixed=function(e,t){var n,r,o=this,i=o.constructor;return void 0===e?Qr(o):(Fr(e,0,Sr),void 0===t?t=i.rounding:Fr(t,0,8),n=Qr((r=jr(new i(o),e+Kr(o)+1,t)).abs(),!1,e+Kr(r)+1),o.isneg()&&!o.isZero()?"-"+n:n)},Vr.toInteger=Vr.toint=function(){var e=this,t=e.constructor;return jr(new t(e),Kr(e)+1,t.rounding)},Vr.toNumber=function(){return+this},Vr.toPower=Vr.pow=function(e){var t,n,r,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!e.s)return new c(vr);if(!(a=new c(a)).s){if(e.s<1)throw Error("[DecimalError] Infinity");return a}if(a.eq(vr))return a;if(r=c.precision,e.eq(vr))return jr(a,r);if(s=(t=e.e)>=(n=e.d.length-1),i=a.s,s){if((n=u<0?-u:u)<=Lr){for(o=new c(vr),t=Math.ceil(r/7+4),xr=!1;n%2&&Zr((o=o.times(a)).d,t),0!==(n=qr(n/2));)Zr((a=a.times(a)).d,t);return xr=!0,e.s<0?new c(vr).div(o):jr(o,r)}}else if(i<0)throw Error("[DecimalError] NaN");return i=i<0&&1&e.d[Math.max(t,n)]?-1:1,a.s=1,xr=!1,o=e.times(Xr(a,r+12)),xr=!0,(o=_r(o)).s=i,o},Vr.toPrecision=function(e,t){var n,r,o=this,i=o.constructor;return void 0===e?r=Qr(o,(n=Kr(o))<=i.toExpNeg||n>=i.toExpPos):(Fr(e,1,Sr),void 0===t?t=i.rounding:Fr(t,0,8),r=Qr(o=jr(new i(o),e,t),e<=(n=Kr(o))||n<=i.toExpNeg,e)),r},Vr.toSignificantDigits=Vr.tosd=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(Fr(e,1,Sr),void 0===t?t=n.rounding:Fr(t,0,8)),jr(new n(this),e,t)},Vr.toString=Vr.valueOf=Vr.val=Vr.toJSON=Vr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Kr(e),n=e.constructor;return Qr(e,t<=n.toExpNeg||t>=n.toExpPos)};var Dr=function(){function e(e,t){var n,r=0,o=e.length;for(e=e.slice();o--;)n=e[o]*t+r,e[o]=n%Mr|0,r=n/Mr|0;return r&&e.unshift(r),e}function t(e,t,n,r){var o,i;if(n!=r)i=n>r?1:-1;else for(o=i=0;o<n;o++)if(e[o]!=t[o]){i=e[o]>t[o]?1:-1;break}return i}function n(e,t,n){for(var r=0;n--;)e[n]-=r,r=e[n]<t[n]?1:0,e[n]=r*Mr+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(r,o,i,s){var a,c,u,l,d,m,p,f,g,w,h,k,y,A,I,b,T,v,S=r.constructor,x=r.s==o.s?1:-1,O=r.d,B=o.d;if(!r.s)return new S(r);if(!o.s)throw Error("[DecimalError] Division by zero");for(c=r.e-o.e,T=B.length,I=O.length,f=(p=new S(x)).d=[],u=0;B[u]==(O[u]||0);)++u;if(B[u]>(O[u]||0)&&--c,(k=null==i?i=S.precision:s?i+(Kr(r)-Kr(o))+1:i)<0)return new S(0);if(k=k/7+2|0,u=0,1==T)for(l=0,B=B[0],k++;(u<I||l)&&k--;u++)y=l*Mr+(O[u]||0),f[u]=y/B|0,l=y%B|0;else{for((l=Mr/(B[0]+1)|0)>1&&(B=e(B,l),O=e(O,l),T=B.length,I=O.length),A=T,w=(g=O.slice(0,T)).length;w<T;)g[w++]=0;(v=B.slice()).unshift(0),b=B[0],B[1]>=5e6&&++b;do{l=0,(a=t(B,g,T,w))<0?(h=g[0],T!=w&&(h=h*Mr+(g[1]||0)),(l=h/b|0)>1?(l>=Mr&&(l=9999999),1==(a=t(d=e(B,l),g,m=d.length,w=g.length))&&(l--,n(d,T<m?v:B,m))):(0==l&&(a=l=1),d=B.slice()),(m=d.length)<w&&d.unshift(0),n(g,d,w),-1==a&&(a=t(B,g,T,w=g.length))<1&&(l++,n(g,T<w?v:B,w)),w=g.length):0===a&&(l++,g=[0]),f[u++]=l,a&&g[0]?g[w++]=O[A]||0:(g=[O[A]],w=1)}while((A++<I||void 0!==g[0])&&k--)}return f[0]||f.shift(),p.e=c,jr(p,s?i+Kr(p)+1:i)}}();function _r(e,t){var n,r,o,i,s,a=0,c=0,u=e.constructor,l=u.precision;if(Kr(e)>16)throw Error(Cr+Kr(e));if(!e.s)return new u(vr);for(null==t?(xr=!1,s=l):s=t,i=new u(.03125);e.abs().gte(.1);)e=e.times(i),c+=5;for(s+=Math.log(Pr(2,c))/Math.LN10*2+5|0,n=r=o=new u(vr),u.precision=s;;){if(r=jr(r.times(e),s),n=n.times(++a),Wr((i=o.plus(Dr(r,n,s))).d).slice(0,s)===Wr(o.d).slice(0,s)){for(;c--;)o=jr(o.times(o),s);return u.precision=l,null==t?(xr=!0,jr(o,l)):o}o=i}}function Kr(e){for(var t=7*e.e,n=e.d[0];n>=10;n/=10)t++;return t}function Ur(e,t,n){if(t>e.LN10.sd())throw xr=!0,n&&(e.precision=n),Error("[DecimalError] LN10 precision limit exceeded");return jr(new e(e.LN10),t)}function zr(e){for(var t="";e--;)t+="0";return t}function Xr(e,t){var n,r,o,i,s,a,c,u,l,d=1,m=e,p=m.d,f=m.constructor,g=f.precision;if(m.s<1)throw Error(Or+(m.s?"NaN":"-Infinity"));if(m.eq(vr))return new f(0);if(null==t?(xr=!1,u=g):u=t,m.eq(10))return null==t&&(xr=!0),Ur(f,u);if(u+=10,f.precision=u,r=(n=Wr(p)).charAt(0),i=Kr(m),!(Math.abs(i)<15e14))return c=Ur(f,u+2,g).times(i+""),m=Xr(new f(r+"."+n.slice(1)),u-10).plus(c),f.precision=g,null==t?(xr=!0,jr(m,g)):m;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=Wr((m=m.times(e)).d)).charAt(0),d++;for(i=Kr(m),r>1?(m=new f("0."+n),i++):m=new f(r+"."+n.slice(1)),a=s=m=Dr(m.minus(vr),m.plus(vr),u),l=jr(m.times(m),u),o=3;;){if(s=jr(s.times(l),u),Wr((c=a.plus(Dr(s,new f(o),u))).d).slice(0,u)===Wr(a.d).slice(0,u))return a=a.times(2),0!==i&&(a=a.plus(Ur(f,u+2,g).times(i+""))),a=Dr(a,new f(d),u),f.precision=g,null==t?(xr=!0,jr(a,g)):a;a=c,o+=2}}function Gr(e,t){var n,r,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);)++r;for(o=t.length;48===t.charCodeAt(o-1);)--o;if(t=t.slice(r,o)){if(o-=r,n=n-r-1,e.e=qr(n/7),e.d=[],r=(n+1)%7,n<0&&(r+=7),r<o){for(r&&e.d.push(+t.slice(0,r)),o-=7;r<o;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=o;for(;r--;)t+="0";if(e.d.push(+t),xr&&(e.e>Nr||e.e<-Nr))throw Error(Cr+n)}else e.s=0,e.e=0,e.d=[0];return e}function jr(e,t,n){var r,o,i,s,a,c,u,l,d=e.d;for(s=1,i=d[0];i>=10;i/=10)s++;if((r=t-s)<0)r+=7,o=t,u=d[l=0];else{if((l=Math.ceil((r+1)/7))>=(i=d.length))return e;for(u=i=d[l],s=1;i>=10;i/=10)s++;o=(r%=7)-7+s}if(void 0!==n&&(a=u/(i=Pr(10,s-o-1))%10|0,c=t<0||void 0!==d[l+1]||u%i,c=n<4?(a||c)&&(0==n||n==(e.s<0?3:2)):a>5||5==a&&(4==n||c||6==n&&(r>0?o>0?u/Pr(10,s-o):0:d[l-1])%10&1||n==(e.s<0?8:7))),t<1||!d[0])return c?(i=Kr(e),d.length=1,t=t-i-1,d[0]=Pr(10,(7-t%7)%7),e.e=qr(-t/7)||0):(d.length=1,d[0]=e.e=e.s=0),e;if(0==r?(d.length=l,i=1,l--):(d.length=l+1,i=Pr(10,7-r),d[l]=o>0?(u/Pr(10,s-o)%Pr(10,o)|0)*i:0),c)for(;;){if(0==l){(d[0]+=i)==Mr&&(d[0]=1,++e.e);break}if(d[l]+=i,d[l]!=Mr)break;d[l--]=0,i=1}for(r=d.length;0===d[--r];)d.pop();if(xr&&(e.e>Nr||e.e<-Nr))throw Error(Cr+Kr(e));return e}function Hr(e,t){var n,r,o,i,s,a,c,u,l,d,m=e.constructor,p=m.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new m(e),xr?jr(t,p):t;if(c=e.d,d=t.d,r=t.e,u=e.e,c=c.slice(),s=u-r){for((l=s<0)?(n=c,s=-s,a=d.length):(n=d,r=u,a=c.length),s>(o=Math.max(Math.ceil(p/7),a)+2)&&(s=o,n.length=1),n.reverse(),o=s;o--;)n.push(0);n.reverse()}else{for((l=(o=c.length)<(a=d.length))&&(a=o),o=0;o<a;o++)if(c[o]!=d[o]){l=c[o]<d[o];break}s=0}for(l&&(n=c,c=d,d=n,t.s=-t.s),a=c.length,o=d.length-a;o>0;--o)c[a++]=0;for(o=d.length;o>s;){if(c[--o]<d[o]){for(i=o;i&&0===c[--i];)c[i]=9999999;--c[i],c[o]+=Mr}c[o]-=d[o]}for(;0===c[--a];)c.pop();for(;0===c[0];c.shift())--r;return c[0]?(t.d=c,t.e=r,xr?jr(t,p):t):new m(0)}function Qr(e,t,n){var r,o=Kr(e),i=Wr(e.d),s=i.length;return t?(n&&(r=n-s)>0?i=i.charAt(0)+"."+i.slice(1)+zr(r):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(o<0?"e":"e+")+o):o<0?(i="0."+zr(-o-1)+i,n&&(r=n-s)>0&&(i+=zr(r))):o>=s?(i+=zr(o+1-s),n&&(r=n-o-1)>0&&(i=i+"."+zr(r))):((r=o+1)<s&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-s)>0&&(o+1===s&&(i+="."),i+=zr(r))),e.s<0?"-"+i:i}function Zr(e,t){if(e.length>t)return e.length=t,!0}function $r(e){if(!e||"object"!=typeof e)throw Error("[DecimalError] Object expected");var t,n,r,o=["precision",1,Sr,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<o.length;t+=3)if(void 0!==(r=e[n=o[t]])){if(!(qr(r)===r&&r>=o[t+1]&&r<=o[t+2]))throw Error(Br+n+": "+r);this[n]=r}if(void 0!==(r=e[n="LN10"])){if(r!=Math.LN10)throw Error(Br+n+": "+r);this[n]=new this(r)}return this}var Yr=function e(t){var n,r,o;function i(e){var t=this;if(!(t instanceof i))return new i(e);if(t.constructor=i,e instanceof i)return t.s=e.s,t.e=e.e,void(t.d=(e=e.d)?e.slice():e);if("number"==typeof e){if(0*e!=0)throw Error(Br+e);if(e>0)t.s=1;else{if(!(e<0))return t.s=0,t.e=0,void(t.d=[0]);e=-e,t.s=-1}return e===~~e&&e<1e7?(t.e=0,void(t.d=[e])):Gr(t,e.toString())}if("string"!=typeof e)throw Error(Br+e);if(45===e.charCodeAt(0)?(e=e.slice(1),t.s=-1):t.s=1,!Er.test(e))throw Error(Br+e);Gr(t,e)}if(i.prototype=Vr,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=e,i.config=i.set=$r,void 0===t&&(t={}),t)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<o.length;)t.hasOwnProperty(r=o[n++])||(t[r]=this[r]);return i.config(t),i}({precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"});vr=new Yr(1);const Jr=Yr;var eo={exports:{}};!function(e){e.exports&&(e.exports=function(e){return e.prototype.toFormat=function(e,t,n){if(!this.e&&0!==this.e)return this.toString();var r,o,i,s,a,c,u,l,d,m,p,f,g,w,h,k=this.format||{},y=this.constructor.format||{};if(e!=a?"object"==typeof e?(n=e,e=a):t!=a?"object"==typeof t?(n=t,t=a):"object"!=typeof n&&(n={}):n={}:n={},l=(r=this.toFixed(e,t).split("."))[0],d=r[1],c=(u=this.s<0?l.slice(1):l).length,(m=n.decimalSeparator)==a&&(m=k.decimalSeparator)==a&&(m=y.decimalSeparator)==a&&(m="."),(p=n.groupSeparator)==a&&(p=k.groupSeparator)==a&&(p=y.groupSeparator),p&&((f=n.groupSize)==a&&(f=k.groupSize)==a&&(f=y.groupSize)==a&&(f=0),(g=n.secondaryGroupSize)==a&&(g=k.secondaryGroupSize)==a&&(g=y.secondaryGroupSize)==a&&(g=0),g?(o=+g,c-=i=+f):(o=+f,i=+g),o>0&&c>0)){for(s=c%o||o,l=u.substr(0,s);s<c;s+=o)l+=p+u.substr(s,o);i>0&&(l+=p+u.slice(s)),this.s<0&&(l="-"+l)}return d?((w=n.fractionGroupSeparator)==a&&(w=k.fractionGroupSeparator)==a&&(w=y.fractionGroupSeparator),w&&((h=n.fractionGroupSize)==a&&(h=k.fractionGroupSize)==a&&(h=y.fractionGroupSize)==a&&(h=0),(h=+h)&&(d=d.replace(new RegExp("\\d{"+h+"}\\B","g"),"$&"+w))),l+m+d):l},e.format={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:"",fractionGroupSize:0},e})}(eo);const to=Fe(eo.exports),no=Wn.from("entity/fraction"),ro=to(On),oo=to(Jr),io={[sr.ROUND_DOWN]:oo.ROUND_DOWN,[sr.ROUND_HALF_UP]:oo.ROUND_HALF_UP,[sr.ROUND_UP]:oo.ROUND_UP},so={[sr.ROUND_DOWN]:ro.roundDown,[sr.ROUND_HALF_UP]:ro.roundHalfUp,[sr.ROUND_UP]:ro.roundUp};class ao{constructor(e,t=cr){this.numerator=pr(e),this.denominator=pr(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ao(this.denominator,this.numerator)}add(e){const t=e instanceof ao?e:new ao(pr(e));return this.denominator.eq(t.denominator)?new ao(this.numerator.add(t.numerator),this.denominator):new ao(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){const t=e instanceof ao?e:new ao(pr(e));return this.denominator.eq(t.denominator)?new ao(this.numerator.sub(t.numerator),this.denominator):new ao(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){const t=e instanceof ao?e:new ao(pr(e));return new ao(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){const t=e instanceof ao?e:new ao(pr(e));return new ao(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=sr.ROUND_HALF_UP){no.assert(Number.isInteger(e),`${e} is not an integer.`),no.assert(e>0,`${e} is not positive.`),oo.set({precision:e+1,rounding:io[n]});const r=new oo(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=sr.ROUND_HALF_UP){return no.assert(Number.isInteger(e),`${e} is not an integer.`),no.assert(e>=0,`${e} is negative.`),ro.DP=e,ro.RM=so[n],new ro(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}}const co=Wn.from("entity/amount"),uo=to(On);class lo extends ao{constructor(e,t,n=!0){let r=new Re(0);const o=ur.pow(new Re(e.decimals));if(n)r=pr(t);else{let n=new Re(0),i=new Re(0);if("string"==typeof t||"number"==typeof t||"bigint"==typeof t){const[r,o]=function(e,t){let n="0",r="0";if(e.includes(".")){const o=e.split(".");if(2!==o.length)return co.throwArgumentError("invalid number string","num",e);[n,r]=o,r=r.padEnd(t,"0")}else n=e;return[n,r.slice(0,t)||r]}(t.toString(),e.decimals);n=pr(r),i=pr(o)}n=n.mul(o),r=n.add(i)}super(r,o),this.currency=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return co.assert(Tr(this.currency,e.currency),"gt currency not equals"),this.raw.gt(e.raw)}lt(e){return co.assert(Tr(this.currency,e.currency),"lt currency not equals"),this.raw.lt(e.raw)}add(e){return co.assert(Tr(this.currency,e.currency),"add currency not equals"),new lo(this.currency,this.raw.add(e.raw))}sub(e){return co.assert(Tr(this.currency,e.currency),"sub currency not equals"),new lo(this.currency,this.raw.sub(e.raw))}toSignificant(e=this.currency.decimals,t,n=sr.ROUND_DOWN){return super.toSignificant(e,t,n)}toFixed(e=this.currency.decimals,t,n=sr.ROUND_DOWN){return co.assert(e<=this.currency.decimals,"decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return uo.DP=this.currency.decimals,new uo(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}}class mo extends lo{constructor(e,t,n=!0){super(e,t,n),this.token=e}add(e){return co.assert(Tr(this.token,e.token),"add token not equals"),new mo(this.token,this.raw.add(e.raw))}subtract(e){return co.assert(Tr(this.token,e.token),"sub token not equals"),new mo(this.token,this.raw.sub(e.raw))}}e("a",mo);const po=new ao(lr);class fo extends ao{toSignificant(e=5,t,n){return this.mul(po).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(po).toFixed(e,t,n)}}e("P",fo);const go=Wn.from("entity/price");class wo extends ao{constructor(e,t,n,r){super(r,t),this.baseCurrency=e,this.quoteCurrency=n,this.scalar=new ao(fr(e.decimals),fr(n.decimals))}get raw(){return new ao(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new wo(this.quoteCurrency,this.numerator,this.baseCurrency,this.denominator)}mul(e){go.assert(Tr(this.quoteCurrency,e.baseCurrency),"mul currency not equals");const t=super.mul(e);return new wo(this.baseCurrency,t.denominator,e.quoteCurrency,t.numerator)}toSignificant(e=this.quoteCurrency.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteCurrency.decimals,t,n){return this.adjusted.toFixed(e,t,n)}}const ho=Ke,ko=Ue,yo=De,Ao=ne,Io=ce,bo=ae,To=We,vo=_e,So=Y,xo=ze;class Oo extends ho{constructor(e,t,n){super(e,n),this.blob=So(e),this.signed=t}decode(e,t=0){const n=new Re(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(8*this.span).clone():n}encode(e,t,n=0){return"number"==typeof e&&(e=new Re(e)),this.signed&&(e=e.toTwos(8*this.span)),this.blob.encode(e.toArrayLike(ee,"le",this.span),t,n)}}class Bo extends ho{constructor(e){super(8,e),this._lower=xo(bo(),!1),this._upper=xo(bo(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,t=0){return{...this._lower.decode(e,t),...this._upper.decode(e,t+this._lower.span)}}encode(e,t,n=0){return this._lower.encode(e,t,n)+this._upper.encode(e,t,n+this._lower.span)}}function Co(e){return new yo(1,e)}function qo(e){return new yo(4,e)}function Po(e){return new Oo(8,!1,e)}function Eo(e){return new Oo(16,!1,e)}function Mo(e){return new Oo(8,!0,e)}class Lo extends ho{constructor(e,t,n,r){super(e.span,r),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}}function No(e){return new Lo(So(32),(e=>new re(e)),(e=>e.toBuffer()),e)}function Vo(e){return new Lo(Ao(),Ro,Fo,e)}function Ro(e){if(0===e)return!1;if(1===e)return!0;throw new Error("Invalid bool: "+e)}function Fo(e){return e?1:0}class Wo extends ko{decode(e,t){return super.decode(e,t)}}function Do(e,t,n){return new Wo(e,t,n)}function _o(e,t,n){let r;const o="number"==typeof t?t:Pe.isBN(t)?t.toNumber():new Proxy(t,{get(e,t){if(!r){const t=Reflect.get(e,"count");r=Pe.isBN(t)?t.toNumber():t,Reflect.set(e,"count",r)}return Reflect.get(e,t)},set:(e,t,n)=>("count"===t&&(r=n),Reflect.set(e,t,n))});return vo(e,o,n)}const Ko=Do([qo("mintAuthorityOption"),No("mintAuthority"),Po("supply"),Co("decimals"),Co("isInitialized"),qo("freezeAuthorityOption"),No("freezeAuthority")]),Uo=Do([No("mint"),No("owner"),Po("amount"),qo("delegateOption"),No("delegate"),Co("state"),qo("isNativeOption"),Po("isNative"),Po("delegatedAmount"),qo("closeAuthorityOption"),No("closeAuthority")]);function zo(e,t,n){return jn([e.toBuffer(),n.toBuffer(),t.toBuffer()],new re("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}class Xo{static getAssociatedTokenAccount({mint:e,owner:t,programId:n}){return zo(t,e,n).publicKey}static makeCreateAssociatedTokenAccountInstruction({programId:e,mint:t,associatedAccount:n,owner:r,payer:o,instructionsType:i}){return i.push(jo.createATA),Jt(o,n,r,t,e)}static async makeCreateWrappedNativeAccountInstructions({connection:e,owner:t,payer:n,amount:r,commitment:o}){const i=[],s=[],a=await e.getMinimumBalanceForRentExemption(Uo.span,o),c=pr(r).add(new Re(a)),u=Qo({fromPublicKey:n,programId:se});return i.push(de.createAccountWithSeed({fromPubkey:n,basePubkey:n,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:Uo.span,programId:se})),s.push(jo.createAccount),i.push(this.makeInitAccountInstruction({programId:se,mint:Gn(yr),tokenAccount:u.publicKey,owner:t,instructionTypes:s})),{address:{newAccount:u.publicKey},innerTransaction:{instructions:i,signers:[],lookupTableAddress:[],instructionTypes:s}}}static async insertCreateWrappedNativeAccount({connection:e,owner:t,payer:n,amount:r,instructions:o,instructionsType:i,signers:s,commitment:a}){const c=await this.makeCreateWrappedNativeAccountInstructions({connection:e,owner:t,payer:n,amount:r,commitment:a});return o.push(...c.innerTransaction.instructions),s.push(...c.innerTransaction.signers),i.push(...c.innerTransaction.instructionTypes),c.address.newAccount}static makeInitMintInstruction({programId:e,mint:t,decimals:n,mintAuthority:r,freezeAuthority:o=null,instructionTypes:i}){return i.push(jo.initMint),function(e,t,n,r,o=se){const i=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1}],s=ee.alloc(nn.span);return nn.encode({instruction:Vt.InitializeMint,decimals:t,mintAuthority:n,freezeAuthorityOption:r?1:0,freezeAuthority:r||new re(0)},s),new ie({keys:i,programId:o,data:s})}(t,n,r,o,e)}static makeMintToInstruction({programId:e,mint:t,dest:n,authority:r,amount:o,multiSigners:i=[],instructionTypes:s}){return s.push(jo.mintTo),function(e,t,n,r,o=[],i=se){const s=Rt([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],n,o),a=ee.alloc(en.span);return en.encode({instruction:Vt.MintTo,amount:BigInt(r)},a),new ie({keys:s,programId:i,data:a})}(t,n,r,BigInt(String(o)),i,e)}static makeInitAccountInstruction({programId:e,mint:t,tokenAccount:n,owner:r,instructionTypes:o}){return o.push(jo.initAccount),function(e,t,n,r=se){const o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1}],i=ee.alloc(Yt.span);return Yt.encode({instruction:Vt.InitializeAccount},i),new ie({keys:o,programId:r,data:i})}(n,t,r,e)}static makeTransferInstruction({programId:e,source:t,destination:n,owner:r,amount:o,multiSigners:i=[],instructionsType:s}){return s.push(jo.transferAmount),function(e,t,n,r,o=[],i=se){const s=Rt([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],n,o),a=ee.alloc(tn.span);return tn.encode({instruction:Vt.Transfer,amount:BigInt(r)},a),new ie({keys:s,programId:i,data:a})}(t,n,r,BigInt(String(o)),i,e)}static makeCloseAccountInstruction({programId:e,tokenAccount:t,owner:n,payer:r,multiSigners:o=[],instructionsType:i}){return i.push(jo.closeAccount),function(e,t,n,r=[],o=se){const i=Rt([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0}],n,r),s=ee.alloc(Ft.span);return Ft.encode({instruction:Vt.CloseAccount},s),new ie({keys:i,programId:o,data:s})}(t,r,n,o,e)}static createInitAccountInstruction(e,t,n,r){const o=[{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1}],i=Co("instruction"),s=ee.alloc(i.span);return i.encode(1,s),new ie({keys:o,programId:e,data:s})}}var Go,jo;!function(e){e[e.V0=0]="V0",e[e.LEGACY=1]="LEGACY"}(Go||(Go={})),function(e){e[e.createAccount=0]="createAccount",e[e.initAccount=1]="initAccount",e[e.createATA=2]="createATA",e[e.closeAccount=3]="closeAccount",e[e.transferAmount=4]="transferAmount",e[e.initMint=5]="initMint",e[e.mintTo=6]="mintTo",e[e.initMarket=7]="initMarket",e[e.util1216OwnerClaim=8]="util1216OwnerClaim",e[e.setComputeUnitPrice=9]="setComputeUnitPrice",e[e.setComputeUnitLimit=10]="setComputeUnitLimit",e[e.clmmCreatePool=11]="clmmCreatePool",e[e.clmmOpenPosition=12]="clmmOpenPosition",e[e.clmmIncreasePosition=13]="clmmIncreasePosition",e[e.clmmDecreasePosition=14]="clmmDecreasePosition",e[e.clmmClosePosition=15]="clmmClosePosition",e[e.clmmSwapBaseIn=16]="clmmSwapBaseIn",e[e.clmmSwapBaseOut=17]="clmmSwapBaseOut",e[e.clmmInitReward=18]="clmmInitReward",e[e.clmmSetReward=19]="clmmSetReward",e[e.clmmCollectReward=20]="clmmCollectReward",e[e.ammV4Swap=21]="ammV4Swap",e[e.ammV4AddLiquidity=22]="ammV4AddLiquidity",e[e.ammV4RemoveLiquidity=23]="ammV4RemoveLiquidity",e[e.ammV4SimulatePoolInfo=24]="ammV4SimulatePoolInfo",e[e.ammV4SwapBaseIn=25]="ammV4SwapBaseIn",e[e.ammV4SwapBaseOut=26]="ammV4SwapBaseOut",e[e.ammV4CreatePool=27]="ammV4CreatePool",e[e.ammV4InitPool=28]="ammV4InitPool",e[e.ammV4CreatePoolV2=29]="ammV4CreatePoolV2",e[e.ammV5AddLiquidity=30]="ammV5AddLiquidity",e[e.ammV5RemoveLiquidity=31]="ammV5RemoveLiquidity",e[e.ammV5SimulatePoolInfo=32]="ammV5SimulatePoolInfo",e[e.ammV5SwapBaseIn=33]="ammV5SwapBaseIn",e[e.ammV5SwapBaseOut=34]="ammV5SwapBaseOut",e[e.routeSwap=35]="routeSwap",e[e.routeSwap1=36]="routeSwap1",e[e.routeSwap2=37]="routeSwap2",e[e.farmV3Deposit=38]="farmV3Deposit",e[e.farmV3Withdraw=39]="farmV3Withdraw",e[e.farmV3CreateLedger=40]="farmV3CreateLedger",e[e.farmV5Deposit=41]="farmV5Deposit",e[e.farmV5Withdraw=42]="farmV5Withdraw",e[e.farmV5CreateLedger=43]="farmV5CreateLedger",e[e.farmV6Deposit=44]="farmV6Deposit",e[e.farmV6Withdraw=45]="farmV6Withdraw",e[e.farmV6Create=46]="farmV6Create",e[e.farmV6Restart=47]="farmV6Restart",e[e.farmV6CreatorAddReward=48]="farmV6CreatorAddReward",e[e.farmV6CreatorWithdraw=49]="farmV6CreatorWithdraw",e[e.test=50]="test"}(jo||(jo={}));class Ho{static _selectTokenAccount(e){const{tokenAccounts:t,programId:n,mint:r,owner:o,config:i}=e,{associatedOnly:s}={associatedOnly:!0,...i},a=t.filter((({accountInfo:e})=>e.mint.equals(r))).sort(((e,t)=>e.accountInfo.amount.lt(t.accountInfo.amount)?1:-1)),c=Xo.getAssociatedTokenAccount({mint:r,owner:o,programId:n});for(const u of a){const{pubkey:e}=u;if(!s)return e;if(c.equals(e))return e}return null}static async _handleTokenAccount(e){const{connection:t,side:n,amount:r,programId:o,mint:i,tokenAccount:s,owner:a,payer:c=a,frontInstructions:u,endInstructions:l,signers:d,bypassAssociatedCheck:m,frontInstructionsType:p,endInstructionsType:f,checkCreateATAOwner:g}=e,w=Xo.getAssociatedTokenAccount({mint:i,owner:a,programId:o});if(br.WSOL.mint.equals(i)){const e=await Xo.insertCreateWrappedNativeAccount({connection:t,owner:a,payer:c,instructions:u,instructionsType:p,signers:d,amount:r});return l&&l.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:e,owner:a,payer:c,instructionsType:f??[]})),e}if(!s||"out"===n&&!w.equals(s)&&!m){const e=Xo.makeCreateAssociatedTokenAccountInstruction({programId:o,mint:i,associatedAccount:w,owner:a,payer:c,instructionsType:p});if(g){const n=await t.getAccountInfo(w);if(null===n)u.push(e);else if(!(n.owner.equals(se)&&Kt.decode(n.data).mint.equals(i)&&Kt.decode(n.data).owner.equals(a)))throw Error(`create ata check error -> mint: ${i.toString()}, ata: ${w.toString()}`)}else u.push(e);return w}return s}static async _selectOrCreateTokenAccount(e){const{mint:t,tokenAccounts:n,createInfo:r,associatedOnly:o,owner:i,checkCreateATAOwner:s,programId:a}=e,c=Xo.getAssociatedTokenAccount({mint:t,owner:i,programId:a}),u=n.filter((e=>e.accountInfo.mint.equals(t)&&(!o||e.pubkey.equals(c)))).sort(((e,t)=>e.accountInfo.amount.lt(t.accountInfo.amount)?1:-1));if(void 0===r||u.length>0)return u.length>0?u[0].pubkey:void 0;if(o){const e=Xo.makeCreateAssociatedTokenAccountInstruction({programId:a,mint:t,associatedAccount:c,owner:i,payer:r.payer,instructionsType:r.frontInstructionsType});if(s){const n=await r.connection.getAccountInfo(c);if(null===n)r.frontInstructions.push(e);else if(!(n.owner.equals(a)&&Kt.decode(n.data).mint.equals(t)&&Kt.decode(n.data).owner.equals(i)))throw Error(`create ata check error -> mint: ${t.toString()}, ata: ${c.toString()}`)}else r.frontInstructions.push(e);if(t.equals(br.WSOL.mint)&&r.amount){const e=await Xo.insertCreateWrappedNativeAccount({connection:r.connection,owner:i,payer:r.payer,instructions:r.frontInstructions,instructionsType:r.frontInstructionsType,signers:r.signers,amount:r.amount??0});(r.endInstructions??[]).push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:e,owner:i,payer:r.payer,instructionsType:r.endInstructionsType??[]})),r.amount&&r.frontInstructions.push(Xo.makeTransferInstruction({programId:se,source:e,destination:c,owner:i,amount:r.amount,instructionsType:r.frontInstructionsType}))}return(r.endInstructions??[]).push(Xo.makeCloseAccountInstruction({programId:a,tokenAccount:c,owner:i,payer:r.payer,instructionsType:r.endInstructionsType??[]})),c}if(t.equals(br.WSOL.mint)){const e=await Xo.insertCreateWrappedNativeAccount({connection:r.connection,owner:i,payer:r.payer,instructions:r.frontInstructions,instructionsType:r.frontInstructionsType,signers:r.signers,amount:r.amount??0});return(r.endInstructions??[]).push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:e,owner:i,payer:r.payer,instructionsType:r.endInstructionsType??[]})),e}{const e=Qo({fromPublicKey:i,programId:a}),n=await r.connection.getMinimumBalanceForRentExemption(Kt.span),o=de.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:e.seed,newAccountPubkey:e.publicKey,lamports:n,space:Kt.span,programId:a}),s=Xo.createInitAccountInstruction(a,t,e.publicKey,i);return r.frontInstructions.push(o,s),r.frontInstructionsType.push(jo.createAccount,jo.initAccount),(r.endInstructions??[]).push(Xo.makeCloseAccountInstruction({programId:a,tokenAccount:e.publicKey,owner:i,payer:r.payer,instructionsType:r.endInstructionsType??[]})),e.publicKey}}}function Qo({fromPublicKey:e,programId:t=se}){const n=Ne.generate().publicKey.toBase58().slice(0,32),r=function(e,t,n){const r=ee.concat([e.toBuffer(),ee.from(t),n.toBuffer()]),o=Xe(r);return new re(o)}(e,n,t);return{publicKey:r,seed:n}}const Zo={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Ve({key:new re("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Ve.deserialize(ee.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};function $o({makeTxVersion:e,instructions:t,payer:n,recentBlockhash:r,signers:o,lookupTableInfos:i}){if(e===Go.LEGACY){const e=new Me;return e.add(...t),e.feePayer=n,e.recentBlockhash=r,o.length>0&&e.sign(...o),e}if(e===Go.V0){const e=new Le({payerKey:n,recentBlockhash:r,instructions:t}),s=new Ge(e.compileToV0Message(i));return s.sign(o),s}throw Error(" make tx version check error ")}const Yo=1e4;function Jo(e,t,n,r){if(void 0===t)return{amount:e,fee:void 0,expirationTime:void 0};const o=n.epoch<t.newerTransferFee.epoch?t.olderTransferFee:t.newerTransferFee,i=new Re(o.maximumFee.toString()),s=n.epoch<t.newerTransferFee.epoch?400*(Number(t.newerTransferFee.epoch)*n.slotsInEpoch-n.absoluteSlot)/1e3:void 0;if(r){if(o.transferFeeBasisPoints===Yo){const t=new Re(o.maximumFee.toString());return{amount:e.add(t),fee:t,expirationTime:s}}{const t=ni(e.mul(new Re(Yo)),new Re(Yo-o.transferFeeBasisPoints)),n=new Re(o.maximumFee.toString()),r=t.sub(e).gt(n)?e.add(n):t,a=ni(r.mul(new Re(o.transferFeeBasisPoints)),new Re(Yo));return{amount:r,fee:a.gt(i)?i:a,expirationTime:s}}}{const t=ni(e.mul(new Re(o.transferFeeBasisPoints)),new Re(Yo));return{amount:e,fee:t.gt(i)?i:t,expirationTime:s}}}function ei(e,t){return void 0===e?t:void 0===t?e:Math.min(e,t)}async function ti({connection:e,mints:t}){if(0===t.length)return{};const n=await Jn(e,t.map((e=>({pubkey:e})))),r={};for(const o of n){const e=Gt(o.pubkey,o.accountInfo,o.accountInfo?.owner);r[o.pubkey.toString()]={...e,feeConfig:Qt(e)??void 0}}return r}function ni(e,t){const{div:n,mod:r}=e.divmod(t);return r.gt(ar)?n.add(cr):n}const ri={voterStakeRegistryCreateVoter:ee.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:ee.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:ee.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:ee.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:ee.from([45,185,3,36,109,190,115,169])},oi=Do([Po("state"),Po("nonce"),No("lpVault"),No("rewardVault"),No(),No(),Po(),Po(),Po("totalReward"),Eo("perShareReward"),Po("lastSlot"),Po("perSlotReward")]),ii=Do([Po("state"),Po("nonce"),No("lpVault"),No("rewardVaultA"),Po("totalRewardA"),Eo("perShareRewardA"),Po("perSlotRewardA"),Co("option"),No("rewardVaultB"),So(7),Po("totalRewardB"),Eo("perShareRewardB"),Po("perSlotRewardB"),Po("lastSlot"),No()]),si=Do([Po("rewardState"),Po("rewardOpenTime"),Po("rewardEndTime"),Po("rewardLastUpdateTime"),Po("totalReward"),Po("totalRewardEmissioned"),Po("rewardClaimed"),Po("rewardPerSecond"),Eo("accRewardPerShare"),No("rewardVault"),No("rewardMint"),No("rewardSender"),Po("rewardType"),_o(Po(),15,"padding")]),ai=Do([Po(),Po("state"),Po("nonce"),Po("validRewardTokenNum"),Eo("rewardMultiplier"),Po("rewardPeriodMax"),Po("rewardPeriodMin"),Po("rewardPeriodExtend"),No("lpMint"),No("lpVault"),_o(si,5,"rewardInfos"),No("creator"),No(),_o(Po(),32,"padding")]),ci=new Proxy(oi,{get:(e,t,n)=>"decode"===t?(...t)=>{const n=e.decode(...t);return{...n,version:3,rewardInfos:[{rewardVault:n.rewardVault,totalReward:n.totalReward,perSlotReward:n.perSlotReward,perShareReward:n.perShareReward}]}}:Reflect.get(e,t,n)}),ui=new Proxy(ii,{get:(e,t,n)=>"decode"===t?(...t)=>{const n=e.decode(...t);return{...n,version:5,rewardInfos:[{rewardVault:n.rewardVaultA,totalReward:n.totalRewardA,perSlotReward:n.perSlotRewardA,perShareReward:n.perShareRewardA},{rewardVault:n.rewardVaultB,totalReward:n.totalRewardB,perSlotReward:n.perSlotRewardB,perShareReward:n.perShareRewardB}]}}:Reflect.get(e,t,n)}),li=new Proxy(ai,{get:(e,t,n)=>"decode"===t?(...t)=>{const n=e.decode(...t);return{...n,version:6,rewardInfos:n.rewardInfos.map((e=>({...e,rewardType:(Object.entries(Pi).find((t=>String(t[1])===e.rewardType.toString()))??["Standard SPL"])[0]})))}}:Reflect.get(e,t,n)}),di=Do([Po("state"),No("id"),No("owner"),Po("deposited"),_o(Po(),1,"rewardDebts")]),mi=Do([Po("state"),No("id"),No("owner"),Po("deposited"),_o(Eo(),1,"rewardDebts"),Po(""),Po("voteLockedBalance"),_o(Po(),15)]),pi=Do([Po("state"),No("id"),No("owner"),Po("deposited"),_o(Po(),2,"rewardDebts")]),fi=Do([Po("state"),No("id"),No("owner"),Po("deposited"),_o(Eo(),2,"rewardDebts"),_o(Po(),17)]),gi=Do([Po(),Po("state"),No("id"),No("owner"),Po("deposited"),_o(Eo(),5,"rewardDebts"),_o(Po(),16)]),wi={3:ci,5:ui,6:li},hi={3:mi,5:fi,6:gi},ki=Do([No("mint"),No("grantAuthority"),Po("baselineVoteWeightScaledFactor"),Po("maxExtraLockupVoteWeightScaledFactor"),Po("lockupSaturationSecs"),(yi="digitShift",new Oo(1,!0,yi)),_o(Co(),7,"reserved1"),_o(Po(),7,"reserved2")]);var yi;const Ai=Do([So(8),No("governanceProgramId"),No("realm"),No("realmGoverningTokenMint"),No("realmAuthority"),_o(Co(),32,"reserved1"),_o(ki,4,"votingMints"),Mo("timeOffset"),Co("bump"),_o(Co(),7,"reserved2"),_o(Po(),11,"reserved3")]),Ii=Do([Mo("startTime"),Mo("endTime"),Co("kind"),_o(Co(),15,"reserved")]),bi=Do([_o(Ii,1,"lockup"),Po("amountDeposited_native"),Po("amountInitiallyLockedNative"),Vo("isUsed"),Vo("allowClawback"),Co("votingMintConfigIdx"),_o(Co(),29,"reserved")]),Ti=Do([So(8),No("voterAuthority"),No("registrar"),_o(bi,32,"deposits"),Co("voterBump"),Co("voterWweightRecordBump"),_o(Co(),94,"reserved")]);function vi(e,t,n){return jn([t.toBuffer(),ee.from("registrar","utf8"),n.toBuffer()],e)}function Si(e,t){return jn([t.toBuffer(),ee.from("voting_mint_seed","utf8")],e)}function xi(e,t){return jn([t.toBuffer()],e)}function Oi(e,t,n){return jn([t.toBuffer(),ee.from("voter","utf8"),n.toBuffer()],e)}function Bi(e,t,n){return jn([t.toBuffer(),ee.from("voter-weight-record","utf8"),n.toBuffer()],e)}function Ci(e,t,n,r){return jn([ee.from("governance","utf8"),t.toBuffer(),n.toBuffer(),r.toBuffer()],e)}const qi=Wn.from("Farm"),Pi={"Standard SPL":0,"Option tokens":1};class Ei extends Ho{static getStateLayout(e){const t=wi[e];return qi.assertArgument(!!t,"invalid version","version",e),t}static getLedgerLayout(e){const t=hi[e];return qi.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e),ledger:this.getLedgerLayout(e)}}static getAssociatedAuthority({programId:e,poolId:t}){return jn([t.toBuffer()],e)}static getAssociatedLedgerAccount({programId:e,poolId:t,owner:n,version:r}){const{publicKey:o}=jn([t.toBuffer(),n.toBuffer(),ee.from(6===r?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}static getAssociatedLedgerPoolAccount({programId:e,poolId:t,mint:n,type:r}){const{publicKey:o}=jn([t.toBuffer(),n.toBuffer(),ee.from("lpVault"===r?"lp_vault_associated_seed":"rewardVault"===r?"reward_vault_associated_seed":"","utf-8")],e);return o}static makeDepositInstruction(e){const{poolKeys:t}=e,{version:n}=t;return 3===n?this.makeDepositInstructionV3(e):5===n?this.makeDepositInstructionV5(e):6===n?this.makeDepositInstructionV6(e):qi.throwArgumentError("invalid version","poolKeys.version",n)}static makeDepositInstructionV3({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(1===e.rewardInfos.length,"lengths not equal 1","poolKeys.rewardInfos",e.rewardInfos),qi.assertArgument(1===t.rewardTokenAccounts.length,"lengths not equal 1","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:10,amount:pr(n)},o);const i=[Hn(e.id,!1),Qn(e.authority,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1),Hn(e.lpVault,!1),Hn(t.rewardTokenAccounts[0],!1),Hn(e.rewardInfos[0].rewardVault,!1),Qn(je,!1),Qn(se,!1)];if(t.auxiliaryLedgers)for(const s of t.auxiliaryLedgers)i.push(Hn(s,!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV3Deposit]}}}static makeDepositInstructionV5({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:11,amount:pr(n)},o);const i=[Hn(e.id,!1),Qn(e.authority,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1),Hn(e.lpVault,!1),Hn(t.rewardTokenAccounts[0],!1),Hn(e.rewardInfos[0].rewardVault,!1),Qn(je,!1),Qn(se,!1)];for(let s=1;s<e.rewardInfos.length;s++)i.push(Hn(t.rewardTokenAccounts[s],!1)),i.push(Hn(e.rewardInfos[s].rewardVault,!1));if(t.auxiliaryLedgers)for(const s of t.auxiliaryLedgers)i.push(Hn(s,!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV5Deposit]}}}static makeDepositInstructionV6({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(0!==t.rewardTokenAccounts.length,"lengths equal zero","userKeys.rewardTokenAccounts",t.rewardTokenAccounts),qi.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:1,amount:pr(n)},o);const i=[Qn(se,!1),Qn(_n,!1),Hn(e.id,!1),Qn(e.authority,!1),Hn(e.lpVault,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1)];for(let s=0;s<e.rewardInfos.length;s++)i.push(Hn(e.rewardInfos[s].rewardVault,!1)),i.push(Hn(t.rewardTokenAccounts[s],!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV6Deposit]}}}static makeWithdrawInstruction(e){const{poolKeys:t}=e,{version:n}=t;return 3===n?this.makeWithdrawInstructionV3(e):5===n?this.makeWithdrawInstructionV5(e):6===n?this.makeWithdrawInstructionV6(e):qi.throwArgumentError("invalid version","poolKeys.version",n)}static makeWithdrawInstructionV3({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(1===e.rewardInfos.length,"lengths not equal 1","poolKeys.rewardInfos",e.rewardInfos),qi.assertArgument(1===t.rewardTokenAccounts.length,"lengths not equal 1","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:11,amount:pr(n)},o);const i=[Hn(e.id,!1),Qn(e.authority,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1),Hn(e.lpVault,!1),Hn(t.rewardTokenAccounts[0],!1),Hn(e.rewardInfos[0].rewardVault,!1),Qn(je,!1),Qn(se,!1)];if(t.auxiliaryLedgers)for(const s of t.auxiliaryLedgers)i.push(Hn(s,!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV5Deposit]}}}static makeWithdrawInstructionV5({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with params.poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:12,amount:pr(n)},o);const i=[Hn(e.id,!1),Qn(e.authority,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1),Hn(e.lpVault,!1),Hn(t.rewardTokenAccounts[0],!1),Hn(e.rewardInfos[0].rewardVault,!1),Qn(je,!1),Qn(se,!1)];for(let s=1;s<e.rewardInfos.length;s++)i.push(Hn(t.rewardTokenAccounts[s],!1)),i.push(Hn(e.rewardInfos[s].rewardVault,!1));if(t.auxiliaryLedgers)for(const s of t.auxiliaryLedgers)i.push(Hn(s,!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV5Withdraw]}}}static makeWithdrawInstructionV6({poolKeys:e,userKeys:t,amount:n}){qi.assertArgument(0!==t.rewardTokenAccounts.length,"lengths equal zero","userKeys.rewardTokenAccounts",t.rewardTokenAccounts),qi.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with params.poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const r=Do([Co("instruction"),Po("amount")]),o=ee.alloc(r.span);r.encode({instruction:2,amount:pr(n)},o);const i=[Qn(se,!1),Hn(e.id,!1),Qn(e.authority,!1),Hn(e.lpVault,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Hn(t.lpTokenAccount,!1)];for(let s=0;s<e.rewardInfos.length;s++)i.push(Hn(e.rewardInfos[s].rewardVault,!1)),i.push(Hn(t.rewardTokenAccounts[s],!1));return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:i,data:o})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV6Withdraw]}}}static makeCreateAssociatedLedgerAccountInstruction(e){const{poolKeys:t}=e,{version:n}=t;return 3===n?this.makeCreateAssociatedLedgerAccountInstructionV3(e):5===n?this.makeCreateAssociatedLedgerAccountInstructionV5(e):qi.throwArgumentError("invalid version","poolKeys.version",n)}static makeCreateAssociatedLedgerAccountInstructionV3({poolKeys:e,userKeys:t}){const n=Do([Co("instruction")]),r=ee.alloc(n.span);n.encode({instruction:9},r);const o=[Hn(e.id,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Qn(_n,!1),Qn(ue,!1)];return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:o,data:r})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV3CreateLedger]}}}static makeCreateAssociatedLedgerAccountInstructionV5({poolKeys:e,userKeys:t}){const n=Do([Co("instruction")]),r=ee.alloc(n.span);n.encode({instruction:10},r);const o=[Hn(e.id,!1),Hn(t.ledger,!1),Qn(t.owner,!0),Qn(_n,!1),Qn(ue,!1)];return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:o,data:r})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV5CreateLedger]}}}static makeCreateFarmInstruction({connection:e,userKeys:t,poolInfo:n}){const{version:r}=n;return 6===r?this.makeCreateFarmInstructionV6({connection:e,userKeys:t,poolInfo:n}):qi.throwArgumentError("invalid version","version",r)}static async makeCreateFarmInstructionV6({connection:e,userKeys:t,poolInfo:n}){const r=t.payer??t.owner,o=Qo({fromPublicKey:r,programId:n.programId}),i=await e.getMinimumBalanceForRentExemption(li.span),s=[],a=[],c=[],u=[],l=[];s.push(de.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:o.seed,newAccountPubkey:o.publicKey,lamports:i,space:li.span,programId:n.programId}));const{publicKey:d,nonce:m}=Ei.getAssociatedAuthority({programId:n.programId,poolId:o.publicKey}),p=Ei.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:o.publicKey,mint:n.lpMint,type:"lpVault"}),f=[],g=[];for(const b of n.rewardInfos){let r;qi.assertArgument(b.rewardOpenTime<b.rewardEndTime,"start time error","rewardInfo.rewardOpenTime",b.rewardOpenTime),qi.assertArgument(void 0!==Pi[b.rewardType],"reward type error","rewardInfo.rewardType",b.rewardType),qi.assertArgument(pr(b.rewardPerSecond).gt(ar),"rewardPerSecond error","rewardInfo.rewardPerSecond",b.rewardPerSecond),f.push({isSet:new Re(1),rewardPerSecond:pr(b.rewardPerSecond),rewardOpenTime:pr(b.rewardOpenTime),rewardEndTime:pr(b.rewardEndTime),rewardType:pr(Pi[b.rewardType])}),b.rewardMint.equals(re.default)?(r=await Xo.insertCreateWrappedNativeAccount({connection:e,owner:t.owner,payer:t.payer??t.owner,instructions:s,signers:l,amount:pr(b.rewardEndTime).sub(pr(b.rewardOpenTime)).mul(pr(b.rewardPerSecond)),instructionsType:c}),a.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:r,owner:t.owner,payer:t.payer??t.owner,instructionsType:u}))):r=this._selectTokenAccount({programId:se,tokenAccounts:t.tokenAccounts,mint:b.rewardMint,owner:t.owner,config:{associatedOnly:!1}}),qi.assertArgument(null!==r,"cannot found target token accounts","tokenAccounts",t.tokenAccounts);const i=b.rewardMint.equals(re.default)?br.WSOL.mint:b.rewardMint;g.push({rewardMint:i,rewardVault:Ei.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:o.publicKey,mint:i,type:"rewardVault"}),userRewardToken:r})}const w=this._selectTokenAccount({programId:se,tokenAccounts:t.tokenAccounts,mint:n.lockInfo.lockMint,owner:t.owner,config:{associatedOnly:!1}});qi.assertArgument(null!==w,"cannot found lock vault","tokenAccounts",t.tokenAccounts);const h=Do([Po("isSet"),Po("rewardPerSecond"),Po("rewardOpenTime"),Po("rewardEndTime"),Po("rewardType")]),k=Do([Co("instruction"),Po("nonce"),_o(h,5,"rewardTimeInfo")]),y=ee.alloc(k.span);k.encode({instruction:0,nonce:new Re(m),rewardTimeInfo:f},y);const A=[Qn(se,!1),Qn(_n,!1),Qn(ue,!1),Hn(o.publicKey,!1),Qn(d,!1),Hn(p,!1),Qn(n.lpMint,!1),Hn(n.lockInfo.lockVault,!1),Qn(n.lockInfo.lockMint,!1),Hn(w??re.default,!1),Qn(t.owner,!0)];for(const b of g)A.push({pubkey:b.rewardMint,isSigner:!1,isWritable:!1},{pubkey:b.rewardVault,isSigner:!1,isWritable:!0},{pubkey:b.userRewardToken,isSigner:!1,isWritable:!0});const I=new ie({programId:n.programId,keys:A,data:y});return{address:{farmId:o.publicKey},innerTransaction:{instructions:[...s,I,...a],signers:l,lookupTableAddress:[],instructionTypes:[...c,jo.farmV6Create,...u]}}}static makeCreatorWithdrawFarmRewardInstruction(e){const{poolKeys:t}=e,{version:n}=t;return 6===n?this.makeCreatorWithdrawFarmRewardInstructionV6(e):qi.throwArgumentError("invalid version","version",n)}static makeCreatorWithdrawFarmRewardInstructionV6({poolKeys:e,userKeys:t,withdrawMint:n}){const r=e.rewardInfos.find((e=>e.rewardMint.equals(n.equals(re.default)?br.WSOL.mint:n)));qi.assertArgument(void 0!==r,"withdraw mint error","poolKeys.rewardInfos",e.rewardInfos);const o=r?.rewardVault??re.default,i=Do([Co("instruction")]),s=ee.alloc(i.span);i.encode({instruction:5},s);const a=[Qn(se,!1),Hn(e.id,!1),Qn(e.authority,!1),Qn(e.lpVault,!1),Hn(o,!1),Hn(t.userRewardToken,!1),Qn(t.owner,!0)];return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[jo.farmV6CreatorWithdraw]}}}static async fetchMultipleInfoAndUpdate({connection:e,pools:t,owner:n,config:r,chainTime:o}){let i=!1,s=!1;const a=[],c={};for(const m of t)c[m.id.toString()]=m,6===m.version?s=!0:i=!0,a.push({pubkey:m.id,version:m.version,key:"state",poolId:m.id}),a.push({pubkey:m.lpVault,version:m.version,key:"lpVault",poolId:m.id}),n&&a.push({pubkey:this.getAssociatedLedgerAccount({programId:m.programId,poolId:m.id,owner:n,version:m.version}),version:m.version,key:"ledger",poolId:m.id});const u={},l=await Jn(e,a,r);for(const{pubkey:m,version:p,key:f,poolId:g,accountInfo:w}of l){const e=g.toBase58();if("state"===f){const t=this.getStateLayout(p);if(!w||!w.data||w.data.length!==t.span)return qi.throwArgumentError("invalid farm state account info","pools.id",m);u[e]={...u[e],apiPoolInfo:c[e],state:t.decode(w.data)}}else if("lpVault"===f){if(!w||!w.data||w.data.length!==Uo.span)return qi.throwArgumentError("invalid farm lp vault account info","pools.lpVault",m);u[e]={...u[e],lpVault:Uo.decode(w.data)}}else if("ledger"===f){const t=this.getLedgerLayout(p);w&&w.data&&(qi.assertArgument(w.data.length===t.span,"invalid farm ledger account info","ledger",m),u[e]={...u[e],ledger:t.decode(w.data)})}}const d=s||i?await e.getSlot():0;for(const m of Object.keys(u))void 0!==u[m]&&(u[m].state=Ei.updatePoolInfo(u[m].state,u[m].lpVault,d,o));for(const[m,{state:p,ledger:f}]of Object.entries(u))if(f){let e;e=6===p.version?p.rewardMultiplier:1===p.rewardInfos.length?ur.pow(new Re(9)):ur.pow(new Re(15));const t=p.rewardInfos.map(((t,n)=>{const r=f.rewardDebts[n];return f.deposited.mul(6===p.version?t.accRewardPerShare:t.perShareReward).div(e).sub(r)}));u[m].wrapped={...u[m].wrapped,pendingRewards:t}}return u}static updatePoolInfo(e,t,n,r){if(3===e.version||5===e.version){if(e.lastSlot.gte(new Re(n)))return e;const r=new Re(n).sub(e.lastSlot);e.lastSlot=new Re(n);for(const n of e.rewardInfos){if(t.amount.eq(new Re(0)))continue;const o=n.perSlotReward.mul(r);n.perShareReward=n.perShareReward.add(o.mul(new Re(10).pow(new Re(3===e.version?9:15))).div(t.amount)),n.totalReward=n.totalReward.add(o)}}else if(6===e.version)for(const o of e.rewardInfos){if(o.rewardState.eq(new Re(0)))continue;const n=Re.min(new Re(r),o.rewardEndTime);if(o.rewardOpenTime.gte(n))continue;let i=n.sub(o.rewardLastUpdateTime).mul(o.rewardPerSecond);const s=o.totalReward.sub(o.totalRewardEmissioned);s.lt(i)?(i=s,o.rewardLastUpdateTime=o.rewardLastUpdateTime.add(s.div(o.rewardPerSecond))):o.rewardLastUpdateTime=n,t.amount.eq(new Re(0))||(o.accRewardPerShare=o.accRewardPerShare.add(i.mul(e.rewardMultiplier).div(t.amount)),o.totalRewardEmissioned=o.totalRewardEmissioned.add(i))}return e}static makeCreatorWithdrawFarmRewardInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return 6===n?this.makeCreatorWithdrawFarmRewardInstructionV6Simple(e):qi.throwArgumentError("invalid version","version",n)}static async makeCreatorWithdrawFarmRewardInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,withdrawMint:r,makeTxVersion:o,lookupTableCache:i,computeBudgetConfig:s}){const a=[],c=[],u=[],l=[],d=[];let m;if(r.equals(re.default))m=await Xo.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:n.payer??n.owner,instructions:a,signers:d,amount:0,instructionsType:u}),c.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:m,owner:n.owner,payer:n.payer??n.owner,instructionsType:l}));else{const e=this._selectTokenAccount({programId:se,tokenAccounts:n.tokenAccounts,mint:r,owner:n.owner});null===e?(m=zo(n.owner,r,se).publicKey,a.push(Xo.makeCreateAssociatedTokenAccountInstruction({programId:se,mint:r,associatedAccount:m,owner:n.owner,payer:n.payer??n.owner,instructionsType:u}))):m=e}const p=this.makeCreatorWithdrawFarmRewardInstructionV6({poolKeys:t,userKeys:{userRewardToken:m,owner:n.owner,payer:n.payer},withdrawMint:r});return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:o,computeBudgetConfig:s,payer:n.payer??n.owner,innerTransaction:[{instructionTypes:u,instructions:a,signers:d},p.innerTransaction,{instructionTypes:l,instructions:c,signers:[]}],lookupTableCache:i})}}static makeCreateFarmInstructionSimple(e){const{version:t}=e.poolInfo;return 6===t?this.makeCreateFarmInstructionV6Simple(e):qi.throwArgumentError("invalid version","version",t)}static async makeCreateFarmInstructionV6Simple({connection:e,userKeys:t,poolInfo:n,makeTxVersion:r,lookupTableCache:o,computeBudgetConfig:i}){const s=t.payer??t.owner,a=Qo({fromPublicKey:s,programId:n.programId}),c=await e.getMinimumBalanceForRentExemption(li.span),u=[],l=[],d=[],m=[],p=[];u.push(de.createAccountWithSeed({fromPubkey:s,basePubkey:s,seed:a.seed,newAccountPubkey:a.publicKey,lamports:c,space:li.span,programId:n.programId}));const{publicKey:f,nonce:g}=Ei.getAssociatedAuthority({programId:n.programId,poolId:a.publicKey}),w=Ei.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:a.publicKey,mint:n.lpMint,type:"lpVault"}),h=[],k=[];for(const S of n.rewardInfos){let r;if(qi.assertArgument(S.rewardOpenTime<S.rewardEndTime,"start time error","rewardInfo.rewardOpenTime",S.rewardOpenTime),qi.assertArgument(void 0!==Pi[S.rewardType],"reward type error","rewardInfo.rewardType",S.rewardType),qi.assertArgument(pr(S.rewardPerSecond).gt(ar),"rewardPerSecond error","rewardInfo.rewardPerSecond",S.rewardPerSecond),h.push({isSet:new Re(1),rewardPerSecond:pr(S.rewardPerSecond),rewardOpenTime:pr(S.rewardOpenTime),rewardEndTime:pr(S.rewardEndTime),rewardType:pr(Pi[S.rewardType])}),S.rewardMint.equals(re.default)?(r=await Xo.insertCreateWrappedNativeAccount({connection:e,owner:t.owner,payer:t.payer??t.owner,instructions:u,signers:p,amount:pr(S.rewardEndTime).sub(pr(S.rewardOpenTime)).mul(pr(S.rewardPerSecond)),instructionsType:d}),l.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:r,owner:t.owner,payer:t.payer??t.owner,instructionsType:m}))):r=this._selectTokenAccount({programId:se,tokenAccounts:t.tokenAccounts,mint:S.rewardMint,owner:t.owner,config:{associatedOnly:!1}}),qi.assertArgument(null!==r,"cannot found target token accounts","tokenAccounts",t.tokenAccounts),null===r)throw Error("cannot found target token accounts");const o=S.rewardMint.equals(re.default)?br.WSOL.mint:S.rewardMint;k.push({rewardMint:o,rewardVault:Ei.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:a.publicKey,mint:o,type:"rewardVault"}),userRewardToken:r})}const y=this._selectTokenAccount({programId:se,tokenAccounts:t.tokenAccounts,mint:n.lockInfo.lockMint,owner:t.owner,config:{associatedOnly:!1}});qi.assertArgument(null!==y,"cannot found lock vault","tokenAccounts",t.tokenAccounts);const A=Do([Po("isSet"),Po("rewardPerSecond"),Po("rewardOpenTime"),Po("rewardEndTime"),Po("rewardType")]),I=Do([Co("instruction"),Po("nonce"),_o(A,5,"rewardTimeInfo")]),b=ee.alloc(I.span);I.encode({instruction:0,nonce:new Re(g),rewardTimeInfo:h},b);const T=[Qn(se,!1),Qn(_n,!1),Qn(ue,!1),Hn(a.publicKey,!1),Qn(f,!1),Hn(w,!1),Qn(n.lpMint,!1),Hn(n.lockInfo.lockVault,!1),Qn(n.lockInfo.lockMint,!1),Hn(y??re.default,!1),Qn(t.owner,!0)];for(const S of k)T.push({pubkey:S.rewardMint,isSigner:!1,isWritable:!1},{pubkey:S.rewardVault,isSigner:!1,isWritable:!0},{pubkey:S.userRewardToken,isSigner:!1,isWritable:!0});const v=new ie({programId:n.programId,keys:T,data:b});return{address:{farmId:a.publicKey},innerTransactions:await rr({connection:e,makeTxVersion:r,computeBudgetConfig:i,payer:t.payer??t.owner,innerTransaction:[{instructionTypes:d,instructions:u,signers:p},{instructionTypes:[jo.farmV6Create],instructions:[v],signers:[]},{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:o})}}static makeRestartFarmInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return 6===n?this.makeRestartFarmInstructionV6Simple(e):qi.throwArgumentError("invalid version","version",n)}static async makeRestartFarmInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,newRewardInfo:r,makeTxVersion:o,lookupTableCache:i,computeBudgetConfig:s}){qi.assertArgument(r.rewardOpenTime<r.rewardEndTime,"start time error","newRewardInfo",r);const a=r.rewardMint.equals(re.default)?br.WSOL.mint:r.rewardMint,c=t.rewardInfos.find((e=>e.rewardMint.equals(a)));qi.assertArgument(c,"configuration does not exist","rewardInfo",c);const u=c?.rewardVault??re.default,l=[],d=[],m=[],p=[],f=[];let g;if(r.rewardMint.equals(re.default)?(g=await Xo.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:n.payer??n.owner,instructions:l,signers:f,amount:pr(r.rewardEndTime).sub(pr(r.rewardOpenTime)).mul(pr(r.rewardPerSecond)),instructionsType:m}),d.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:g,owner:n.owner,payer:n.payer??n.owner,instructionsType:p}))):g=this._selectTokenAccount({programId:se,tokenAccounts:n.tokenAccounts,mint:r.rewardMint,owner:n.owner,config:{associatedOnly:!1}}),qi.assertArgument(null!==g,"cannot found target token accounts","tokenAccounts",n.tokenAccounts),null===g)throw Error("cannot found target token accounts");const w=Do([Co("instruction"),Po("rewardReopenTime"),Po("rewardEndTime"),Po("rewardPerSecond")]),h=ee.alloc(w.span);w.encode({instruction:3,rewardReopenTime:pr(r.rewardOpenTime),rewardEndTime:pr(r.rewardEndTime),rewardPerSecond:pr(r.rewardPerSecond)},h);const k=[Qn(se,!1),Hn(t.id,!1),Qn(t.lpVault,!1),Hn(u,!1),Hn(g,!1),Qn(n.owner,!0)],y=new ie({programId:t.programId,keys:k,data:h});return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:o,computeBudgetConfig:s,payer:n.payer??n.owner,innerTransaction:[{instructionTypes:m,instructions:l,signers:f},{instructionTypes:[jo.farmV6Restart],instructions:[y],signers:[]},{instructionTypes:p,instructions:d,signers:[]}],lookupTableCache:i})}}static makeFarmCreatorAddRewardTokenInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return 6===n?this.makeFarmCreatorAddRewardTokenInstructionV6Simple(e):qi.throwArgumentError("invalid version","version",n)}static async makeFarmCreatorAddRewardTokenInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,newRewardInfo:r,makeTxVersion:o,lookupTableCache:i,computeBudgetConfig:s}){const a=Ei.getAssociatedLedgerPoolAccount({programId:t.programId,poolId:t.id,mint:r.rewardMint.equals(re.default)?br.WSOL.mint:r.rewardMint,type:"rewardVault"}),c=[],u=[],l=[],d=[],m=[];let p;if(r.rewardMint.equals(re.default)?(p=await Xo.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:n.payer??n.owner,instructions:c,signers:m,amount:pr(r.rewardEndTime).sub(pr(r.rewardOpenTime)).mul(pr(r.rewardPerSecond)),instructionsType:l}),u.push(Xo.makeCloseAccountInstruction({programId:se,tokenAccount:p,owner:n.owner,payer:n.payer??n.owner,instructionsType:d}))):p=this._selectTokenAccount({programId:se,tokenAccounts:n.tokenAccounts,mint:r.rewardMint,owner:n.owner,config:{associatedOnly:!1}}),qi.assertArgument(null!==p,"cannot found target token accounts","tokenAccounts",n.tokenAccounts),null===p)throw Error("cannot found target token accounts");const f=r.rewardMint.equals(re.default)?br.WSOL.mint:r.rewardMint,g=Do([Co("instruction"),Po("isSet"),Po("rewardPerSecond"),Po("rewardOpenTime"),Po("rewardEndTime"),Po("rewardType")]),w=ee.alloc(g.span);g.encode({instruction:4,isSet:new Re(1),rewardPerSecond:pr(r.rewardPerSecond),rewardOpenTime:pr(r.rewardOpenTime),rewardEndTime:pr(r.rewardEndTime),rewardType:pr(Pi[r.rewardType])},w);const h=[Qn(se,!1),Qn(_n,!1),Qn(ue,!1),Hn(t.id,!1),Qn(t.authority,!1),Qn(f,!1),Hn(a,!1),Hn(p,!1),Qn(n.owner,!0)],k=new ie({programId:t.programId,keys:h,data:w});return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:o,computeBudgetConfig:s,payer:n.payer??n.owner,innerTransaction:[{instructionTypes:l,instructions:c,signers:m},{instructionTypes:[jo.farmV6CreatorAddReward],instructions:[k],signers:[]},{instructionTypes:d,instructions:u,signers:[]}],lookupTableCache:i})}}static async makeDepositInstructionSimple({connection:e,poolKeys:t,fetchPoolInfo:n,ownerInfo:r,amount:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,makeTxVersion:a,lookupTableCache:c,computeBudgetConfig:u}){const l={};for(const T of r.tokenAccounts)i?zo(r.wallet,T.accountInfo.mint,T.programId).publicKey.equals(T.pubkey)&&(l[T.accountInfo.mint.toString()]=T.pubkey):l[T.accountInfo.mint.toString()]=T.pubkey;const d=[],m=[],p=[],f=[],g=[],{lpVault:w,apiPoolInfo:h,ledger:k}=n,y=l[w.mint.toString()];qi.assertArgument(y,"you don't have any lp","lp zero",l);const A=[];for(const T of h.rewardInfos){const t=r.useSOLBalance&&T.rewardMint.equals(br.WSOL.mint),n=l[T.rewardMint.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:T.rewardMint,tokenAccounts:t?[]:r.tokenAccounts,owner:r.wallet,createInfo:{connection:e,payer:r.feePayer,amount:0,frontInstructions:d,frontInstructionsType:p,endInstructions:t?m:[],endInstructionsType:t?f:[],signers:g},associatedOnly:!t&&i,checkCreateATAOwner:s});l[T.rewardMint.toString()]=n,A.push(n)}const I=await Ei.getAssociatedLedgerAccount({programId:new re(h.programId),poolId:new re(h.id),owner:r.wallet,version:h.version});if(h.version<6&&!k){const e=Ei.makeCreateAssociatedLedgerAccountInstruction({poolKeys:t,userKeys:{owner:r.wallet,ledger:I}});d.push(...e.innerTransaction.instructions),p.push(...e.innerTransaction.instructionTypes)}const b=Ei.makeDepositInstruction({poolKeys:t,userKeys:{ledger:I,lpTokenAccount:y,owner:r.wallet,rewardTokenAccounts:A},amount:o});return{address:b.address,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:u,payer:r.feePayer,innerTransaction:[{instructionTypes:p,instructions:d,signers:g},b.innerTransaction,{instructionTypes:f,instructions:m,signers:[]}],lookupTableCache:c})}}static async makeWithdrawInstructionSimple({connection:e,fetchPoolInfo:t,ownerInfo:n,amount:r,associatedOnly:o=!0,checkCreateATAOwner:i=!1,makeTxVersion:s,lookupTableCache:a,computeBudgetConfig:c}){const u={};for(const S of n.tokenAccounts)o?zo(n.wallet,S.accountInfo.mint,S.programId).publicKey.equals(S.pubkey)&&(u[S.accountInfo.mint.toString()]=S.pubkey):u[S.accountInfo.mint.toString()]=S.pubkey;const l=[],d=[],m=[],p=[],f=[],g=[],w=[],{lpVault:h,wrapped:k,apiPoolInfo:y}=t;if(void 0===k)throw Error("no lp");const A=h.mint,I=n.useSOLBalance&&A.equals(br.WSOL.mint),b=u[A.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:A,tokenAccounts:I?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,frontInstructionsType:m,signers:w},associatedOnly:!I&&o,checkCreateATAOwner:i});u[A.toString()]=b;const T=[];for(const S of y.rewardInfos){const t=n.useSOLBalance&&S.rewardMint.equals(br.WSOL.mint),r=u[S.rewardMint.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:S.rewardMint,tokenAccounts:t?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,frontInstructionsType:m,endInstructions:t?d:[],endInstructionsType:t?p:[],signers:w},associatedOnly:!t&&o,checkCreateATAOwner:i});u[S.rewardMint.toString()]=r,T.push(r)}const v=this.makeWithdrawInstruction({poolKeys:y,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:y.programId,poolId:y.id,owner:n.wallet,version:y.version}),lpTokenAccount:b,rewardTokenAccounts:T,owner:n.wallet},amount:r});return f.push(...v.innerTransaction.instructions),g.push(...v.innerTransaction.instructionTypes),{address:{},innerTransactions:await rr({connection:e,makeTxVersion:s,computeBudgetConfig:c,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:w},{instructionTypes:g,instructions:f,signers:[]},{instructionTypes:p,instructions:d,signers:[]}],lookupTableCache:a})}}static async makeHarvestAllRewardInstructionSimple({connection:e,fetchPoolInfos:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,makeTxVersion:i,lookupTableCache:s,computeBudgetConfig:a}){const c={};for(const g of n.tokenAccounts)r?zo(n.wallet,g.accountInfo.mint,g.programId).publicKey.equals(g.pubkey)&&(c[g.accountInfo.mint.toString()]=g.pubkey):c[g.accountInfo.mint.toString()]=g.pubkey;const u=[],l=[],d=[],m=[],p=[],f=[];for(const{lpVault:g,wrapped:w,apiPoolInfo:h,ledger:k}of Object.values(t)){if(void 0===w||void 0===k||void 0===w.pendingRewards.find((e=>e.gt(ar)))&&!k.deposited.isZero())continue;const t=g.mint,i=n.useSOLBalance&&t.equals(br.WSOL.mint),s=c[t.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:t,tokenAccounts:i?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:u,frontInstructionsType:d,signers:f},associatedOnly:!i&&r,checkCreateATAOwner:o});c[t.toString()]=s;const a=[];for(const p of h.rewardInfos){const t=n.useSOLBalance&&p.rewardMint.equals(br.WSOL.mint),i=c[p.rewardMint.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:p.rewardMint,tokenAccounts:t?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:u,frontInstructionsType:d,endInstructions:t?l:[],endInstructionsType:t?m:[],signers:f},associatedOnly:!t&&r,checkCreateATAOwner:o});c[p.rewardMint.toString()]=i,a.push(i)}const y=this.makeWithdrawInstruction({poolKeys:h,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:h.programId,poolId:h.id,owner:n.wallet,version:h.version}),lpTokenAccount:s,rewardTokenAccounts:a,owner:n.wallet},amount:0});p.push(y.innerTransaction)}return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:i,computeBudgetConfig:a,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:f},...p,{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:s})}}static async makeV1InfoToV2PdaAndHarvestSimple({connection:e,wallet:t,tokenAccounts:n,programIdV3:r,programIdV5:o,makeTxVersion:i,lookupTableCache:s,computeBudgetConfig:a}){const c={};for(const I of n){const e=I.accountInfo.mint,n=zo(t,e,I.programId).publicKey;n.equals(I.pubkey)&&(c[e.toString()]=n),void 0===c[e.toString()]&&(c[e.toString()]=I.pubkey)}const u=await e.getProgramAccounts(r,{filters:[{memcmp:{offset:40,bytes:t.toString()}}]}),l=await e.getProgramAccounts(o,{filters:[{memcmp:{offset:40,bytes:t.toString()}}]}),d={},m={};for(const I of u){const e=(I.account.data.length===di.span?di:mi).decode(I.account.data),n=e.id.toString(),o=this.getAssociatedLedgerAccount({programId:r,poolId:e.id,owner:t,version:3});void 0===d[n]&&(d[n]={pda:void 0,other:[]}),o.equals(I.pubkey)?d[n].pda=I.pubkey:d[n].other.push(I.pubkey)}for(const I of l){const e=(I.account.data.length===pi.span?pi:fi).decode(I.account.data),n=e.id.toString(),r=this.getAssociatedLedgerAccount({programId:o,poolId:e.id,owner:t,version:5});void 0===m[n]&&(m[n]={pda:void 0,other:[]}),r.equals(I.pubkey)?m[n].pda=I.pubkey:m[n].other.push(I.pubkey)}const p=[...Object.entries(d).filter((e=>e[1].other.length>0)).map((e=>e[0])),...Object.entries(m).filter((e=>e[1].other.length>0)).map((e=>e[0]))],f=await e.getMultipleAccountsInfo(p.map((e=>new re(e)))),g={};for(let I=0;I<p.length;I++){const e=p[I],t=f[I];null!==t&&(g[e]=t.data)}const w=[],h=[],k=[],y=[],A=[];for(const[I,b]of Object.entries(d)){if(0===b.other.length)continue;if(void 0===g[I])continue;const n=oi.decode(g[I]),[o,i]=await e.getMultipleAccountsInfo([n.lpVault,n.rewardVault]);if(null===o||null===i)throw Error("get lp and reward info error");const s=Uo.decode(o.data),a=Uo.decode(i.data);let u=c[s.mint.toString()];void 0===u&&(u=await this._selectOrCreateTokenAccount({programId:o.owner,mint:s.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:w,frontInstructionsType:h,endInstructions:[],endInstructionsType:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[s.mint.toString()]=u);let l=c[a.mint.toString()];if(void 0===l&&(l=await this._selectOrCreateTokenAccount({programId:i.owner,mint:a.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:w,frontInstructionsType:h,endInstructions:a.mint.toString()===yr?y:[],endInstructionsType:a.mint.toString()===yr?A:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[a.mint.toString()]=l),void 0===b.pda){const e=this.makeCreateAssociatedLedgerAccountInstructionV3({poolKeys:{programId:r,id:new re(I)},userKeys:{ledger:this.getAssociatedLedgerAccount({programId:r,poolId:new re(I),owner:t,version:3}),owner:t}});k.push(e.innerTransaction)}const d=this.makeDepositInstructionV3({amount:0,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:r,poolId:new re(I),owner:t,version:3}),owner:t,lpTokenAccount:u,rewardTokenAccounts:[l],auxiliaryLedgers:b.other},poolKeys:{programId:r,id:new re(I),authority:this.getAssociatedAuthority({programId:r,poolId:new re(I)}).publicKey,lpVault:n.lpVault,rewardInfos:[{rewardVault:n.rewardVault}]}});k.push(d.innerTransaction)}for(const[I,b]of Object.entries(m)){if(0===b.other.length)continue;if(void 0===g[I])continue;const n=ii.decode(g[I]),[r,i,s]=await e.getMultipleAccountsInfo([n.lpVault,n.rewardVaultA,n.rewardVaultB]);if(null===r||null===i||null===s)throw Error("get lp and reward A / B info error");const a=Uo.decode(r.data),u=Uo.decode(i.data),l=Uo.decode(s.data);let d=c[a.mint.toString()];void 0===d&&(d=await this._selectOrCreateTokenAccount({programId:r.owner,mint:a.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:w,frontInstructionsType:h,endInstructions:[],endInstructionsType:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[a.mint.toString()]=d);let m=c[u.mint.toString()];void 0===m&&(m=await this._selectOrCreateTokenAccount({programId:i.owner,mint:u.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:w,frontInstructionsType:h,endInstructions:u.mint.toString()===yr?y:[],endInstructionsType:u.mint.toString()===yr?A:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[u.mint.toString()]=m);let p=c[l.mint.toString()];if(void 0===p&&(p=await this._selectOrCreateTokenAccount({programId:s.owner,mint:l.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:w,frontInstructionsType:h,endInstructions:l.mint.toString()===yr?y:[],endInstructionsType:l.mint.toString()===yr?A:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[l.mint.toString()]=p),void 0===b.pda){const e=this.makeCreateAssociatedLedgerAccountInstructionV5({poolKeys:{programId:o,id:new re(I)},userKeys:{ledger:this.getAssociatedLedgerAccount({programId:o,poolId:new re(I),owner:t,version:5}),owner:t}});k.push(e.innerTransaction)}const f=this.makeDepositInstructionV5({amount:0,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:o,poolId:new re(I),owner:t,version:5}),owner:t,lpTokenAccount:d,rewardTokenAccounts:[m,p],auxiliaryLedgers:b.other},poolKeys:{programId:o,id:new re(I),authority:this.getAssociatedAuthority({programId:o,poolId:new re(I)}).publicKey,lpVault:n.lpVault,rewardInfos:[{rewardVault:n.rewardVaultA},{rewardVault:n.rewardVaultB}]}});k.push(f.innerTransaction)}return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:i,computeBudgetConfig:a,payer:t,innerTransaction:[{instructionTypes:h.slice(0,10),instructions:w.slice(0,10),signers:[]},...w.length>10?[{instructionTypes:h.slice(10),instructions:w.slice(10),signers:[]}]:[],...k,{instructionTypes:A,instructions:y,signers:[]}],lookupTableCache:s})}}static async makeDepositTokenInstruction({connection:e,programId:t,governanceProgramId:n,voteWeightAddinProgramId:r,realm:o,communityTokenMint:i,owner:s,poolId:a}){const c=vi(r,o,i).publicKey,u=this.getAssociatedLedgerAccount({programId:t,poolId:a,owner:s,version:3}),l=await e.getAccountInfo(u);if(null===l)throw Error("user is not staker");const d=mi.decode(l.data),m=d.deposited.sub(d.voteLockedBalance);if(m.eq(ar))throw Error("user do not has new stake amount");const p=Si(t,a).publicKey,f=xi(t,a).publicKey,{publicKey:g,nonce:w}=Oi(r,c,s),h=zo(g,p,se).publicKey,{publicKey:k,nonce:y}=Bi(r,c,s),A=Ci(n,o,i,s).publicKey,I=[],b=zo(s,p,se).publicKey;if(null===await e.getAccountInfo(b)&&I.push(Xo.makeCreateAssociatedTokenAccountInstruction({programId:se,mint:p,associatedAccount:b,owner:s,payer:s,instructionsType:[]})),null===await e.getAccountInfo(g)){const e=function(e,t,n,r,o,i){const s=Do([Co("ins")]),a=[Qn(t,!1),Qn(n,!1),Hn(i,!1),Qn(r,!1),Hn(o,!0),Qn(_n,!1)],c=ee.alloc(s.span);return s.encode({ins:23},c),new ie({keys:a,programId:e,data:c})}(n,o,s,i,s,A);I.push(e,function(e,t,n,r,o,i,s,a){const c=Do([Co("voterBump"),Co("voterWeightRecordBump")]),u=[Qn(t,!1),Hn(n,!1),Qn(o,!0),Hn(r,!1),Hn(i,!0),Qn(_n,!1),Qn(Un,!1),Qn(Xn,!1)],l=ee.alloc(c.span);c.encode({voterBump:s,voterWeightRecordBump:a},l);const d=ee.from([...ri.voterStakeRegistryCreateVoter,...l]);return new ie({keys:u,programId:e,data:d})}(r,c,g,k,s,s,w,y))}const{index:T,isInit:v}=await Mi(e,c,g,p);return v||I.push(function(e,t,n,r,o,i,s,a,c,u,l,d){const m=Do([Co("depositEntryIndex"),Co("kind"),Co("option"),Po("startTs"),qo("periods"),Vo("allowClawback")]),p=[Qn(t,!1),Hn(n,!1),Hn(r,!1),Qn(o,!0),Hn(i,!0),Qn(s,!1),Qn(_n,!1),Qn(se,!1),Qn(le,!1),Qn(Un,!1)],f=ee.alloc(m.span);m.encode({depositEntryIndex:a,kind:c,option:void 0===u?0:1,startTs:u??ar,periods:l,allowClawback:d},f);const g=ee.from([...ri.voterStakeRegistryCreateDepositEntry,...f]);return new ie({keys:p,programId:e,data:g})}(r,c,g,h,s,s,p,T,0,void 0,0,!1)),I.push(function(e,t,n,r,o,i,s,a,c,u,l,d,m){const p=Do([Co("depositEntryIndex"),Po("amount")]),f=[Qn(t,!1),Hn(n,!1),Hn(r,!1),Hn(o,!1),Qn(i,!0),Qn(se,!1),Hn(s,!1),Qn(a,!1),Hn(c,!1),Qn(u,!1),Qn(l,!1),Qn(Xn,!1)],g=ee.alloc(p.span);p.encode({depositEntryIndex:d,amount:m},g);const w=ee.from([...ri.voterStakeRegistryDeposit,...g]);return new ie({keys:f,programId:e,data:w})}(r,c,g,h,b,s,u,a,p,f,t,T,m),function(e,t,n,r){const o=Do([]),i=[Qn(t,!1),Qn(n,!1),Hn(r,!1),Qn(_n,!1)],s=ee.alloc(o.span);o.encode({},s);const a=ee.from([...ri.voterStakeRegistryUpdateVoterWeightRecord,...s]);return new ie({keys:i,programId:e,data:a})}(r,c,g,k)),{address:{},innerTransaction:{instructions:I,signers:[],lookupTableAddress:[],instructionTypes:Array(I.length).fill(jo.test)}}}static async makeWithdrawTokenInstruction({connection:e,programId:t,governanceProgramId:n,voteWeightAddinProgramId:r,realm:o,communityTokenMint:i,owner:s,poolId:a}){const c=vi(r,o,i).publicKey,u=this.getAssociatedLedgerAccount({programId:t,poolId:a,owner:s,version:3}),l=await e.getAccountInfo(u);if(null===l)throw Error("user is not staker");const d=mi.decode(l.data);if(d.voteLockedBalance.eq(ar))throw Error("user has vote locked balance = 0");const m=Si(t,a).publicKey,p=xi(t,a).publicKey,{publicKey:f}=Oi(r,c,s),g=zo(f,m,se).publicKey,{publicKey:w}=Bi(r,c,s),h=Ci(n,o,i,s).publicKey,k=[],{index:y,isInit:A}=await Mi(e,c,f,m);if(!A)throw Error("deposit entry index check error");return k.push(function(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f){const g=Do([Co("depositEntryIndex"),Po("amount")]),w=[Qn(t,!1),Hn(n,!1),Qn(r,!0),Qn(o,!1),Hn(i,!1),Hn(s,!1),Hn(a,!1),Qn(se,!1),Hn(c,!1),Qn(u,!1),Hn(l,!1),Qn(d,!1),Qn(m,!1),Qn(Xn,!1)],h=ee.alloc(g.span);g.encode({depositEntryIndex:p,amount:f},h);const k=ee.from([...ri.voterStakeRegistryWithdraw,...h]);return new ie({keys:w,programId:e,data:k})}(r,c,f,s,h,w,g,zo(s,m,se).publicKey,u,a,m,p,t,y,d.voteLockedBalance)),{address:{},innerTransaction:{instructions:k,signers:[],lookupTableAddress:[],instructionTypes:Array(k.length).fill(jo.test)}}}}async function Mi(e,t,n,r){const o=await e.getAccountInfo(t);if(null===o)throw Error("registrar info check error");const i=Ai.decode(o.data).votingMints.findIndex((e=>e.mint.equals(r)));if(-1===i)throw Error("find voter mint error");const s=await e.getAccountInfo(n);if(null===s)return{index:i,isInit:!1};const a=Ti.decode(s.data).deposits.findIndex((e=>e.isUsed&&e.votingMintConfigIdx===i));return-1===a?{index:i,isInit:!1}:{index:a,isInit:!0}}const Li=Do([Po("status"),Po("nonce"),Po("maxOrder"),Po("depth"),Po("baseDecimal"),Po("quoteDecimal"),Po("state"),Po("resetFlag"),Po("minSize"),Po("volMaxCutRatio"),Po("amountWaveRatio"),Po("baseLotSize"),Po("quoteLotSize"),Po("minPriceMultiplier"),Po("maxPriceMultiplier"),Po("systemDecimalValue"),Po("minSeparateNumerator"),Po("minSeparateDenominator"),Po("tradeFeeNumerator"),Po("tradeFeeDenominator"),Po("pnlNumerator"),Po("pnlDenominator"),Po("swapFeeNumerator"),Po("swapFeeDenominator"),Po("baseNeedTakePnl"),Po("quoteNeedTakePnl"),Po("quoteTotalPnl"),Po("baseTotalPnl"),Po("poolOpenTime"),Po("punishPcAmount"),Po("punishCoinAmount"),Po("orderbookToInitTime"),Eo("swapBaseInAmount"),Eo("swapQuoteOutAmount"),Po("swapBase2QuoteFee"),Eo("swapQuoteInAmount"),Eo("swapBaseOutAmount"),Po("swapQuote2BaseFee"),No("baseVault"),No("quoteVault"),No("baseMint"),No("quoteMint"),No("lpMint"),No("openOrders"),No("marketId"),No("marketProgramId"),No("targetOrders"),No("withdrawQueue"),No("lpVault"),No("owner"),Po("lpReserve"),_o(Po(),3,"padding")]),Ni=Do([Po("accountType"),Po("status"),Po("nonce"),Po("maxOrder"),Po("depth"),Po("baseDecimal"),Po("quoteDecimal"),Po("state"),Po("resetFlag"),Po("minSize"),Po("volMaxCutRatio"),Po("amountWaveRatio"),Po("baseLotSize"),Po("quoteLotSize"),Po("minPriceMultiplier"),Po("maxPriceMultiplier"),Po("systemDecimalsValue"),Po("abortTradeFactor"),Po("priceTickMultiplier"),Po("priceTick"),Po("minSeparateNumerator"),Po("minSeparateDenominator"),Po("tradeFeeNumerator"),Po("tradeFeeDenominator"),Po("pnlNumerator"),Po("pnlDenominator"),Po("swapFeeNumerator"),Po("swapFeeDenominator"),Po("baseNeedTakePnl"),Po("quoteNeedTakePnl"),Po("quoteTotalPnl"),Po("baseTotalPnl"),Po("poolOpenTime"),Po("punishPcAmount"),Po("punishCoinAmount"),Po("orderbookToInitTime"),Eo("swapBaseInAmount"),Eo("swapQuoteOutAmount"),Eo("swapQuoteInAmount"),Eo("swapBaseOutAmount"),Po("swapQuote2BaseFee"),Po("swapBase2QuoteFee"),No("baseVault"),No("quoteVault"),No("baseMint"),No("quoteMint"),No("lpMint"),No("modelDataAccount"),No("openOrders"),No("marketId"),No("marketProgramId"),No("targetOrders"),No("owner"),_o(Po(),64,"padding")]),Vi={4:Li,5:Ni};
/*!
       *  decimal.js v10.4.3
       *  An arbitrary-precision Decimal type for JavaScript.
       *  https://github.com/MikeMcl/decimal.js
       *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
       *  MIT Licence
       */
var Ri,Fi,Wi=9e15,Di=1e9,_i="0123456789abcdef",Ki="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Ui="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",zi={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Wi,maxE:Wi,crypto:!1},Xi=!0,Gi="[DecimalError] ",ji=Gi+"Invalid argument: ",Hi=Gi+"Precision limit exceeded",Qi=Gi+"crypto unavailable",Zi="[object Decimal]",$i=Math.floor,Yi=Math.pow,Ji=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,es=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ts=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ns=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,rs=1e7,os=Ki.length-1,is=Ui.length-1,ss={toStringTag:Zi};function as(e){var t,n,r,o=e.length-1,i="",s=e[0];if(o>0){for(i+=s,t=1;t<o;t++)(n=7-(r=e[t]+"").length)&&(i+=ks(n)),i+=r;(n=7-(r=(s=e[t])+"").length)&&(i+=ks(n))}else if(0===s)return"0";for(;s%10==0;)s/=10;return i+s}function cs(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ji+e)}function us(e,t,n,r){var o,i,s,a;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=7,o=0):(o=Math.ceil((t+1)/7),t%=7),i=Yi(10,7-t),a=e[o]%i|0,null==r?t<3?(0==t?a=a/100|0:1==t&&(a=a/10|0),s=n<4&&99999==a||n>3&&49999==a||5e4==a||0==a):s=(n<4&&a+1==i||n>3&&a+1==i/2)&&(e[o+1]/i/100|0)==Yi(10,t-2)-1||(a==i/2||0==a)&&0==(e[o+1]/i/100|0):t<4?(0==t?a=a/1e3|0:1==t?a=a/100|0:2==t&&(a=a/10|0),s=(r||n<4)&&9999==a||!r&&n>3&&4999==a):s=((r||n<4)&&a+1==i||!r&&n>3&&a+1==i/2)&&(e[o+1]/i/1e3|0)==Yi(10,t-3)-1,s}function ls(e,t,n){for(var r,o,i=[0],s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=_i.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(void 0===i[r+1]&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}ss.absoluteValue=ss.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),ms(e)},ss.ceil=function(){return ms(new this.constructor(this),this.e+1,2)},ss.clampedTo=ss.clamp=function(e,t){var n=this,r=n.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(ji+t);return n.cmp(e)<0?e:n.cmp(t)>0?t:new r(n)},ss.comparedTo=ss.cmp=function(e){var t,n,r,o,i=this,s=i.d,a=(e=new i.constructor(e)).d,c=i.s,u=e.s;if(!s||!a)return c&&u?c!==u?c:s===a?0:!s^c<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(i.e!==e.e)return i.e>e.e^c<0?1:-1;for(t=0,n=(r=s.length)<(o=a.length)?r:o;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===o?0:r>o^c<0?1:-1},ss.cosine=ss.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r,o;if(t.isZero())return t;(r=t.d.length)<32?o=(1/Bs(4,n=Math.ceil(r/3))).toString():(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=Os(e,1,t.times(o),new e(1));for(var i=n;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}(r,Cs(r,n)),r.precision=e,r.rounding=t,ms(2==Fi||3==Fi?n.neg():n,e,t,!0)):new r(1):new r(NaN)},ss.cubeRoot=ss.cbrt=function(){var e,t,n,r,o,i,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(Xi=!1,(i=l.s*Yi(l.s*l,1/3))&&Math.abs(i)!=1/0?r=new d(i.toString()):(n=as(l.d),(i=((e=l.e)-n.length+1)%3)&&(n+=1==i||-2==i?"0":"00"),i=Yi(n,1/3),e=$i((e+1)/3)-(e%3==(e<0?-1:2)),(r=new d(n=i==1/0?"5e"+e:(n=i.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=l.s),s=(e=d.precision)+3;;)if(u=(c=(a=r).times(a).times(a)).plus(l),r=ds(u.plus(l).times(a),u.plus(c),s+2,1),as(a.d).slice(0,s)===(n=as(r.d)).slice(0,s)){if("9999"!=(n=n.slice(s-3,s+1))&&(o||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(ms(r,e+1,1),t=!r.times(r).times(r).eq(l));break}if(!o&&(ms(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,o=1}return Xi=!0,ms(r,e,d.rounding,t)},ss.decimalPlaces=ss.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=7*((e=t.length-1)-$i(this.e/7)),e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},ss.dividedBy=ss.div=function(e){return ds(this,new this.constructor(e))},ss.dividedToIntegerBy=ss.divToInt=function(e){var t=this.constructor;return ms(ds(this,new t(e),0,1,1),t.precision,t.rounding)},ss.equals=ss.eq=function(e){return 0===this.cmp(e)},ss.floor=function(){return ms(new this.constructor(this),this.e+1,3)},ss.greaterThan=ss.gt=function(e){return this.cmp(e)>0},ss.greaterThanOrEqualTo=ss.gte=function(e){var t=this.cmp(e);return 1==t||0===t},ss.hyperbolicCosine=ss.cosh=function(){var e,t,n,r,o,i=this,s=i.constructor,a=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(i.e,i.sd())+4,s.rounding=1,(o=i.d.length)<32?t=(1/Bs(4,e=Math.ceil(o/3))).toString():(e=16,t="2.3283064365386962890625e-10"),i=Os(s,1,i.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=i.times(i),i=a.minus(c.times(l.minus(c.times(l))));return ms(i,s.precision=n,s.rounding=r,!0)},ss.hyperbolicSine=ss.sinh=function(){var e,t,n,r,o=this,i=o.constructor;if(!o.isFinite()||o.isZero())return new i(o);if(t=i.precision,n=i.rounding,i.precision=t+Math.max(o.e,o.sd())+4,i.rounding=1,(r=o.d.length)<3)o=Os(i,2,o,o,!0);else{e=(e=1.4*Math.sqrt(r))>16?16:0|e,o=Os(i,2,o=o.times(1/Bs(5,e)),o,!0);for(var s,a=new i(5),c=new i(16),u=new i(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(c.times(s).plus(u))))}return i.precision=t,i.rounding=n,ms(o,t,n,!0)},ss.hyperbolicTangent=ss.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,ds(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)},ss.inverseCosine=ss.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),o=n.precision,i=n.rounding;return-1!==r?0===r?t.isNeg()?ws(n,o,i):new n(0):new n(NaN):t.isZero()?ws(n,o+4,i).times(.5):(n.precision=o+6,n.rounding=1,t=t.asin(),e=ws(n,o+4,i).times(.5),n.precision=o,n.rounding=i,e.minus(t))},ss.inverseHyperbolicCosine=ss.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,Xi=!1,n=n.times(n).minus(1).sqrt().plus(n),Xi=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)},ss.inverseHyperbolicSine=ss.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,Xi=!1,n=n.times(n).plus(1).sqrt().plus(n),Xi=!0,r.precision=e,r.rounding=t,n.ln())},ss.inverseHyperbolicTangent=ss.atanh=function(){var e,t,n,r,o=this,i=o.constructor;return o.isFinite()?o.e>=0?new i(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=i.precision,t=i.rounding,r=o.sd(),Math.max(r,e)<2*-o.e-1?ms(new i(o),e,t,!0):(i.precision=n=r-o.e,o=ds(o.plus(1),new i(1).minus(o),n+e,1),i.precision=e+4,i.rounding=1,o=o.ln(),i.precision=e,i.rounding=t,o.times(.5))):new i(NaN)},ss.inverseSine=ss.asin=function(){var e,t,n,r,o=this,i=o.constructor;return o.isZero()?new i(o):(t=o.abs().cmp(1),n=i.precision,r=i.rounding,-1!==t?0===t?((e=ws(i,n+4,r).times(.5)).s=o.s,e):new i(NaN):(i.precision=n+6,i.rounding=1,o=o.div(new i(1).minus(o.times(o)).sqrt().plus(1)).atan(),i.precision=n,i.rounding=r,o.times(2)))},ss.inverseTangent=ss.atan=function(){var e,t,n,r,o,i,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=is)return(s=ws(l,d+4,m).times(.25)).s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=is)return(s=ws(l,d+4,m).times(.5)).s=u.s,s}for(l.precision=a=d+10,l.rounding=1,e=n=Math.min(28,a/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(Xi=!1,t=Math.ceil(a/7),r=1,c=u.times(u),s=new l(u),o=u;-1!==e;)if(o=o.times(c),i=s.minus(o.div(r+=2)),o=o.times(c),void 0!==(s=i.plus(o.div(r+=2))).d[t])for(e=t;s.d[e]===i.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),Xi=!0,ms(s,l.precision=d,l.rounding=m,!0)},ss.isFinite=function(){return!!this.d},ss.isInteger=ss.isInt=function(){return!!this.d&&$i(this.e/7)>this.d.length-2},ss.isNaN=function(){return!this.s},ss.isNegative=ss.isNeg=function(){return this.s<0},ss.isPositive=ss.isPos=function(){return this.s>0},ss.isZero=function(){return!!this.d&&0===this.d[0]},ss.lessThan=ss.lt=function(e){return this.cmp(e)<0},ss.lessThanOrEqualTo=ss.lte=function(e){return this.cmp(e)<1},ss.logarithm=ss.log=function(e){var t,n,r,o,i,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding;if(null==e)e=new l(10),t=!0;else{if(n=(e=new l(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:1!=u.s?NaN:n?0:1/0);if(t)if(n.length>1)i=!0;else{for(o=n[0];o%10==0;)o/=10;i=1!==o}if(Xi=!1,s=Ts(u,a=d+5),r=t?gs(l,a+10):Ts(e,a),us((c=ds(s,r,a,1)).d,o=d,m))do{if(s=Ts(u,a+=10),r=t?gs(l,a+10):Ts(e,a),c=ds(s,r,a,1),!i){+as(c.d).slice(o+1,o+15)+1==1e14&&(c=ms(c,d+1,0));break}}while(us(c.d,o+=10,m));return Xi=!0,ms(c,d,m)},ss.minus=ss.sub=function(e){var t,n,r,o,i,s,a,c,u,l,d,m,p=this,f=p.constructor;if(e=new f(e),!p.d||!e.d)return p.s&&e.s?p.d?e.s=-e.s:e=new f(e.d||p.s!==e.s?p:NaN):e=new f(NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,m=e.d,a=f.precision,c=f.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!u[0])return new f(3===c?-0:0);e=new f(p)}return Xi?ms(e,a,c):e}if(n=$i(e.e/7),l=$i(p.e/7),u=u.slice(),i=l-n){for((d=i<0)?(t=u,i=-i,s=m.length):(t=m,n=l,s=u.length),i>(r=Math.max(Math.ceil(a/7),s)+2)&&(i=r,t.length=1),t.reverse(),r=i;r--;)t.push(0);t.reverse()}else{for((d=(r=u.length)<(s=m.length))&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){d=u[r]<m[r];break}i=0}for(d&&(t=u,u=m,m=t,e.s=-e.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>i;){if(u[--r]<m[r]){for(o=r;o&&0===u[--o];)u[o]=rs-1;--u[o],u[r]+=rs}u[r]-=m[r]}for(;0===u[--s];)u.pop();for(;0===u[0];u.shift())--n;return u[0]?(e.d=u,e.e=fs(u,n),Xi?ms(e,a,c):e):new f(3===c?-0:0)},ss.modulo=ss.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?ms(new r(n),r.precision,r.rounding):(Xi=!1,9==r.modulo?(t=ds(n,e.abs(),0,3,1)).s*=e.s:t=ds(n,e,0,r.modulo,1),t=t.times(e),Xi=!0,n.minus(t))},ss.naturalExponential=ss.exp=function(){return bs(this)},ss.naturalLogarithm=ss.ln=function(){return Ts(this)},ss.negated=ss.neg=function(){var e=new this.constructor(this);return e.s=-e.s,ms(e)},ss.plus=ss.add=function(e){var t,n,r,o,i,s,a,c,u,l,d=this,m=d.constructor;if(e=new m(e),!d.d||!e.d)return d.s&&e.s?d.d||(e=new m(e.d||d.s===e.s?d:NaN)):e=new m(NaN),e;if(d.s!=e.s)return e.s=-e.s,d.minus(e);if(u=d.d,l=e.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(e=new m(d)),Xi?ms(e,a,c):e;if(i=$i(d.e/7),r=$i(e.e/7),u=u.slice(),o=i-r){for(o<0?(n=u,o=-o,s=l.length):(n=l,r=i,s=u.length),o>(s=(i=Math.ceil(a/7))>s?i+1:s+1)&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for((s=u.length)-(o=l.length)<0&&(o=s,n=l,l=u,u=n),t=0;o;)t=(u[--o]=u[o]+l[o]+t)/rs|0,u[o]%=rs;for(t&&(u.unshift(t),++r),s=u.length;0==u[--s];)u.pop();return e.d=u,e.e=fs(u,r),Xi?ms(e,a,c):e},ss.precision=ss.sd=function(e){var t,n=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(ji+e);return n.d?(t=hs(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t},ss.round=function(){var e=this,t=e.constructor;return ms(new t(e),e.e+1,t.rounding)},ss.sine=ss.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+7,r.rounding=1,n=function(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:Os(e,2,t,t);n=(n=1.4*Math.sqrt(r))>16?16:0|n,t=t.times(1/Bs(5,n)),t=Os(e,2,t,t);for(var o,i=new e(5),s=new e(16),a=new e(20);n--;)o=t.times(t),t=t.times(i.plus(o.times(s.times(o).minus(a))));return t}(r,Cs(r,n)),r.precision=e,r.rounding=t,ms(Fi>2?n.neg():n,e,t,!0)):new r(NaN)},ss.squareRoot=ss.sqrt=function(){var e,t,n,r,o,i,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(1!==u||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(Xi=!1,0==(u=Math.sqrt(+s))||u==1/0?(((t=as(a)).length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=$i((c+1)/2)-(c<0||c%2),r=new l(t=u==1/0?"5e"+c:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+c)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(r=(i=r).plus(ds(s,i,n+2,1)).times(.5),as(i.d).slice(0,n)===(t=as(r.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(o||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(ms(r,c+1,1),e=!r.times(r).eq(s));break}if(!o&&(ms(i,c+1,0),i.times(i).eq(s))){r=i;break}n+=4,o=1}return Xi=!0,ms(r,c,l.rounding,e)},ss.tangent=ss.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,(n=n.sin()).s=1,n=ds(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,ms(2==Fi||4==Fi?n.neg():n,e,t,!0)):new r(NaN)},ss.times=ss.mul=function(e){var t,n,r,o,i,s,a,c,u,l=this,d=l.constructor,m=l.d,p=(e=new d(e)).d;if(e.s*=l.s,!(m&&m[0]&&p&&p[0]))return new d(!e.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:m&&p?0*e.s:e.s/0);for(n=$i(l.e/7)+$i(e.e/7),(c=m.length)<(u=p.length)&&(i=m,m=p,p=i,s=c,c=u,u=s),i=[],r=s=c+u;r--;)i.push(0);for(r=u;--r>=0;){for(t=0,o=c+r;o>r;)a=i[o]+p[r]*m[o-r-1]+t,i[o--]=a%rs|0,t=a/rs|0;i[o]=(i[o]+t)%rs|0}for(;!i[--s];)i.pop();return t?++n:i.shift(),e.d=i,e.e=fs(i,n),Xi?ms(e,d.precision,d.rounding):e},ss.toBinary=function(e,t){return qs(this,2,e,t)},ss.toDecimalPlaces=ss.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),void 0===e?n:(cs(e,0,Di),void 0===t?t=r.rounding:cs(t,0,8),ms(n,e+n.e+1,t))},ss.toExponential=function(e,t){var n,r=this,o=r.constructor;return void 0===e?n=ps(r,!0):(cs(e,0,Di),void 0===t?t=o.rounding:cs(t,0,8),n=ps(r=ms(new o(r),e+1,t),!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n},ss.toFixed=function(e,t){var n,r,o=this,i=o.constructor;return void 0===e?n=ps(o):(cs(e,0,Di),void 0===t?t=i.rounding:cs(t,0,8),n=ps(r=ms(new i(o),e+o.e+1,t),!1,e+r.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n},ss.toFraction=function(e){var t,n,r,o,i,s,a,c,u,l,d,m,p=this,f=p.d,g=p.constructor;if(!f)return new g(p);if(u=n=new g(1),r=c=new g(0),s=(i=(t=new g(r)).e=hs(f)-p.e-1)%7,t.d[0]=Yi(10,s<0?7+s:s),null==e)e=i>0?t:u;else{if(!(a=new g(e)).isInt()||a.lt(u))throw Error(ji+a);e=a.gt(t)?i>0?t:u:a}for(Xi=!1,a=new g(as(f)),l=g.precision,g.precision=i=7*f.length*2;d=ds(a,t,0,1,1),1!=(o=n.plus(d.times(r))).cmp(e);)n=r,r=o,o=u,u=c.plus(d.times(o)),c=o,o=t,t=a.minus(d.times(o)),a=o;return o=ds(e.minus(n),r,0,1,1),c=c.plus(o.times(u)),n=n.plus(o.times(r)),c.s=u.s=p.s,m=ds(u,r,i,1).minus(p).abs().cmp(ds(c,n,i,1).minus(p).abs())<1?[u,r]:[c,n],g.precision=l,Xi=!0,m},ss.toHexadecimal=ss.toHex=function(e,t){return qs(this,16,e,t)},ss.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),null==e){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),void 0===t?t=r.rounding:cs(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(Xi=!1,n=ds(n,e,0,t,1).times(e),Xi=!0,ms(n)):(e.s=n.s,n=e),n},ss.toNumber=function(){return+this},ss.toOctal=function(e,t){return qs(this,8,e,t)},ss.toPower=ss.pow=function(e){var t,n,r,o,i,s,a=this,c=a.constructor,u=+(e=new c(e));if(!(a.d&&e.d&&a.d[0]&&e.d[0]))return new c(Yi(+a,u));if((a=new c(a)).eq(1))return a;if(r=c.precision,i=c.rounding,e.eq(1))return ms(a,r,i);if((t=$i(e.e/7))>=e.d.length-1&&(n=u<0?-u:u)<=9007199254740991)return o=ys(c,a,n,r),e.s<0?new c(1).div(o):ms(o,r,i);if((s=a.s)<0){if(t<e.d.length-1)return new c(NaN);if(0==(1&e.d[t])&&(s=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=s,a}return(t=0!=(n=Yi(+a,u))&&isFinite(n)?new c(n+"").e:$i(u*(Math.log("0."+as(a.d))/Math.LN10+a.e+1)))>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(Xi=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),(o=bs(e.times(Ts(a,r+n)),r)).d&&us((o=ms(o,r+5,1)).d,r,i)&&(t=r+10,+as((o=ms(bs(e.times(Ts(a,t+n)),t),t+5,1)).d).slice(r+1,r+15)+1==1e14&&(o=ms(o,r+1,0))),o.s=s,Xi=!0,c.rounding=i,ms(o,r,i))},ss.toPrecision=function(e,t){var n,r=this,o=r.constructor;return void 0===e?n=ps(r,r.e<=o.toExpNeg||r.e>=o.toExpPos):(cs(e,1,Di),void 0===t?t=o.rounding:cs(t,0,8),n=ps(r=ms(new o(r),e,t),e<=r.e||r.e<=o.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n},ss.toSignificantDigits=ss.toSD=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(cs(e,1,Di),void 0===t?t=n.rounding:cs(t,0,8)),ms(new n(this),e,t)},ss.toString=function(){var e=this,t=e.constructor,n=ps(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n},ss.truncated=ss.trunc=function(){return ms(new this.constructor(this),this.e+1,1)},ss.valueOf=ss.toJSON=function(){var e=this,t=e.constructor,n=ps(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};var ds=function(){function e(e,t,n){var r,o=0,i=e.length;for(e=e.slice();i--;)r=e[i]*t+o,e[i]=r%n|0,o=r/n|0;return o&&e.unshift(o),e}function t(e,t,n,r){var o,i;if(n!=r)i=n>r?1:-1;else for(o=i=0;o<n;o++)if(e[o]!=t[o]){i=e[o]>t[o]?1:-1;break}return i}function n(e,t,n,r){for(var o=0;n--;)e[n]-=o,o=e[n]<t[n]?1:0,e[n]=o*r+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(r,o,i,s,a,c){var u,l,d,m,p,f,g,w,h,k,y,A,I,b,T,v,S,x,O,B,C=r.constructor,q=r.s==o.s?1:-1,P=r.d,E=o.d;if(!(P&&P[0]&&E&&E[0]))return new C(r.s&&o.s&&(P?!E||P[0]!=E[0]:E)?P&&0==P[0]||!E?0*q:q/0:NaN);for(c?(p=1,l=r.e-o.e):(c=rs,p=7,l=$i(r.e/p)-$i(o.e/p)),O=E.length,S=P.length,k=(h=new C(q)).d=[],d=0;E[d]==(P[d]||0);d++);if(E[d]>(P[d]||0)&&l--,null==i?(b=i=C.precision,s=C.rounding):b=a?i+(r.e-o.e)+1:i,b<0)k.push(1),f=!0;else{if(b=b/p+2|0,d=0,1==O){for(m=0,E=E[0],b++;(d<S||m)&&b--;d++)T=m*c+(P[d]||0),k[d]=T/E|0,m=T%E|0;f=m||d<S}else{for((m=c/(E[0]+1)|0)>1&&(E=e(E,m,c),P=e(P,m,c),O=E.length,S=P.length),v=O,A=(y=P.slice(0,O)).length;A<O;)y[A++]=0;(B=E.slice()).unshift(0),x=E[0],E[1]>=c/2&&++x;do{m=0,(u=t(E,y,O,A))<0?(I=y[0],O!=A&&(I=I*c+(y[1]||0)),(m=I/x|0)>1?(m>=c&&(m=c-1),1==(u=t(g=e(E,m,c),y,w=g.length,A=y.length))&&(m--,n(g,O<w?B:E,w,c))):(0==m&&(u=m=1),g=E.slice()),(w=g.length)<A&&g.unshift(0),n(y,g,A,c),-1==u&&(u=t(E,y,O,A=y.length))<1&&(m++,n(y,O<A?B:E,A,c)),A=y.length):0===u&&(m++,y=[0]),k[d++]=m,u&&y[0]?y[A++]=P[v]||0:(y=[P[v]],A=1)}while((v++<S||void 0!==y[0])&&b--);f=void 0!==y[0]}k[0]||k.shift()}if(1==p)h.e=l,Ri=f;else{for(d=1,m=k[0];m>=10;m/=10)d++;h.e=d+l*p-1,ms(h,a?i+h.e+1:i,s,f)}return h}}();function ms(e,t,n,r){var o,i,s,a,c,u,l,d,m,p=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(o=1,a=d[0];a>=10;a/=10)o++;if((i=t-o)<0)i+=7,s=t,c=(l=d[m=0])/Yi(10,o-s-1)%10|0;else if((m=Math.ceil((i+1)/7))>=(a=d.length)){if(!r)break e;for(;a++<=m;)d.push(0);l=c=0,o=1,s=(i%=7)-7+1}else{for(l=a=d[m],o=1;a>=10;a/=10)o++;c=(s=(i%=7)-7+o)<0?0:l/Yi(10,o-s-1)%10|0}if(r=r||t<0||void 0!==d[m+1]||(s<0?l:l%Yi(10,o-s-1)),u=n<4?(c||r)&&(0==n||n==(e.s<0?3:2)):c>5||5==c&&(4==n||r||6==n&&(i>0?s>0?l/Yi(10,o-s):0:d[m-1])%10&1||n==(e.s<0?8:7)),t<1||!d[0])return d.length=0,u?(t-=e.e+1,d[0]=Yi(10,(7-t%7)%7),e.e=-t||0):d[0]=e.e=0,e;if(0==i?(d.length=m,a=1,m--):(d.length=m+1,a=Yi(10,7-i),d[m]=s>0?(l/Yi(10,o-s)%Yi(10,s)|0)*a:0),u)for(;;){if(0==m){for(i=1,s=d[0];s>=10;s/=10)i++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;i!=a&&(e.e++,d[0]==rs&&(d[0]=1));break}if(d[m]+=a,d[m]!=rs)break;d[m--]=0,a=1}for(i=d.length;0===d[--i];)d.pop()}return Xi&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function ps(e,t,n){if(!e.isFinite())return vs(e);var r,o=e.e,i=as(e.d),s=i.length;return t?(n&&(r=n-s)>0?i=i.charAt(0)+"."+i.slice(1)+ks(r):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):o<0?(i="0."+ks(-o-1)+i,n&&(r=n-s)>0&&(i+=ks(r))):o>=s?(i+=ks(o+1-s),n&&(r=n-o-1)>0&&(i=i+"."+ks(r))):((r=o+1)<s&&(i=i.slice(0,r)+"."+i.slice(r)),n&&(r=n-s)>0&&(o+1===s&&(i+="."),i+=ks(r))),i}function fs(e,t){var n=e[0];for(t*=7;n>=10;n/=10)t++;return t}function gs(e,t,n){if(t>os)throw Xi=!0,n&&(e.precision=n),Error(Hi);return ms(new e(Ki),t,1,!0)}function ws(e,t,n){if(t>is)throw Error(Hi);return ms(new e(Ui),t,n,!0)}function hs(e){var t=e.length-1,n=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ks(e){for(var t="";e--;)t+="0";return t}function ys(e,t,n,r){var o,i=new e(1),s=Math.ceil(r/7+4);for(Xi=!1;;){if(n%2&&Ps((i=i.times(t)).d,s)&&(o=!0),0===(n=$i(n/2))){n=i.d.length-1,o&&0===i.d[n]&&++i.d[n];break}Ps((t=t.times(t)).d,s)}return Xi=!0,i}function As(e){return 1&e.d[e.d.length-1]}function Is(e,t,n){for(var r,o=new e(t[0]),i=0;++i<t.length;){if(!(r=new e(t[i])).s){o=r;break}o[n](r)&&(o=r)}return o}function bs(e,t){var n,r,o,i,s,a,c,u=0,l=0,d=0,m=e.constructor,p=m.rounding,f=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(Xi=!1,c=f):c=t,a=new m(.03125);e.e>-2;)e=e.times(a),d+=5;for(c+=r=Math.log(Yi(2,d))/Math.LN10*2+5|0,n=i=s=new m(1),m.precision=c;;){if(i=ms(i.times(e),c,1),n=n.times(++l),as((a=s.plus(ds(i,n,c,1))).d).slice(0,c)===as(s.d).slice(0,c)){for(o=d;o--;)s=ms(s.times(s),c,1);if(null!=t)return m.precision=f,s;if(!(u<3&&us(s.d,c-r,p,u)))return ms(s,m.precision=f,p,Xi=!0);m.precision=c+=10,n=i=a=new m(1),l=0,u++}s=a}}function Ts(e,t){var n,r,o,i,s,a,c,u,l,d,m,p=1,f=e,g=f.d,w=f.constructor,h=w.rounding,k=w.precision;if(f.s<0||!g||!g[0]||!f.e&&1==g[0]&&1==g.length)return new w(g&&!g[0]?-1/0:1!=f.s?NaN:g?0:f);if(null==t?(Xi=!1,l=k):l=t,w.precision=l+=10,r=(n=as(g)).charAt(0),!(Math.abs(i=f.e)<15e14))return u=gs(w,l+2,k).times(i+""),f=Ts(new w(r+"."+n.slice(1)),l-10).plus(u),w.precision=k,null==t?ms(f,k,h,Xi=!0):f;for(;r<7&&1!=r||1==r&&n.charAt(1)>3;)r=(n=as((f=f.times(e)).d)).charAt(0),p++;for(i=f.e,r>1?(f=new w("0."+n),i++):f=new w(r+"."+n.slice(1)),d=f,c=s=f=ds(f.minus(1),f.plus(1),l,1),m=ms(f.times(f),l,1),o=3;;){if(s=ms(s.times(m),l,1),as((u=c.plus(ds(s,new w(o),l,1))).d).slice(0,l)===as(c.d).slice(0,l)){if(c=c.times(2),0!==i&&(c=c.plus(gs(w,l+2,k).times(i+""))),c=ds(c,new w(p),l,1),null!=t)return w.precision=k,c;if(!us(c.d,l-10,h,a))return ms(c,w.precision=k,h,Xi=!0);w.precision=l+=10,u=s=f=ds(d.minus(1),d.plus(1),l,1),m=ms(f.times(f),l,1),o=a=1}c=u,o+=2}}function vs(e){return String(e.s*e.s/0)}function Ss(e,t){var n,r,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;48===t.charCodeAt(r);r++);for(o=t.length;48===t.charCodeAt(o-1);--o);if(t=t.slice(r,o)){if(o-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%7,n<0&&(r+=7),r<o){for(r&&e.d.push(+t.slice(0,r)),o-=7;r<o;)e.d.push(+t.slice(r,r+=7));r=7-(t=t.slice(r)).length}else r-=o;for(;r--;)t+="0";e.d.push(+t),Xi&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function xs(e,t){var n,r,o,i,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),ns.test(t))return Ss(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(es.test(t))n=16,t=t.toLowerCase();else if(Ji.test(t))n=2;else{if(!ts.test(t))throw Error(ji+t);n=8}for((i=t.search(/p/i))>0?(c=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),s=(i=t.indexOf("."))>=0,r=e.constructor,s&&(i=(a=(t=t.replace(".","")).length)-i,o=ys(r,new r(n),i,2*i)),i=l=(u=ls(t,n,rs)).length-1;0===u[i];--i)u.pop();return i<0?new r(0*e.s):(e.e=fs(u,l),e.d=u,Xi=!1,s&&(e=ds(e,o,4*a)),c&&(e=e.times(Math.abs(c)<54?Yi(2,c):ka.pow(2,c))),Xi=!0,e)}function Os(e,t,n,r,o){var i,s,a,c,u=e.precision,l=Math.ceil(u/7);for(Xi=!1,c=n.times(n),a=new e(r);;){if(s=ds(a.times(c),new e(t++*t++),u,1),a=o?r.plus(s):r.minus(s),r=ds(s.times(c),new e(t++*t++),u,1),void 0!==(s=a.plus(r)).d[l]){for(i=l;s.d[i]===a.d[i]&&i--;);if(-1==i)break}i=a,a=r,r=s,s=i}return Xi=!0,s.d.length=l+1,s}function Bs(e,t){for(var n=e;--t;)n*=e;return n}function Cs(e,t){var n,r=t.s<0,o=ws(e,e.precision,1),i=o.times(.5);if((t=t.abs()).lte(i))return Fi=r?4:1,t;if((n=t.divToInt(o)).isZero())Fi=r?3:2;else{if((t=t.minus(n.times(o))).lte(i))return Fi=As(n)?r?2:3:r?4:1,t;Fi=As(n)?r?1:4:r?3:2}return t.minus(o).abs()}function qs(e,t,n,r){var o,i,s,a,c,u,l,d,m,p=e.constructor,f=void 0!==n;if(f?(cs(n,1,Di),void 0===r?r=p.rounding:cs(r,0,8)):(n=p.precision,r=p.rounding),e.isFinite()){for(f?(o=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):o=t,(s=(l=ps(e)).indexOf("."))>=0&&(l=l.replace(".",""),(m=new p(1)).e=l.length-s,m.d=ls(ps(m),10,o),m.e=m.d.length),i=c=(d=ls(l,10,o)).length;0==d[--c];)d.pop();if(d[0]){if(s<0?i--:((e=new p(e)).d=d,e.e=i,d=(e=ds(e,m,n,r,0,o)).d,i=e.e,u=Ri),s=d[n],a=o/2,u=u||void 0!==d[n+1],u=r<4?(void 0!==s||u)&&(0===r||r===(e.s<0?3:2)):s>a||s===a&&(4===r||u||6===r&&1&d[n-1]||r===(e.s<0?8:7)),d.length=n,u)for(;++d[--n]>o-1;)d[n]=0,n||(++i,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=_i.charAt(d[s]);if(f){if(c>1)if(16==t||8==t){for(s=16==t?4:3,--c;c%s;c++)l+="0";for(c=(d=ls(l,o,t)).length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=_i.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)l="0"+l;l="0."+l}else if(++i>c)for(i-=c;i--;)l+="0";else i<c&&(l=l.slice(0,i)+"."+l.slice(i))}else l=f?"0p+0":"0";l=(16==t?"0x":2==t?"0b":8==t?"0o":"")+l}else l=vs(e);return e.s<0?"-"+l:l}function Ps(e,t){if(e.length>t)return e.length=t,!0}function Es(e){return new this(e).abs()}function Ms(e){return new this(e).acos()}function Ls(e){return new this(e).acosh()}function Ns(e,t){return new this(e).plus(t)}function Vs(e){return new this(e).asin()}function Rs(e){return new this(e).asinh()}function Fs(e){return new this(e).atan()}function Ws(e){return new this(e).atanh()}function Ds(e,t){e=new this(e),t=new this(t);var n,r=this.precision,o=this.rounding,i=r+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?ws(this,r,o):new this(0)).s=e.s:!e.d||t.isZero()?(n=ws(this,i,1).times(.5)).s=e.s:t.s<0?(this.precision=i,this.rounding=1,n=this.atan(ds(e,t,i,1)),t=ws(this,i,1),this.precision=r,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(ds(e,t,i,1)):(n=ws(this,i,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function _s(e){return new this(e).cbrt()}function Ks(e){return ms(e=new this(e),e.e+1,2)}function Us(e,t,n){return new this(e).clamp(t,n)}function zs(e){if(!e||"object"!=typeof e)throw Error(Gi+"Object expected");var t,n,r,o=!0===e.defaults,i=["precision",1,Di,"rounding",0,8,"toExpNeg",-Wi,0,"toExpPos",0,Wi,"maxE",0,Wi,"minE",-Wi,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(n=i[t],o&&(this[n]=zi[n]),void 0!==(r=e[n])){if(!($i(r)===r&&r>=i[t+1]&&r<=i[t+2]))throw Error(ji+n+": "+r);this[n]=r}if(n="crypto",o&&(this[n]=zi[n]),void 0!==(r=e[n])){if(!0!==r&&!1!==r&&0!==r&&1!==r)throw Error(ji+n+": "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Error(Qi);this[n]=!0}else this[n]=!1}return this}function Xs(e){return new this(e).cos()}function Gs(e){return new this(e).cosh()}function js(e,t){return new this(e).div(t)}function Hs(e){return new this(e).exp()}function Qs(e){return ms(e=new this(e),e.e+1,3)}function Zs(){var e,t,n=new this(0);for(Xi=!1,e=0;e<arguments.length;)if((t=new this(arguments[e++])).d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return Xi=!0,new this(1/0);n=t}return Xi=!0,n.sqrt()}function $s(e){return e instanceof ka||e&&e.toStringTag===Zi||!1}function Ys(e){return new this(e).ln()}function Js(e,t){return new this(e).log(t)}function ea(e){return new this(e).log(2)}function ta(e){return new this(e).log(10)}function na(){return Is(this,arguments,"lt")}function ra(){return Is(this,arguments,"gt")}function oa(e,t){return new this(e).mod(t)}function ia(e,t){return new this(e).mul(t)}function sa(e,t){return new this(e).pow(t)}function aa(e){var t,n,r,o,i=0,s=new this(1),a=[];if(void 0===e?e=this.precision:cs(e,1,Di),r=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));i<r;)(o=t[i])>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:a[i++]=o%1e7;else{if(!crypto.randomBytes)throw Error(Qi);for(t=crypto.randomBytes(r*=4);i<r;)(o=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((127&t[i+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,i):(a.push(o%1e7),i+=4);i=r/4}else for(;i<r;)a[i++]=1e7*Math.random()|0;for(e%=7,(r=a[--i])&&e&&(o=Yi(10,7-e),a[i]=(r/o|0)*o);0===a[i];i--)a.pop();if(i<0)n=0,a=[0];else{for(n=-1;0===a[0];n-=7)a.shift();for(r=1,o=a[0];o>=10;o/=10)r++;r<7&&(n-=7-r)}return s.e=n,s.d=a,s}function ca(e){return ms(e=new this(e),e.e+1,this.rounding)}function ua(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function la(e){return new this(e).sin()}function da(e){return new this(e).sinh()}function ma(e){return new this(e).sqrt()}function pa(e,t){return new this(e).sub(t)}function fa(){var e=0,t=arguments,n=new this(t[e]);for(Xi=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return Xi=!0,ms(n,this.precision,this.rounding)}function ga(e){return new this(e).tan()}function wa(e){return new this(e).tanh()}function ha(e){return ms(e=new this(e),e.e+1,1)}ss[Symbol.for("nodejs.util.inspect.custom")]=ss.toString,ss[Symbol.toStringTag]="Decimal";var ka=e("D",ss.constructor=function e(t){var n,r,o;function i(e){var t,n,r,o=this;if(!(o instanceof i))return new i(e);if(o.constructor=i,$s(e))return o.s=e.s,void(Xi?!e.d||e.e>i.maxE?(o.e=NaN,o.d=null):e.e<i.minE?(o.e=0,o.d=[0]):(o.e=e.e,o.d=e.d.slice()):(o.e=e.e,o.d=e.d?e.d.slice():e.d));if("number"==(r=typeof e)){if(0===e)return o.s=1/e<0?-1:1,o.e=0,void(o.d=[0]);if(e<0?(e=-e,o.s=-1):o.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;return void(Xi?t>i.maxE?(o.e=NaN,o.d=null):t<i.minE?(o.e=0,o.d=[0]):(o.e=t,o.d=[e]):(o.e=t,o.d=[e]))}return 0*e!=0?(e||(o.s=NaN),o.e=NaN,void(o.d=null)):Ss(o,e.toString())}if("string"!==r)throw Error(ji+e);return 45===(n=e.charCodeAt(0))?(e=e.slice(1),o.s=-1):(43===n&&(e=e.slice(1)),o.s=1),ns.test(e)?Ss(o,e):xs(o,e)}if(i.prototype=ss,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=zs,i.clone=e,i.isDecimal=$s,i.abs=Es,i.acos=Ms,i.acosh=Ls,i.add=Ns,i.asin=Vs,i.asinh=Rs,i.atan=Fs,i.atanh=Ws,i.atan2=Ds,i.cbrt=_s,i.ceil=Ks,i.clamp=Us,i.cos=Xs,i.cosh=Gs,i.div=js,i.exp=Hs,i.floor=Qs,i.hypot=Zs,i.ln=Ys,i.log=Js,i.log10=ta,i.log2=ea,i.max=na,i.min=ra,i.mod=oa,i.mul=ia,i.pow=sa,i.random=aa,i.round=ca,i.sign=ua,i.sin=la,i.sinh=da,i.sqrt=ma,i.sub=pa,i.sum=fa,i.tan=ga,i.tanh=wa,i.trunc=ha,void 0===t&&(t={}),t&&!0!==t.defaults)for(o=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<o.length;)t.hasOwnProperty(r=o[n++])||(t[r]=this[r]);return i.config(t),i}(zi));Ki=new ka(Ki),Ui=new ka(Ui);const ya={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]};function Aa(e,t,n,r,o,i,s,a,c,u,l,d,m,p){const f=Do([Eo("sqrtPriceX64"),Po("startTime")]),g=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:Un,isSigner:!1,isWritable:!1}],w=ee.alloc(f.span);f.encode({sqrtPriceX64:m,startTime:p},w);const h=ee.from([...ya.createPool,...w]);return new ie({keys:g,programId:e,data:h})}function Ia(e,t,n,r,o){const i=Do([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1}],a=ee.alloc(i.span);i.encode({},a);const c=ee.from([...ya.closePosition,...a]);return new ie({keys:s,programId:e,data:c})}function ba(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h){const k=Do([Eo("liquidity"),Po("amountMaxA"),Po("amountMaxB"),Co("optionBaseFlag"),Vo("baseFlag")]),y=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...y],I=ee.alloc(k.span);k.encode({liquidity:f,amountMaxA:g,amountMaxB:w,optionBaseFlag:0,baseFlag:!1},I);const b=ee.from([...ya.increaseLiquidity,...I]);return new ie({keys:A,programId:e,data:b})}function Ta(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h){const k=Do([Eo("liquidity"),Po("amountMaxA"),Po("amountMaxB"),Co("optionBaseFlag"),Vo("baseFlag")]),y=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...y],I=ee.alloc(k.span);k.encode({liquidity:ar,amountMaxA:"MintA"===f?g:w,amountMaxB:"MintA"===f?w:g,baseFlag:"MintA"===f,optionBaseFlag:1},I);const b=ee.from([...ya.increaseLiquidity,...I]);return new ie({keys:A,programId:e,data:b})}function va(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h,k){const y=Do([Eo("liquidity"),Po("amountMinA"),Po("amountMinB")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...f.map((e=>[{pubkey:e.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:e.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:e.rewardMint,isSigner:!1,isWritable:!1}])).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...A],b=ee.alloc(y.span);y.encode({liquidity:g,amountMinA:w,amountMinB:h},b);const T=ee.from([...ya.decreaseLiquidity,...b]);return new ie({keys:I,programId:e,data:T})}function Sa(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w){const h=Do([Po("amount"),Po("otherAmountThreshold"),Eo("sqrtPriceLimitX64"),Vo("isBaseInput")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...l.map((e=>({pubkey:e,isSigner:!1,isWritable:!0})))],y=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},...k],A=ee.alloc(h.span);h.encode({amount:m,otherAmountThreshold:p,sqrtPriceLimitX64:f,isBaseInput:g},A);const I=ee.from([...ya.swap,...A]);return new ie({keys:y,programId:e,data:I})}function xa(e,t,n,r,o,i,s,a,c,u,l,d){const m=Do([Po("openTime"),Po("endTime"),Eo("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:Un,isSigner:!1,isWritable:!1}],f=ee.alloc(m.span);m.encode({openTime:pr(u),endTime:pr(l),emissionsPerSecondX64:d},f);const g=ee.from([...ya.initReward,...f]);return new ie({keys:p,programId:e,data:g})}function Oa(e,t,n,r,o,i,s,a,c,u,l,d){const m=Do([Co("rewardIndex"),Eo("emissionsPerSecondX64"),Po("openTime"),Po("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],f=ee.alloc(m.span);m.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:pr(u),endTime:pr(l)},f);const g=ee.from([...ya.setRewardEmissions,...f]);return new ie({keys:p,programId:e,data:g})}function Ba(e,t,n,r,o,i,s){const a=Do([Co("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1}],u=ee.alloc(a.span);a.encode({rewardIndex:s},u);const l=ee.from([...ya.collectReward,...u]);return new ie({keys:c,programId:e,data:l})}const Ca=new Re(-1),qa=new Re(1).shln(64),Pa=new Re(1).shln(128),Ea=qa.sub(cr),Ma=Pa.subn(1),La=-443636,Na=443636,Va=new Re("4295048016"),Ra=new Re("79226673521066979257578248091"),Fa=new Re(10).pow(new Re(6));var Wa;!function(e){e[e.rate_500=500]="rate_500",e[e.rate_3000=3e3]="rate_3000",e[e.rate_10000=1e4]="rate_10000"}(Wa||(Wa={})),Wa.rate_500,Wa.rate_3000,Wa.rate_10000;const Da=new Re("18446744073700000000");function _a(e){const t=new ArrayBuffer(4);return new DataView(t).setInt32(0,e,!1),new Uint8Array(t)}function Ka(e,t){let n=0;for(let r=e-1;r>=0&&!t.testn(r);r--)n++;return n}function Ua(e,t){let n=0;for(let r=0;r<e&&!t.testn(r);r++)n++;return n}function za(e,t){for(let n=0;n<e;n++)if(t.testn(n))return!1;return!0}ee.from("amm_config","utf8");const Xa=ee.from("pool","utf8"),Ga=ee.from("pool_vault","utf8"),ja=ee.from("pool_reward_vault","utf8"),Ha=ee.from("position","utf8"),Qa=ee.from("tick_array","utf8"),Za=ee.from("operation","utf8"),$a=ee.from("pool_tick_array_bitmap_extension","utf8");function Ya(e,t,n){return jn([Ga,t.toBuffer(),n.toBuffer()],e)}function Ja(e,t,n){return jn([Qa,t.toBuffer(),_a(n)],e)}function ec(e,t,n,r){return jn([Ha,t.toBuffer(),_a(n),_a(r)],e)}function tc(e,t){return jn([Ha,t.toBuffer()],e)}function nc(e){return jn([ee.from("metadata","utf8"),zn.toBuffer(),e.toBuffer()],zn)}function rc(e){return jn([Za],e)}function oc(e,t){return jn([$a,t.toBuffer()],e)}class ic{static async getTickArrays(e,t,n,r,o,i,s){const a=[],c=cc.getTickArrayStartIndexByTick(r,o),u=cc.getInitializedTickArrayInRange(i,s,o,c,Math.floor(7.5));for(let m=0;m<u.length;m++){const{publicKey:e}=Ja(t,n,u[m]);a.push(e)}const l=(await Yn(e,a)).map((e=>null!==e?kc.decode(e.data):null)),d={};for(let m=0;m<a.length;m++){const e=l[m];null!==e&&(d[e.startTickIndex]={...e,address:a[m]})}return d}static nextInitializedTick(e,t,n,r,o,i){let{initializedTick:s,tickArrayAddress:a,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,i);for(;null==s||s.liquidityGross.lten(0);){if(c=cc.getNextTickArrayStartIndex(c,o,i),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");const r=n[c];if(void 0===r)continue;const{nextTick:u,tickArrayAddress:l,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,r,i);[s,a,c]=[u,l,d]}if(null==s)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:a,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){const i=Math.floor(e/ic.tickCount(t)),s=n?cc.searchLowBitFromStart(r,o,i-1,1,t):cc.searchHightBitFromStart(r,o,i+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let e=sc-1;for(;e>=0;){const t=n.ticks[e];if(t.liquidityGross.gtn(0)){o=t;break}e-=1}}else{let e=0;for(;e<sc;){const t=n.ticks[e];if(t.liquidityGross.gtn(0)){o=t;break}e+=1}}const{publicKey:i}=Ja(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:i,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,i){const s=cc.getTickArrayStartIndexByTick(r,o);let a=Math.floor((r-s)/o);const c=n[s];if(null==c)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let u;if(i)for(;a>=0;){const e=c.ticks[a];if(e.liquidityGross.gtn(0)){u=e;break}a-=1}else for(a+=1;a<sc;){const e=c.ticks[a];if(e.liquidityGross.gtn(0)){u=e;break}a+=1}const{publicKey:l}=Ja(e,t,s);return{initializedTick:u,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){const n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){return cc.checkIsOutOfBoundary(e)?!(e>Na)&&e==cc.getTickArrayStartIndexByTick(La,t):e%this.tickCount(t)==0}static tickCount(e){return sc*e}}const sc=60,ac=512;class cc{static getTickArrayAddressByTick(e,t,n,r){const o=cc.getTickArrayStartIndexByTick(n,r),{publicKey:i}=Ja(e,t,o);return i}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");const n=cc.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=sc)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){const n=ic.tickCount(t);let r=e/n;return r=e<0&&e%n!=0?Math.ceil(r)-1:Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ic.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){const n=t*sc,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){const r=n*sc,o=Math.floor(t/r)+512,i=Math.abs(o);return{isInitialized:e.testn(i),startIndex:(i-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*sc:e+t*sc}static mergeTickArrayBitmap(e){let t=new Re(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){const i=Math.floor(r/(n*sc));return[...cc.searchLowBitFromStart(e,t,i-1,o,n),...cc.searchHightBitFromStart(e,t,i,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return cc.searchHightBitFromStart(e,t,0,ac,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){const i=[],s=cc.getAllInitializedTickArrayStartIndex(n,r,o);for(const a of s){const{publicKey:n}=Ja(e,t,a);i.push({tickArrayStartIndex:a,tickArrayAddress:n})}return i}static getAllInitializedTickInTickArray(e){return e.ticks.filter((e=>e.liquidityGross.gtn(0)))}static searchLowBitFromStart(e,t,n,r,o){const i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map((e=>cc.mergeTickArrayBitmap(e))),s=[];for(;n>=-7680;){const e=(n+7680)%512;if(i[Math.floor((n+7680)/512)].testn(e)&&s.push(n),n--,s.length===r)break}const a=ic.tickCount(o);return s.map((e=>e*a))}static searchHightBitFromStart(e,t,n,r,o){const i=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map((e=>cc.mergeTickArrayBitmap(e))),s=[];for(;n<7680;){const e=(n+7680)%512;if(i[Math.floor((n+7680)/512)].testn(e)&&s.push(n),n++,s.length===r)break}const a=ic.tickCount(o);return s.map((e=>e*a))}static checkIsOutOfBoundary(e){return e<La||e>Na}static nextInitTick(e,t,n,r,o){if(ic.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let i=Math.floor((t-e.startTickIndex)/n);if(r)for(;i>=0;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i-=1}else for(o||(i+=1);i<sc;){if(e.ticks[i].liquidityGross.gtn(0))return e.ticks[i];i+=1}return null}static firstInitializedTick(e,t){if(t){let t=sc-1;for(;t>=0;){if(e.ticks[t].liquidityGross.gtn(0))return e.ticks[t];t-=1}}else{let t=0;for(;t<sc;){if(e.ticks[t].liquidityGross.gtn(0))return e.ticks[t];t+=1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}}class uc{static maxTickInTickarrayBitmap(e){return e*sc*ac}static getBitmapTickBoundary(e,t){const n=this.maxTickInTickarrayBitmap(t);let r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);const o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!ic.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");const o=this.maxTickInTickarrayBitmap(n),i=r?t-ic.tickCount(n):t+ic.tickCount(n);if(i<-o||i>=o)return{isInit:!1,tickIndex:t};const s=n*sc;let a=i/s+512;i<0&&i%s!=0&&a--;const c=Math.abs(a);if(r){const t=e.shln(1024-c-1),n=za(u=1024,l=t)?null:Ka(u,l);return null!==n?{isInit:!0,tickIndex:(c-n-512)*s}:{isInit:!1,tickIndex:-o}}{const t=function(e,t){return za(e,t)?null:Ua(e,t)}(1024,e.shrn(c));return null!==t?{isInit:!0,tickIndex:(c+t-512)*s}:{isInit:!1,tickIndex:o-ic.tickCount(n)}}var u,l}}class lc{static getBitmapOffset(e,t){if(!ic.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);const n=uc.maxTickInTickarrayBitmap(t);let r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n==0&&r--,r}static getBitmap(e,t,n){const r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){const{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){const t=uc.maxTickInTickarrayBitmap(e),n=-t;if(Na<=t)throw Error(`extensionTickBoundary check error: 443636, ${t}`);if(n<=La)throw Error(`extensionTickBoundary check error: ${n}, -443636`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){const{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:cc.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){const o=ic.tickCount(t),i=n?e-o:e+o,s=ic.getArrayStartIndex(La,t),a=ic.getArrayStartIndex(Na,t);if(i<s||i>a)return{isInit:!1,tickIndex:i};const{tickarrayBitmap:c}=this.getBitmap(i,t,r);return this.nextInitializedTickArrayInBitmap(c,i,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){const{minValue:o,maxValue:i}=uc.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(r){const r=cc.mergeTickArrayBitmap(e).shln(511-s),i=za(512,r)?null:Ka(512,r);return null!==i?{isInit:!0,tickIndex:t-i*ic.tickCount(n)}:{isInit:!1,tickIndex:o}}{const r=cc.mergeTickArrayBitmap(e).shrn(s),o=za(512,r)?null:Ua(512,r);return null!==o?{isInit:!0,tickIndex:t+o*ic.tickCount(n)}:{isInit:!1,tickIndex:i-ic.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){const n=Math.abs(e)%uc.maxTickInTickarrayBitmap(t);let r=Math.floor(n/ic.tickCount(t));return e<0&&0!=n&&(r=ac-r),r}}Do([So(8),Co("bump"),Io("index"),No(""),qo("protocolFeeRate"),qo("tradeFeeRate"),Io("tickSpacing"),qo("fundFeeRate"),_o(qo(),1,"padding"),No("fundOwner"),_o(Po(),3,"padding")]);const dc=Do([qo("blockTimestamp"),Eo("sqrtPriceX64"),Eo("cumulativeTimePriceX64"),_o(Eo(),1,"")]),mc=Do([So(8),Vo("initialized"),No("poolId"),_o(dc,1e3,"observations"),_o(Eo(),5,"")]),pc=Do([Co("rewardState"),Po("openTime"),Po("endTime"),Po("lastUpdateTime"),Eo("emissionsPerSecondX64"),Po("rewardTotalEmissioned"),Po("rewardClaimed"),No("tokenMint"),No("tokenVault"),No("creator"),Eo("rewardGrowthGlobalX64")]),fc=Do([So(8),Co("bump"),No("ammConfig"),No("creator"),No("mintA"),No("mintB"),No("vaultA"),No("vaultB"),No("observationId"),Co("mintDecimalsA"),Co("mintDecimalsB"),Io("tickSpacing"),Eo("liquidity"),Eo("sqrtPriceX64"),To("tickCurrent"),Io("observationIndex"),Io("observationUpdateDuration"),Eo("feeGrowthGlobalX64A"),Eo("feeGrowthGlobalX64B"),Po("protocolFeesTokenA"),Po("protocolFeesTokenB"),Eo("swapInAmountTokenA"),Eo("swapOutAmountTokenB"),Eo("swapInAmountTokenB"),Eo("swapOutAmountTokenA"),Co("status"),_o(Co(),7,""),_o(pc,3,"rewardInfos"),_o(Po(),16,"tickArrayBitmap"),Po("totalFeesTokenA"),Po("totalFeesClaimedTokenA"),Po("totalFeesTokenB"),Po("totalFeesClaimedTokenB"),Po("fundFeesTokenA"),Po("fundFeesTokenB"),Po("startTime"),_o(Po(),57,"padding")]),gc=Do([Eo("growthInsideLastX64"),Po("rewardAmountOwed")]),wc=Do([So(8),Co("bump"),No("nftMint"),No("poolId"),To("tickLower"),To("tickUpper"),Eo("liquidity"),Eo("feeGrowthInsideLastX64A"),Eo("feeGrowthInsideLastX64B"),Po("tokenFeesOwedA"),Po("tokenFeesOwedB"),_o(gc,3,"rewardInfos"),_o(Po(),8,"")]);Do([So(8),Co("bump"),No("poolId"),To("tickLowerIndex"),To("tickUpperIndex"),Eo("liquidity"),Eo("feeGrowthInsideLastX64A"),Eo("feeGrowthInsideLastX64B"),Po("tokenFeesOwedA"),Po("tokenFeesOwedB"),_o(Eo(),3,"rewardGrowthInside"),_o(Po(),8,"")]);const hc=Do([To("tick"),function(e){return new Oo(16,!0,e)}("liquidityNet"),Eo("liquidityGross"),Eo("feeGrowthOutsideX64A"),Eo("feeGrowthOutsideX64B"),_o(Eo(),3,"rewardGrowthsOutsideX64"),_o(qo(),13,"")]),kc=Do([So(8),No("poolId"),To("startTickIndex"),_o(hc,sc,"ticks"),Co("initializedTickCount"),_o(Co(),115,"")]),yc=Do([So(329),_o(No(),100,"whitelistMints")]),Ac=Do([So(8),No("poolId"),_o(_o(Po(),8),14,"positiveTickArrayBitmap"),_o(_o(Po(),8),14,"negativeTickArrayBitmap")]);class Ic{static getOutputAmountAndRemainAccounts(e,t,n,r,o,i=!1){const s=n.equals(e.mintA.mint),a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||void 0===u||!l)throw new Error("Invalid tick array");try{const t=this.preInitializedTickArrayStartIndex(e,s);if(t.isExist){const{publicKey:n}=Ja(e.programId,e.id,t.nextStartIndex);a.push(n)}}catch(h){}a.push(l);const{allTrade:d,amountSpecifiedRemaining:m,amountCalculated:p,accounts:f,sqrtPriceX64:g,feeAmount:w}=Bc.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,u,o,i);return a.push(...f),{allTrade:d,realTradeAmountIn:r.sub(m),expectedAmountOut:p.mul(Ca),remainingAccounts:a,executionPrice:g,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,r,o){const i=n.equals(e.mintB.mint),s=[],{isExist:a,startIndex:c,nextAccountMeta:u}=this.getFirstInitializedTickArray(e,i);if(!a||void 0===c||!u)throw new Error("Invalid tick array");try{const t=this.preInitializedTickArrayStartIndex(e,i);if(t.isExist){const{publicKey:n}=Ja(e.programId,e.id,t.nextStartIndex);s.push(n)}}catch(f){}s.push(u);const{amountCalculated:l,accounts:d,sqrtPriceX64:m,feeAmount:p}=Bc.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,i,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Ca),c,o);return s.push(...d),{expectedAmountIn:l,remainingAccounts:s,executionPrice:m,feeAmount:p}}static getFirstInitializedTickArray(e,t){const{isInitialized:n,startIndex:r}=Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?lc.checkTickArrayIsInit(ic.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):cc.checkTickArrayIsInitialized(cc.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){const{publicKey:t}=Ja(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:t}}const{isExist:o,nextStartIndex:i}=this.nextInitializedTickArrayStartIndex(e,ic.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){const{publicKey:t}=Ja(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:t}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){const n=Math.floor(e.tickCurrent/ic.tickCount(e.tickSpacing)),r=t?cc.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):cc.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ic.getArrayStartIndex(t,e.tickSpacing);;){const{isInit:r,tickIndex:o}=uc.nextInitializedTickArrayStartIndex(cc.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;const{isInit:i,tickIndex:s}=lc.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(i)return{isExist:!0,nextStartIndex:s};if((t=s)<La||t>Na)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){const i=[];for(let s=0;s<o.length;s++){const a=o[s],c=t.rewardInfos[s]?.programId??(await e.getAccountInfo(a.tokenMint))?.owner;if(void 0===c)throw Error("get new reward mint info error");const u={...a,perSecond:bc.x64ToDecimal(a.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new re(c)};if(u.tokenMint.equals(re.default))continue;if(n<=u.openTime.toNumber()||r.eq(ar)){i.push(u);continue}const l=new Re(Math.min(u.endTime.toNumber(),n)),d=l.sub(u.lastUpdateTime),m=bc.mulDivFloor(d,u.emissionsPerSecondX64,r),p=u.rewardGrowthGlobalX64.add(m),f=bc.mulDivFloor(d,u.emissionsPerSecondX64,qa),g=u.rewardTotalEmissioned.add(f);i.push({...u,rewardGrowthGlobalX64:p,rewardTotalEmissioned:g,lastUpdateTime:l})}return i}static isOverflowDefaultTickarrayBitmap(e,t){const{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(const o of t){const t=cc.getTickArrayStartIndexByTick(o,e);if(t>=n||t<r)return!0}return!1}static tickRange(e){let t=uc.maxTickInTickarrayBitmap(e),n=-t;return t>Na&&(t=Na),n<La&&(n=La),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ic.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ic.tickCount(t)*ac}}class bc{static mulDivRoundingUp(e,t,n){const r=e.mul(t);let o=r.div(n);return r.mod(n).eq(ar)||(o=o.add(cr)),o}static mulDivFloor(e,t,n){if(n.eq(ar))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ar))throw new Error("division by 0");return e.mul(t).add(n.sub(cr)).div(n)}static x64ToDecimal(e,t){return new ka(e.toString()).div(ka.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Re(e.mul(ka.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Pa).sub(t).mod(Pa)}}function Tc(e,t){return vc(e.mul(t),64,256)}function vc(e,t,n){const r=e.toTwos(n).shrn(t);return r.imaskn(n-t+1),r.fromTwos(n-t)}class Sc{static sqrtPriceX64ToPrice(e,t,n){return bc.x64ToDecimal(e).pow(2).mul(ka.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return bc.decimalToX64(e.mul(ka.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ar))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ar))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ar))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ar))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ar))return e;const o=t.shln(64);if(r){const t=o,r=o.add(n.mul(e));return r.gte(t)?bc.mulDivCeil(t,e,r):bc.mulDivRoundingUp(t,cr,t.div(e).add(n))}{const t=n.mul(e);if(!o.gt(t))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");const r=o.sub(t);return bc.mulDivCeil(o,e,r)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){const o=n.shln(64);if(r)return e.add(o.div(t));{const n=bc.mulDivRoundingUp(o,cr,t);if(!e.gt(n))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(n)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<La||e>Na)throw new Error("tick must be in MIN_TICK and MAX_TICK");const t=e<0?-1*e:e;let n=new Re(0!=(1&t)?"18445821805675395072":"18446744073709551616");return 0!=(2&t)&&(n=Tc(n,new Re("18444899583751176192"))),0!=(4&t)&&(n=Tc(n,new Re("18443055278223355904"))),0!=(8&t)&&(n=Tc(n,new Re("18439367220385607680"))),0!=(16&t)&&(n=Tc(n,new Re("18431993317065453568"))),0!=(32&t)&&(n=Tc(n,new Re("18417254355718170624"))),0!=(64&t)&&(n=Tc(n,new Re("18387811781193609216"))),0!=(128&t)&&(n=Tc(n,new Re("18329067761203558400"))),0!=(256&t)&&(n=Tc(n,new Re("18212142134806163456"))),0!=(512&t)&&(n=Tc(n,new Re("17980523815641700352"))),0!=(1024&t)&&(n=Tc(n,new Re("17526086738831433728"))),0!=(2048&t)&&(n=Tc(n,new Re("16651378430235570176"))),0!=(4096&t)&&(n=Tc(n,new Re("15030750278694412288"))),0!=(8192&t)&&(n=Tc(n,new Re("12247334978884435968"))),0!=(16384&t)&&(n=Tc(n,new Re("8131365268886854656"))),0!=(32768&t)&&(n=Tc(n,new Re("3584323654725218816"))),0!=(65536&t)&&(n=Tc(n,new Re("696457651848324352"))),0!=(131072&t)&&(n=Tc(n,new Re("26294789957507116"))),0!=(262144&t)&&(n=Tc(n,new Re("37481735321082"))),e>0&&(n=Ma.div(n)),n}static getTickFromPrice(e,t,n){return Sc.getTickFromSqrtPriceX64(Sc.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ra)||e.lt(Va))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");const t=e.bitLength()-1,n=function(e,t,n){const r=e.toTwos(n).shln(t);return r.imaskn(n+1),r.fromTwos(n)}(new Re(t-64),32,128);let r=new Re("8000000000000000","hex"),o=0,i=new Re(0),s=t>=64?e.shrn(t-63):e.shln(63-t);for(;r.gt(new Re(0))&&o<16;){s=s.mul(s);const e=s.shrn(127);s=s.shrn(63+e.toNumber()),i=i.add(r.mul(e)),r=r.shrn(1),o+=1}const a=i.shrn(32),c=n.add(a).mul(new Re("59543866431248")),u=vc(c.sub(new Re("184467440737095516")),64,128).toNumber(),l=vc(c.add(new Re("15793534762490258745")),64,128).toNumber();return u==l?u:Sc.getSqrtPriceX64FromTick(l).lte(e)?l:u}}class xc{static getTickWithPriceAndTickspacing(e,t,n,r){let o=Sc.getTickFromSqrtPriceX64(Sc.priceToSqrtPriceX64(e,n,r))/t;return o=o<0?Math.floor(o):Math.ceil(o),o*t}static roundPriceWithTickspacing(e,t,n,r){const o=xc.getTickWithPriceAndTickspacing(e,t,n,r),i=Sc.getSqrtPriceX64FromTick(o);return Sc.sqrtPriceX64ToPrice(i,n,r)}}class Oc{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ar))throw new Error("sqrtPriceX64A must greater than 0");const o=n.ushln(64),i=t.sub(e);return r?bc.mulDivRoundingUp(bc.mulDivCeil(o,i,t),cr,e):bc.mulDivFloor(o,i,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ar))throw new Error("sqrtPriceX64A must greater than 0");return r?bc.mulDivCeil(n,t.sub(e),qa):bc.mulDivFloor(n,t.sub(e),qa)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);const o=n.mul(e).mul(t),i=t.sub(e),s=o.div(i);return r?bc.mulDivRoundingUp(s,cr,Ea):s.shrn(64)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),bc.mulDivFloor(n,Ea,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Oc.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){const i=Oc.getLiquidityFromTokenAmountA(e,n,r,!1),s=Oc.getLiquidityFromTokenAmountB(t,e,o);return i.lt(s)?i:s}return Oc.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){return t.gt(n)&&([t,n]=[n,t]),e.lte(t)?{amountA:Oc.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new Re(0)}:e.lt(n)?{amountA:Oc.getTokenAmountAFromLiquidity(e,n,r,o),amountB:Oc.getTokenAmountBFromLiquidity(t,e,r,o)}:{amountA:new Re(0),amountB:Oc.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,i,s){const{amountA:a,amountB:c}=Oc.getAmountsFromLiquidity(e,t,n,r,i),u=o?1+s:1-s;return{amountSlippageA:new Re(new ka(a.toString()).mul(u).toFixed(0)),amountSlippageB:new Re(new ka(c.toString()).mul(u).toFixed(0))}}}class Bc{static swapCompute(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f=!1){if(d.eq(ar))throw new Error("amountSpecified must not be 0");if(p||(p=i?Va.add(cr):Ra.sub(cr)),i){if(p.lt(Va))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(l))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(Ra))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(l))throw new Error("sqrtPriceX64 must greater than current")}const g=d.gt(ar),w={amountSpecifiedRemaining:d,amountCalculated:ar,sqrtPriceX64:l,tick:c>m?Math.min(m+ic.tickCount(u)-1,c):m,accounts:[],liquidity:a,feeAmount:new Re(0)};let h=m,k=n[m],y=!i&&k.startTickIndex===w.tick;for(;!w.amountSpecifiedRemaining.eq(ar)&&!w.sqrtPriceX64.eq(p);){const a={};a.sqrtPriceStartX64=w.sqrtPriceX64;const c=cc.nextInitTick(k,w.tick,u,i,y);let l,d=c||null,I=null;if(!d?.liquidityGross.gtn(0)){const s=Ic.nextInitializedTickArrayStartIndex({tickCurrent:w.tick,tickSpacing:u,tickArrayBitmap:r,exBitmapInfo:o},h,i);if(!s.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:w.amountSpecifiedRemaining,amountCalculated:w.amountCalculated,feeAmount:w.feeAmount,sqrtPriceX64:w.sqrtPriceX64,liquidity:w.liquidity,tickCurrent:w.tick,accounts:w.accounts};throw Error("swapCompute LiquidityInsufficient")}h=s.nextStartIndex;const{publicKey:a}=Ja(e,t,h);I=a,k=n[h];try{d=cc.firstInitializedTick(k,i)}catch(A){throw Error("not found next tick info")}}if(a.tickNext=d.tick,a.initialized=d.liquidityGross.gtn(0),m!==h&&I&&(w.accounts.push(I),m=h),a.tickNext<La?a.tickNext=La:a.tickNext>Na&&(a.tickNext=Na),a.sqrtPriceNextX64=Sc.getSqrtPriceX64FromTick(a.tickNext),l=i&&a.sqrtPriceNextX64.lt(p)||!i&&a.sqrtPriceNextX64.gt(p)?p:a.sqrtPriceNextX64,[w.sqrtPriceX64,a.amountIn,a.amountOut,a.feeAmount]=Bc.swapStepCompute(w.sqrtPriceX64,l,w.liquidity,w.amountSpecifiedRemaining,s),w.feeAmount=w.feeAmount.add(a.feeAmount),g?(w.amountSpecifiedRemaining=w.amountSpecifiedRemaining.sub(a.amountIn.add(a.feeAmount)),w.amountCalculated=w.amountCalculated.sub(a.amountOut)):(w.amountSpecifiedRemaining=w.amountSpecifiedRemaining.add(a.amountOut),w.amountCalculated=w.amountCalculated.add(a.amountIn.add(a.feeAmount))),w.sqrtPriceX64.eq(a.sqrtPriceNextX64)){if(a.initialized){let e=d.liquidityNet;i&&(e=e.mul(Ca)),w.liquidity=Oc.addDelta(w.liquidity,e)}y=a.tickNext!=w.tick&&!i&&k.startTickIndex===a.tickNext,w.tick=i?a.tickNext-1:a.tickNext}else if(w.sqrtPriceX64!=a.sqrtPriceStartX64){const e=Sc.getTickFromSqrtPriceX64(w.sqrtPriceX64);y=e!=w.tick&&!i&&k.startTickIndex===e,w.tick=e}}try{const{nextStartIndex:n,isExist:s}=ic.nextInitializedTickArray(w.tick,u,i,r,o);s&&m!==n&&(w.accounts.push(Ja(e,t,n).publicKey),m=n)}catch(A){}return{allTrade:!0,amountSpecifiedRemaining:ar,amountCalculated:w.amountCalculated,feeAmount:w.feeAmount,sqrtPriceX64:w.sqrtPriceX64,liquidity:w.liquidity,tickCurrent:w.tick,accounts:w.accounts}}static swapStepCompute(e,t,n,r,o){const i={sqrtPriceX64Next:new Re(0),amountIn:new Re(0),amountOut:new Re(0),feeAmount:new Re(0)},s=e.gte(t),a=r.gte(ar);if(a){const a=bc.mulDivFloor(r,Fa.sub(new Re(o.toString())),Fa);i.amountIn=s?Oc.getTokenAmountAFromLiquidity(t,e,n,!0):Oc.getTokenAmountBFromLiquidity(e,t,n,!0),a.gte(i.amountIn)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=Sc.getNextSqrtPriceX64FromInput(e,n,a,s)}else i.amountOut=s?Oc.getTokenAmountBFromLiquidity(t,e,n,!1):Oc.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Ca).gte(i.amountOut)?i.sqrtPriceX64Next=t:i.sqrtPriceX64Next=Sc.getNextSqrtPriceX64FromOutput(e,n,r.mul(Ca),s);const c=t.eq(i.sqrtPriceX64Next);return s?(c&&a||(i.amountIn=Oc.getTokenAmountAFromLiquidity(i.sqrtPriceX64Next,e,n,!0)),c&&!a||(i.amountOut=Oc.getTokenAmountBFromLiquidity(i.sqrtPriceX64Next,e,n,!1))):(i.amountIn=c&&a?i.amountIn:Oc.getTokenAmountBFromLiquidity(e,i.sqrtPriceX64Next,n,!0),i.amountOut=c&&!a?i.amountOut:Oc.getTokenAmountAFromLiquidity(e,i.sqrtPriceX64Next,n,!1)),!a&&i.amountOut.gt(r.mul(Ca))&&(i.amountOut=r.mul(Ca)),a&&!i.sqrtPriceX64Next.eq(t)?i.feeAmount=r.sub(i.amountIn):i.feeAmount=bc.mulDivCeil(i.amountIn,new Re(o),Fa.sub(new Re(o))),[i.sqrtPriceX64Next,i.amountIn,i.amountOut,i.feeAmount]}}class Cc{static getfeeGrowthInside(e,t,n){let r=new Re(0),o=new Re(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let i=new Re(0),s=new Re(0);return e.tickCurrent<n.tick?(i=n.feeGrowthOutsideX64A,s=n.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B)),{feeGrowthInsideX64A:bc.wrappingSubU128(bc.wrappingSubU128(e.feeGrowthGlobalX64A,r),i),feeGrowthInsideBX64:bc.wrappingSubU128(bc.wrappingSubU128(e.feeGrowthGlobalX64B,o),s)}}static GetPositionFees(e,t,n,r){const{feeGrowthInsideX64A:o,feeGrowthInsideBX64:i}=this.getfeeGrowthInside(e,n,r),s=bc.mulDivFloor(bc.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,qa),a=t.tokenFeesOwedA.add(s),c=bc.mulDivFloor(bc.wrappingSubU128(i,t.feeGrowthInsideLastX64B),t.liquidity,qa);return{tokenFeeAmountA:a,tokenFeeAmountB:t.tokenFeesOwedB.add(c)}}static GetPositionRewards(e,t,n,r){const o=[],i=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<i.length;s++){const e=i[s],n=t.rewardInfos[s],r=bc.wrappingSubU128(e,n.growthInsideLastX64),a=bc.mulDivFloor(r,t.liquidity,qa),c=n.rewardAmountOwed.add(a);o.push(c)}return o}static getRewardGrowthInside(e,t,n,r){const o=[];for(let i=0;i<r.length;i++){let s=new Re(0);s=t.liquidityGross.eqn(0)?r[i].rewardGrowthGlobalX64:e<t.tick?r[i].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[i]):t.rewardGrowthsOutsideX64[i];let a=new Re(0);n.liquidityGross.eqn(0)||(a=e<n.tick?n.rewardGrowthsOutsideX64[i]:r[i].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[i])),o.push(bc.wrappingSubU128(bc.wrappingSubU128(r[i].rewardGrowthGlobalX64,s),a))}return o}}const qc=Wn.from("Clmm");class Pc extends Ho{static makeMockPoolInfo({programId:e,mint1:t,mint2:n,ammConfig:r,createPoolInstructionSimpleAddress:o,initialPrice:i,startTime:s,owner:a}){const[c,u,l]=new Re(t.mint.toBuffer()).gt(new Re(n.mint.toBuffer()))?[n,t,new ka(1).div(i)]:[t,n,i],d=Sc.priceToSqrtPriceX64(l,c.decimals,u.decimals);return{id:o.poolId,mintA:{programId:o.mintProgramIdA,mint:o.mintA,vault:o.mintAVault,decimals:c.decimals},mintB:{programId:o.mintProgramIdB,mint:o.mintB,vault:o.mintBVault,decimals:u.decimals},ammConfig:r,observationId:o.observationId,creator:a,programId:e,version:6,tickSpacing:r.tickSpacing,liquidity:ar,sqrtPriceX64:d,currentPrice:l,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:ar,feeGrowthGlobalX64B:ar,protocolFeesTokenA:ar,protocolFeesTokenB:ar,swapInAmountTokenA:ar,swapOutAmountTokenB:ar,swapInAmountTokenB:ar,swapOutAmountTokenA:ar,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0,lookupTableAccount:re.default,startTime:s.toNumber(),exBitmapInfo:{poolId:o.poolId,positiveTickArrayBitmap:Array.from({length:14},(()=>Array.from({length:8},(()=>new Re(0))))),negativeTickArrayBitmap:Array.from({length:14},(()=>Array.from({length:8},(()=>new Re(0)))))}}}static async makeCreatePoolInstructionSimple({makeTxVersion:e,connection:t,programId:n,owner:r,payer:o,mint1:i,mint2:s,ammConfig:a,initialPrice:c,startTime:u,computeBudgetConfig:l,lookupTableCache:d}){const[m,p,f]=new Re(i.mint.toBuffer()).gt(new Re(s.mint.toBuffer()))?[s,i,new ka(1).div(c)]:[i,s,c],g=Sc.priceToSqrtPriceX64(f,m.decimals,p.decimals),w=await this.makeCreatePoolInstructions({connection:t,programId:n,owner:r,mintA:m,mintB:p,ammConfigId:a.id,initialPriceX64:g,startTime:u});return{address:{...w.address,mintA:m.mint,mintB:p.mint,mintProgramIdA:m.programId,mintProgramIdB:p.programId},innerTransactions:await rr({connection:t,makeTxVersion:e,computeBudgetConfig:l,payer:o,innerTransaction:[w.innerTransaction],lookupTableCache:d})}}static async makeOpenPositionFromLiquidityInstructionSimple({makeTxVersion:e,connection:t,poolInfo:n,ownerInfo:r,amountMaxA:o,amountMaxB:i,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:d="create",getEphemeralSigners:m,computeBudgetConfig:p,lookupTableCache:f}){const g=[],w=[],h=[],k=[],y=[],A=r.useSOLBalance&&n.mintA.mint.equals(br.WSOL.mint),I=r.useSOLBalance&&n.mintB.mint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:n.mintA.programId,mint:n.mintA.mint,tokenAccounts:A?[]:r.tokenAccounts,owner:r.wallet,createInfo:A||o.eq(ar)?{connection:t,payer:r.feePayer,amount:o,frontInstructions:g,endInstructions:w,frontInstructionsType:h,endInstructionsType:k,signers:y}:void 0,associatedOnly:!A&&u,checkCreateATAOwner:l}),T=await this._selectOrCreateTokenAccount({programId:n.mintB.programId,mint:n.mintB.mint,tokenAccounts:I?[]:r.tokenAccounts,owner:r.wallet,createInfo:I||i.eq(ar)?{connection:t,payer:r.feePayer,amount:i,frontInstructions:g,endInstructions:w,frontInstructionsType:h,endInstructionsType:k,signers:y}:void 0,associatedOnly:!I&&u,checkCreateATAOwner:l});qc.assertArgument(void 0!==b&&void 0!==T,"cannot found target token accounts","tokenAccounts",r.tokenAccounts);const v=await this.makeOpenPositionFromLiquidityInstructions({poolInfo:n,ownerInfo:{...r,tokenAccountA:b,tokenAccountB:T},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:o,amountMaxB:i,withMetadata:d,getEphemeralSigners:m});return{address:v.address,innerTransactions:await rr({connection:t,makeTxVersion:e,computeBudgetConfig:p,payer:r.feePayer,innerTransaction:[{instructionTypes:h,instructions:g,signers:y},v.innerTransaction,{instructionTypes:k,instructions:w,signers:[]}],lookupTableCache:f})}}static async makeOpenPositionFromBaseInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,tickLower:r,tickUpper:o,base:i,baseAmount:s,otherAmountMax:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,withMetadata:d="create",makeTxVersion:m,lookupTableCache:p,getEphemeralSigners:f}){const g=[],w=[],h=[],k=[],y=[],A=n.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),I=n.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:n.tokenAccounts,owner:n.wallet,createInfo:A?{connection:e,payer:n.feePayer,amount:"MintA"===i?s:a,frontInstructions:g,endInstructions:w,frontInstructionsType:h,endInstructionsType:k,signers:y}:void 0,associatedOnly:!A&&c,checkCreateATAOwner:u}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:I?[]:n.tokenAccounts,owner:n.wallet,createInfo:I?{connection:e,payer:n.feePayer,amount:"MintA"===i?a:s,frontInstructions:g,endInstructions:w,frontInstructionsType:h,endInstructionsType:k,signers:y}:void 0,associatedOnly:!I&&c,checkCreateATAOwner:u});qc.assertArgument(void 0!==b&&void 0!==T,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=await this.makeOpenPositionFromBaseInstructions({poolInfo:t,ownerInfo:{...n,tokenAccountA:b,tokenAccountB:T},tickLower:r,tickUpper:o,base:i,baseAmount:s,otherAmountMax:a,withMetadata:d,getEphemeralSigners:f});return{address:v.address,innerTransactions:await rr({connection:e,makeTxVersion:m,computeBudgetConfig:l,payer:n.feePayer,innerTransaction:[{instructionTypes:h,instructions:g,signers:y},v.innerTransaction,{instructionTypes:k,instructions:w,signers:[]}],lookupTableCache:p})}}static async makeIncreasePositionFromLiquidityInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:r,amountMaxA:o,amountMaxB:i,liquidity:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:u,makeTxVersion:l,lookupTableCache:d}){const m=[],p=[],f=[],g=[],w=[],h=r.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),k=r.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),y=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:h?[]:r.tokenAccounts,owner:r.wallet,createInfo:h?{connection:e,payer:r.feePayer,amount:o,frontInstructions:m,endInstructions:p,frontInstructionsType:f,endInstructionsType:g,signers:w}:void 0,associatedOnly:!h&&a,checkCreateATAOwner:c}),A=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:r.tokenAccounts,owner:r.wallet,createInfo:k?{connection:e,payer:r.feePayer,amount:i,frontInstructions:m,endInstructions:p,frontInstructionsType:f,endInstructionsType:g,signers:w}:void 0,associatedOnly:!k&&a,checkCreateATAOwner:c});qc.assertArgument(!!y||!!A,"cannot found target token accounts","tokenAccounts",r.tokenAccounts);const I=this.makeIncreasePositionFromLiquidityInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:r.wallet,tokenAccountA:y,tokenAccountB:A},liquidity:s,amountMaxA:o,amountMaxB:i});return{address:I.address,innerTransactions:await rr({connection:e,makeTxVersion:l,computeBudgetConfig:u,payer:r.feePayer,innerTransaction:[{instructionTypes:f,instructions:m,signers:w},I.innerTransaction,{instructionTypes:g,instructions:p,signers:[]}],lookupTableCache:d})}}static async makeIncreasePositionFromBaseInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:i,otherAmountMax:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:u,makeTxVersion:l,lookupTableCache:d}){const m=[],p=[],f=[],g=[],w=[],h=r.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),k=r.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),y=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:h?[]:r.tokenAccounts,owner:r.wallet,createInfo:h?{connection:e,payer:r.feePayer,amount:"MintA"===o?i:s,frontInstructions:m,endInstructions:p,frontInstructionsType:f,endInstructionsType:g,signers:w}:void 0,associatedOnly:!h&&a,checkCreateATAOwner:c}),A=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:r.tokenAccounts,owner:r.wallet,createInfo:k?{connection:e,payer:r.feePayer,amount:"MintA"===o?s:i,frontInstructions:m,endInstructions:p,frontInstructionsType:f,endInstructionsType:g,signers:w}:void 0,associatedOnly:!k&&a,checkCreateATAOwner:c});qc.assertArgument(!!y||!!A,"cannot found target token accounts","tokenAccounts",r.tokenAccounts);const I=this.makeIncreasePositionFromBaseInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:r.wallet,tokenAccountA:y,tokenAccountB:A},base:o,baseAmount:i,otherAmountMax:s});return{address:I.address,innerTransactions:await rr({connection:e,makeTxVersion:l,computeBudgetConfig:u,payer:r.feePayer,innerTransaction:[{instructionTypes:f,instructions:m,signers:w},I.innerTransaction,{instructionTypes:g,instructions:p,signers:[]}],lookupTableCache:d})}}static async makeDecreaseLiquidityInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:i,amountMinB:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:u,makeTxVersion:l,lookupTableCache:d}){const m=[],p=[],f=[],g=[],w=[],h=r.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),k=r.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),y=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:h?[]:r.tokenAccounts,owner:r.wallet,createInfo:{connection:e,payer:r.feePayer,amount:0,frontInstructions:m,frontInstructionsType:f,endInstructions:h?p:[],endInstructionsType:h?g:[],signers:w},associatedOnly:!h&&a,checkCreateATAOwner:c}),A=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:r.tokenAccounts,owner:r.wallet,createInfo:{connection:e,payer:r.feePayer,amount:0,frontInstructions:m,frontInstructionsType:f,endInstructions:k?p:[],endInstructionsType:k?g:[],signers:w},associatedOnly:!k&&a,checkCreateATAOwner:c}),I=[];for(const v of t.rewardInfos){const n=r.useSOLBalance&&v.tokenMint.equals(br.WSOL.mint),o=v.tokenMint.equals(t.mintA.mint)?y:v.tokenMint.equals(t.mintB.mint)?A:await this._selectOrCreateTokenAccount({programId:v.tokenProgramId,mint:v.tokenMint,tokenAccounts:n?[]:r.tokenAccounts,owner:r.wallet,createInfo:{connection:e,payer:r.feePayer,amount:0,frontInstructions:m,frontInstructionsType:f,endInstructions:n?p:[],endInstructionsType:n?g:[],signers:w},associatedOnly:!n&&a,checkCreateATAOwner:c});I.push(o)}qc.assertArgument(!!y||!!A,"cannot found target token accounts","tokenAccounts",r.tokenAccounts);const b=this.makeDecreaseLiquidityInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:r.wallet,tokenAccountA:y,tokenAccountB:A,rewardAccounts:I},liquidity:o,amountMinA:i,amountMinB:s}),T=r.closePosition?this.makeClosePositionInstructions({poolInfo:t,ownerInfo:r,ownerPosition:n}):{address:{},innerTransaction:{instructions:[],signers:[],instructionTypes:[]}};return{address:b.address,innerTransactions:await rr({connection:e,makeTxVersion:l,computeBudgetConfig:u,payer:r.feePayer,innerTransaction:[{instructionTypes:f,instructions:m,signers:w},b.innerTransaction,{instructionTypes:g,instructions:p,signers:[]},T.innerTransaction],lookupTableCache:d})}}static async makeSwapBaseInInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,inputMint:r,amountIn:o,amountOutMin:i,priceLimit:s,remainingAccounts:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,makeTxVersion:d,lookupTableCache:m}){const p=[],f=[],g=[],w=[],h=[];let k;k=!s||s.equals(new ka(0))?r.equals(t.mintA.mint)?Va.add(cr):Ra.sub(cr):Sc.priceToSqrtPriceX64(s,t.mintA.decimals,t.mintB.decimals);const y=t.mintA.mint.equals(r),A=n.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),I=n.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:n.tokenAccounts,owner:n.wallet,createInfo:A||!y?{connection:e,payer:n.feePayer,amount:y?o:0,frontInstructions:p,endInstructions:f,frontInstructionsType:g,endInstructionsType:w,signers:h}:void 0,associatedOnly:!A&&c,checkCreateATAOwner:u}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:I?[]:n.tokenAccounts,owner:n.wallet,createInfo:I||y?{connection:e,payer:n.feePayer,amount:y?0:o,frontInstructions:p,endInstructions:f,frontInstructionsType:g,endInstructionsType:w,signers:h}:void 0,associatedOnly:!I&&c,checkCreateATAOwner:u});qc.assertArgument(!!b||!!T,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=this.makeSwapBaseInInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccountA:b,tokenAccountB:T},inputMint:r,amountIn:o,amountOutMin:i,sqrtPriceLimitX64:k,remainingAccounts:a});return{address:v.address,innerTransactions:await rr({connection:e,makeTxVersion:d,computeBudgetConfig:l,payer:n.feePayer,innerTransaction:[{instructionTypes:g,instructions:p,signers:h},v.innerTransaction,{instructionTypes:w,instructions:f,signers:[]}],lookupTableCache:m})}}static async makeSwapBaseOutInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,outputMint:r,amountOut:o,amountInMax:i,priceLimit:s,remainingAccounts:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,makeTxVersion:d,lookupTableCache:m}){const p=[],f=[],g=[],w=[],h=[];let k;k=!s||s.equals(new ka(0))?r.equals(t.mintB.mint)?Va.add(cr):Ra.sub(cr):Sc.priceToSqrtPriceX64(s,t.mintA.decimals,t.mintB.decimals);const y=t.mintA.mint.equals(r),A=n.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),I=n.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:n.tokenAccounts,owner:n.wallet,createInfo:A||!y?{connection:e,payer:n.feePayer,amount:y?i:0,frontInstructions:p,endInstructions:f,frontInstructionsType:g,endInstructionsType:w,signers:h}:void 0,associatedOnly:!A&&c,checkCreateATAOwner:u}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:I?[]:n.tokenAccounts,owner:n.wallet,createInfo:I||y?{connection:e,payer:n.feePayer,amount:y?0:i,frontInstructions:p,endInstructions:f,frontInstructionsType:g,endInstructionsType:w,signers:h}:void 0,associatedOnly:!I&&c,checkCreateATAOwner:u});qc.assertArgument(!!b||!!T,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=this.makeSwapBaseOutInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccountA:b,tokenAccountB:T},outputMint:r,amountOut:o,amountInMax:i,sqrtPriceLimitX64:k,remainingAccounts:a});return{address:v.address,innerTransactions:await rr({connection:e,makeTxVersion:d,computeBudgetConfig:l,payer:n.feePayer,innerTransaction:[{instructionTypes:g,instructions:p,signers:h},v.innerTransaction,{instructionTypes:w,instructions:f,signers:[]}],lookupTableCache:m})}}static async makeCLosePositionInstructionSimple({poolInfo:e,ownerPosition:t,ownerInfo:n,makeTxVersion:r,lookupTableCache:o,connection:i}){const s=this.makeClosePositionInstructions({poolInfo:e,ownerInfo:n,ownerPosition:t});return{address:s.address,innerTransactions:await rr({connection:i,makeTxVersion:r,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[s.innerTransaction],lookupTableCache:o})}}static async makeInitRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfo:r,chainTime:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,makeTxVersion:a,lookupTableCache:c}){qc.assertArgument(r.endTime>r.openTime,"reward time error","rewardInfo",r),qc.assertArgument(r.openTime>o,"reward must be paid later","rewardInfo",r);const u=[],l=[],d=[],m=[],p=[],f=n.useSOLBalance&&r.mint.equals(br.WSOL.mint),g=r.perSecond.mul(r.endTime-r.openTime),w=await this._selectOrCreateTokenAccount({programId:r.programId,mint:r.mint,tokenAccounts:f?[]:n.tokenAccounts,owner:n.wallet,createInfo:f?{connection:e,payer:n.feePayer,amount:new Re(new ka(g.toFixed(0)).gte(g)?g.toFixed(0):g.add(1).toFixed(0)),frontInstructions:u,endInstructions:l,frontInstructionsType:d,endInstructionsType:m,signers:p}:void 0,associatedOnly:!f&&i,checkCreateATAOwner:s});qc.assertArgument(w,"no money","ownerRewardAccount",n.tokenAccounts);const h=this.makeInitRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:w},rewardInfo:{programId:r.programId,mint:r.mint,openTime:r.openTime,endTime:r.endTime,emissionsPerSecondX64:bc.decimalToX64(r.perSecond)}});return{address:h.address,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:p},h.innerTransaction,{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:c})}}static async makeInitRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:i=!1,computeBudgetConfig:s,makeTxVersion:a,lookupTableCache:c}){for(const w of r)qc.assertArgument(w.endTime>w.openTime,"reward time error","rewardInfo",w);const u=[],l=[],d=[],m=[],p=[],f=[];for(const w of r){const r=n.useSOLBalance&&w.mint.equals(br.WSOL.mint),s=w.perSecond.mul(w.endTime-w.openTime),a=await this._selectOrCreateTokenAccount({programId:w.programId,mint:w.mint,tokenAccounts:r?[]:n.tokenAccounts,owner:n.wallet,createInfo:r?{connection:e,payer:n.feePayer,amount:new Re(new ka(s.toFixed(0)).gte(s)?s.toFixed(0):s.add(1).toFixed(0)),frontInstructions:u,endInstructions:l,frontInstructionsType:d,endInstructionsType:m,signers:f}:void 0,associatedOnly:!r&&o,checkCreateATAOwner:i});qc.assertArgument(a,"no money","ownerRewardAccount",n.tokenAccounts),p.push(this.makeInitRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:a},rewardInfo:{programId:w.programId,mint:w.mint,openTime:w.openTime,endTime:w.endTime,emissionsPerSecondX64:bc.decimalToX64(w.perSecond)}}))}let g={};for(const w of p)g={...g,...w.address};return{address:g,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:s,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:f},...p.map((e=>e.innerTransaction)),{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:c})}}static async makeSetRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfo:r,chainTime:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,makeTxVersion:a,lookupTableCache:c}){qc.assertArgument(r.endTime>r.openTime,"reward time error","rewardInfo",r),qc.assertArgument(r.openTime>o,"reward must be paid later","rewardInfo",r);const u=[],l=[],d=[],m=[],p=[],f=n.useSOLBalance&&r.mint.equals(br.WSOL.mint),g=await this._selectOrCreateTokenAccount({programId:r.programId,mint:r.mint,tokenAccounts:f?[]:n.tokenAccounts,owner:n.wallet,createInfo:f?{connection:e,payer:n.feePayer,amount:new Re(new ka(r.perSecond.sub(r.endTime-r.openTime).toFixed(0)).gte(r.perSecond.sub(r.endTime-r.openTime))?r.perSecond.sub(r.endTime-r.openTime).toFixed(0):r.perSecond.sub(r.endTime-r.openTime).add(1).toFixed(0)),frontInstructions:u,endInstructions:l,frontInstructionsType:d,endInstructionsType:m,signers:p}:void 0,associatedOnly:!f&&i,checkCreateATAOwner:s});qc.assertArgument(g,"no money","ownerRewardAccount",n.tokenAccounts);const w=this.makeSetRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:g},rewardInfo:{mint:r.mint,openTime:r.openTime,endTime:r.endTime,emissionsPerSecondX64:bc.decimalToX64(r.perSecond)}});return{address:w.address,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:p},w.innerTransaction,{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:c})}}static async makeSetRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfos:r,chainTime:o,associatedOnly:i=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,makeTxVersion:c,lookupTableCache:u}){const l=[],d=[],m=[],p=[],f=[],g=[];for(const h of r){qc.assertArgument(h.endTime>h.openTime,"reward time error","rewardInfo",h),qc.assertArgument(h.openTime>o,"reward must be paid later","rewardInfo",h);const r=n.useSOLBalance&&h.mint.equals(br.WSOL.mint),a=await this._selectOrCreateTokenAccount({programId:h.programId,mint:h.mint,tokenAccounts:r?[]:n.tokenAccounts,owner:n.wallet,createInfo:r?{connection:e,payer:n.feePayer,amount:new Re(new ka(h.perSecond.sub(h.endTime-h.openTime).toFixed(0)).gte(h.perSecond.sub(h.endTime-h.openTime))?h.perSecond.sub(h.endTime-h.openTime).toFixed(0):h.perSecond.sub(h.endTime-h.openTime).add(1).toFixed(0)),frontInstructions:l,endInstructions:d,frontInstructionsType:m,endInstructionsType:p,signers:g}:void 0,associatedOnly:!r&&i,checkCreateATAOwner:s});qc.assertArgument(a,"no money","ownerRewardAccount",n.tokenAccounts),f.push(this.makeSetRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:a},rewardInfo:{mint:h.mint,openTime:h.openTime,endTime:h.endTime,emissionsPerSecondX64:bc.decimalToX64(h.perSecond)}}))}let w={};for(const h of f)w={...w,...h.address};return{address:w,innerTransactions:await rr({connection:e,makeTxVersion:c,computeBudgetConfig:a,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:g},...f.map((e=>e.innerTransaction)),{instructionTypes:p,instructions:d,signers:[]}],lookupTableCache:u})}}static async makeCollectRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardMint:r,associatedOnly:o=!0,checkCreateATAOwner:i=!1,computeBudgetConfig:s,makeTxVersion:a,lookupTableCache:c}){const u=[],l=[],d=[],m=[],p=[],f=t.rewardInfos.find((e=>e.tokenMint.equals(r)));if(qc.assertArgument(void 0!==f,"reward mint error","not found reward mint",r),void 0===f)throw Error("reward mint error");const g=n.useSOLBalance&&r.equals(br.WSOL.mint),w=await this._selectOrCreateTokenAccount({programId:f.tokenProgramId,mint:r,tokenAccounts:g?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:u,endInstructions:g?l:[],frontInstructionsType:d,endInstructionsType:m,signers:p},associatedOnly:!g&&o,checkCreateATAOwner:i});qc.assertArgument(w,"no money","ownerRewardAccount",n.tokenAccounts);const h=this.makeCollectRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:w},rewardMint:r});return{address:h.address,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:s,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:p},h.innerTransaction,{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:c})}}static async makeCollectRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardMints:r,associatedOnly:o=!0,checkCreateATAOwner:i=!1,computeBudgetConfig:s,makeTxVersion:a,lookupTableCache:c}){const u=[],l=[],d=[],m=[],p=[],f=[];for(const w of r){const r=t.rewardInfos.find((e=>e.tokenMint.equals(w)));if(qc.assertArgument(void 0!==r,"reward mint error","not found reward mint",w),void 0===r)throw Error("reward mint error");const s=n.useSOLBalance&&w.equals(br.WSOL.mint),a=await this._selectOrCreateTokenAccount({programId:r.tokenProgramId,mint:w,tokenAccounts:s?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:u,endInstructions:s?l:[],signers:f,frontInstructionsType:d,endInstructionsType:m},associatedOnly:!s&&o,checkCreateATAOwner:i});qc.assertArgument(a,"no money","ownerRewardAccount",n.tokenAccounts),p.push(this.makeCollectRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:a},rewardMint:w}))}let g={};for(const w of p)g={...g,...w.address};return{address:g,innerTransactions:await rr({connection:e,makeTxVersion:a,computeBudgetConfig:s,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:u,signers:f},...p.map((e=>e.innerTransaction)),{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:c})}}static async makeHarvestAllRewardInstructionSimple({connection:e,fetchPoolInfos:t,ownerInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,makeTxVersion:i,lookupTableCache:s}){const a={};for(const f of n.tokenAccounts)r?zo(n.wallet,f.accountInfo.mint,f.programId).publicKey.equals(f.pubkey)&&(a[f.accountInfo.mint.toString()]=f.pubkey):a[f.accountInfo.mint.toString()]=f.pubkey;const c=[],u=[],l=[],d=[],m=[],p=[];for(const f of Object.values(t)){if(void 0===f.positionAccount)continue;if(!f.positionAccount.find((e=>!e.tokenFeeAmountA.isZero()||!e.tokenFeeAmountB.isZero()||e.rewardInfos.find((e=>!e.pendingReward.isZero())))))continue;const t=f.state,i=n.useSOLBalance&&t.mintA.mint.equals(br.WSOL.mint),s=n.useSOLBalance&&t.mintB.mint.equals(br.WSOL.mint),g=a[t.mintA.mint.toString()]??await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:i?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,frontInstructionsType:l,endInstructions:i?u:[],endInstructionsType:i?d:[],signers:p},associatedOnly:!i&&r,checkCreateATAOwner:o}),w=a[t.mintB.mint.toString()]??await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:s?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,frontInstructionsType:l,endInstructions:s?u:[],endInstructionsType:s?d:[],signers:p},associatedOnly:!s&&r,checkCreateATAOwner:o});a[t.mintA.mint.toString()]=g,a[t.mintB.mint.toString()]=w;const h=[];for(const m of t.rewardInfos){const t=n.useSOLBalance&&m.tokenMint.equals(br.WSOL.mint),i=a[m.tokenMint.toString()]??await this._selectOrCreateTokenAccount({programId:m.tokenProgramId,mint:m.tokenMint,tokenAccounts:t?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,endInstructions:t?u:[],frontInstructionsType:l,endInstructionsType:d,signers:p},associatedOnly:!t&&r,checkCreateATAOwner:o});a[m.tokenMint.toString()]=i,h.push(i)}for(const e of f.positionAccount)m.push(this.makeDecreaseLiquidityInstructions({poolInfo:t,ownerPosition:e,ownerInfo:{wallet:n.wallet,tokenAccountA:g,tokenAccountB:w,rewardAccounts:h},liquidity:ar,amountMinA:ar,amountMinB:ar}))}return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:i,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:l,instructions:c,signers:p},...m.map((e=>e.innerTransaction)),{instructionTypes:d,instructions:u,signers:[]}],lookupTableCache:s})}}static async makeCreatePoolInstructions({connection:e,programId:t,owner:n,mintA:r,mintB:o,ammConfigId:i,initialPriceX64:s,startTime:a}){const c=Qo({fromPublicKey:n,programId:t}),u=function(e,t,n,r){return jn([Xa,t.toBuffer(),n.toBuffer(),r.toBuffer()],e)}(t,i,r.mint,o.mint).publicKey,l=Ya(t,u,r.mint).publicKey,d=Ya(t,u,o.mint).publicKey,m=[de.createAccountWithSeed({fromPubkey:n,basePubkey:n,seed:c.seed,newAccountPubkey:c.publicKey,lamports:await e.getMinimumBalanceForRentExemption(mc.span),space:mc.span,programId:t}),Aa(t,u,n,i,c.publicKey,r.mint,l,r.programId,o.mint,d,o.programId,oc(t,u).publicKey,s,a)];return{address:{observationId:c.publicKey,poolId:u,mintAVault:l,mintBVault:d},innerTransaction:{instructions:m,signers:[],instructionTypes:[jo.createAccount,jo.clmmCreatePool],lookupTableAddress:[]}}}static async makeOpenPositionFromLiquidityInstructions({poolInfo:e,ownerInfo:t,tickLower:n,tickUpper:r,liquidity:o,amountMaxA:i,amountMaxB:s,withMetadata:a,getEphemeralSigners:c}){const u=[];let l;if(c)l=new re((await c(1))[0]);else{const e=Ne.generate();u.push(e),l=e.publicKey}const d=cc.getTickArrayStartIndexByTick(n,e.ammConfig.tickSpacing),m=cc.getTickArrayStartIndexByTick(r,e.ammConfig.tickSpacing),{publicKey:p}=Ja(e.programId,e.id,d),{publicKey:f}=Ja(e.programId,e.id,m),{publicKey:g}=zo(t.wallet,l,se),{publicKey:w}=nc(l),{publicKey:h}=tc(e.programId,l),{publicKey:k}=ec(e.programId,e.id,n,r),y=function(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h,k,y,A,I,b,T,v,S){const x=Do([To("tickLowerIndex"),To("tickUpperIndex"),To("tickArrayLowerStartIndex"),To("tickArrayUpperStartIndex"),Eo("liquidity"),Po("amountMaxA"),Po("amountMaxB"),Vo("withMetadata"),Co("optionBaseFlag"),Vo("baseFlag")]),O=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Un,isSigner:!1,isWritable:!1},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:zn,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...O],C=ee.alloc(x.span);x.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:y,tickArrayUpperStartIndex:A,liquidity:I,amountMaxA:b,amountMaxB:T,withMetadata:"create"===v,baseFlag:!1,optionBaseFlag:0},C);const q=ee.from([...ya.openPosition,...C]);return new ie({keys:B,programId:e,data:q})}(e.programId,t.feePayer,e.id,t.wallet,l,g,w,k,p,f,h,t.tokenAccountA,t.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,n,r,d,m,o,i,s,a,Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[d,m])?oc(e.programId,e.id).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:p,tickArrayUpper:f,positionNftAccount:g,metadataAccount:w,personalPosition:h,protocolPosition:k},innerTransaction:{instructions:[y],signers:u,instructionTypes:[jo.clmmOpenPosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static async makeOpenPositionFromBaseInstructions({poolInfo:e,ownerInfo:t,tickLower:n,tickUpper:r,base:o,baseAmount:i,otherAmountMax:s,withMetadata:a,getEphemeralSigners:c}){const u=[];let l;if(c)l=new re((await c(1))[0]);else{const e=Ne.generate();u.push(e),l=e.publicKey}const d=cc.getTickArrayStartIndexByTick(n,e.ammConfig.tickSpacing),m=cc.getTickArrayStartIndexByTick(r,e.ammConfig.tickSpacing),{publicKey:p}=Ja(e.programId,e.id,d),{publicKey:f}=Ja(e.programId,e.id,m),{publicKey:g}=zo(t.wallet,l,se),{publicKey:w}=nc(l),{publicKey:h}=tc(e.programId,l),{publicKey:k}=ec(e.programId,e.id,n,r),y=function(e,t,n,r,o,i,s,a,c,u,l,d,m,p,f,g,w,h,k,y,A,I,b,T,v,S){const x=Do([To("tickLowerIndex"),To("tickUpperIndex"),To("tickArrayLowerStartIndex"),To("tickArrayUpperStartIndex"),Eo("liquidity"),Po("amountMaxA"),Po("amountMaxB"),Vo("withMetadata"),Co("optionBaseFlag"),Vo("baseFlag")]),O=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Un,isSigner:!1,isWritable:!1},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:zn,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...O],C=ee.alloc(x.span);x.encode({tickLowerIndex:h,tickUpperIndex:k,tickArrayLowerStartIndex:y,tickArrayUpperStartIndex:A,liquidity:ar,amountMaxA:"MintA"===b?T:v,amountMaxB:"MintA"===b?v:T,withMetadata:"create"===I,baseFlag:"MintA"===b,optionBaseFlag:1},C);const q=ee.from([...ya.openPosition,...C]);return new ie({keys:B,programId:e,data:q})}(e.programId,t.feePayer,e.id,t.wallet,l,g,w,k,p,f,h,t.tokenAccountA,t.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,n,r,d,m,a,o,i,s,Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[d,m])?oc(e.programId,e.id).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:p,tickArrayUpper:f,positionNftAccount:g,metadataAccount:w,personalPosition:h,protocolPosition:k},innerTransaction:{instructions:[y],signers:u,instructionTypes:[jo.clmmOpenPosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeIncreasePositionFromLiquidityInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,liquidity:r,amountMaxA:o,amountMaxB:i}){const s=cc.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),a=cc.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Ja(e.programId,e.id,s),{publicKey:u}=Ja(e.programId,e.id,a),{publicKey:l}=zo(n.wallet,t.nftMint,se),{publicKey:d}=tc(e.programId,t.nftMint),{publicKey:m}=ec(e.programId,e.id,t.tickLower,t.tickUpper);return{address:{tickArrayLower:c,tickArrayUpper:u,positionNftAccount:l,personalPosition:d,protocolPosition:m},innerTransaction:{instructions:[ba(e.programId,n.wallet,l,d,e.id,m,c,u,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,r,o,i,Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[s,a])?oc(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[jo.clmmIncreasePosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeIncreasePositionFromBaseInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,base:r,baseAmount:o,otherAmountMax:i}){const s=cc.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),a=cc.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Ja(e.programId,e.id,s),{publicKey:u}=Ja(e.programId,e.id,a),{publicKey:l}=zo(n.wallet,t.nftMint,se),{publicKey:d}=tc(e.programId,t.nftMint),{publicKey:m}=ec(e.programId,e.id,t.tickLower,t.tickUpper);return{address:{tickArrayLower:c,tickArrayUpper:u,positionNftAccount:l,personalPosition:d,protocolPosition:m},innerTransaction:{instructions:[Ta(e.programId,n.wallet,l,d,e.id,m,c,u,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,r,o,i,Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[s,a])?oc(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[jo.clmmIncreasePosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeDecreaseLiquidityInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,liquidity:r,amountMinA:o,amountMinB:i}){const s=cc.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),a=cc.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Ja(e.programId,e.id,s),{publicKey:u}=Ja(e.programId,e.id,a),{publicKey:l}=zo(n.wallet,t.nftMint,se),{publicKey:d}=tc(e.programId,t.nftMint),{publicKey:m}=ec(e.programId,e.id,t.tickLower,t.tickUpper),p=[];for(let f=0;f<e.rewardInfos.length;f++)p.push({poolRewardVault:e.rewardInfos[f].tokenVault,ownerRewardVault:n.rewardAccounts[f],rewardMint:e.rewardInfos[f].tokenMint});return{address:{tickArrayLower:c,tickArrayUpper:u,positionNftAccount:l,personalPosition:d,protocolPosition:m},innerTransaction:{instructions:[va(e.programId,n.wallet,l,d,e.id,m,c,u,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,p,r,o,i,Ic.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[s,a])?oc(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[jo.clmmDecreasePosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeClosePositionInstructions({poolInfo:e,ownerInfo:t,ownerPosition:n}){const{publicKey:r}=zo(t.wallet,n.nftMint,se),{publicKey:o}=tc(e.programId,n.nftMint);return{address:{positionNftAccount:r,personalPosition:o},innerTransaction:{instructions:[Ia(e.programId,t.wallet,n.nftMint,r,o)],signers:[],instructionTypes:[jo.clmmClosePosition],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeSwapBaseInInstructions({poolInfo:e,ownerInfo:t,inputMint:n,amountIn:r,amountOutMin:o,sqrtPriceLimitX64:i,remainingAccounts:s}){const a=e.mintA.mint.equals(n);return{address:{},innerTransaction:{instructions:[Sa(e.programId,t.wallet,e.id,e.ammConfig.id,a?t.tokenAccountA:t.tokenAccountB,a?t.tokenAccountB:t.tokenAccountA,a?e.mintA.vault:e.mintB.vault,a?e.mintB.vault:e.mintA.vault,a?e.mintA.mint:e.mintB.mint,a?e.mintB.mint:e.mintA.mint,s,e.observationId,r,o,i,!0,oc(e.programId,e.id).publicKey)],signers:[],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[jo.clmmSwapBaseIn]}}}static makeSwapBaseOutInstructions({poolInfo:e,ownerInfo:t,outputMint:n,amountOut:r,amountInMax:o,sqrtPriceLimitX64:i,remainingAccounts:s}){const a=e.mintA.mint.equals(n);return{address:{},innerTransaction:{instructions:[Sa(e.programId,t.wallet,e.id,e.ammConfig.id,a?t.tokenAccountB:t.tokenAccountA,a?t.tokenAccountA:t.tokenAccountB,a?e.mintB.vault:e.mintA.vault,a?e.mintA.vault:e.mintB.vault,a?e.mintB.mint:e.mintA.mint,a?e.mintA.mint:e.mintB.mint,s,e.observationId,r,o,i,!1,oc(e.programId,e.id).publicKey)],signers:[],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[jo.clmmSwapBaseOut]}}}static makeInitRewardInstructions({poolInfo:e,ownerInfo:t,rewardInfo:n}){const r=(o=e.programId,i=e.id,s=n.mint,jn([ja,i.toBuffer(),s.toBuffer()],o)).publicKey;var o,i,s;const a=rc(e.programId).publicKey;return{address:{poolRewardVault:r,operationId:a},innerTransaction:{instructions:[xa(e.programId,t.wallet,e.id,a,e.ammConfig.id,t.tokenAccount,n.programId,n.mint,r,n.openTime,n.endTime,n.emissionsPerSecondX64)],signers:[],instructionTypes:[jo.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeSetRewardInstructions({poolInfo:e,ownerInfo:t,rewardInfo:n}){let r,o,i;for(let a=0;a<e.rewardInfos.length;a++)e.rewardInfos[a].tokenMint.equals(n.mint)&&(r=a,o=e.rewardInfos[a].tokenVault,i=e.rewardInfos[a].tokenMint);if(void 0===r||void 0===o||void 0===i)throw Error("reward mint check error");const s=rc(e.programId).publicKey;return{address:{rewardVault:o,operationId:s},innerTransaction:{instructions:[Oa(e.programId,t.wallet,e.id,s,e.ammConfig.id,t.tokenAccount,o,i,r,n.openTime,n.endTime,n.emissionsPerSecondX64)],signers:[],instructionTypes:[jo.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static makeCollectRewardInstructions({poolInfo:e,ownerInfo:t,rewardMint:n}){let r,o;for(let i=0;i<e.rewardInfos.length;i++)e.rewardInfos[i].tokenMint.equals(n)&&(r=i,o=e.rewardInfos[i].tokenVault);if(void 0===r||void 0===o)throw Error("reward mint check error");return{address:{rewardVault:o},innerTransaction:{instructions:[Ba(e.programId,t.wallet,e.id,t.tokenAccount,o,n,r)],signers:[],instructionTypes:[jo.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default)))}}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:i,add:s,token2022Infos:a,epochInfo:c,amountHasFee:u}){const l=e.sqrtPriceX64,d=Sc.getSqrtPriceX64FromTick(n),m=Sc.getSqrtPriceX64FromTick(r),p=s?1-i:1+i,f=Jo(o,a[t?e.mintA.mint.toString():e.mintB.mint.toString()]?.feeConfig,c,!u),g=new Re(new ka(f.amount.sub(f.fee??ar).toString()).mul(p).toFixed(0));let w;if(l.lte(d))w=t?Oc.getLiquidityFromTokenAmountA(d,m,g,!s):new Re(0);else if(l.lte(m)){const e=Oc.getLiquidityFromTokenAmountA(l,m,g,!s),n=Oc.getLiquidityFromTokenAmountB(d,l,g);w=t?e:n}else w=t?new Re(0):Oc.getLiquidityFromTokenAmountB(d,m,g);return this.getAmountsFromLiquidity({poolInfo:e,tickLower:n,tickUpper:r,liquidity:w,slippage:i,add:s,token2022Infos:a,epochInfo:c,amountAddFee:u})}static getLiquidityFromAmounts({poolInfo:e,tickLower:t,tickUpper:n,amountA:r,amountB:o,slippage:i,add:s,token2022Infos:a,epochInfo:c,amountHasFee:u}){const[l,d,m,p]=t<n?[t,n,r,o]:[n,t,o,r],f=e.sqrtPriceX64,g=Sc.getSqrtPriceX64FromTick(l),w=Sc.getSqrtPriceX64FromTick(d),[h,k]=[Jo(m,a[e.mintA.mint.toString()]?.feeConfig,c,!u),Jo(p,a[e.mintB.mint.toString()]?.feeConfig,c,!u)],y=Oc.getLiquidityFromTokenAmounts(f,g,w,h.amount.sub(h.fee??ar),k.amount.sub(k.fee??ar));return this.getAmountsFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:y,slippage:i,add:s,token2022Infos:a,epochInfo:c,amountAddFee:!u})}static getAmountsFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:i,token2022Infos:s,epochInfo:a,amountAddFee:c}){const u=Sc.getSqrtPriceX64FromTick(t),l=Sc.getSqrtPriceX64FromTick(n),d=i?1+o:1-o,m=Oc.getAmountsFromLiquidity(e.sqrtPriceX64,u,l,r,i),[p,f]=[Jo(m.amountA,s[e.mintA.mint.toString()]?.feeConfig,a,c),Jo(m.amountB,s[e.mintB.mint.toString()]?.feeConfig,a,c)],[g,w]=[Jo(new Re(new ka(m.amountA.toString()).mul(d).toFixed(0)),s[e.mintA.mint.toString()]?.feeConfig,a,c),Jo(new Re(new ka(m.amountB.toString()).mul(d).toFixed(0)),s[e.mintB.mint.toString()]?.feeConfig,a,c)];return{liquidity:r,amountA:p,amountB:f,amountSlippageA:g,amountSlippageB:w,expirationTime:ei(p.expirationTime,f.expirationTime)}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){const r=n?t:new ka(1).div(t),o=xc.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),i=Sc.getSqrtPriceX64FromTick(o),s=Sc.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new ka(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){const r=Sc.getSqrtPriceX64FromTick(t),o=Sc.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new ka(1).div(o),tickSqrtPriceX64:r}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,epochInfo:r,amountIn:o,currencyOut:i,slippage:s,catchLiquidityInsufficient:a=!1}){const c=o instanceof mo,u=(c?o.token:br.WSOL).mint,l=o.raw,d=s.numerator.toNumber()/s.denominator.toNumber(),{allTrade:m,realAmountIn:p,amountOut:f,minAmountOut:g,expirationTime:w,currentPrice:h,executionPrice:k,priceImpact:y,fee:A,remainingAccounts:I}=this.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:u,amountIn:l,slippage:d,token2022Infos:n,epochInfo:r,catchLiquidityInsufficient:a});return{allTrade:m,realAmountIn:{...p,amount:c?new mo(o.token,p.amount):new lo(Ir.SOL,p.amount),fee:void 0===p.fee?void 0:c?new mo(o.token,p.fee):new lo(Ir.SOL,p.fee)},amountOut:{...f,amount:i instanceof br?new mo(i,f.amount):new lo(i,f.amount),fee:void 0===f.fee?void 0:i instanceof br?new mo(i,f.fee):new lo(i,f.fee)},minAmountOut:{...g,amount:i instanceof br?new mo(i,g.amount):new lo(i,g.amount),fee:void 0===g.fee?void 0:i instanceof br?new mo(i,g.fee):new lo(i,g.fee)},expirationTime:w,currentPrice:new wo(c?o.token:o.currency,new Re(10).pow(new Re(20+(c?o.token:o.currency).decimals)),i instanceof br?i:br.WSOL,h.mul(new ka(10**(20+(i instanceof br?i:br.WSOL).decimals))).toFixed(0)),executionPrice:new wo(c?o.token:o.currency,new Re(10).pow(new Re(20+(c?o.token:o.currency).decimals)),i instanceof br?i:br.WSOL,k.mul(new ka(10**(20+(i instanceof br?i:br.WSOL).decimals))).toFixed(0)),priceImpact:y,fee:c?new mo(o.token,A):new lo(o.currency,A),remainingAccounts:I}}static async computeAmountOutAndCheckToken({connection:e,poolInfo:t,tickArrayCache:n,baseMint:r,amountIn:o,slippage:i,priceLimit:s=new ka(0),catchLiquidityInsufficient:a=!1}){const c=await e.getEpochInfo(),u=await ti({connection:e,mints:[t.mintA,t.mintB].filter((e=>e.programId.equals(He))).map((e=>e.mint))});return this.computeAmountOut({poolInfo:t,tickArrayCache:n,baseMint:r,amountIn:o,slippage:i,priceLimit:s,token2022Infos:u,epochInfo:c,catchLiquidityInsufficient:a})}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountIn:i,slippage:s,priceLimit:a=new ka(0),catchLiquidityInsufficient:c=!1}){let u;u=a.equals(new ka(0))?n.equals(e.mintA.mint)?Va.add(cr):Ra.sub(cr):Sc.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);const l=Jo(i,r[n.toString()]?.feeConfig,o,!1),{allTrade:d,realTradeAmountIn:m,expectedAmountOut:p,remainingAccounts:f,executionPrice:g,feeAmount:w}=Ic.getOutputAmountAndRemainAccounts(e,t,n,l.amount.sub(l.fee??ar),u,c),h=Jo(m,r[n.toString()]?.feeConfig,o,!0),k=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,y=Jo(p,r[k.toString()]?.feeConfig,o,!1),A=Sc.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),I=n.equals(e.mintA.mint)?A:new ka(1).div(A),b=Jo(p.mul(new Re(Math.floor(1e10*(1-s)))).div(new Re(1e10)),r[k.toString()]?.feeConfig,o,!1),T=e.mintA.mint.equals(n)?e.currentPrice:new ka(1).div(e.currentPrice),v=new ka(I).sub(T).abs(),S=T,x=new fo(new ka(v).mul(10**15).toFixed(0),new ka(S).mul(10**15).toFixed(0));return{allTrade:d,realAmountIn:h,amountOut:y,minAmountOut:b,expirationTime:ei(h.expirationTime,y.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:x,fee:w,remainingAccounts:f}}static async computeAmountInAndCheckToken({connection:e,poolInfo:t,tickArrayCache:n,baseMint:r,amountOut:o,slippage:i,priceLimit:s=new ka(0)}){const a=await e.getEpochInfo(),c=await ti({connection:e,mints:[t.mintA,t.mintB].filter((e=>e.programId.equals(He))).map((e=>e.mint))});return this.computeAmountIn({poolInfo:t,tickArrayCache:n,baseMint:r,amountOut:o,slippage:i,priceLimit:s,token2022Infos:c,epochInfo:a})}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:r,epochInfo:o,amountOut:i,slippage:s,priceLimit:a=new ka(0)}){let c;c=a.equals(new ka(0))?n.equals(e.mintB.mint)?Va.add(cr):Ra.sub(cr):Sc.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);const u=Jo(i,r[n.toString()]?.feeConfig,o,!0),{expectedAmountIn:l,remainingAccounts:d,executionPrice:m,feeAmount:p}=Ic.getInputAmountAndRemainAccounts(e,t,n,u.amount.sub(u.fee??ar),c),f=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,g=Jo(l,r[f.toString()]?.feeConfig,o,!0),w=Sc.sqrtPriceX64ToPrice(m,e.mintA.decimals,e.mintB.decimals),h=n.equals(e.mintA.mint)?w:new ka(1).div(w),k=Jo(l.mul(new Re(Math.floor(1e10*(1+s)))).div(new Re(1e10)),r[f.toString()]?.feeConfig,o,!0),y=e.mintA.mint.equals(n)?e.currentPrice:new ka(1).div(e.currentPrice),A=new ka(h).sub(y).abs(),I=y,b=new fo(new ka(A).mul(10**15).toFixed(0),new ka(I).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:k,realAmountOut:u,expirationTime:ei(g.expirationTime,u.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:b,fee:p,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){const o=e[t],i=this.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),s=this.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),a=Math.max(i,o.priceMin),c=Math.min(s,o.priceMax)-a,u=s-i,l=o.priceMax-o.priceMin;let d;return d=c<=0?0:u===c?l/c:l===c?c/u:c/l*(c/u),{feeApr:o.feeApr*d,rewardsApr:[o.rewardApr.A*d,o.rewardApr.B*d,o.rewardApr.C*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,aprType:t,mintPrice:n,rewardMintDecimals:r,liquidity:o,positionTickLowerIndex:i,positionTickUpperIndex:s,chainTime:a}){const c="day"===t?1:"week"===t?7:"month"===t?30:0,u=e[t],l=n[e.mintA.mint.toString()],d=n[e.mintB.mint.toString()],m=e.mintA.decimals,p=e.mintB.decimals;if(!u||!l||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};const f=Sc.getSqrtPriceX64FromTick(i),g=Sc.getSqrtPriceX64FromTick(s),{amountSlippageA:w,amountSlippageB:h}=Oc.getAmountsFromLiquidityWithSlippage(e.sqrtPriceX64,f,g,e.liquidity,!1,!1,0),{amountSlippageA:k,amountSlippageB:y}=Oc.getAmountsFromLiquidityWithSlippage(e.sqrtPriceX64,f,g,o,!1,!1,0),A=new ka(w.toString()).div(new ka(10).pow(m)).mul(l.toFixed(m)).add(new ka(h.toString()).div(new ka(10).pow(p)).mul(d.toFixed(p))),I=new ka(k.toString()).div(new ka(10).pow(m)).mul(l.toFixed(m)).add(new ka(y.toString()).div(new ka(10).pow(p)).mul(d.toFixed(p))),b=I.div(A.add(I)).div(I),T=new ka(u.volumeFee).mul(365).div(c).mul(b).mul(100).toNumber(),v=e.rewardInfos.map((e=>{const t=r[e.tokenMint.toString()],o=n[e.tokenMint.toString()];return a<e.openTime.toNumber()||a>e.endTime.toNumber()||e.perSecond.equals(0)||!o||void 0===t?0:new ka(o.toFixed(t)).mul(e.perSecond.mul(31536e3)).div(new ka(10).pow(t)).mul(b).mul(100).toNumber()}));return{feeApr:T,rewardsApr:v,apr:T+v.reduce(((e,t)=>e+t),0)}}static async fetchMultiplePoolInfos({connection:e,poolKeys:t,ownerInfo:n,chainTime:r,batchRequest:o=!1,updateOwnerRewardAndFee:i=!0}){const s=await Yn(e,t.map((e=>new re(e.id))),{batchRequest:o}),a={};for(let m=0;m<t.length;m++){const e=t[m],n=s[m];null!==n&&(a[e.id]=oc(n.owner,new re(e.id)).publicKey)}const c=await this.fetchExBitmaps({connection:e,exBitmapAddress:Object.values(a),batchRequest:o}),u=[],l={},d=[];for(let m=0;m<t.length;m++){const o=t[m],i=s[m],p=c[a[o.id].toString()];if(null===i)continue;const f=fc.decode(i.data);l[o.id]={state:{id:new re(o.id),mintA:{programId:new re(o.mintProgramIdA),mint:f.mintA,vault:f.vaultA,decimals:f.mintDecimalsA},mintB:{programId:new re(o.mintProgramIdB),mint:f.mintB,vault:f.vaultB,decimals:f.mintDecimalsB},observationId:f.observationId,ammConfig:{...o.ammConfig,id:new re(o.ammConfig.id)},creator:f.creator,programId:i.owner,version:6,tickSpacing:f.tickSpacing,liquidity:f.liquidity,sqrtPriceX64:f.sqrtPriceX64,currentPrice:Sc.sqrtPriceX64ToPrice(f.sqrtPriceX64,f.mintDecimalsA,f.mintDecimalsB),tickCurrent:f.tickCurrent,observationIndex:f.observationIndex,observationUpdateDuration:f.observationUpdateDuration,feeGrowthGlobalX64A:f.feeGrowthGlobalX64A,feeGrowthGlobalX64B:f.feeGrowthGlobalX64B,protocolFeesTokenA:f.protocolFeesTokenA,protocolFeesTokenB:f.protocolFeesTokenB,swapInAmountTokenA:f.swapInAmountTokenA,swapOutAmountTokenB:f.swapOutAmountTokenB,swapInAmountTokenB:f.swapInAmountTokenB,swapOutAmountTokenA:f.swapOutAmountTokenA,tickArrayBitmap:f.tickArrayBitmap,rewardInfos:await Ic.updatePoolRewardInfos({connection:e,apiPoolInfo:o,chainTime:r,poolLiquidity:f.liquidity,rewardInfos:f.rewardInfos.filter((e=>!e.tokenMint.equals(re.default)))}),day:o.day,week:o.week,month:o.month,tvl:o.tvl,lookupTableAccount:o.lookupTableAccount?new re(o.lookupTableAccount):re.default,startTime:f.startTime.toNumber(),exBitmapInfo:p}},n&&d.push(...l[o.id].state.rewardInfos.filter((e=>e.creator.equals(n.wallet)))),u.find((e=>e.equals(i.owner)))||u.push(i.owner)}if(n){const t=n.tokenAccounts.filter((e=>e.accountInfo.amount.eq(new Re(1)))).map((e=>e.accountInfo.mint)),r=[];for(const e of t)for(const t of u)r.push(tc(t,e).publicKey);const s=await Yn(e,r,{batchRequest:o}),a={};for(const e of s){if(null===e)continue;const t=wc.decode(e.data),n=t.poolId.toString(),r=l[n];if(void 0===r)continue;const o=r.state,i=this.getTickPrice({poolInfo:o,tick:t.tickLower,baseIn:!0}),s=this.getTickPrice({poolInfo:o,tick:t.tickUpper,baseIn:!0}),{amountA:c,amountB:u}=Oc.getAmountsFromLiquidity(o.sqrtPriceX64,i.tickSqrtPriceX64,s.tickSqrtPriceX64,t.liquidity,!1),d=1/(1-Math.sqrt(Math.sqrt(i.price.div(s.price).toNumber())));l[n].positionAccount=[...l[n].positionAccount??[],{poolId:t.poolId,nftMint:t.nftMint,priceLower:i.price,priceUpper:s.price,amountA:c,amountB:u,tickLower:t.tickLower,tickUpper:t.tickUpper,liquidity:t.liquidity,feeGrowthInsideLastX64A:t.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:t.feeGrowthInsideLastX64B,tokenFeesOwedA:t.tokenFeesOwedA,tokenFeesOwedB:t.tokenFeesOwedB,rewardInfos:t.rewardInfos.map((e=>({...e,pendingReward:new Re(0)}))),leverage:d,tokenFeeAmountA:new Re(0),tokenFeeAmountB:new Re(0)}];const m=cc.getTickArrayAddressByTick(l[n].state.programId,t.poolId,t.tickLower,l[n].state.tickSpacing),p=cc.getTickArrayAddressByTick(l[n].state.programId,t.poolId,t.tickUpper,l[n].state.tickSpacing);a[`${l[n].state.programId.toString()}-${t.poolId.toString()}-${t.tickLower}`]=m,a[`${l[n].state.programId.toString()}-${t.poolId.toString()}-${t.tickUpper}`]=p}if(i){const t=Object.values(a),n=await Yn(e,t,{batchRequest:o}),r={};for(let e=0;e<t.length;e++){const o=n[e];if(null===o)continue;const i=t[e];r[i.toString()]={address:i,...kc.decode(o.data)}}for(const{state:e,positionAccount:o}of Object.values(l))if(o)for(const t of o){const n=`${e.programId.toString()}-${e.id.toString()}-${t.tickLower}`,o=`${e.programId.toString()}-${e.id.toString()}-${t.tickUpper}`,i=r[a[n].toString()],s=r[a[o].toString()],c=i.ticks[cc.getTickOffsetInArray(t.tickLower,e.tickSpacing)],u=s.ticks[cc.getTickOffsetInArray(t.tickUpper,e.tickSpacing)],{tokenFeeAmountA:l,tokenFeeAmountB:d}=Cc.GetPositionFees(e,t,c,u),m=Cc.GetPositionRewards(e,t,c,u);t.tokenFeeAmountA=l.gte(ar)&&l.lt(Da)?l:ar,t.tokenFeeAmountB=d.gte(ar)&&l.lt(Da)?d:ar;for(let e=0;e<m.length;e++)t.rewardInfos[e].pendingReward=m[e].gte(ar)&&m[e].lt(Da)?m[e]:ar}}}if(d.length>0){const t=d.map((e=>e.tokenVault)),n=await Yn(e,t,{batchRequest:o}),r={};for(let e=0;e<t.length;e++){const o=t[e].toString(),i=n[e];if(null===i)continue;const s=Uo.decode(i.data);r[o]=s.amount}for(const e of d){const t=r[e.tokenVault.toString()];e.remainingRewards=void 0!==t?t.sub(e.rewardTotalEmissioned.sub(e.rewardClaimed)):ar}}return l}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){const r={},o=[];for(const a of t){const e=cc.getTickArrayStartIndexByTick(a.tickCurrent,a.tickSpacing),t=cc.getInitializedTickArrayInRange(a.tickArrayBitmap,a.exBitmapInfo,a.tickSpacing,e,7);for(const n of t){const{publicKey:e}=Ja(a.programId,a.id,n);o.push({pubkey:e}),r[e.toString()]=a.id}}const i=await Jn(e,o,{batchRequest:n}),s={};for(const a of i){if(!a.accountInfo)continue;const e=r[a.pubkey.toString()];if(!e)continue;void 0===s[e.toString()]&&(s[e.toString()]={});const t=kc.decode(a.accountInfo.data);s[e.toString()][t.startTickIndex]={...t,address:a.pubkey}}return s}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){const r=await Jn(e,t.map((e=>({pubkey:e}))),{batchRequest:n}),o={};for(const i of r)null!==i.accountInfo&&(o[i.pubkey.toString()]=Ac.decode(i.accountInfo.data));return o}static async getWhiteListMint({connection:e,programId:t}){const n=await e.getAccountInfo(rc(t).publicKey);return n?yc.decode(n.data).whitelistMints.filter((e=>!e.equals(re.default))):[]}}const Ec="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",Mc=new re(Ec),Lc={[Ec]:3},Nc={3:Mc},Vc=Do([So(5),So(8),No("ownAddress"),Po("vaultSignerNonce"),No("baseMint"),No("quoteMint"),No("baseVault"),Po("baseDepositsTotal"),Po("baseFeesAccrued"),No("quoteVault"),Po("quoteDepositsTotal"),Po("quoteFeesAccrued"),Po("quoteDustThreshold"),No("requestQueue"),No("eventQueue"),No("bids"),No("asks"),Po("baseLotSize"),Po("quoteLotSize"),Po("feeRateBps"),Po("referrerRebatesAccrued"),So(7)]),Rc={3:Vc},Fc=Wn.from("Serum");class Wc{static getProgramId(e){const t=Nc[e];return Fc.assertArgument(!!t,"invalid version","version",e),t}static getVersion(e){const t=e.toBase58(),n=Lc[t];return Fc.assertArgument(!!n,"invalid program id","programId",t),n}static getStateLayout(e){const t=Rc[e];return Fc.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){const n=[t.toBuffer()];let r,o=0;for(;o<100;){try{const t=n.concat(ee.from([o]),ee.alloc(7));r=re.createProgramAddressSync(t,e)}catch(i){if(i instanceof TypeError)throw i;o++;continue}return{publicKey:r,nonce:o}}return Fc.throwArgumentError("unable to find a viable program address nonce","params",{programId:e,marketId:t})}}const Dc=new re("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),_c=5e4,Kc=Do([Po("x"),Po("y"),Po("price")]),Uc=Do([Po("accountType"),Po("status"),Po("multiplier"),Po("validDataCount"),_o(Kc,_c,"DataElement")]);function zc(e,t,n){const[r,o,i]=function(e,t,n){const[r,o]=[0,49998];let i=r,s=o,a=0;const c=t*e.multiplier/n;for(;i<=s;){if(a=Math.floor((s+i)/2),0===a||a>=49998)return[a,a,!1];const t=e.DataElement[a].x*e.multiplier/e.DataElement[a].y,n=e.DataElement[a-1].x*e.multiplier/e.DataElement[a-1].y,r=e.DataElement[a+1].x*e.multiplier/e.DataElement[a+1].y;if(c===t)return[a,a,!0];if(c===n)return[a-1,a-1,!0];if(c===r)return[a+1,a+1,!0];if(c<n)s=a-1;else{if(c>n&&c<t)return[a-1,a,!0];if(c>t&&c<r)return[a,a+1,!0];i=a+1}}return[a,a,!1]}(e,t,n);if(!i)return 0;if(r===o){const n=e.DataElement[r].x;return t*e.multiplier/n}{const i=e.DataElement[r].x,s=e.DataElement[r].y,a=e.DataElement[o].x,c=e.DataElement[o].y,u=n*(a*s-i*c),l=i*u+(a-i)*(t*s-i*n)*c;return t*e.multiplier*u/l}}function Xc(e,t,n){return t*e.multiplier/n}function Gc(e,t,n){return t*n/e.multiplier}function jc(e,t,n,r){const o=r?t+n:t-n,[i,s,a]=function(e,t){const[n,r]=[0,49998];let o=n,i=r,s=0;const a=t;for(;o<i;){if(s=Math.floor((i+o)/2),s<=0||s>49998)return[s,s,!1];const t=e.DataElement[s].x,n=e.DataElement[s-1].x,r=e.DataElement[s+1].x;if(a===t)return[s,s,!0];if(a===n)return[s-1,s-1,!0];if(a===r)return[s+1,s+1,!0];if(a<n)i=s-1;else{if(a>n&&a<t)return[s-1,s,!0];if(a>t&&a<r)return[s,s+1,!0];o=s+1}}return[s,s,!1]}(e,o);if(!a)return[0,0,!1,a];if(i===s)return[e.DataElement[s].price,e.DataElement[s].y,!1,a];{const n=e.DataElement[i].x,c=e.DataElement[s].x,u=e.DataElement[i].price,l=e.DataElement[s].price,d=e.DataElement[i].y,m=e.DataElement[s].y;if(t>=n&&t<=c)return r?[l,m,!0,a]:[u,d,!0,a];{let i,s;return r?(i=u+(l-u)*(t-n)/(c-n),s=d-(o-n)*e.multiplier/l):(i=u+(l-u)*(t-n)/(c-n),s=m+(c-o)*e.multiplier/u),[i,s,!1,a]}}}function Hc(e,t,n,r){const o=r?t-n:t+n,[i,s,a]=function(e,t){const[n,r]=[0,49998];let o=n,i=r,s=0;const a=t;for(;o<=i;){if(s=Math.floor((i+o)/2),s<=0||s>=49998)return[s,s,!1];const t=e.DataElement[s].y,n=e.DataElement[s-1].y,r=e.DataElement[s+1].y;if(a===t)return[s,s,!0];if(a===n)return[s-1,s-1,!0];if(a===r)return[s+1,s+1,!0];if(a<r)o=s+1;else{if(a<n&&a>t)return[s-1,s,!0];if(a<t&&a>r)return[s,s+1,!0];i=s-1}}return[s,s,!1]}(e,o);if(!a)return[0,0,!1,a];if(i===s)return[e.DataElement[s].price,e.DataElement[s].x,!1,a];{const n=e.DataElement[i].x,c=e.DataElement[s].x,u=e.DataElement[i].price,l=e.DataElement[s].price,d=e.DataElement[i].y,m=e.DataElement[s].y;if(t>=m&&t<=d)return r?[l,c,!0,a]:[u,n,!0,a];{let i,s;return r?(i=u+(l-u)*(d-t)/(d-m),s=n+l*(d-o)/e.multiplier):(i=u+(l-u)*(d-t)/(d-m),s=c-u*(o-m)/e.multiplier),[i,s,!1,a]}}}function Qc(e,t,n,r){const o=function(e,t){const n=jc(e,t,0,!1);return n[3]?n[0]:0}(e,Xc(e,t,zc(e,t,n)))/e.multiplier;return r?o:1/o}var Zc;const $c=Wn.from("Liquidity");let Yc={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};async function Jc(e){if(0===Yc.validDataCount&&e){const t=await e.getAccountInfo(Dc);t&&(Yc=function(e){const t=Uc.decode(e);return{accountType:t.accountType.toNumber(),status:t.status.toNumber(),multiplier:t.multiplier.toNumber(),validDataCount:t.validDataCount.toNumber(),DataElement:t.DataElement.map((e=>({x:e.x.toNumber(),y:e.y.toNumber(),price:e.price.toNumber()})))}}(t?.data))}}var eu;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initialized=1]="Initialized",e[e.Disabled=2]="Disabled",e[e.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",e[e.LiquidityOnly=4]="LiquidityOnly",e[e.OrderBook=5]="OrderBook",e[e.Swap=6]="Swap",e[e.WaitingForStart=7]="WaitingForStart"}(eu||(eu={}));const tu=new Re(25),nu=new Re(1e4);class ru extends Ho{static getStateLayout(e){const t=Vi[e];return $c.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedId({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("amm_associated_seed","utf-8")],e);return n}static getAssociatedAuthority({programId:e}){return jn([ee.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],e)}static getAssociatedBaseVault({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("coin_vault_associated_seed","utf-8")],e);return n}static getAssociatedQuoteVault({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("pc_vault_associated_seed","utf-8")],e);return n}static getAssociatedLpMint({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("lp_mint_associated_seed","utf-8")],e);return n}static getAssociatedLpVault({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("temp_lp_token_associated_seed","utf-8")],e);return n}static getAssociatedTargetOrders({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("target_associated_seed","utf-8")],e);return n}static getAssociatedWithdrawQueue({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("withdraw_associated_seed","utf-8")],e);return n}static getAssociatedOpenOrders({programId:e,marketId:t}){const{publicKey:n}=jn([e.toBuffer(),t.toBuffer(),ee.from("open_order_associated_seed","utf-8")],e);return n}static getAssociatedConfigId({programId:e}){const{publicKey:t}=jn([ee.from("amm_config_account_seed","utf-8")],e);return t}static getAssociatedPoolKeys({version:e,marketVersion:t,marketId:n,baseMint:r,quoteMint:o,baseDecimals:i,quoteDecimals:s,programId:a,marketProgramId:c}){const u=this.getAssociatedId({programId:a,marketId:n}),l=this.getAssociatedLpMint({programId:a,marketId:n}),{publicKey:d,nonce:m}=this.getAssociatedAuthority({programId:a}),p=this.getAssociatedBaseVault({programId:a,marketId:n}),f=this.getAssociatedQuoteVault({programId:a,marketId:n}),g=this.getAssociatedLpVault({programId:a,marketId:n}),w=this.getAssociatedOpenOrders({programId:a,marketId:n}),h=this.getAssociatedTargetOrders({programId:a,marketId:n}),k=this.getAssociatedWithdrawQueue({programId:a,marketId:n}),{publicKey:y}=Wc.getAssociatedAuthority({programId:c,marketId:n});return{id:u,baseMint:r,quoteMint:o,lpMint:l,baseDecimals:i,quoteDecimals:s,lpDecimals:i,version:e,programId:a,authority:d,nonce:m,baseVault:p,quoteVault:f,lpVault:g,openOrders:w,targetOrders:h,withdrawQueue:k,marketVersion:t,marketProgramId:c,marketId:n,marketAuthority:y,lookupTableAccount:re.default,configId:this.getAssociatedConfigId({programId:a})}}static async getCreatePoolFee({connection:e,programId:t}){const n=this.getAssociatedConfigId({programId:t}),r=Do([Po("fee")]),o=await e.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(null===o)throw Error("get config account error");return r.decode(o.data).fee}static makeAddLiquidityInstruction(e){const{poolKeys:t,userKeys:n,baseAmountIn:r,quoteAmountIn:o,fixedSide:i}=e,{version:s}=t;if(4===s||5===s){const e=Do([Co("instruction"),Po("baseAmountIn"),Po("quoteAmountIn"),Po("fixedSide")]),a=ee.alloc(e.span);e.encode({instruction:3,baseAmountIn:pr(r),quoteAmountIn:pr(o),fixedSide:pr("base"===i?0:1)},a);const c=[Qn(se,!1),Hn(t.id,!1),Qn(t.authority,!1),Qn(t.openOrders,!1),Hn(t.targetOrders,!1),Hn(t.lpMint,!1),Hn(t.baseVault,!1),Hn(t.quoteVault,!1)];return 5===s&&c.push(Hn(Dc,!1)),c.push(Qn(t.marketId,!1),Hn(n.baseTokenAccount,!1),Hn(n.quoteTokenAccount,!1),Hn(n.lpTokenAccount,!1),Qn(n.owner,!0),Qn(t.marketEventQueue,!1)),{address:{},innerTransaction:{instructions:[new ie({programId:t.programId,keys:c,data:a})],signers:[],lookupTableAddress:[t.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[4===s?jo.ammV4AddLiquidity:jo.ammV5AddLiquidity]}}}return $c.throwArgumentError("invalid version","poolKeys.version",s)}static async makeAddLiquidityInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:r,amountInA:o,amountInB:i,fixedSide:s,config:a,makeTxVersion:c,lookupTableCache:u,computeBudgetConfig:l}=e,{lpMint:d}=n,{tokenAccounts:m,owner:p,payer:f=p}=r;$c.debug("amountInA:",o),$c.debug("amountInB:",i),$c.assertArgument(!o.isZero()&&!i.isZero(),"amounts must greater than zero","amountInA & amountInB",{amountInA:o.toFixed(),amountInB:i.toFixed()});const{bypassAssociatedCheck:g,checkCreateATAOwner:w}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...a},h=o instanceof mo?o.token:br.WSOL,k=i instanceof mo?i.token:br.WSOL,y=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:h.mint,owner:p,config:{associatedOnly:!1}}),A=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:k.mint,owner:p,config:{associatedOnly:!1}});$c.assertArgument(!!y||!!A,"cannot found target token accounts","tokenAccounts",m);const I=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:d,owner:p}),b=[h,k],T=[y,A],v=[o.raw,i.raw],[S]=this._getAmountsSide(o,i,n);let x="base";if("quote"===S)if(b.reverse(),T.reverse(),v.reverse(),"a"===s)x="quote";else{if("b"!==s)return $c.throwArgumentError("invalid fixedSide","fixedSide",s);x="base"}else{if("base"!==S)return $c.throwArgumentError("invalid fixedSide","fixedSide",s);if("a"===s)x="base";else{if("b"!==s)return $c.throwArgumentError("invalid fixedSide","fixedSide",s);x="quote"}}const[O,B]=b,[C,q]=T,[P,E]=v,M=[],L=[],N=[],V=[],R=[],F=await this._handleTokenAccount({programId:se,connection:t,side:"in",amount:P,mint:O.mint,tokenAccount:C,owner:p,payer:f,frontInstructions:M,endInstructions:L,signers:R,bypassAssociatedCheck:g,frontInstructionsType:N,endInstructionsType:V,checkCreateATAOwner:w}),W=await this._handleTokenAccount({programId:se,connection:t,side:"in",amount:E,mint:B.mint,tokenAccount:q,owner:p,payer:f,frontInstructions:M,endInstructions:L,signers:R,bypassAssociatedCheck:g,frontInstructionsType:N,endInstructionsType:V,checkCreateATAOwner:w}),D=await this._handleTokenAccount({programId:se,connection:t,side:"out",amount:0,mint:d,tokenAccount:I,owner:p,payer:f,frontInstructions:M,endInstructions:L,signers:R,bypassAssociatedCheck:g,frontInstructionsType:N,endInstructionsType:V,checkCreateATAOwner:w}),_=this.makeAddLiquidityInstruction({poolKeys:n,userKeys:{baseTokenAccount:F,quoteTokenAccount:W,lpTokenAccount:D,owner:p},baseAmountIn:P,quoteAmountIn:E,fixedSide:x});return{address:{lpTokenAccount:D},innerTransactions:await rr({connection:t,makeTxVersion:c,computeBudgetConfig:l,payer:f,innerTransaction:[{instructionTypes:N,instructions:M,signers:R},_.innerTransaction,{instructionTypes:V,instructions:L,signers:[]}],lookupTableCache:u})}}static makeRemoveLiquidityInstruction(e){const{poolKeys:t,userKeys:n,amountIn:r}=e,{version:o}=t;if(4===o||5===o){const e=Do([Co("instruction"),Po("amountIn")]),i=ee.alloc(e.span);e.encode({instruction:4,amountIn:pr(r)},i);const s=[Qn(se,!1),Hn(t.id,!1),Qn(t.authority,!1),Hn(t.openOrders,!1),Hn(t.targetOrders,!1),Hn(t.lpMint,!1),Hn(t.baseVault,!1),Hn(t.quoteVault,!1)];return 5===o?s.push(Hn(Dc,!1)):(s.push(Hn(t.withdrawQueue,!1)),s.push(Hn(t.lpVault,!1))),s.push(Qn(t.marketProgramId,!1),Hn(t.marketId,!1),Hn(t.marketBaseVault,!1),Hn(t.marketQuoteVault,!1),Qn(t.marketAuthority,!1),Hn(n.lpTokenAccount,!1),Hn(n.baseTokenAccount,!1),Hn(n.quoteTokenAccount,!1),Qn(n.owner,!0),Hn(t.marketEventQueue,!1),Hn(t.marketBids,!1),Hn(t.marketAsks,!1)),{address:{},innerTransaction:{instructions:[new ie({programId:t.programId,keys:s,data:i})],signers:[],lookupTableAddress:[t.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[4===o?jo.ammV4RemoveLiquidity:jo.ammV5RemoveLiquidity]}}}return $c.throwArgumentError("invalid version","poolKeys.version",o)}static async makeRemoveLiquidityInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:r,amountIn:o,config:i,makeTxVersion:s,lookupTableCache:a,computeBudgetConfig:c}=e,{baseMint:u,quoteMint:l,lpMint:d}=n,{tokenAccounts:m,owner:p,payer:f=p}=r;$c.debug("amountIn:",o),$c.assertArgument(!o.isZero(),"amount must greater than zero","amountIn",o.toFixed()),$c.assertArgument(o instanceof mo&&o.token.mint.equals(d),"amountIn's token not match lpMint","amountIn",o);const g=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:d,owner:p,config:{associatedOnly:!1}});if(!g)return $c.throwArgumentError("cannot found lpTokenAccount","tokenAccounts",m);const w=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:u,owner:p}),h=this._selectTokenAccount({programId:se,tokenAccounts:m,mint:l,owner:p}),{bypassAssociatedCheck:k,checkCreateATAOwner:y}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...i},A=[],I=[],b=[],T=[],v=g,S=await this._handleTokenAccount({programId:se,connection:t,side:"out",amount:0,mint:u,tokenAccount:w,owner:p,payer:f,frontInstructions:A,endInstructions:I,signers:T,bypassAssociatedCheck:k,frontInstructionsType:b,checkCreateATAOwner:y}),x=await this._handleTokenAccount({programId:se,connection:t,side:"out",amount:0,mint:l,tokenAccount:h,owner:p,payer:f,frontInstructions:A,endInstructions:I,signers:T,bypassAssociatedCheck:k,frontInstructionsType:b,checkCreateATAOwner:y}),O=this.makeRemoveLiquidityInstruction({poolKeys:n,userKeys:{lpTokenAccount:v,baseTokenAccount:S,quoteTokenAccount:x,owner:p},amountIn:o.raw});return{address:{lpTokenAccount:v},innerTransactions:await rr({connection:t,makeTxVersion:s,computeBudgetConfig:c,payer:f,innerTransaction:[{instructionTypes:b,instructions:A,signers:T},O.innerTransaction,{instructionTypes:[],instructions:I,signers:[]}],lookupTableCache:a})}}static makeSwapInstruction(e){const{poolKeys:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:i}=e,{version:s}=t;return 4===s||5===s?"in"===i?this.makeSwapFixedInInstruction({poolKeys:t,userKeys:n,amountIn:r,minAmountOut:o},s):"out"===i?this.makeSwapFixedOutInstruction({poolKeys:t,userKeys:n,maxAmountIn:r,amountOut:o},s):$c.throwArgumentError("invalid params","params",e):$c.throwArgumentError("invalid version","poolKeys.version",s)}static makeSwapFixedInInstruction({poolKeys:e,userKeys:t,amountIn:n,minAmountOut:r},o){const i=Do([Co("instruction"),Po("amountIn"),Po("minAmountOut")]),s=ee.alloc(i.span);i.encode({instruction:9,amountIn:pr(n),minAmountOut:pr(r)},s);const a=[Qn(se,!1),Hn(e.id,!1),Qn(e.authority,!1),Hn(e.openOrders,!1)];return 4===o&&a.push(Hn(e.targetOrders,!1)),a.push(Hn(e.baseVault,!1),Hn(e.quoteVault,!1)),5===o&&a.push(Hn(Dc,!1)),a.push(Qn(e.marketProgramId,!1),Hn(e.marketId,!1),Hn(e.marketBids,!1),Hn(e.marketAsks,!1),Hn(e.marketEventQueue,!1),Hn(e.marketBaseVault,!1),Hn(e.marketQuoteVault,!1),Qn(e.marketAuthority,!1),Hn(t.tokenAccountIn,!1),Hn(t.tokenAccountOut,!1),Qn(t.owner,!0)),{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[4===o?jo.ammV4SwapBaseIn:jo.ammV5SwapBaseIn]}}}static makeSwapFixedOutInstruction({poolKeys:e,userKeys:t,maxAmountIn:n,amountOut:r},o){const i=Do([Co("instruction"),Po("maxAmountIn"),Po("amountOut")]),s=ee.alloc(i.span);i.encode({instruction:11,maxAmountIn:pr(n),amountOut:pr(r)},s);const a=[Qn(se,!1),Hn(e.id,!1),Qn(e.authority,!1),Hn(e.openOrders,!1),Hn(e.targetOrders,!1),Hn(e.baseVault,!1),Hn(e.quoteVault,!1)];return 5===o&&a.push(Hn(Dc,!1)),a.push(Qn(e.marketProgramId,!1),Hn(e.marketId,!1),Hn(e.marketBids,!1),Hn(e.marketAsks,!1),Hn(e.marketEventQueue,!1),Hn(e.marketBaseVault,!1),Hn(e.marketQuoteVault,!1),Qn(e.marketAuthority,!1),Hn(t.tokenAccountIn,!1),Hn(t.tokenAccountOut,!1),Qn(t.owner,!0)),{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[4===o?jo.ammV4SwapBaseOut:jo.ammV5SwapBaseOut]}}}static async makeSwapInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:r,amountIn:o,amountOut:i,fixedSide:s,config:a,makeTxVersion:c,lookupTableCache:u,computeBudgetConfig:l}=e,{tokenAccounts:d,owner:m,payer:p=m}=r;$c.debug("amountIn:",o),$c.debug("amountOut:",i),$c.assertArgument(!o.isZero()&&!i.isZero(),"amounts must greater than zero","currencyAmounts",{amountIn:o.toFixed(),amountOut:i.toFixed()});const{bypassAssociatedCheck:f,checkCreateATAOwner:g}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...a},w=o instanceof mo?o.token:br.WSOL,h=i instanceof mo?i.token:br.WSOL,k=this._selectTokenAccount({programId:se,tokenAccounts:d,mint:w.mint,owner:m,config:{associatedOnly:!1}}),y=this._selectTokenAccount({programId:se,tokenAccounts:d,mint:h.mint,owner:m}),[A,I]=[o.raw,i.raw],b=[],T=[],v=[],S=[],x=await this._handleTokenAccount({programId:se,connection:t,side:"in",amount:A,mint:w.mint,tokenAccount:k,owner:m,payer:p,frontInstructions:b,endInstructions:T,signers:S,bypassAssociatedCheck:f,frontInstructionsType:v,checkCreateATAOwner:g}),O=await this._handleTokenAccount({programId:se,connection:t,side:"out",amount:0,mint:h.mint,tokenAccount:y,owner:m,payer:p,frontInstructions:b,endInstructions:T,signers:S,bypassAssociatedCheck:f,frontInstructionsType:v,checkCreateATAOwner:g}),B=this.makeSwapInstruction({poolKeys:n,userKeys:{tokenAccountIn:x,tokenAccountOut:O,owner:m},amountIn:A,amountOut:I,fixedSide:s});return{address:{},innerTransactions:await rr({connection:t,makeTxVersion:c,computeBudgetConfig:l,payer:p,innerTransaction:[{instructionTypes:v,instructions:b,signers:S},B.innerTransaction,{instructionTypes:[],instructions:T,signers:[]}],lookupTableCache:u})}}static makeSimulatePoolInfoInstruction({poolKeys:e}){const t=Do([Co("instruction"),Co("simulateType")]),n=ee.alloc(t.span);t.encode({instruction:12,simulateType:0},n);const r=[Qn(e.id,!1),Qn(e.authority,!1),Qn(e.openOrders,!1),Qn(e.baseVault,!1),Qn(e.quoteVault,!1),Qn(e.lpMint,!1),Qn(e.marketId,!1),Qn(e.marketEventQueue,!1)];return{address:{},innerTransaction:{instructions:[new ie({programId:e.programId,keys:r,data:n})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter((e=>e&&!e.equals(re.default))),instructionTypes:[4===e.version?jo.ammV4SimulatePoolInfo:jo.ammV5SimulatePoolInfo]}}}static isV4(e){return void 0!==e.withdrawQueue}static async makeCreatePoolV4InstructionV2Simple({connection:e,programId:t,marketInfo:n,baseMintInfo:r,quoteMintInfo:o,baseAmount:i,quoteAmount:s,startTime:a,ownerInfo:c,associatedOnly:u=!1,computeBudgetConfig:l,checkCreateATAOwner:d=!1,makeTxVersion:m,lookupTableCache:p,feeDestinationId:f}){const g=[],w=[],h=[],k=[],y=[],A=c.useSOLBalance&&r.mint.equals(br.WSOL.mint),I=c.useSOLBalance&&o.mint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:se,mint:r.mint,tokenAccounts:A?[]:c.tokenAccounts,owner:c.wallet,createInfo:A?{connection:e,payer:c.feePayer,amount:i,frontInstructions:g,frontInstructionsType:h,endInstructions:A?w:[],endInstructionsType:A?k:[],signers:y}:void 0,associatedOnly:!A&&u,checkCreateATAOwner:d}),T=await this._selectOrCreateTokenAccount({programId:se,mint:o.mint,tokenAccounts:I?[]:c.tokenAccounts,owner:c.wallet,createInfo:I?{connection:e,payer:c.feePayer,amount:s,frontInstructions:g,frontInstructionsType:h,endInstructions:I?w:[],endInstructionsType:I?k:[],signers:y}:void 0,associatedOnly:!I&&u,checkCreateATAOwner:d});if(void 0===b||void 0===T)throw Error("you don't has some token account");const v=Zc.getAssociatedPoolKeys({version:4,marketVersion:3,marketId:n.marketId,baseMint:r.mint,quoteMint:o.mint,baseDecimals:r.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),S=this.makeCreatePoolV4InstructionV2({programId:t,ammId:v.id,ammAuthority:v.authority,ammOpenOrders:v.openOrders,lpMint:v.lpMint,coinMint:v.baseMint,pcMint:v.quoteMint,coinVault:v.baseVault,pcVault:v.quoteVault,ammTargetOrders:v.targetOrders,marketProgramId:v.marketProgramId,marketId:v.marketId,userWallet:c.wallet,userCoinVault:b,userPcVault:T,userLpVault:zo(c.wallet,v.lpMint,se).publicKey,ammConfigId:v.configId,feeDestinationId:f,nonce:v.nonce,openTime:a,coinAmount:i,pcAmount:s}).innerTransaction;return{address:{programId:t,ammId:v.id,ammAuthority:v.authority,ammOpenOrders:v.openOrders,lpMint:v.lpMint,coinMint:v.baseMint,pcMint:v.quoteMint,coinVault:v.baseVault,pcVault:v.quoteVault,withdrawQueue:v.withdrawQueue,ammTargetOrders:v.targetOrders,poolTempLp:v.lpVault,marketProgramId:v.marketProgramId,marketId:v.marketId},innerTransactions:await rr({connection:e,makeTxVersion:m,computeBudgetConfig:l,payer:c.feePayer,innerTransaction:[{instructionTypes:h,instructions:g,signers:y},S,{instructionTypes:k,instructions:w,signers:[]}],lookupTableCache:p})}}static makeCreatePoolV4InstructionV2({programId:e,ammId:t,ammAuthority:n,ammOpenOrders:r,lpMint:o,coinMint:i,pcMint:s,coinVault:a,pcVault:c,ammTargetOrders:u,marketProgramId:l,marketId:d,userWallet:m,userCoinVault:p,userPcVault:f,userLpVault:g,nonce:w,openTime:h,coinAmount:k,pcAmount:y,lookupTableAddress:A,ammConfigId:I,feeDestinationId:b}){const T=Do([Co("instruction"),Co("nonce"),Po("openTime"),Po("pcAmount"),Po("coinAmount")]),v=[{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:_n,isSigner:!1,isWritable:!1},{pubkey:Un,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],S=ee.alloc(T.span);return T.encode({instruction:1,nonce:w,openTime:h,coinAmount:k,pcAmount:y},S),{address:{},innerTransaction:{instructions:[new ie({keys:v,programId:e,data:S})],signers:[],lookupTableAddress:A?[A]:void 0,instructionTypes:[jo.ammV4CreatePoolV2]}}}static async makeRemoveAllLpAndCreateClmmPosition({connection:e,poolKeys:t,removeLpAmount:n,userKeys:r,clmmPoolKeys:o,createPositionInfo:i,farmInfo:s,computeBudgetConfig:a,checkCreateATAOwner:c=!1,getEphemeralSigners:u,makeTxVersion:l,lookupTableCache:d}){if(!t.baseMint.equals(o.mintA.mint)&&!t.baseMint.equals(o.mintB.mint))throw Error("mint check error");if(!t.quoteMint.equals(o.mintA.mint)&&!t.quoteMint.equals(o.mintB.mint))throw Error("mint check error");const m=[],p=[],f=[],g=[],w=[],h={};for(const C of r.tokenAccounts)(void 0===h[C.accountInfo.mint.toString()]||zo(r.owner,C.accountInfo.mint,se).publicKey.equals(C.pubkey))&&(h[C.accountInfo.mint.toString()]=C.pubkey);const k=h[t.lpMint.toString()];if(void 0===k)throw Error("find lp account error in trade accounts");const y=n.add(s?.amount??new Re(0)),A=t.baseMint.equals(br.WSOL.mint),I=t.quoteMint.equals(br.WSOL.mint),b=await this._selectOrCreateTokenAccount({programId:se,mint:t.baseMint,tokenAccounts:r.tokenAccounts,owner:r.owner,createInfo:{connection:e,payer:r.payer??r.owner,frontInstructions:m,frontInstructionsType:f,endInstructions:A?p:[],endInstructionsType:A?g:[],signers:w},associatedOnly:!0,checkCreateATAOwner:c}),T=await this._selectOrCreateTokenAccount({programId:se,mint:t.quoteMint,tokenAccounts:r.tokenAccounts,owner:r.owner,createInfo:{connection:e,payer:r.payer??r.owner,amount:0,frontInstructions:m,frontInstructionsType:f,endInstructions:I?p:[],endInstructionsType:I?g:[],signers:w},associatedOnly:!0,checkCreateATAOwner:c});h[t.baseMint.toString()]=b,h[t.quoteMint.toString()]=T;const v=this.makeRemoveLiquidityInstruction({poolKeys:t,userKeys:{lpTokenAccount:k,baseTokenAccount:b,quoteTokenAccount:T,owner:r.owner},amountIn:y}),[S,x]=t.baseMint.equals(o.mintA.mint)?[b,T]:[T,b],O=await Pc.makeOpenPositionFromLiquidityInstructions({poolInfo:o,ownerInfo:{feePayer:r.payer??r.owner,wallet:r.owner,tokenAccountA:S,tokenAccountB:x},withMetadata:"create",...i,getEphemeralSigners:u});let B={instructions:[],signers:[],instructionTypes:[]};if(void 0!==s){const t=[];for(const n of s.poolKeys.rewardInfos){const o=n.rewardMint.equals(br.WSOL.mint);t.push(h[n.rewardMint.toString()]??await this._selectOrCreateTokenAccount({programId:se,mint:n.rewardMint,tokenAccounts:r.tokenAccounts,owner:r.owner,createInfo:{connection:e,payer:r.payer??r.owner,frontInstructions:m,frontInstructionsType:f,endInstructions:o?p:[],endInstructionsType:o?g:[],signers:w},associatedOnly:!0,checkCreateATAOwner:c}))}B=Ei.makeWithdrawInstruction({poolKeys:s.poolKeys,amount:s.amount,userKeys:{ledger:Ei.getAssociatedLedgerAccount({programId:s.poolKeys.programId,poolId:s.poolKeys.id,owner:r.owner,version:s.poolKeys.version}),lpTokenAccount:k,rewardTokenAccounts:t,owner:r.owner}}).innerTransaction}return{address:{...v.address,...O.address},innerTransactions:await rr({connection:e,makeTxVersion:l,computeBudgetConfig:a,payer:r.payer??r.owner,innerTransaction:[{instructionTypes:f,instructions:m,signers:w},B,v.innerTransaction,O.innerTransaction,{instructionTypes:g,instructions:p,signers:[]}],lookupTableCache:d})}}static async fetchAllPoolKeys(e,t,n){const r=(await Promise.all(Object.entries(Vi).map((([n,r])=>{try{return e.getProgramAccounts(t[Number(n)],{filters:[{dataSize:r.span}]}).then((e=>e.map((e=>({id:e.pubkey,version:Number(n),programId:t[Number(n)],...r.decode(e.account.data)})))))}catch(o){if(o instanceof Error)return $c.throwError("failed to fetch pool info",Wn.errors.RPC_ERROR,{message:o.message})}})))).flat(),o=r.map((e=>e.marketId)),i={};try{const t=await Yn(e,o,n);for(const e of t){if(null===e)continue;const t={programId:e.owner,...Vc.decode(e.data)};i[t.ownAddress.toString()]=t}}catch(c){if(c instanceof Error)return $c.throwError("failed to fetch markets",Wn.errors.RPC_ERROR,{message:c.message})}const s={};for(const[u,l]of Object.entries(t))s[u]=this.getAssociatedAuthority({programId:l}).publicKey;const a=[];for(const u of r){if(void 0===u)continue;if(u.baseMint.equals(re.default))continue;const e=i[u.marketId.toString()],t=e.programId;a.push({id:u.id,baseMint:u.baseMint,quoteMint:u.quoteMint,lpMint:u.lpMint,baseDecimals:u.baseDecimal.toNumber(),quoteDecimals:u.quoteDecimal.toNumber(),lpDecimals:"6kmMMacvoCKBkBrqssLEdFuEZu2wqtLdNQxh9VjtzfwT"===u.id.toString()?5:u.baseDecimal.toNumber(),version:u.version,programId:u.programId,authority:s[u.version],openOrders:u.openOrders,targetOrders:u.targetOrders,baseVault:u.baseVault,quoteVault:u.quoteVault,marketVersion:3,marketProgramId:t,marketId:e.ownAddress,marketAuthority:Wc.getAssociatedAuthority({programId:t,marketId:e.ownAddress}).publicKey,marketBaseVault:e.baseVault,marketQuoteVault:e.quoteVault,marketBids:e.bids,marketAsks:e.asks,marketEventQueue:e.eventQueue,...5===u.version?{modelDataAccount:u.modelDataAccount,withdrawQueue:re.default,lpVault:re.default}:{withdrawQueue:u.withdrawQueue,lpVault:u.lpVault},lookupTableAccount:re.default})}return a}static async fetchInfo({connection:e,poolKeys:t}){const n=await this.fetchMultipleInfo({connection:e,pools:[t]});return $c.assertArgument(1===n.length,`fetchInfo failed, ${n.length} pools found`,"poolKeys.id",t.id),n[0]}static async fetchMultipleInfo({connection:e,pools:t,config:n}){await Jc(e);const r=t.map((e=>this.makeSimulatePoolInfoInstruction({poolKeys:e}))),o=(await tr(e,r.map((e=>e.innerTransaction.instructions)).flat(),"GetPoolData")).map((e=>{const t=function(e,t){const n=e.match(/{["\w:,]+}/g);return n&&1===n.length?n[0]:$n.throwArgumentError("simulate log fail to match json","keyword",t)}(e,"GetPoolData"),n=new Re(nr(t,"status")),r=Number(nr(t,"coin_decimals")),o=Number(nr(t,"pc_decimals")),i=Number(nr(t,"lp_decimals")),s=new Re(nr(t,"pool_coin_amount")),a=new Re(nr(t,"pool_pc_amount")),c=new Re(nr(t,"pool_lp_supply"));let u="0";try{u=nr(t,"pool_open_time")}catch(l){}return{status:n,baseDecimals:r,quoteDecimals:o,lpDecimals:i,baseReserve:s,quoteReserve:a,lpSupply:c,startTime:new Re(u)}}));return o}static getEnabledFeatures(e){const{status:t}=e,n=t.toNumber();if(n===eu.Uninitialized)return{swap:!1,addLiquidity:!1,removeLiquidity:!1};if(n===eu.Initialized)return{swap:!0,addLiquidity:!0,removeLiquidity:!0};if(n===eu.Disabled)return{swap:!1,addLiquidity:!1,removeLiquidity:!1};if(n===eu.RemoveLiquidityOnly)return{swap:!1,addLiquidity:!1,removeLiquidity:!0};if(n===eu.LiquidityOnly)return{swap:!1,addLiquidity:!0,removeLiquidity:!0};if(n===eu.OrderBook)return{swap:!1,addLiquidity:!0,removeLiquidity:!0};if(n===eu.Swap)return{swap:!0,addLiquidity:!0,removeLiquidity:!0};if(n===eu.WaitingForStart){const{startTime:t}=e;return Date.now()/1e3<t.toNumber()?{swap:!1,addLiquidity:!0,removeLiquidity:!0}:{swap:!0,addLiquidity:!0,removeLiquidity:!0}}return{swap:!1,addLiquidity:!1,removeLiquidity:!1}}static includesToken(e,t){const{baseMint:n,quoteMint:r}=t;return e.mint.equals(n)||e.mint.equals(r)}static _getTokenSide(e,t){const{baseMint:n,quoteMint:r}=t;return e.mint.equals(n)?"base":e.mint.equals(r)?"quote":$c.throwArgumentError("token not match with pool","params",{token:e.mint,baseMint:n,quoteMint:r})}static _getTokensSide(e,t,n){const{baseMint:r,quoteMint:o}=n,i=this._getTokenSide(e,n),s=this._getTokenSide(t,n);return $c.assertArgument(i!==s,"tokens not match with pool","params",{tokenA:e.mint,tokenB:t.mint,baseMint:r,quoteMint:o}),[i,s]}static _getAmountSide(e,t){const n=e instanceof mo?e.token:br.WSOL;return this._getTokenSide(n,t)}static _getAmountsSide(e,t,n){const r=e instanceof mo?e.token:br.WSOL,o=t instanceof mo?t.token:br.WSOL;return this._getTokensSide(r,o,n)}static computeAnotherAmount({poolKeys:e,poolInfo:t,amount:n,anotherCurrency:r,slippage:o}){const{baseReserve:i,quoteReserve:s}=t;$c.debug("baseReserve:",i.toString()),$c.debug("quoteReserve:",s.toString());const a=n instanceof mo?n.token:n.currency;$c.debug("currencyIn:",a),$c.debug("amount:",n.toFixed()),$c.debug("anotherCurrency:",r),$c.debug("slippage:",`${o.toSignificant()}%`);const c=this._getAmountSide(n,e);$c.debug("input side:",c);let u=ar;n.isZero()||(u="base"===c?gr(n.raw.mul(s),i):gr(n.raw.mul(i),s));const l=gr(n.raw.mul(t.lpSupply),"base"===c?t.baseReserve:t.quoteReserve),d=new fo(cr).add(o).mul(u).quotient,m=r instanceof br?new mo(r,u):new lo(r,u),p=r instanceof br?new mo(r,d):new lo(r,d);return $c.debug("anotheAmount:",m.toFixed()),$c.debug("maxAnotheAmount:",p.toFixed()),{anotherAmount:m,maxAnotherAmount:p,liquidity:l}}static _computePriceImpact(e,t,n){const r=e.raw.mul(t),o=r.sub(n).div(r);return new fo(o.numerator,o.denominator)}static getRate(e){const{baseReserve:t,quoteReserve:n,baseDecimals:r,quoteDecimals:o}=e;return new wo(new Ir(r),t,new Ir(o),n)}static computeAmountIn({poolKeys:e,poolInfo:t,amountOut:n,currencyIn:r,slippage:o}){const{baseReserve:i,quoteReserve:s}=t;$c.debug("baseReserve:",i.toString()),$c.debug("quoteReserve:",s.toString());const a=n instanceof mo?n.token:n.currency;$c.debug("currencyOut:",a),$c.debug("amountOut:",n.toFixed()),$c.debug("currencyIn:",r),$c.debug("slippage:",`${o.toSignificant()}%`);const c=[i,s],u=this._getAmountSide(n,e);"base"===u&&c.reverse(),$c.debug("output side:",u);const[l,d]=c,m=new wo(r,l,a,d);$c.debug("currentPrice:",`1 ${r.symbol}  ${m.toFixed()} ${a.symbol}`),$c.debug("currentPrice invert:",`1 ${a.symbol}  ${m.invert().toFixed()} ${r.symbol}`);let p=ar,f=n.raw;if(!f.isZero()){f.gt(d)&&(f=d.sub(cr));const e=d.sub(f);p=l.mul(f).div(e).mul(nu).div(nu.sub(tu))}const g=new fo(cr).add(o).mul(p).quotient,w=r instanceof br?new mo(r,p):new lo(r,p),h=r instanceof br?new mo(r,g):new lo(r,g);$c.debug("amountIn:",w.toFixed()),$c.debug("maxAmountIn:",h.toFixed());let k=null;p.isZero()||f.isZero()||(k=new wo(r,p,a,f),$c.debug("executionPrice:",`1 ${r.symbol}  ${k.toFixed()} ${a.symbol}`),$c.debug("executionPrice invert:",`1 ${a.symbol}  ${k.invert().toFixed()} ${r.symbol}`));const y=this._computePriceImpact(m,p,f);return $c.debug("priceImpact:",`${y.toSignificant()}%`),{amountIn:w,maxAmountIn:h,currentPrice:m,executionPrice:k,priceImpact:y}}}var ou;e("L",ru),Zc=ru,ru.computeAmountOut=({poolKeys:e,poolInfo:t,amountIn:n,currencyOut:r,slippage:o})=>{const i=n instanceof mo?n.token:br.WSOL,s=r instanceof br?r:br.WSOL;$c.assertArgument(Zc.includesToken(i,e)&&Zc.includesToken(s,e),"token not match with pool","poolKeys",{poolKeys:e,tokenIn:i,tokenOut:s});const{baseReserve:a,quoteReserve:c}=t;$c.debug("baseReserve:",a.toString()),$c.debug("quoteReserve:",c.toString());const u=n instanceof mo?n.token:n.currency;$c.debug("currencyIn:",u),$c.debug("amountIn:",n.toFixed()),$c.debug("currencyOut:",r),$c.debug("slippage:",`${o.toSignificant()}%`);const l=[a,c],d=Zc._getAmountSide(n,e);"quote"===d&&l.reverse(),$c.debug("input side:",d);const[m,p]=l;let f;if(4===e.version)f=new wo(u,m,r,p);else{const e=Qc(Yc,a.toNumber(),c.toNumber(),!1);f="quote"===d?new wo(u,new Re(1e6*e),r,new Re(1e6)):new wo(u,new Re(1e6),r,new Re(1e6*e))}$c.debug("currentPrice:",`1 ${u.symbol}  ${f.toFixed()} ${r.symbol}`),$c.debug("currentPrice invert:",`1 ${r.symbol}  ${f.invert().toFixed()} ${u.symbol}`);const g=n.raw;let w=ar,h=ar;if(!g.isZero())if(4===e.version){h=ni(g.mul(tu),nu);const e=g.sub(h),t=m.add(e);w=p.mul(e).div(t)}else{h=g.mul(new Re(2)).div(new Re(1e4));const e=g.sub(h);w=new Re("quote"===d?function(e,t,n,r){const o=zc(e,t,n),i=Xc(e,t,o),s=Xc(e,n,o),a=Xc(e,r,o),[c,u,l,d]=jc(e,i,a,!0);return d?l?r*e.multiplier/c:Gc(e,s-u,o):0}(Yc,c.toNumber(),a.toNumber(),e.toNumber()):function(e,t,n,r){const o=zc(e,t,n),i=Xc(e,t,o),s=Xc(e,n,o),a=Xc(e,r,o),[c,u,l,d]=Hc(e,s,a,!1);return d?l?r*c/e.multiplier:Gc(e,i-u,o):0}(Yc,c.toNumber(),a.toNumber(),e.toNumber()))}const k=new fo(cr).add(o).invert().mul(w).quotient,y=r instanceof br?new mo(r,w):new lo(r,w),A=r instanceof br?new mo(r,k):new lo(r,k);$c.debug("amountOut:",y.toFixed()),$c.debug("minAmountOut:",A.toFixed());let I=new wo(u,g.sub(h),r,w);g.isZero()||w.isZero()||(I=new wo(u,g.sub(h),r,w),$c.debug("executionPrice:",`1 ${u.symbol}  ${I.toFixed()} ${r.symbol}`),$c.debug("executionPrice invert:",`1 ${r.symbol}  ${I.invert().toFixed()} ${u.symbol}`));const b=I.denominator.mul(f.numerator),T=I.numerator.mul(f.denominator).sub(b).abs(),v=new fo(T,b);return $c.debug("priceImpact:",`${v.toSignificant()}%`),{amountOut:y,minAmountOut:A,currentPrice:f,executionPrice:I,priceImpact:v,fee:u instanceof br?new mo(u,h):new lo(u,h)}},new re("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),new re("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),new re("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),new re("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),new re("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),new re("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),new re("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),new re("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),new re("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),new re("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),re.default,new re("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),re.default,new re("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),new re("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),new re("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),new re("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),new re("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),new re("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),new re("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),Do([So(5),function(e="accountFlags"){const t=new Bo(e);return t.addBoolean("initialized"),t.addBoolean("market"),t.addBoolean("openOrders"),t.addBoolean("requestQueue"),t.addBoolean("eventQueue"),t.addBoolean("bids"),t.addBoolean("asks"),t}("accountFlags"),No("ownAddress"),Po("vaultSignerNonce"),No("baseMint"),No("quoteMint"),No("baseVault"),Po("baseDepositsTotal"),Po("baseFeesAccrued"),No("quoteVault"),Po("quoteDepositsTotal"),Po("quoteFeesAccrued"),Po("quoteDustThreshold"),No("requestQueue"),No("eventQueue"),No("bids"),No("asks"),Po("baseLotSize"),Po("quoteLotSize"),Po("feeRateBps"),Po("referrerRebatesAccrued"),So(7)]);class iu extends Ho{static getPdaPoolId(e,t){return jn([this.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,r){return jn([this.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),ee.from(new Re(r).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:r,chainTime:o}){if(0===n.length)return[];const i=n.map((e=>this.getPdaPoolId(t,e).publicKey)),s=[];for(let u=0;u<this.VERSION_PROJECT.length;u++)s.push(...i.map((e=>this.getPdaOwnerId(t,e,r,u).publicKey)));const a=await Yn(e,[...i,...s]),c=[];for(let u=0;u<a.length;u++){const e=Math.floor(u/n.length),r=u%n.length,l=i[r],d=s[u],m=a[r],p=a[n.length+u];if(!m||!p)continue;if(m.data.length!==this.POOL_LAYOUT.span||p.data.length!==this.OWNER_LAYOUT.span)continue;const f=this.POOL_LAYOUT.decode(m.data),g=this.OWNER_LAYOUT.decode(p.data),w=f.openTime.toNumber(),h=f.endTime.toNumber(),k=3!==g.tokenInfo.map((e=>e.debtAmount.gt(new Re(0)))).filter((e=>!e)).length,y=o>w&&o<h&&1===f.status,A=k&&y;c.push({programId:t,poolId:l,ammId:f.ammId,ownerAccountId:d,snapshotLpAmount:g.lpAmount,project:this.VERSION_PROJECT[e],openTime:w,endTime:h,canClaim:A,canClaimErrorType:k?y?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:f.tokenInfo.map(((e,t)=>({programId:se,mintAddress:e.mintAddress,mintVault:e.mintVault,mintDecimals:e.mintDecimals,perLpLoss:e.perLpLoss,debtAmount:g.tokenInfo[t].debtAmount.add(g.tokenInfo[t].claimedAmount)})))})}return c}static async makeClaimInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,makeTxVersion:r,lookupTableCache:o}){const i=[],s=[],a=[],c=[],u=[],l=[],d=[],m=[];for(const p of t.tokenInfo)m.push(await this._selectOrCreateTokenAccount({programId:p.programId,mint:p.mintAddress,tokenAccounts:p.mintAddress.equals(br.WSOL.mint)?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.wallet,amount:0,frontInstructions:i,endInstructions:p.mintAddress.equals(br.WSOL.mint)?a:[],frontInstructionsType:s,endInstructionsType:c,signers:d},associatedOnly:!p.mintAddress.equals(br.WSOL.mint)&&n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner}));return u.push(this.makeClaimInstruction({programId:t.programId,poolInfo:t,ownerInfo:{wallet:n.wallet,ownerPda:t.ownerAccountId,claimAddress:m}})),l.push(jo.util1216OwnerClaim),{address:{},innerTransactions:await rr({connection:e,makeTxVersion:r,computeBudgetConfig:void 0,payer:n.wallet,innerTransaction:[{instructionTypes:s,instructions:i,signers:d},{instructionTypes:l,instructions:u,signers:[]},{instructionTypes:c,instructions:a,signers:[]}],lookupTableCache:o})}}static async makeClaimAllInstructionSimple({connection:e,poolInfos:t,ownerInfo:n,makeTxVersion:r,lookupTableCache:o}){const i=[],s=[],a=[],c=[],u=[],l=[],d=[],m={};for(const p of t){const t=[];for(const r of p.tokenInfo){const o=m[r.mintAddress.toString()]??await this._selectOrCreateTokenAccount({programId:r.programId,mint:r.mintAddress,tokenAccounts:r.mintAddress.equals(br.WSOL.mint)?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.wallet,amount:0,frontInstructions:i,endInstructions:r.mintAddress.equals(br.WSOL.mint)?a:[],frontInstructionsType:s,endInstructionsType:c,signers:d},associatedOnly:!r.mintAddress.equals(br.WSOL.mint)&&n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});m[r.mintAddress.toString()]=o,t.push(o)}u.push(this.makeClaimInstruction({programId:p.programId,poolInfo:p,ownerInfo:{wallet:n.wallet,ownerPda:p.ownerAccountId,claimAddress:t}})),l.push(jo.util1216OwnerClaim)}return{address:{},innerTransactions:await rr({connection:e,makeTxVersion:r,computeBudgetConfig:void 0,payer:n.wallet,innerTransaction:[{instructionTypes:s,instructions:i,signers:d},{instructionTypes:l,instructions:u,signers:[]},{instructionTypes:c,instructions:a,signers:[]}],lookupTableCache:o})}}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){const r=Do([]),o=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map((e=>({pubkey:e,isSigner:!1,isWritable:!0}))),...t.tokenInfo.map((({mintVault:e})=>({pubkey:e,isSigner:!1,isWritable:!0}))),{pubkey:se,isSigner:!1,isWritable:!1}],i=ee.alloc(r.span);r.encode({},i);const s=ee.from([10,66,208,184,161,6,191,98,...i]);return new ie({keys:o,programId:e,data:s})}}ou=iu,iu.CLAIMED_NUM=3,iu.POOL_LAYOUT=Do([So(8),Co("bump"),Co("status"),Po("openTime"),Po("endTime"),No("ammId"),_o(Do([Co("mintDecimals"),No("mintAddress"),No("mintVault"),Po("perLpLoss"),Po("totalClaimedAmount")]),ou.CLAIMED_NUM,"tokenInfo"),_o(Po(),10,"padding")]),iu.OWNER_LAYOUT=Do([So(8),Co("bump"),Co("version"),No("poolId"),No("owner"),Po("lpAmount"),_o(Do([No("mintAddress"),Po("debtAmount"),Po("claimedAmount")]),ou.CLAIMED_NUM,"tokenInfo"),_o(Po(),4,"padding")]),iu.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map((e=>new re(e))),iu.SEED_CONFIG={pool:{id:ee.from("pool_seed","utf8")},owner:{id:ee.from("user_claim_seed","utf8")}},iu.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];const su=e("m",Go.V0),au=Zo;new Ir(9,"SOL","SOL"),new br(se,new re("So11111111111111111111111111111111111111112"),9,"WSOL","WSOL"),new br(se,new re("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),6,"USDC","USDC"),new br(se,new re("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),6,"USDT","USDT"),new br(se,new re("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),6,"RAY","RAY"),new br(se,new re("FGYXP4vBkMEtKhxrmEBcWN8VNmXX8qNgEJpENKDETZ4Y"),6,"RAY-USDC","RAY-USDC")}}}));
