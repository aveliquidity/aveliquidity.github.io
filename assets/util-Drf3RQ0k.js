import{v as Pt,o as ba,A as xr,b9 as hs,ba as _r,m as ae,j as xn,d as dn,k as Ta,t as Dt,n as _n,p as Nt,bb as ya,bc as Sa,x as Ia,c as wi,l as ks,T as Jn,bd as bs,be as va,aD as Ts,bf as ys,E as Kr,D as Ss,bg as Jr,aK as Nr,bh as Ba,bi as Oa,s as Ea,bj as La,bk as Is,bl as Ra,bm as Pa,bn as Ai,bo as xa,bp as _a,bq as Na,br as Ma,bs as Ca,bt as qa,bu as Fa,bv as hi,bw as Wa,bx as Va,w as vs,G as Bs,H as Da,z as ki,C as Ua,by as Ga,bz as ei,bA as za,bB as N,bC as Xa,bD as Xe,aN as P,bE as at,bF as ne,aM as _,bG as cn,bH as Os,bI as Et,bJ as mn,bK as Ht,I as $a,b as Fn,L as Wn,N as $e,X as bi,f as Vn,O as Dn,M as rn,Q as Tr,R as Ya,S as Ha,aI as Ti,aF as Qa,b1 as Za,P as ja,bL as Ka,_ as Ja,$ as eo,a0 as to,bM as Mr,bN as yi,bO as er,bP as Es,bQ as tr,bR as nr,bS as B,a8 as no,bT as ro,bU as io,bV as so,bW as ao,bX as oo,bY as co,bZ as uo,b_ as lo,b$ as Un,c0 as mt,aL as Qn,u as mo}from"./index-CJdFXsl4.js";const fo=(r,e)=>{const t=Pt(),n=()=>{t.value=_r(r).height};return ba(()=>{if(xr(n),e)for(let i=1;i<=3;i++)setTimeout(n,100*i)}),hs(()=>xr(n)),t};function po(r,e){const t=fo(r,!0);return n=>ae("div",{class:e("placeholder"),style:{height:t.value?"".concat(t.value,"px"):void 0}},[n()])}const[Ls,Si]=xn("action-bar"),Rs=Symbol(Ls),go={placeholder:Boolean,safeAreaInsetBottom:Dt};var wo=dn({name:Ls,props:go,setup(r,{slots:e}){const t=Pt(),n=po(t,Si),{linkChildren:i}=Ta(Rs);i();const s=()=>{var a;return ae("div",{ref:t,class:[Si(),{"van-safe-area-bottom":r.safeAreaInsetBottom}]},[(a=e.default)==null?void 0:a.call(e)])};return()=>r.placeholder?n(s):s()}});const Ao=_n(wo),[ho,ko]=xn("action-bar-button"),bo=Nt({},ya,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var To=dn({name:ho,props:bo,setup(r,{slots:e}){const t=Sa(),{parent:n,index:i}=Ia(Rs),s=wi(()=>{if(n){const o=n.children[i.value-1];return!(o&&"isButton"in o)}}),a=wi(()=>{if(n){const o=n.children[i.value+1];return!(o&&"isButton"in o)}});return ks({isButton:!0}),()=>{const{type:o,icon:u,text:c,color:l,loading:d,disabled:m}=r;return ae(Jn,{class:ko([o,{last:a.value,first:s.value}]),size:"large",type:o,icon:u,color:l,loading:d,disabled:m,onClick:t},{default:()=>[e.default?e.default():c]})}}});const Ii=_n(To),[yo,Ke]=xn("action-sheet"),So=Nt({},bs,{title:String,round:Dt,actions:va(),closeIcon:Ts("cross"),closeable:Dt,cancelText:String,description:String,closeOnPopstate:Dt,closeOnClickAction:Boolean,safeAreaInsetBottom:Dt}),Io=[...ys,"round","closeOnPopstate","safeAreaInsetBottom"];var vo=dn({name:yo,props:So,emits:["select","cancel","update:show"],setup(r,{slots:e,emit:t}){const n=l=>t("update:show",l),i=()=>{n(!1),t("cancel")},s=()=>{if(r.title)return ae("div",{class:Ke("header")},[r.title,r.closeable&&ae(Nr,{name:r.closeIcon,class:[Ke("close"),Ba],onClick:i},null)])},a=()=>{if(e.cancel||r.cancelText)return[ae("div",{class:Ke("gap")},null),ae("button",{type:"button",class:Ke("cancel"),onClick:i},[e.cancel?e.cancel():r.cancelText])]},o=(l,d)=>l.loading?ae(Oa,{class:Ke("loading-icon")},null):e.action?e.action({action:l,index:d}):[ae("span",{class:Ke("name")},[l.name]),l.subname&&ae("div",{class:Ke("subname")},[l.subname])],u=(l,d)=>{const{color:m,loading:f,callback:w,disabled:g,className:h}=l,p=()=>{g||f||(w&&w(l),r.closeOnClickAction&&n(!1),xr(()=>t("select",l,d)))};return ae("button",{type:"button",style:{color:m},class:[Ke("item",{loading:f,disabled:g}),h],onClick:p},[o(l,d)])},c=()=>{if(r.description||e.description){const l=e.description?e.description():r.description;return ae("div",{class:Ke("description")},[l])}};return()=>ae(Jr,Kr({class:Ke(),position:"bottom","onUpdate:show":n},Ss(r,Io)),{default:()=>{var l;return[s(),c(),ae("div",{class:Ke("content")},[r.actions.map(u),(l=e.default)==null?void 0:l.call(e)]),a()]}})}});const Ad=_n(vo),[Bo,Je,Gn]=xn("dialog"),Oo=Nt({},bs,{title:String,theme:String,width:Ea,message:[String,Function],callback:Function,allowHtml:Boolean,className:La,transition:Ts("van-dialog-bounce"),messageAlign:String,closeOnPopstate:Dt,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:Dt,closeOnClickOverlay:Boolean}),Eo=[...ys,"transition","closeOnPopstate"];var Ps=dn({name:Bo,props:Oo,emits:["confirm","cancel","keydown","update:show"],setup(r,{emit:e,slots:t}){const n=Pt(),i=Is({confirm:!1,cancel:!1}),s=p=>e("update:show",p),a=p=>{var A;s(!1),(A=r.callback)==null||A.call(r,p)},o=p=>()=>{r.show&&(e(p),r.beforeClose?(i[p]=!0,Ma(r.beforeClose,{args:[p],done(){a(p),i[p]=!1},canceled(){i[p]=!1}})):a(p))},u=o("cancel"),c=o("confirm"),l=Pa(p=>{var A,k;if(p.target!==((k=(A=n.value)==null?void 0:A.popupRef)==null?void 0:k.value))return;({Enter:r.showConfirmButton?c:Ai,Escape:r.showCancelButton?u:Ai})[p.key](),e("keydown",p)},["enter","esc"]),d=()=>{const p=t.title?t.title():r.title;if(p)return ae("div",{class:Je("header",{isolated:!r.message&&!t.default})},[p])},m=p=>{const{message:A,allowHtml:k,messageAlign:S}=r,T=Je("message",{"has-title":p,[S]:S}),y=xa(A)?A():A;return k&&typeof y=="string"?ae("div",{class:T,innerHTML:y},null):ae("div",{class:T},[y])},f=()=>{if(t.default)return ae("div",{class:Je("content")},[t.default()]);const{title:p,message:A,allowHtml:k}=r;if(A){const S=!!(p||t.title);return ae("div",{key:k?1:0,class:Je("content",{isolated:!S})},[m(S)])}},w=()=>ae("div",{class:[Na,Je("footer")]},[r.showCancelButton&&ae(Jn,{size:"large",text:r.cancelButtonText||Gn("cancel"),class:Je("cancel"),style:{color:r.cancelButtonColor},loading:i.cancel,disabled:r.cancelButtonDisabled,onClick:u},null),r.showConfirmButton&&ae(Jn,{size:"large",text:r.confirmButtonText||Gn("confirm"),class:[Je("confirm"),{[_a]:r.showCancelButton}],style:{color:r.confirmButtonColor},loading:i.confirm,disabled:r.confirmButtonDisabled,onClick:c},null)]),g=()=>ae(Ao,{class:Je("footer")},{default:()=>[r.showCancelButton&&ae(Ii,{type:"warning",text:r.cancelButtonText||Gn("cancel"),class:Je("cancel"),color:r.cancelButtonColor,loading:i.cancel,disabled:r.cancelButtonDisabled,onClick:u},null),r.showConfirmButton&&ae(Ii,{type:"danger",text:r.confirmButtonText||Gn("confirm"),class:Je("confirm"),color:r.confirmButtonColor,loading:i.confirm,disabled:r.confirmButtonDisabled,onClick:c},null)]}),h=()=>t.footer?t.footer():r.theme==="round-button"?g():w();return()=>{const{width:p,title:A,theme:k,message:S,className:T}=r;return ae(Jr,Kr({ref:n,role:"dialog",class:[Je([k]),T],style:{width:Ra(p)},tabindex:0,"aria-labelledby":A||S,onKeydown:l,"onUpdate:show":s},Ss(r,Eo)),{default:()=>[d(),f(),h()]})}}});let On;function Lo(){({instance:On}=qa({setup(){const{state:e,toggle:t}=Fa();return()=>ae(Ps,Kr(e,{"onUpdate:show":t}),null)}}))}function Pe(r){return Ca?new Promise((e,t)=>{On||Lo(),On.open(Nt({},Pe.currentOptions,r,{callback:n=>{(n==="confirm"?e:t)(n)}}))}):Promise.resolve()}Pe.defaultOptions={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};Pe.currentOptions=Nt({},Pe.defaultOptions);Pe.alert=Pe;Pe.confirm=r=>Pe(Nt({showCancelButton:!0},r));Pe.close=()=>{On&&On.toggle(!1)};Pe.setDefaultOptions=r=>{Nt(Pe.currentOptions,r)};Pe.resetDefaultOptions=()=>{Pe.currentOptions=Nt({},Pe.defaultOptions)};Pe.Component=_n(Ps);Pe.install=r=>{r.use(Pe.Component),r.config.globalProperties.$dialog=Pe};const[Ro,wn]=xn("notice-bar"),Po={text:String,mode:String,color:String,delay:hi(1),speed:hi(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var xo=dn({name:Ro,props:Po,emits:["close","replay"],setup(r,{emit:e,slots:t}){let n=0,i=0,s;const a=Pt(),o=Pt(),u=Is({show:!0,offset:0,duration:0}),c=()=>{if(t["left-icon"])return t["left-icon"]();if(r.leftIcon)return ae(Nr,{class:wn("left-icon"),name:r.leftIcon},null)},l=()=>{if(r.mode==="closeable")return"cross";if(r.mode==="link")return"arrow"},d=h=>{r.mode==="closeable"&&(u.show=!1,e("close",h))},m=()=>{if(t["right-icon"])return t["right-icon"]();const h=l();if(h)return ae(Nr,{name:h,class:wn("right-icon"),onClick:d},null)},f=()=>{u.offset=n,u.duration=0,Ua(()=>{ki(()=>{u.offset=-i,u.duration=(i+n)/+r.speed,e("replay")})})},w=()=>{const h=r.scrollable===!1&&!r.wrapable,p={transform:u.offset?"translateX(".concat(u.offset,"px)"):"",transitionDuration:"".concat(u.duration,"s")};return ae("div",{ref:a,role:"marquee",class:wn("wrap")},[ae("div",{ref:o,style:p,class:[wn("content"),{"van-ellipsis":h}],onTransitionend:f},[t.default?t.default():r.text])])},g=()=>{const{delay:h,speed:p,scrollable:A}=r,k=Ga(h)?+h*1e3:0;n=0,i=0,u.offset=0,u.duration=0,clearTimeout(s),s=setTimeout(()=>{if(!a.value||!o.value||A===!1)return;const S=_r(a).width,T=_r(o).width;(A||T>S)&&ki(()=>{n=S,i=T,u.offset=-i,u.duration=i/+p})},k)};return hs(g),Wa(g),Va("pageshow",g),ks({reset:g}),vs(()=>[r.text,r.scrollable],g),()=>{const{color:h,wrapable:p,background:A}=r;return Bs(ae("div",{role:"alert",class:wn({wrapable:p}),style:{color:h,background:A}},[c(),w(),m()]),[[Da,u.show]])}}});const hd=_n(xo),ti=r=>{const e=r.decode.bind(r),t=r.encode.bind(r);return{decode:e,encode:t}},_o=r=>e=>{const t=ei(r,e),{encode:n,decode:i}=ti(t),s=t;return s.decode=(a,o)=>{const u=i(a,o);return za(N.from(u))},s.encode=(a,o,u)=>{const c=Xa(a,r);return n(c,o,u)},s},lt=_o(8),xs=r=>{const e=Xe(r),{encode:t,decode:n}=ti(e),i=e;return i.decode=(s,a)=>!!n(s,a),i.encode=(s,a,o)=>{const u=Number(s);return t(u,a,o)},i},Ie=r=>{const e=ei(32,r),{encode:t,decode:n}=ti(e),i=e;return i.decode=(s,a)=>{const o=n(s,a);return new P(o)},i.encode=(s,a,o)=>{const u=s.toBuffer();return t(u,a,o)},i};class gr extends Error{constructor(e){super(e)}}class No extends gr{constructor(){super(...arguments),this.name="TokenAccountNotFoundError"}}class Mo extends gr{constructor(){super(...arguments),this.name="TokenInvalidAccountOwnerError"}}class yr extends gr{constructor(){super(...arguments),this.name="TokenInvalidAccountSizeError"}}class Co extends gr{constructor(){super(...arguments),this.name="TokenInvalidMintError"}}var Qt;(function(r){r[r.InitializeMint=0]="InitializeMint",r[r.InitializeAccount=1]="InitializeAccount",r[r.InitializeMultisig=2]="InitializeMultisig",r[r.Transfer=3]="Transfer",r[r.Approve=4]="Approve",r[r.Revoke=5]="Revoke",r[r.SetAuthority=6]="SetAuthority",r[r.MintTo=7]="MintTo",r[r.Burn=8]="Burn",r[r.CloseAccount=9]="CloseAccount",r[r.FreezeAccount=10]="FreezeAccount",r[r.ThawAccount=11]="ThawAccount",r[r.TransferChecked=12]="TransferChecked",r[r.ApproveChecked=13]="ApproveChecked",r[r.MintToChecked=14]="MintToChecked",r[r.BurnChecked=15]="BurnChecked",r[r.InitializeAccount2=16]="InitializeAccount2",r[r.SyncNative=17]="SyncNative",r[r.InitializeAccount3=18]="InitializeAccount3",r[r.InitializeMultisig2=19]="InitializeMultisig2",r[r.InitializeMint2=20]="InitializeMint2",r[r.GetAccountDataSize=21]="GetAccountDataSize",r[r.InitializeImmutableOwner=22]="InitializeImmutableOwner",r[r.AmountToUiAmount=23]="AmountToUiAmount",r[r.UiAmountToAmount=24]="UiAmountToAmount",r[r.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",r[r.TransferFeeExtension=26]="TransferFeeExtension",r[r.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",r[r.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",r[r.Reallocate=29]="Reallocate",r[r.MemoTransferExtension=30]="MemoTransferExtension",r[r.CreateNativeMint=31]="CreateNativeMint",r[r.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",r[r.InterestBearingMintExtension=33]="InterestBearingMintExtension",r[r.CpiGuardExtension=34]="CpiGuardExtension",r[r.InitializePermanentDelegate=35]="InitializePermanentDelegate",r[r.TransferHookExtension=36]="TransferHookExtension",r[r.MetadataPointerExtension=39]="MetadataPointerExtension"})(Qt||(Qt={}));function ni(r,e,t){if(t.length){r.push({pubkey:e,isSigner:!1,isWritable:!1});for(const n of t)r.push({pubkey:n instanceof P?n:n.publicKey,isSigner:!0,isWritable:!1})}else r.push({pubkey:e,isSigner:!0,isWritable:!1});return r}const vi=at([Xe("instruction")]);function qo(r,e,t,n=[],i=_){const s=ni([{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!0}],t,n),a=N.alloc(vi.span);return vi.encode({instruction:Qt.CloseAccount},a),new ne({keys:s,programId:i,data:a})}var Cr;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Mint=1]="Mint",r[r.Account=2]="Account"})(Cr||(Cr={}));const Fo=1,Wo=at([Xe("m"),Xe("n"),xs("isInitialized"),Ie("signer1"),Ie("signer2"),Ie("signer3"),Ie("signer4"),Ie("signer5"),Ie("signer6"),Ie("signer7"),Ie("signer8"),Ie("signer9"),Ie("signer10"),Ie("signer11")]),Vo=Wo.span;var Bi;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Initialized=1]="Initialized",r[r.Frozen=2]="Frozen"})(Bi||(Bi={}));const Ft=at([Ie("mint"),Ie("owner"),lt("amount"),cn("delegateOption"),Ie("delegate"),Xe("state"),cn("isNativeOption"),lt("isNative"),lt("delegatedAmount"),cn("closeAuthorityOption"),Ie("closeAuthority")]),Sr=Ft.span,_s=at([cn("mintAuthorityOption"),Ie("mintAuthority"),lt("supply"),Xe("decimals"),xs("isInitialized"),cn("freezeAuthorityOption"),Ie("freezeAuthority")]),Ir=_s.span;function Do(r,e,t=_){if(!e)throw new No;if(!e.owner.equals(t))throw new Mo;if(e.data.length<Ir)throw new yr;const n=_s.decode(e.data.slice(0,Ir));let i=N.alloc(0);if(e.data.length>Ir){if(e.data.length<=Sr)throw new yr;if(e.data.length===Vo)throw new yr;if(e.data[Sr]!=Cr.Mint)throw new Co;i=e.data.slice(Sr+Fo)}return{address:r,mintAuthority:n.mintAuthorityOption?n.mintAuthority:null,supply:n.supply,decimals:n.decimals,isInitialized:n.isInitialized,freezeAuthority:n.freezeAuthorityOption?n.freezeAuthority:null,tlvData:i}}const Uo=1e4;BigInt(Uo);function Oi(r){return at([lt("epoch"),lt("maximumFee"),Os("transferFeeBasisPoints")],r)}const Ns=at([Ie("transferFeeConfigAuthority"),Ie("withdrawWithheldAuthority"),lt("withheldAmount"),Oi("olderTransferFee"),Oi("newerTransferFee")]);Ns.span;const Go=at([lt("withheldAmount")]);Go.span;function zo(r){const e=$o(qr.TransferFeeConfig,r.tlvData);return e!==null?Ns.decode(e):null}var qr;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.TransferFeeConfig=1]="TransferFeeConfig",r[r.TransferFeeAmount=2]="TransferFeeAmount",r[r.MintCloseAuthority=3]="MintCloseAuthority",r[r.ConfidentialTransferMint=4]="ConfidentialTransferMint",r[r.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",r[r.DefaultAccountState=6]="DefaultAccountState",r[r.ImmutableOwner=7]="ImmutableOwner",r[r.MemoTransfer=8]="MemoTransfer",r[r.NonTransferable=9]="NonTransferable",r[r.InterestBearingConfig=10]="InterestBearingConfig",r[r.CpiGuard=11]="CpiGuard",r[r.PermanentDelegate=12]="PermanentDelegate",r[r.NonTransferableAccount=13]="NonTransferableAccount",r[r.TransferHook=14]="TransferHook",r[r.TransferHookAccount=15]="TransferHookAccount",r[r.MetadataPointer=18]="MetadataPointer",r[r.TokenMetadata=19]="TokenMetadata"})(qr||(qr={}));const Ms=2,Xo=2;function Ei(r){return r+Ms+Xo}function $o(r,e){let t=0;for(;Ei(t)<=e.length;){const n=e.readUInt16LE(t),i=e.readUInt16LE(t+Ms),s=Ei(t);if(n==r)return e.slice(s,s+i);t=s+i}return null}const Li=at([Xe("instruction")]);function Yo(r,e,t,n=_){const i=[{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:Et,isSigner:!1,isWritable:!1}],s=N.alloc(Li.span);return Li.encode({instruction:Qt.InitializeAccount},s),new ne({keys:i,programId:n,data:s})}function Ho(r,e,t,n,i=_,s=mn){return Qo(r,e,t,n,N.alloc(0),i,s)}function Qo(r,e,t,n,i,s=_,a=mn){const o=[{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:Ht.programId,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1}];return new ne({keys:o,programId:a,data:i})}const Ri=at([Xe("instruction"),lt("amount")]);function Zo(r,e,t,n,i=[],s=_){const a=ni([{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!0}],t,i),o=N.alloc(Ri.span);return Ri.encode({instruction:Qt.MintTo,amount:BigInt(n)},o),new ne({keys:a,programId:s,data:o})}const Pi=at([Xe("instruction"),lt("amount")]);function jo(r,e,t,n,i=[],s=_){const a=ni([{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!0}],t,i),o=N.alloc(Pi.span);return Pi.encode({instruction:Qt.Transfer,amount:BigInt(n)},o),new ne({keys:a,programId:s,data:o})}const xi=at([Xe("instruction"),Xe("decimals"),Ie("mintAuthority"),Xe("freezeAuthorityOption"),Ie("freezeAuthority")]);function Ko(r,e,t,n,i=_){const s=[{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:Et,isSigner:!1,isWritable:!1}],a=N.alloc(xi.span);return xi.encode({instruction:Qt.InitializeMint,decimals:e,mintAuthority:t,freezeAuthorityOption:n?1:0,freezeAuthority:n||new P(0)},a),new ne({keys:s,programId:i,data:a})}const Jo=r=>(Ja("data-v-d45994be"),r=r(),eo(),r),ec={class:"popup-title"},tc={class:"slippage-label"},nc=["onClick"],rc={style:{width:"100%"}},ic={class:"radio-group"},sc={key:0,style:{flex:"1"}},ac=["id","value"],oc=["for"],cc={class:"slippage-input"},uc=Jo(()=>$e("span",null,"%",-1)),lc={class:"form-submit"},dc=dn({__name:"slippage",props:{slippage:null},emits:["update:slippage"],setup(r,{emit:e}){const t=r,{t:n}=$a();let i=Pt(!1),s=Pt(["0.1","0.5","1"]),a=Pt(t.slippage||"1");vs(i,d=>{d&&(a.value=t.slippage||"1")});function o(){e("update:slippage",a.value),i.value=!1}function u(){Pe.alert({title:n("slippage"),message:n("slippageTips"),confirmButtonText:n("iKnown"),confirmButtonColor:"#3F80F7",messageAlign:"left"}).then(()=>{})}function c(){i.value&&Number(a.value)<0&&(a.value="0")}function l(d){return Number(d)<=49.99}return(d,m)=>{const f=Qa,w=Jn,g=Za,h=Jr;return Fn(),Wn(Tr,null,[$e("i",{class:"iconfont icon-edit clickable",onClick:m[0]||(m[0]=bi(p=>Ti(i)?i.value=!0:i=!0,["stop"]))}),ae(h,{show:rn(i),"onUpdate:show":m[4]||(m[4]=p=>Ti(i)?i.value=p:i=p),class:"popup-container",closeable:!0,"close-on-click-overlay":!1,"close-on-popstate":!1,round:"",position:"center",teleport:"#app",style:{width:"90%","min-height":"20vh"}},{default:Vn(()=>[$e("h3",ec,Dn(rn(n)("setSlippage")),1),ae(g,{class:"popup-content",onSubmit:o},{default:Vn(()=>[$e("div",tc,[$e("span",null,Dn(rn(n)("slippage")),1),$e("i",{class:"iconfont icon-changjianwentixiangguanwenti",onClick:bi(u,["stop"]),style:{"font-size":"0.38rem","margin-left":"0.05rem",color:"#3F80F7"}},null,8,nc)]),ae(f,{name:"slippage",modelValue:a.value,"onUpdate:modelValue":m[3]||(m[3]=p=>a.value=p),label:"",style:{"--van-cell-horizontal-padding":"0"},rules:[{required:!0,message:rn(n)("enterSlippage")},{validator:l,message:rn(n)("slippageMaxTip")}],border:!1},{input:Vn(()=>[$e("div",rc,[$e("div",ic,[(Fn(!0),Wn(Tr,null,Ya(s.value,(p,A)=>(Fn(),Wn(Tr,{key:A},[A!==0?(Fn(),Wn("span",sc)):ja("",!0),Bs($e("input",{type:"radio",id:"radio-".concat(p),"onUpdate:modelValue":m[1]||(m[1]=k=>a.value=k),value:p,class:"radio-input"},null,8,ac),[[Ka,a.value]]),$e("label",{for:"radio-".concat(p),class:"radio-item"},Dn(p)+"%",9,oc)],64))),128))]),$e("div",cc,[ae(f,{class:"input",name:"slippage",type:"number",min:"0",max:"49.99",modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=p=>a.value=p),onBlur:c,clearable:""},null,8,["modelValue"]),uc])])]),_:1},8,["modelValue","rules"]),$e("div",lc,[ae(w,{class:"btn",block:"",round:"","native-type":"submit",size:"normal",type:"primary"},{default:Vn(()=>[Ha(Dn(rn(n)("confirm1")),1)]),_:1})])]),_:1})]),_:1},8,["show"])],64)}}}),kd=to(dc,[["__scopeId","data-v-d45994be"]]);var mc=20,fc=1,Zt=1e6,_i=1e6,pc=-7,gc=21,wc=!1,Nn="[big.js] ",Kt=Nn+"Invalid ",wr=Kt+"decimal places",Ac=Kt+"rounding mode",Cs=Nn+"Division by zero",me={},dt=void 0,hc=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function qs(){function r(e){var t=this;if(!(t instanceof r))return e===dt?qs():new r(e);if(e instanceof r)t.s=e.s,t.e=e.e,t.c=e.c.slice();else{if(typeof e!="string"){if(r.strict===!0&&typeof e!="bigint")throw TypeError(Kt+"value");e=e===0&&1/e<0?"-0":String(e)}kc(t,e)}t.constructor=r}return r.prototype=me,r.DP=mc,r.RM=fc,r.NE=pc,r.PE=gc,r.strict=wc,r.roundDown=0,r.roundHalfUp=1,r.roundHalfEven=2,r.roundUp=3,r}function kc(r,e){var t,n,i;if(!hc.test(e))throw Error(Kt+"number");for(r.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),i=e.length,n=0;n<i&&e.charAt(n)=="0";)++n;if(n==i)r.c=[r.e=0];else{for(;i>0&&e.charAt(--i)=="0";);for(r.e=t-n-1,r.c=[],t=0;n<=i;)r.c[t++]=+e.charAt(n++)}return r}function Jt(r,e,t,n){var i=r.c;if(t===dt&&(t=r.constructor.RM),t!==0&&t!==1&&t!==2&&t!==3)throw Error(Ac);if(e<1)n=t===3&&(n||!!i[0])||e===0&&(t===1&&i[0]>=5||t===2&&(i[0]>5||i[0]===5&&(n||i[1]!==dt))),i.length=1,n?(r.e=r.e-e+1,i[0]=1):i[0]=r.e=0;else if(e<i.length){if(n=t===1&&i[e]>=5||t===2&&(i[e]>5||i[e]===5&&(n||i[e+1]!==dt||i[e-1]&1))||t===3&&(n||!!i[0]),i.length=e,n){for(;++i[--e]>9;)if(i[e]=0,e===0){++r.e,i.unshift(1);break}}for(e=i.length;!i[--e];)i.pop()}return r}function fn(r,e,t){var n=r.e,i=r.c.join(""),s=i.length;if(e)i=i.charAt(0)+(s>1?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)i="0"+i;i="0."+i}else if(n>0)if(++n>s)for(n-=s;n--;)i+="0";else n<s&&(i=i.slice(0,n)+"."+i.slice(n));else s>1&&(i=i.charAt(0)+"."+i.slice(1));return r.s<0&&t?"-"+i:i}me.abs=function(){var r=new this.constructor(this);return r.s=1,r};me.cmp=function(r){var e,t=this,n=t.c,i=(r=new t.constructor(r)).c,s=t.s,a=r.s,o=t.e,u=r.e;if(!n[0]||!i[0])return n[0]?s:i[0]?-a:0;if(s!=a)return s;if(e=s<0,o!=u)return o>u^e?1:-1;for(a=(o=n.length)<(u=i.length)?o:u,s=-1;++s<a;)if(n[s]!=i[s])return n[s]>i[s]^e?1:-1;return o==u?0:o>u^e?1:-1};me.div=function(r){var e=this,t=e.constructor,n=e.c,i=(r=new t(r)).c,s=e.s==r.s?1:-1,a=t.DP;if(a!==~~a||a<0||a>Zt)throw Error(wr);if(!i[0])throw Error(Cs);if(!n[0])return r.s=s,r.c=[r.e=0],r;var o,u,c,l,d,m=i.slice(),f=o=i.length,w=n.length,g=n.slice(0,o),h=g.length,p=r,A=p.c=[],k=0,S=a+(p.e=e.e-r.e)+1;for(p.s=s,s=S<0?0:S,m.unshift(0);h++<o;)g.push(0);do{for(c=0;c<10;c++){if(o!=(h=g.length))l=o>h?1:-1;else for(d=-1,l=0;++d<o;)if(i[d]!=g[d]){l=i[d]>g[d]?1:-1;break}if(l<0){for(u=h==o?i:m;h;){if(g[--h]<u[h]){for(d=h;d&&!g[--d];)g[d]=9;--g[d],g[h]+=10}g[h]-=u[h]}for(;!g[0];)g.shift()}else break}A[k++]=l?c:++c,g[0]&&l?g[h]=n[f]||0:g=[n[f]]}while((f++<w||g[0]!==dt)&&s--);return!A[0]&&k!=1&&(A.shift(),p.e--,S--),k>S&&Jt(p,S,t.RM,g[0]!==dt),p};me.eq=function(r){return this.cmp(r)===0};me.gt=function(r){return this.cmp(r)>0};me.gte=function(r){return this.cmp(r)>-1};me.lt=function(r){return this.cmp(r)<0};me.lte=function(r){return this.cmp(r)<1};me.minus=me.sub=function(r){var e,t,n,i,s=this,a=s.constructor,o=s.s,u=(r=new a(r)).s;if(o!=u)return r.s=-u,s.plus(r);var c=s.c.slice(),l=s.e,d=r.c,m=r.e;if(!c[0]||!d[0])return d[0]?r.s=-u:c[0]?r=new a(s):r.s=1,r;if(o=l-m){for((i=o<0)?(o=-o,n=c):(m=l,n=d),n.reverse(),u=o;u--;)n.push(0);n.reverse()}else for(t=((i=c.length<d.length)?c:d).length,o=u=0;u<t;u++)if(c[u]!=d[u]){i=c[u]<d[u];break}if(i&&(n=c,c=d,d=n,r.s=-r.s),(u=(t=d.length)-(e=c.length))>0)for(;u--;)c[e++]=0;for(u=e;t>o;){if(c[--t]<d[t]){for(e=t;e&&!c[--e];)c[e]=9;--c[e],c[t]+=10}c[t]-=d[t]}for(;c[--u]===0;)c.pop();for(;c[0]===0;)c.shift(),--m;return c[0]||(r.s=1,c=[m=0]),r.c=c,r.e=m,r};me.mod=function(r){var e,t=this,n=t.constructor,i=t.s,s=(r=new n(r)).s;if(!r.c[0])throw Error(Cs);return t.s=r.s=1,e=r.cmp(t)==1,t.s=i,r.s=s,e?new n(t):(i=n.DP,s=n.RM,n.DP=n.RM=0,t=t.div(r),n.DP=i,n.RM=s,this.minus(t.times(r)))};me.neg=function(){var r=new this.constructor(this);return r.s=-r.s,r};me.plus=me.add=function(r){var e,t,n,i=this,s=i.constructor;if(r=new s(r),i.s!=r.s)return r.s=-r.s,i.minus(r);var a=i.e,o=i.c,u=r.e,c=r.c;if(!o[0]||!c[0])return c[0]||(o[0]?r=new s(i):r.s=i.s),r;if(o=o.slice(),e=a-u){for(e>0?(u=a,n=c):(e=-e,n=o),n.reverse();e--;)n.push(0);n.reverse()}for(o.length-c.length<0&&(n=c,c=o,o=n),e=c.length,t=0;e;o[e]%=10)t=(o[--e]=o[e]+c[e]+t)/10|0;for(t&&(o.unshift(t),++u),e=o.length;o[--e]===0;)o.pop();return r.c=o,r.e=u,r};me.pow=function(r){var e=this,t=new e.constructor("1"),n=t,i=r<0;if(r!==~~r||r<-_i||r>_i)throw Error(Kt+"exponent");for(i&&(r=-r);r&1&&(n=n.times(e)),r>>=1,!!r;)e=e.times(e);return i?t.div(n):n};me.prec=function(r,e){if(r!==~~r||r<1||r>Zt)throw Error(Kt+"precision");return Jt(new this.constructor(this),r,e)};me.round=function(r,e){if(r===dt)r=0;else if(r!==~~r||r<-Zt||r>Zt)throw Error(wr);return Jt(new this.constructor(this),r+this.e+1,e)};me.sqrt=function(){var r,e,t,n=this,i=n.constructor,s=n.s,a=n.e,o=new i("0.5");if(!n.c[0])return new i(n);if(s<0)throw Error(Nn+"No square root");s=Math.sqrt(n+""),s===0||s===1/0?(e=n.c.join(""),e.length+a&1||(e+="0"),s=Math.sqrt(e),a=((a+1)/2|0)-(a<0||a&1),r=new i((s==1/0?"5e":(s=s.toExponential()).slice(0,s.indexOf("e")+1))+a)):r=new i(s+""),a=r.e+(i.DP+=4);do t=r,r=o.times(t.plus(n.div(t)));while(t.c.slice(0,a).join("")!==r.c.slice(0,a).join(""));return Jt(r,(i.DP-=4)+r.e+1,i.RM)};me.times=me.mul=function(r){var e,t=this,n=t.constructor,i=t.c,s=(r=new n(r)).c,a=i.length,o=s.length,u=t.e,c=r.e;if(r.s=t.s==r.s?1:-1,!i[0]||!s[0])return r.c=[r.e=0],r;for(r.e=u+c,a<o&&(e=i,i=s,s=e,c=a,a=o,o=c),e=new Array(c=a+o);c--;)e[c]=0;for(u=o;u--;){for(o=0,c=a+u;c>u;)o=e[c]+s[u]*i[c-u-1]+o,e[c--]=o%10,o=o/10|0;e[c]=o}for(o?++r.e:e.shift(),u=e.length;!e[--u];)e.pop();return r.c=e,r};me.toExponential=function(r,e){var t=this,n=t.c[0];if(r!==dt){if(r!==~~r||r<0||r>Zt)throw Error(wr);for(t=Jt(new t.constructor(t),++r,e);t.c.length<r;)t.c.push(0)}return fn(t,!0,!!n)};me.toFixed=function(r,e){var t=this,n=t.c[0];if(r!==dt){if(r!==~~r||r<0||r>Zt)throw Error(wr);for(t=Jt(new t.constructor(t),r+t.e+1,e),r=r+t.e+1;t.c.length<r;)t.c.push(0)}return fn(t,!1,!!n)};me[Symbol.for("nodejs.util.inspect.custom")]=me.toJSON=me.toString=function(){var r=this,e=r.constructor;return fn(r,r.e<=e.NE||r.e>=e.PE,!!r.c[0])};me.toNumber=function(){var r=Number(fn(this,!0,!0));if(this.constructor.strict===!0&&!this.eq(r.toString()))throw Error(Nn+"Imprecise conversion");return r};me.toPrecision=function(r,e){var t=this,n=t.constructor,i=t.c[0];if(r!==dt){if(r!==~~r||r<1||r>Zt)throw Error(Kt+"precision");for(t=Jt(new n(t),r,e);t.c.length<r;)t.c.push(0)}return fn(t,r<=t.e||t.e<=n.NE||t.e>=n.PE,!!i)};me.valueOf=function(){var r=this,e=r.constructor;if(e.strict===!0)throw Error(Nn+"valueOf disallowed");return fn(r,r.e<=e.NE||r.e>=e.PE,!0)};var Fs=qs();const Ni="1.1.0-beta.6";let Mi=!1,Ci=!1;const zn={debug:1,default:2,info:2,warning:3,error:4,off:5},qi={};let vr;function bc(){try{const r=[];if(["NFD","NFC","NFKD","NFKC"].forEach(e=>{try{if("test".normalize(e)!=="test")throw new Error("bad normalize")}catch(t){r.push(e)}}),r.length)throw new Error("missing "+r.join(", "));if("é".normalize("NFD")!=="é")throw new Error("broken implementation")}catch(r){if(r instanceof Error)return r.message}return""}const Fi=bc();var Fr;(function(r){r.DEBUG="DEBUG",r.INFO="INFO",r.WARNING="WARNING",r.ERROR="ERROR",r.OFF="OFF"})(Fr||(Fr={}));var Wr;(function(r){r.UNKNOWN_ERROR="UNKNOWN_ERROR",r.NOT_IMPLEMENTED="NOT_IMPLEMENTED",r.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",r.NETWORK_ERROR="NETWORK_ERROR",r.RPC_ERROR="RPC_ERROR",r.TIMEOUT="TIMEOUT",r.BUFFER_OVERRUN="BUFFER_OVERRUN",r.NUMERIC_FAULT="NUMERIC_FAULT",r.MISSING_NEW="MISSING_NEW",r.INVALID_ARGUMENT="INVALID_ARGUMENT",r.MISSING_ARGUMENT="MISSING_ARGUMENT",r.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",r.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS"})(Wr||(Wr={}));const Wi="0123456789abcdef";function Ws(r,e=!1){let t=r;try{if(r instanceof Uint8Array){let n="";for(let i=0;i<r.length;i++)n+=Wi[r[i]>>4],n+=Wi[r[i]&15];t="Uint8Array(0x".concat(n,")")}else if(r instanceof P)t="PublicKey(".concat(r.toBase58(),")");else if(r instanceof Object&&!e){const n={};Object.entries(r).forEach(([i,s])=>{n[i]=Ws(s,!0)}),t=JSON.stringify(n)}else e||(t=JSON.stringify(r))}catch(n){t=JSON.stringify(r.toString())}return t}class se{constructor(e){this.version=Ni,this.moduleName=e}_log(e,t){const n=e.toLowerCase();zn[n]==null&&this.throwArgumentError("invalid log level name","logLevel",e),!((qi[this.moduleName]||zn.default)>zn[n])&&console.log(...t)}debug(...e){this._log(se.levels.DEBUG,["[DEBUG]",...e])}info(...e){this._log(se.levels.INFO,["[INFO]",...e])}warn(...e){this._log(se.levels.WARNING,["[WARN]",...e])}makeError(e,t,n){if(Ci)return this.makeError("censored error",t,{});t||(t=se.errors.UNKNOWN_ERROR),n||(n={});const i=[];Object.entries(n).forEach(([o,u])=>{i.push("".concat(o,"=").concat(Ws(u),")"))}),i.push("code=".concat(t)),i.push("module=".concat(this.moduleName)),i.push("version=".concat(this.version));const s=e;i.length&&(e+=" ("+i.join(", ")+")");const a=new Error(e);return a.reason=s,a.code=t,Object.entries(n).forEach(([o,u])=>{a[o]=u}),a}throwError(e,t,n){throw this.makeError(e,t,n)}throwArgumentError(e,t,n){return this.throwError(e,se.errors.INVALID_ARGUMENT,{argument:t,value:n})}assert(e,t,n,i){e||this.throwError(t,n,i)}assertArgument(e,t,n,i){e||this.throwArgumentError(t,n,i)}checkNormalize(e){Fi&&this.throwError("platform missing String.prototype.normalize",se.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:Fi})}checkSafeUint53(e,t){typeof e=="number"&&(t==null&&(t="value not safe"),(e<0||e>=9007199254740991)&&this.throwError(t,se.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:e}),e%1&&this.throwError(t,se.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:e}))}checkArgumentCount(e,t,n){n?n=": "+n:n="",e<t&&this.throwError("missing argument"+n,se.errors.MISSING_ARGUMENT,{count:e,expectedCount:t}),e>t&&this.throwError("too many arguments"+n,se.errors.UNEXPECTED_ARGUMENT,{count:e,expectedCount:t})}checkNew(e,t){(e===Object||e==null)&&this.throwError("missing new",se.errors.MISSING_NEW,{name:t.name})}checkAbstract(e,t){e===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",se.errors.UNSUPPORTED_OPERATION,{name:e.name,operation:"new"}):(e===Object||e==null)&&this.throwError("missing new",se.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return vr||(vr=new se(Ni)),vr}static setCensorship(e,t){if(!e&&t&&this.globalLogger().throwError("cannot permanently disable censorship",se.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),Mi){if(!e)return;this.globalLogger().throwError("error censorship permanent",se.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}Ci=!!e,Mi=!!t}static setLogLevel(e,t){const n=zn[t.toLowerCase()];if(n==null){se.globalLogger().warn("invalid log level - "+t);return}qi[e]=n}static from(e){return new se(e)}}se.errors=Wr;se.levels=Fr;const Vi=se.from("common/pubkey"),Ce=Ht.programId,ri=new P("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),en=new P("SysvarRent111111111111111111111111111111111"),rr=new P("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ii=new P("Sysvar1nstructions1111111111111111111111111");function ir(r){if(r instanceof P)return r;if(typeof r=="string")try{return new P(r)}catch(e){return Vi.throwArgumentError("invalid public key","publicKey",r)}return Vi.throwArgumentError("invalid public key","publicKey",r)}function de(r,e){const[t,n]=P.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function O(r,e){return{pubkey:r,isWritable:!0,isSigner:e}}function R(r,e){return{pubkey:r,isWritable:!1,isSigner:e}}function Tc(r){return typeof r=="object"&&r!==null&&![le,P,be,Mr.BN,St,Re,De,xt].some(e=>typeof e=="object"&&r instanceof e)}function Di(r){return typeof r=="string"?ir(r):Array.isArray(r)?r.map(e=>Di(e)):Tc(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,Di(t)])):r}function Ui(r,e=1,t=[]){const n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}function yc(r){const e=[],t=[];return r.microLamports&&(e.push(yi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(Q.setComputeUnitPrice)),r.units&&(e.push(yi.setComputeUnitLimit({units:r.units})),t.push(Q.setComputeUnitLimit)),{address:{},innerTransaction:{instructions:e,signers:[],instructionTypes:t}}}const Ye=se.from("common/web3");async function bt(r,e,t){const{batchRequest:n,commitment:i}={batchRequest:!1,...t},s=Ui(e,100);let a=new Array(s.length).fill([]);if(n){const o=s.map(l=>({methodName:"getMultipleAccounts",args:r._buildArgs([l.map(m=>m.toBase58())],i,"base64")})),u=Ui(o,10);a=(await(await Promise.all(u.map(async l=>await r._rpcBatchRequest(l)))).flat()).map(l=>l.error?Ye.throwError("failed to get info for multiple accounts",se.errors.RPC_ERROR,{message:l.error.message}):l.result.value.map(d=>{if(d){const{data:m,executable:f,lamports:w,owner:g,rentEpoch:h}=d;return m.length!==2&&m[1]!=="base64"?Ye.throwError("info must be base64 encoded",se.errors.RPC_ERROR):{data:N.from(m[0],"base64"),executable:f,lamports:w,owner:new P(g),rentEpoch:h}}else return null}))}else try{a=await Promise.all(s.map(o=>r.getMultipleAccountsInfo(o,i)))}catch(o){if(o instanceof Error)return Ye.throwError("failed to get info for multiple accounts",se.errors.RPC_ERROR,{message:o.message})}return a.flat()}async function sr(r,e,t){const n=await bt(r,e.map(i=>i.pubkey),t);return e.map((i,s)=>({...i,accountInfo:n[s]}))}function Vs(r,e){if(r.length<1)return Ye.throwArgumentError("no instructions provided","instructions",r);if(e.length<1)return Ye.throwArgumentError("no signers provided","signers",e);const t=new er({recentBlockhash:"11111111111111111111111111111111",feePayer:e[0]});t.add(...r);try{return N.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ds}catch(n){return!1}}async function Sc(r,e,t,n=!0){const i=new P("RaydiumSimuLateTransaction11111111111111111"),s=[];let a=new er;a.feePayer=i;for(const c of e)Vs([...a.instructions,c],[i])||(s.push(a),a=new er,a.feePayer=i),a.add(c);a.instructions.length>0&&s.push(a);let o=[];try{if(o=await vc(r,s,n),o.find(c=>c.err!==null))throw Error("rpc simulateTransaction error")}catch(c){if(c instanceof Error)return Ye.throwError("failed to simulate for instructions",se.errors.RPC_ERROR,{message:c.message})}const u=[];for(const c of o)if(Ye.debug("simulate result:",c),c.logs){const l=c.logs.filter(d=>d&&d.includes(t));Ye.debug("filteredLog:",u),Ye.assertArgument(l.length!==0,"simulate log not match keyword","keyword",t),u.push(...l)}return u}function Ic(r,e){const t=r.match(/{["\w:,]+}/g);return!t||t.length!==1?Ye.throwArgumentError("simulate log fail to match json","keyword",e):t[0]}function vt(r,e){const n=new RegExp('"'.concat(e,'":(\\d+)'),"g").exec(r);return!n||n.length!==2?Ye.throwArgumentError("simulate log fail to match key","key",e):n[1]}async function vc(r,e,t){let n=[];if(t){const i=await r.getLatestBlockhash(),s=[];for(const c of e){c.recentBlockhash=i.blockhash,c.lastValidBlockHeight=i.lastValidBlockHeight;const d=c._compile().serialize(),f=c._serialize(d).toString("base64");s.push(f)}const a=s.map(c=>({methodName:"simulateTransaction",args:r._buildArgs([c],void 0,"base64")})),o=[],u=20;for(let c=0;c<Math.ceil(a.length/u);c++)o.push(a.slice(c*u,(c+1)*u));n=await(await Promise.all(o.map(async c=>(await r._rpcBatchRequest(c)).map(d=>d.result.value)))).flat()}else try{n=await Promise.all(e.map(async i=>await(await r.simulateTransaction(i)).value))}catch(i){if(i instanceof Error)return Ye.throwError("failed to get info for multiple accounts",se.errors.RPC_ERROR,{message:i.message})}return n}async function ue({connection:r,makeTxVersion:e,innerTransaction:t,lookupTableCache:n,computeBudgetConfig:i,payer:s}){const a=n!=null?n:{},o=[...new Set(t.map(f=>{var w;return((w=f.lookupTableAddress)!=null?w:[]).map(g=>g.toString())}).flat())],u=[];for(const f of o)a[f]===void 0&&u.push(new P(f));const c=await Ec({connection:r,address:u});for(const[f,w]of Object.entries(c))a[f]=w;const l=i?yc(i).innerTransaction:void 0,d=[];let m=[];for(const f of t){if(f.instructions.length===0)continue;const w=[...m,f],g=l?[l,...w]:w;if(m.length<12&&(Xn({makeTxVersion:e,innerIns:g,payer:s,lookupTableAddressAccount:a})||Xn({makeTxVersion:e,innerIns:w,payer:s,lookupTableAddressAccount:a})))m.push(f);else{if(m.length===0)throw Error(" item ins too big ");let h;if(e===pt.V0){h={};for(const p of[...new Set(m.map(A=>{var k;return(k=A.lookupTableAddress)!=null?k:[]}).flat().map(A=>A.toString()))])a[p]!==void 0&&(h[p]=a[p])}if(Xn({makeTxVersion:e,innerIns:l?[l,...m]:m,payer:s,lookupTableAddressAccount:a})){const p=l?[l,...m]:m;d.push({instructionTypes:p.map(A=>A.instructionTypes).flat(),instructions:p.map(A=>A.instructions).flat(),signers:m.map(A=>A.signers).flat(),lookupTableAddress:h})}else d.push({instructionTypes:m.map(p=>p.instructionTypes).flat(),instructions:m.map(p=>p.instructions).flat(),signers:m.map(p=>p.signers).flat(),lookupTableAddress:h});m=[f]}}if(m.length>0){let f;if(e===pt.V0){f={};for(const w of[...new Set(m.map(g=>{var h;return(h=g.lookupTableAddress)!=null?h:[]}).flat().map(g=>g.toString()))])a[w]!==void 0&&(f[w]=a[w])}if(Xn({makeTxVersion:e,innerIns:l?[l,...m]:m,payer:s,lookupTableAddressAccount:a})){const w=l?[l,...m]:m;d.push({instructionTypes:w.map(g=>g.instructionTypes).flat(),instructions:w.map(g=>g.instructions).flat(),signers:m.map(g=>g.signers).flat(),lookupTableAddress:f})}else d.push({instructionTypes:m.map(w=>w.instructionTypes).flat(),instructions:m.map(w=>w.instructions).flat(),signers:m.map(w=>w.signers).flat(),lookupTableAddress:f})}return d}function Xn({makeTxVersion:r,innerIns:e,payer:t,lookupTableAddressAccount:n}){const i=e.map(c=>c.instructions).flat(),s=[...new Set(e.map(c=>c.signers).flat().map(c=>c.publicKey.toString()))].map(c=>new P(c)),a=e.map(c=>{var l;return(l=c.lookupTableAddress)!=null?l:[]}).flat().map(c=>c.toString()),o={},u=n!=null?n:{};for(const c of a)u[c]!==void 0&&(o[c]=u[c]);return r===pt.V0?Oc({instructions:i,payer:t,lookupTableAddressAccount:o}):Bc({instructions:i,payer:t,signers:s})}const Ds=1644;function Bc({instructions:r,payer:e,signers:t}){return Vs(r,[e,...t])}function Oc({instructions:r,payer:e,lookupTableAddressAccount:t}){const i=new Es({payerKey:e,recentBlockhash:tr.generate().publicKey.toString(),instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return N.from(i.serialize()).toString("base64").length<Ds}catch(s){return!1}}async function Ec({connection:r,address:e}){const t=await bt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new P(i))),n={};for(let i=0;i<e.length;i++){const s=t[i],a=e[i];s&&(n[a.toString()]=new nr({key:a,state:nr.deserialize(s.data)}))}return n}var Qe;(function(r){r[r.ROUND_DOWN=0]="ROUND_DOWN",r[r.ROUND_HALF_UP=1]="ROUND_HALF_UP",r[r.ROUND_UP=2]="ROUND_UP"})(Qe||(Qe={}));const $=new B(0),Te=new B(1);new B(2);new B(3);new B(5);const ar=new B(10),Lc=new B(100);new B(1e3);new B(1e4);const $n=se.from("entity/bignumber"),Gi=9007199254740991;function z(r){return r instanceof B?r:typeof r=="string"?r.match(/^-?[0-9]+$/)?new B(r):$n.throwArgumentError("invalid BigNumberish string","value",r):typeof r=="number"?r%1?$n.throwArgumentError("BigNumberish number underflow","value",r):r>=Gi||r<=-Gi?$n.throwArgumentError("BigNumberish number overflow","value",r):new B(String(r)):typeof r=="bigint"?new B(r.toString()):$n.throwArgumentError("invalid BigNumberish value","value",r)}function zi(r){return ar.pow(z(r))}function Br(r,e){const t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}const Tn={symbol:"SOL",name:"Solana",decimals:9},kt={symbol:"WSOL",name:"Wrapped SOL",mint:"So11111111111111111111111111111111111111112",decimals:9,extensions:{coingeckoId:"solana"}};class St{constructor(e,t="UNKNOWN",n="UNKNOWN"){this.decimals=e,this.symbol=t,this.name=n}}St.SOL=new St(Tn.decimals,Tn.symbol,Tn.name);class F extends St{constructor(e,t,n,i="UNKNOWN",s="UNKNOWN"){super(n,i,s),this.programId=ir(e),this.mint=ir(t)}equals(e){return this===e?!0:this.mint.equals(e.mint)}}F.WSOL=new F(_,kt.mint,kt.decimals,Tn.symbol,Tn.name);function Ut(r,e){return r instanceof F&&e instanceof F?r.equals(e):r instanceof F||e instanceof F?!1:r===e}var pn=1e9,Rc={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},ai,ke=!0,je="[DecimalError] ",Xt=je+"Invalid argument: ",si=je+"Exponent out of range: ",gn=Math.floor,Wt=Math.pow,Pc=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ze,_e=1e7,he=7,Us=9007199254740991,or=gn(Us/he),D={};D.absoluteValue=D.abs=function(){var r=new this.constructor(this);return r.s&&(r.s=1),r};D.comparedTo=D.cmp=function(r){var e,t,n,i,s=this;if(r=new s.constructor(r),s.s!==r.s)return s.s||-r.s;if(s.e!==r.e)return s.e>r.e^s.s<0?1:-1;for(n=s.d.length,i=r.d.length,e=0,t=n<i?n:i;e<t;++e)if(s.d[e]!==r.d[e])return s.d[e]>r.d[e]^s.s<0?1:-1;return n===i?0:n>i^s.s<0?1:-1};D.decimalPlaces=D.dp=function(){var r=this,e=r.d.length-1,t=(e-r.e)*he;if(e=r.d[e],e)for(;e%10==0;e/=10)t--;return t<0?0:t};D.dividedBy=D.div=function(r){return yt(this,new this.constructor(r))};D.dividedToIntegerBy=D.idiv=function(r){var e=this,t=e.constructor;return we(yt(e,new t(r),0,1),t.precision)};D.equals=D.eq=function(r){return!this.cmp(r)};D.exponent=function(){return Be(this)};D.greaterThan=D.gt=function(r){return this.cmp(r)>0};D.greaterThanOrEqualTo=D.gte=function(r){return this.cmp(r)>=0};D.isInteger=D.isint=function(){return this.e>this.d.length-2};D.isNegative=D.isneg=function(){return this.s<0};D.isPositive=D.ispos=function(){return this.s>0};D.isZero=function(){return this.s===0};D.lessThan=D.lt=function(r){return this.cmp(r)<0};D.lessThanOrEqualTo=D.lte=function(r){return this.cmp(r)<1};D.logarithm=D.log=function(r){var e,t=this,n=t.constructor,i=n.precision,s=i+5;if(r===void 0)r=new n(10);else if(r=new n(r),r.s<1||r.eq(ze))throw Error(je+"NaN");if(t.s<1)throw Error(je+(t.s?"NaN":"-Infinity"));return t.eq(ze)?new n(0):(ke=!1,e=yt(En(t,s),En(r,s),s),ke=!0,we(e,i))};D.minus=D.sub=function(r){var e=this;return r=new e.constructor(r),e.s==r.s?Xs(e,r):Gs(e,(r.s=-r.s,r))};D.modulo=D.mod=function(r){var e,t=this,n=t.constructor,i=n.precision;if(r=new n(r),!r.s)throw Error(je+"NaN");return t.s?(ke=!1,e=yt(t,r,0,1).times(r),ke=!0,t.minus(e)):we(new n(t),i)};D.naturalExponential=D.exp=function(){return zs(this)};D.naturalLogarithm=D.ln=function(){return En(this)};D.negated=D.neg=function(){var r=new this.constructor(this);return r.s=-r.s||0,r};D.plus=D.add=function(r){var e=this;return r=new e.constructor(r),e.s==r.s?Gs(e,r):Xs(e,(r.s=-r.s,r))};D.precision=D.sd=function(r){var e,t,n,i=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Xt+r);if(e=Be(i)+1,n=i.d.length-1,t=n*he+1,n=i.d[n],n){for(;n%10==0;n/=10)t--;for(n=i.d[0];n>=10;n/=10)t++}return r&&e>t?e:t};D.squareRoot=D.sqrt=function(){var r,e,t,n,i,s,a,o=this,u=o.constructor;if(o.s<1){if(!o.s)return new u(0);throw Error(je+"NaN")}for(r=Be(o),ke=!1,i=Math.sqrt(+o),i==0||i==1/0?(e=ut(o.d),(e.length+r)%2==0&&(e+="0"),i=Math.sqrt(e),r=gn((r+1)/2)-(r<0||r%2),i==1/0?e="5e"+r:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+r),n=new u(e)):n=new u(i.toString()),t=u.precision,i=a=t+3;;)if(s=n,n=s.plus(yt(o,s,a+2)).times(.5),ut(s.d).slice(0,a)===(e=ut(n.d)).slice(0,a)){if(e=e.slice(a-3,a+1),i==a&&e=="4999"){if(we(s,t+1,0),s.times(s).eq(o)){n=s;break}}else if(e!="9999")break;a+=4}return ke=!0,we(n,t)};D.times=D.mul=function(r){var e,t,n,i,s,a,o,u,c,l=this,d=l.constructor,m=l.d,f=(r=new d(r)).d;if(!l.s||!r.s)return new d(0);for(r.s*=l.s,t=l.e+r.e,u=m.length,c=f.length,u<c&&(s=m,m=f,f=s,a=u,u=c,c=a),s=[],a=u+c,n=a;n--;)s.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)o=s[i]+f[n]*m[i-n-1]+e,s[i--]=o%_e|0,e=o/_e|0;s[i]=(s[i]+e)%_e|0}for(;!s[--a];)s.pop();return e?++t:s.shift(),r.d=s,r.e=t,ke?we(r,d.precision):r};D.toDecimalPlaces=D.todp=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(ft(r,0,pn),e===void 0?e=n.rounding:ft(e,0,8),we(t,r+Be(t)+1,e))};D.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=jt(n,!0):(ft(r,0,pn),e===void 0?e=i.rounding:ft(e,0,8),n=we(new i(n),r+1,e),t=jt(n,!0,r+1)),t};D.toFixed=function(r,e){var t,n,i=this,s=i.constructor;return r===void 0?jt(i):(ft(r,0,pn),e===void 0?e=s.rounding:ft(e,0,8),n=we(new s(i),r+Be(i)+1,e),t=jt(n.abs(),!1,r+Be(n)+1),i.isneg()&&!i.isZero()?"-"+t:t)};D.toInteger=D.toint=function(){var r=this,e=r.constructor;return we(new e(r),Be(r)+1,e.rounding)};D.toNumber=function(){return+this};D.toPower=D.pow=function(r){var e,t,n,i,s,a,o=this,u=o.constructor,c=12,l=+(r=new u(r));if(!r.s)return new u(ze);if(o=new u(o),!o.s){if(r.s<1)throw Error(je+"Infinity");return o}if(o.eq(ze))return o;if(n=u.precision,r.eq(ze))return we(o,n);if(e=r.e,t=r.d.length-1,a=e>=t,s=o.s,a){if((t=l<0?-l:l)<=Us){for(i=new u(ze),e=Math.ceil(n/he+4),ke=!1;t%2&&(i=i.times(o),$i(i.d,e)),t=gn(t/2),t!==0;)o=o.times(o),$i(o.d,e);return ke=!0,r.s<0?new u(ze).div(i):we(i,n)}}else if(s<0)throw Error(je+"NaN");return s=s<0&&r.d[Math.max(e,t)]&1?-1:1,o.s=1,ke=!1,i=r.times(En(o,n+c)),ke=!0,i=zs(i),i.s=s,i};D.toPrecision=function(r,e){var t,n,i=this,s=i.constructor;return r===void 0?(t=Be(i),n=jt(i,t<=s.toExpNeg||t>=s.toExpPos)):(ft(r,1,pn),e===void 0?e=s.rounding:ft(e,0,8),i=we(new s(i),r,e),t=Be(i),n=jt(i,r<=t||t<=s.toExpNeg,r)),n};D.toSignificantDigits=D.tosd=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(ft(r,1,pn),e===void 0?e=n.rounding:ft(e,0,8)),we(new n(t),r,e)};D.toString=D.valueOf=D.val=D.toJSON=D[Symbol.for("nodejs.util.inspect.custom")]=function(){var r=this,e=Be(r),t=r.constructor;return jt(r,e<=t.toExpNeg||e>=t.toExpPos)};function Gs(r,e){var t,n,i,s,a,o,u,c,l=r.constructor,d=l.precision;if(!r.s||!e.s)return e.s||(e=new l(r)),ke?we(e,d):e;if(u=r.d,c=e.d,a=r.e,i=e.e,u=u.slice(),s=a-i,s){for(s<0?(n=u,s=-s,o=c.length):(n=c,i=a,o=u.length),a=Math.ceil(d/he),o=a>o?a+1:o+1,s>o&&(s=o,n.length=1),n.reverse();s--;)n.push(0);n.reverse()}for(o=u.length,s=c.length,o-s<0&&(s=o,n=c,c=u,u=n),t=0;s;)t=(u[--s]=u[s]+c[s]+t)/_e|0,u[s]%=_e;for(t&&(u.unshift(t),++i),o=u.length;u[--o]==0;)u.pop();return e.d=u,e.e=i,ke?we(e,d):e}function ft(r,e,t){if(r!==~~r||r<e||r>t)throw Error(Xt+r)}function ut(r){var e,t,n,i=r.length-1,s="",a=r[0];if(i>0){for(s+=a,e=1;e<i;e++)n=r[e]+"",t=he-n.length,t&&(s+=Bt(t)),s+=n;a=r[e],n=a+"",t=he-n.length,t&&(s+=Bt(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}var yt=function(){function r(n,i){var s,a=0,o=n.length;for(n=n.slice();o--;)s=n[o]*i+a,n[o]=s%_e|0,a=s/_e|0;return a&&n.unshift(a),n}function e(n,i,s,a){var o,u;if(s!=a)u=s>a?1:-1;else for(o=u=0;o<s;o++)if(n[o]!=i[o]){u=n[o]>i[o]?1:-1;break}return u}function t(n,i,s){for(var a=0;s--;)n[s]-=a,a=n[s]<i[s]?1:0,n[s]=a*_e+n[s]-i[s];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,s,a){var o,u,c,l,d,m,f,w,g,h,p,A,k,S,T,y,I,E,v=n.constructor,L=n.s==i.s?1:-1,x=n.d,q=i.d;if(!n.s)return new v(n);if(!i.s)throw Error(je+"Division by zero");for(u=n.e-i.e,I=q.length,T=x.length,f=new v(L),w=f.d=[],c=0;q[c]==(x[c]||0);)++c;if(q[c]>(x[c]||0)&&--u,s==null?A=s=v.precision:a?A=s+(Be(n)-Be(i))+1:A=s,A<0)return new v(0);if(A=A/he+2|0,c=0,I==1)for(l=0,q=q[0],A++;(c<T||l)&&A--;c++)k=l*_e+(x[c]||0),w[c]=k/q|0,l=k%q|0;else{for(l=_e/(q[0]+1)|0,l>1&&(q=r(q,l),x=r(x,l),I=q.length,T=x.length),S=I,g=x.slice(0,I),h=g.length;h<I;)g[h++]=0;E=q.slice(),E.unshift(0),y=q[0],q[1]>=_e/2&&++y;do l=0,o=e(q,g,I,h),o<0?(p=g[0],I!=h&&(p=p*_e+(g[1]||0)),l=p/y|0,l>1?(l>=_e&&(l=_e-1),d=r(q,l),m=d.length,h=g.length,o=e(d,g,m,h),o==1&&(l--,t(d,I<m?E:q,m))):(l==0&&(o=l=1),d=q.slice()),m=d.length,m<h&&d.unshift(0),t(g,d,h),o==-1&&(h=g.length,o=e(q,g,I,h),o<1&&(l++,t(g,I<h?E:q,h))),h=g.length):o===0&&(l++,g=[0]),w[c++]=l,o&&g[0]?g[h++]=x[S]||0:(g=[x[S]],h=1);while((S++<T||g[0]!==void 0)&&A--)}return w[0]||w.shift(),f.e=u,we(f,a?s+Be(f)+1:s)}}();function zs(r,e){var t,n,i,s,a,o,u=0,c=0,l=r.constructor,d=l.precision;if(Be(r)>16)throw Error(si+Be(r));if(!r.s)return new l(ze);for(e==null?(ke=!1,o=d):o=e,a=new l(.03125);r.abs().gte(.1);)r=r.times(a),c+=5;for(n=Math.log(Wt(2,c))/Math.LN10*2+5|0,o+=n,t=i=s=new l(ze),l.precision=o;;){if(i=we(i.times(r),o),t=t.times(++u),a=s.plus(yt(i,t,o)),ut(a.d).slice(0,o)===ut(s.d).slice(0,o)){for(;c--;)s=we(s.times(s),o);return l.precision=d,e==null?(ke=!0,we(s,d)):s}s=a}}function Be(r){for(var e=r.e*he,t=r.d[0];t>=10;t/=10)e++;return e}function Or(r,e,t){if(e>r.LN10.sd())throw ke=!0,t&&(r.precision=t),Error(je+"LN10 precision limit exceeded");return we(new r(r.LN10),e)}function Bt(r){for(var e="";r--;)e+="0";return e}function En(r,e){var t,n,i,s,a,o,u,c,l,d=1,m=10,f=r,w=f.d,g=f.constructor,h=g.precision;if(f.s<1)throw Error(je+(f.s?"NaN":"-Infinity"));if(f.eq(ze))return new g(0);if(e==null?(ke=!1,c=h):c=e,f.eq(10))return e==null&&(ke=!0),Or(g,c);if(c+=m,g.precision=c,t=ut(w),n=t.charAt(0),s=Be(f),Math.abs(s)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=ut(f.d),n=t.charAt(0),d++;s=Be(f),n>1?(f=new g("0."+t),s++):f=new g(n+"."+t.slice(1))}else return u=Or(g,c+2,h).times(s+""),f=En(new g(n+"."+t.slice(1)),c-m).plus(u),g.precision=h,e==null?(ke=!0,we(f,h)):f;for(o=a=f=yt(f.minus(ze),f.plus(ze),c),l=we(f.times(f),c),i=3;;){if(a=we(a.times(l),c),u=o.plus(yt(a,new g(i),c)),ut(u.d).slice(0,c)===ut(o.d).slice(0,c))return o=o.times(2),s!==0&&(o=o.plus(Or(g,c+2,h).times(s+""))),o=yt(o,new g(d),c),g.precision=h,e==null?(ke=!0,we(o,h)):o;o=u,i+=2}}function Xi(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;)++n;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(n,i),e){if(i-=n,t=t-n-1,r.e=gn(t/he),r.d=[],n=(t+1)%he,t<0&&(n+=he),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=he;n<i;)r.d.push(+e.slice(n,n+=he));e=e.slice(n),n=he-e.length}else n-=i;for(;n--;)e+="0";if(r.d.push(+e),ke&&(r.e>or||r.e<-or))throw Error(si+t)}else r.s=0,r.e=0,r.d=[0];return r}function we(r,e,t){var n,i,s,a,o,u,c,l,d=r.d;for(a=1,s=d[0];s>=10;s/=10)a++;if(n=e-a,n<0)n+=he,i=e,c=d[l=0];else{if(l=Math.ceil((n+1)/he),s=d.length,l>=s)return r;for(c=s=d[l],a=1;s>=10;s/=10)a++;n%=he,i=n-he+a}if(t!==void 0&&(s=Wt(10,a-i-1),o=c/s%10|0,u=e<0||d[l+1]!==void 0||c%s,u=t<4?(o||u)&&(t==0||t==(r.s<0?3:2)):o>5||o==5&&(t==4||u||t==6&&(n>0?i>0?c/Wt(10,a-i):0:d[l-1])%10&1||t==(r.s<0?8:7))),e<1||!d[0])return u?(s=Be(r),d.length=1,e=e-s-1,d[0]=Wt(10,(he-e%he)%he),r.e=gn(-e/he)||0):(d.length=1,d[0]=r.e=r.s=0),r;if(n==0?(d.length=l,s=1,l--):(d.length=l+1,s=Wt(10,he-n),d[l]=i>0?(c/Wt(10,a-i)%Wt(10,i)|0)*s:0),u)for(;;)if(l==0){(d[0]+=s)==_e&&(d[0]=1,++r.e);break}else{if(d[l]+=s,d[l]!=_e)break;d[l--]=0,s=1}for(n=d.length;d[--n]===0;)d.pop();if(ke&&(r.e>or||r.e<-or))throw Error(si+Be(r));return r}function Xs(r,e){var t,n,i,s,a,o,u,c,l,d,m=r.constructor,f=m.precision;if(!r.s||!e.s)return e.s?e.s=-e.s:e=new m(r),ke?we(e,f):e;if(u=r.d,d=e.d,n=e.e,c=r.e,u=u.slice(),a=c-n,a){for(l=a<0,l?(t=u,a=-a,o=d.length):(t=d,n=c,o=u.length),i=Math.max(Math.ceil(f/he),o)+2,a>i&&(a=i,t.length=1),t.reverse(),i=a;i--;)t.push(0);t.reverse()}else{for(i=u.length,o=d.length,l=i<o,l&&(o=i),i=0;i<o;i++)if(u[i]!=d[i]){l=u[i]<d[i];break}a=0}for(l&&(t=u,u=d,d=t,e.s=-e.s),o=u.length,i=d.length-o;i>0;--i)u[o++]=0;for(i=d.length;i>a;){if(u[--i]<d[i]){for(s=i;s&&u[--s]===0;)u[s]=_e-1;--u[s],u[i]+=_e}u[i]-=d[i]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=n,ke?we(e,f):e):new m(0)}function jt(r,e,t){var n,i=Be(r),s=ut(r.d),a=s.length;return e?(t&&(n=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+Bt(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(i<0?"e":"e+")+i):i<0?(s="0."+Bt(-i-1)+s,t&&(n=t-a)>0&&(s+=Bt(n))):i>=a?(s+=Bt(i+1-a),t&&(n=t-i-1)>0&&(s=s+"."+Bt(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),t&&(n=t-a)>0&&(i+1===a&&(s+="."),s+=Bt(n))),r.s<0?"-"+s:s}function $i(r,e){if(r.length>e)return r.length=e,!0}function $s(r){var e,t,n;function i(s){var a=this;if(!(a instanceof i))return new i(s);if(a.constructor=i,s instanceof i){a.s=s.s,a.e=s.e,a.d=(s=s.d)?s.slice():s;return}if(typeof s=="number"){if(s*0!==0)throw Error(Xt+s);if(s>0)a.s=1;else if(s<0)s=-s,a.s=-1;else{a.s=0,a.e=0,a.d=[0];return}if(s===~~s&&s<1e7){a.e=0,a.d=[s];return}return Xi(a,s.toString())}else if(typeof s!="string")throw Error(Xt+s);if(s.charCodeAt(0)===45?(s=s.slice(1),a.s=-1):a.s=1,Pc.test(s))Xi(a,s);else throw Error(Xt+s)}if(i.prototype=D,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=$s,i.config=i.set=xc,r===void 0&&(r={}),r)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function xc(r){if(!r||typeof r!="object")throw Error(je+"Object expected");var e,t,n,i=["precision",1,pn,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((n=r[t=i[e]])!==void 0)if(gn(n)===n&&n>=i[e+1]&&n<=i[e+2])this[t]=n;else throw Error(Xt+t+": "+n);if((n=r[t="LN10"])!==void 0)if(n==Math.LN10)this[t]=new this(n);else throw Error(Xt+t+": "+n);return this}var ai=$s(Rc);ze=new ai(1);const _c=ai;var Ys={exports:{}};(function(r){function e(t){return t.prototype.toFormat=function(i,s,a){if(!this.e&&this.e!==0)return this.toString();var o,u,c,l,d,m,f,w,g,h,p,A,k,S,T,y=this.format||{},I=this.constructor.format||{};if(i!=d?typeof i=="object"?(a=i,i=d):s!=d?typeof s=="object"?(a=s,s=d):typeof a!="object"&&(a={}):a={}:a={},o=this.toFixed(i,s).split("."),w=o[0],g=o[1],f=this.s<0?w.slice(1):w,m=f.length,h=a.decimalSeparator,h==d&&(h=y.decimalSeparator,h==d&&(h=I.decimalSeparator,h==d&&(h="."))),p=a.groupSeparator,p==d&&(p=y.groupSeparator,p==d&&(p=I.groupSeparator)),p&&(A=a.groupSize,A==d&&(A=y.groupSize,A==d&&(A=I.groupSize,A==d&&(A=0))),k=a.secondaryGroupSize,k==d&&(k=y.secondaryGroupSize,k==d&&(k=I.secondaryGroupSize,k==d&&(k=0))),k?(u=+k,c=+A,m-=c):(u=+A,c=+k),u>0&&m>0)){for(l=m%u||u,w=f.substr(0,l);l<m;l+=u)w+=p+f.substr(l,u);c>0&&(w+=p+f.slice(l)),this.s<0&&(w="-"+w)}return g?(S=a.fractionGroupSeparator,S==d&&(S=y.fractionGroupSeparator,S==d&&(S=I.fractionGroupSeparator)),S&&(T=a.fractionGroupSize,T==d&&(T=y.fractionGroupSize,T==d&&(T=I.fractionGroupSize,T==d&&(T=0))),T=+T,T&&(g=g.replace(new RegExp("\\d{"+T+"}\\B","g"),"$&"+S))),w+h+g):w},t.format={decimalSeparator:".",groupSeparator:",",groupSize:3,secondaryGroupSize:0,fractionGroupSeparator:"",fractionGroupSize:0},t}r.exports&&(r.exports=e)})(Ys);var Nc=Ys.exports;const Mc=no(Nc),oi=Mc,Yn=se.from("entity/fraction"),un=oi(Fs),yn=oi(_c),Cc={[Qe.ROUND_DOWN]:yn.ROUND_DOWN,[Qe.ROUND_HALF_UP]:yn.ROUND_HALF_UP,[Qe.ROUND_UP]:yn.ROUND_UP},qc={[Qe.ROUND_DOWN]:un.roundDown,[Qe.ROUND_HALF_UP]:un.roundHalfUp,[Qe.ROUND_UP]:un.roundUp};class be{constructor(e,t=Te){this.numerator=z(e),this.denominator=z(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new be(this.denominator,this.numerator)}add(e){const t=e instanceof be?e:new be(z(e));return this.denominator.eq(t.denominator)?new be(this.numerator.add(t.numerator),this.denominator):new be(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){const t=e instanceof be?e:new be(z(e));return this.denominator.eq(t.denominator)?new be(this.numerator.sub(t.numerator),this.denominator):new be(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){const t=e instanceof be?e:new be(z(e));return new be(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){const t=e instanceof be?e:new be(z(e));return new be(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=Qe.ROUND_HALF_UP){Yn.assert(Number.isInteger(e),"".concat(e," is not an integer.")),Yn.assert(e>0,"".concat(e," is not positive.")),yn.set({precision:e+1,rounding:Cc[n]});const i=new yn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=Qe.ROUND_HALF_UP){return Yn.assert(Number.isInteger(e),"".concat(e," is not an integer.")),Yn.assert(e>=0,"".concat(e," is negative.")),un.DP=e,un.RM=qc[n],new un(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}}const Lt=se.from("entity/amount"),Yi=oi(Fs);function Fc(r,e){let t="0",n="0";if(r.includes(".")){const i=r.split(".");if(i.length===2)[t,n]=i,n=n.padEnd(e,"0");else return Lt.throwArgumentError("invalid number string","num",r)}else t=r;return[t,n.slice(0,e)||n]}class Re extends be{constructor(e,t,n=!0){let i=new B(0);const s=ar.pow(new B(e.decimals));if(n)i=z(t);else{let a=new B(0),o=new B(0);if(typeof t=="string"||typeof t=="number"||typeof t=="bigint"){const[u,c]=Fc(t.toString(),e.decimals);a=z(u),o=z(c)}a=a.mul(s),i=a.add(o)}super(i,s),this.currency=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return Lt.assert(Ut(this.currency,e.currency),"gt currency not equals"),this.raw.gt(e.raw)}lt(e){return Lt.assert(Ut(this.currency,e.currency),"lt currency not equals"),this.raw.lt(e.raw)}add(e){return Lt.assert(Ut(this.currency,e.currency),"add currency not equals"),new Re(this.currency,this.raw.add(e.raw))}sub(e){return Lt.assert(Ut(this.currency,e.currency),"sub currency not equals"),new Re(this.currency,this.raw.sub(e.raw))}toSignificant(e=this.currency.decimals,t,n=Qe.ROUND_DOWN){return super.toSignificant(e,t,n)}toFixed(e=this.currency.decimals,t,n=Qe.ROUND_DOWN){return Lt.assert(e<=this.currency.decimals,"decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return Yi.DP=this.currency.decimals,new Yi(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}}class le extends Re{constructor(e,t,n=!0){super(e,t,n),this.token=e}add(e){return Lt.assert(Ut(this.token,e.token),"add token not equals"),new le(this.token,this.raw.add(e.raw))}subtract(e){return Lt.assert(Ut(this.token,e.token),"sub token not equals"),new le(this.token,this.raw.sub(e.raw))}}const Hi=new be(Lc);class xt extends be{toSignificant(e=5,t,n){return this.mul(Hi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Hi).toFixed(e,t,n)}}const Wc=se.from("entity/price");class De extends be{constructor(e,t,n,i){super(i,t),this.baseCurrency=e,this.quoteCurrency=n,this.scalar=new be(zi(e.decimals),zi(n.decimals))}get raw(){return new be(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new De(this.quoteCurrency,this.numerator,this.baseCurrency,this.denominator)}mul(e){Wc.assert(Ut(this.quoteCurrency,e.baseCurrency),"mul currency not equals");const t=super.mul(e);return new De(this.baseCurrency,t.denominator,e.quoteCurrency,t.numerator)}toSignificant(e=this.quoteCurrency.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteCurrency.decimals,t,n){return this.adjusted.toFixed(e,t,n)}}const ci=ao,Vc=oo,Hs=io,Dc=Xe,Sn=Os,Qi=cn,Fe=ro,Uc=so,Oe=ei,Zi=co;class Mn extends ci{constructor(e,t,n){super(e,n),this.blob=Oe(e),this.signed=t}decode(e,t=0){const n=new B(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(this.span*8).clone():n}encode(e,t,n=0){return typeof e=="number"&&(e=new B(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(N,"le",this.span),t,n)}}class Gc extends ci{constructor(e){super(8,e),this._lower=Zi(Qi(),!1),this._upper=Zi(Qi(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,t=0){const n=this._lower.decode(e,t),i=this._upper.decode(e,t+this._lower.span);return{...n,...i}}encode(e,t,n=0){return this._lower.encode(e,t,n)+this._upper.encode(e,t,n+this._lower.span)}}function V(r){return new Hs(1,r)}function He(r){return new Hs(4,r)}function b(r){return new Mn(8,!1,r)}function K(r){return new Mn(16,!1,r)}function zc(r){return new Mn(1,!0,r)}function Vr(r){return new Mn(8,!0,r)}function Xc(r){return new Mn(16,!0,r)}class Qs extends ci{constructor(e,t,n,i){super(e.span,i),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}}function C(r){return new Qs(Oe(32),e=>new P(e),e=>e.toBuffer(),r)}function st(r){return new Qs(Dc(),$c,Yc,r)}function $c(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function Yc(r){return r?1:0}class Hc extends Vc{decode(e,t){return super.decode(e,t)}}function W(r,e,t){return new Hc(r,e,t)}function Z(r,e,t){let n;const i=typeof e=="number"?e:Mr.isBN(e)?e.toNumber():new Proxy(e,{get(s,a){if(!n){const o=Reflect.get(s,"count");n=Mr.isBN(o)?o.toNumber():o,Reflect.set(s,"count",n)}return Reflect.get(s,a)},set(s,a,o){return a==="count"&&(n=o),Reflect.set(s,a,o)}});return Uc(r,i,t)}const Qc=W([He("mintAuthorityOption"),C("mintAuthority"),b("supply"),V("decimals"),V("isInitialized"),He("freezeAuthorityOption"),C("freezeAuthority")]),tt=W([C("mint"),C("owner"),b("amount"),He("delegateOption"),C("delegate"),V("state"),He("isNativeOption"),b("isNative"),b("delegatedAmount"),He("closeAuthorityOption"),C("closeAuthority")]);function Ee(r,e,t){return de([r.toBuffer(),t.toBuffer(),e.toBuffer()],new P("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}class pe{static getAssociatedTokenAccount({mint:e,owner:t,programId:n}){return Ee(t,e,n).publicKey}static makeCreateAssociatedTokenAccountInstruction({programId:e,mint:t,associatedAccount:n,owner:i,payer:s,instructionsType:a}){return a.push(Q.createATA),Ho(s,n,i,t,e)}static async makeCreateWrappedNativeAccountInstructions({connection:e,owner:t,payer:n,amount:i,commitment:s}){const a=[],o=[],u=await e.getMinimumBalanceForRentExemption(tt.span,s),c=z(i).add(new B(u)),l=Ln({fromPublicKey:n,programId:_});return a.push(Ht.createAccountWithSeed({fromPubkey:n,basePubkey:n,seed:l.seed,newAccountPubkey:l.publicKey,lamports:c.toNumber(),space:tt.span,programId:_})),o.push(Q.createAccount),a.push(this.makeInitAccountInstruction({programId:_,mint:ir(kt.mint),tokenAccount:l.publicKey,owner:t,instructionTypes:o})),{address:{newAccount:l.publicKey},innerTransaction:{instructions:a,signers:[],lookupTableAddress:[],instructionTypes:o}}}static async insertCreateWrappedNativeAccount({connection:e,owner:t,payer:n,amount:i,instructions:s,instructionsType:a,signers:o,commitment:u}){const c=await this.makeCreateWrappedNativeAccountInstructions({connection:e,owner:t,payer:n,amount:i,commitment:u});return s.push(...c.innerTransaction.instructions),o.push(...c.innerTransaction.signers),a.push(...c.innerTransaction.instructionTypes),c.address.newAccount}static makeInitMintInstruction({programId:e,mint:t,decimals:n,mintAuthority:i,freezeAuthority:s=null,instructionTypes:a}){return a.push(Q.initMint),Ko(t,n,i,s,e)}static makeMintToInstruction({programId:e,mint:t,dest:n,authority:i,amount:s,multiSigners:a=[],instructionTypes:o}){return o.push(Q.mintTo),Zo(t,n,i,BigInt(String(s)),a,e)}static makeInitAccountInstruction({programId:e,mint:t,tokenAccount:n,owner:i,instructionTypes:s}){return s.push(Q.initAccount),Yo(n,t,i,e)}static makeTransferInstruction({programId:e,source:t,destination:n,owner:i,amount:s,multiSigners:a=[],instructionsType:o}){return o.push(Q.transferAmount),jo(t,n,i,BigInt(String(s)),a,e)}static makeCloseAccountInstruction({programId:e,tokenAccount:t,owner:n,payer:i,multiSigners:s=[],instructionsType:a}){return a.push(Q.closeAccount),qo(t,i,n,s,e)}static createInitAccountInstruction(e,t,n,i){const s=[{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:Et,isSigner:!1,isWritable:!1}],a=V("instruction"),o=N.alloc(a.span);return a.encode(1,o),new ne({keys:s,programId:e,data:o})}}var pt;(function(r){r[r.V0=0]="V0",r[r.LEGACY=1]="LEGACY"})(pt||(pt={}));var Q;(function(r){r[r.createAccount=0]="createAccount",r[r.initAccount=1]="initAccount",r[r.createATA=2]="createATA",r[r.closeAccount=3]="closeAccount",r[r.transferAmount=4]="transferAmount",r[r.initMint=5]="initMint",r[r.mintTo=6]="mintTo",r[r.initMarket=7]="initMarket",r[r.util1216OwnerClaim=8]="util1216OwnerClaim",r[r.setComputeUnitPrice=9]="setComputeUnitPrice",r[r.setComputeUnitLimit=10]="setComputeUnitLimit",r[r.clmmCreatePool=11]="clmmCreatePool",r[r.clmmOpenPosition=12]="clmmOpenPosition",r[r.clmmIncreasePosition=13]="clmmIncreasePosition",r[r.clmmDecreasePosition=14]="clmmDecreasePosition",r[r.clmmClosePosition=15]="clmmClosePosition",r[r.clmmSwapBaseIn=16]="clmmSwapBaseIn",r[r.clmmSwapBaseOut=17]="clmmSwapBaseOut",r[r.clmmInitReward=18]="clmmInitReward",r[r.clmmSetReward=19]="clmmSetReward",r[r.clmmCollectReward=20]="clmmCollectReward",r[r.ammV4Swap=21]="ammV4Swap",r[r.ammV4AddLiquidity=22]="ammV4AddLiquidity",r[r.ammV4RemoveLiquidity=23]="ammV4RemoveLiquidity",r[r.ammV4SimulatePoolInfo=24]="ammV4SimulatePoolInfo",r[r.ammV4SwapBaseIn=25]="ammV4SwapBaseIn",r[r.ammV4SwapBaseOut=26]="ammV4SwapBaseOut",r[r.ammV4CreatePool=27]="ammV4CreatePool",r[r.ammV4InitPool=28]="ammV4InitPool",r[r.ammV4CreatePoolV2=29]="ammV4CreatePoolV2",r[r.ammV5AddLiquidity=30]="ammV5AddLiquidity",r[r.ammV5RemoveLiquidity=31]="ammV5RemoveLiquidity",r[r.ammV5SimulatePoolInfo=32]="ammV5SimulatePoolInfo",r[r.ammV5SwapBaseIn=33]="ammV5SwapBaseIn",r[r.ammV5SwapBaseOut=34]="ammV5SwapBaseOut",r[r.routeSwap=35]="routeSwap",r[r.routeSwap1=36]="routeSwap1",r[r.routeSwap2=37]="routeSwap2",r[r.farmV3Deposit=38]="farmV3Deposit",r[r.farmV3Withdraw=39]="farmV3Withdraw",r[r.farmV3CreateLedger=40]="farmV3CreateLedger",r[r.farmV5Deposit=41]="farmV5Deposit",r[r.farmV5Withdraw=42]="farmV5Withdraw",r[r.farmV5CreateLedger=43]="farmV5CreateLedger",r[r.farmV6Deposit=44]="farmV6Deposit",r[r.farmV6Withdraw=45]="farmV6Withdraw",r[r.farmV6Create=46]="farmV6Create",r[r.farmV6Restart=47]="farmV6Restart",r[r.farmV6CreatorAddReward=48]="farmV6CreatorAddReward",r[r.farmV6CreatorWithdraw=49]="farmV6CreatorWithdraw",r[r.test=50]="test"})(Q||(Q={}));class Ar{static _selectTokenAccount(e){const{tokenAccounts:t,programId:n,mint:i,owner:s,config:a}=e,{associatedOnly:o}={associatedOnly:!0,...a},u=t.filter(({accountInfo:l})=>l.mint.equals(i)).sort((l,d)=>l.accountInfo.amount.lt(d.accountInfo.amount)?1:-1),c=pe.getAssociatedTokenAccount({mint:i,owner:s,programId:n});for(const l of u){const{pubkey:d}=l;if(o){if(c.equals(d))return d}else return d}return null}static async _handleTokenAccount(e){const{connection:t,side:n,amount:i,programId:s,mint:a,tokenAccount:o,owner:u,payer:c=u,frontInstructions:l,endInstructions:d,signers:m,bypassAssociatedCheck:f,frontInstructionsType:w,endInstructionsType:g,checkCreateATAOwner:h}=e,p=pe.getAssociatedTokenAccount({mint:a,owner:u,programId:s});if(F.WSOL.mint.equals(a)){const A=await pe.insertCreateWrappedNativeAccount({connection:t,owner:u,payer:c,instructions:l,instructionsType:w,signers:m,amount:i});return d&&d.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:A,owner:u,payer:c,instructionsType:g!=null?g:[]})),A}else if(!o||n==="out"&&!p.equals(o)&&!f){const A=pe.makeCreateAssociatedTokenAccountInstruction({programId:s,mint:a,associatedAccount:p,owner:u,payer:c,instructionsType:w});if(h){const k=await t.getAccountInfo(p);if(k===null)l.push(A);else if(!(k.owner.equals(_)&&Ft.decode(k.data).mint.equals(a)&&Ft.decode(k.data).owner.equals(u)))throw Error("create ata check error -> mint: ".concat(a.toString(),", ata: ").concat(p.toString()))}else l.push(A);return p}return o}static async _selectOrCreateTokenAccount(e){var d,m,f,w,g,h,p,A,k,S;const{mint:t,tokenAccounts:n,createInfo:i,associatedOnly:s,owner:a,checkCreateATAOwner:o,programId:u}=e,c=pe.getAssociatedTokenAccount({mint:t,owner:a,programId:u}),l=n.filter(T=>T.accountInfo.mint.equals(t)&&(!s||T.pubkey.equals(c))).sort((T,y)=>T.accountInfo.amount.lt(y.accountInfo.amount)?1:-1);if(i===void 0||l.length>0)return l.length>0?l[0].pubkey:void 0;if(s){const T=pe.makeCreateAssociatedTokenAccountInstruction({programId:u,mint:t,associatedAccount:c,owner:a,payer:i.payer,instructionsType:i.frontInstructionsType});if(o){const y=await i.connection.getAccountInfo(c);if(y===null)i.frontInstructions.push(T);else if(!(y.owner.equals(u)&&Ft.decode(y.data).mint.equals(t)&&Ft.decode(y.data).owner.equals(a)))throw Error("create ata check error -> mint: ".concat(t.toString(),", ata: ").concat(c.toString()))}else i.frontInstructions.push(T);if(t.equals(F.WSOL.mint)&&i.amount){const y=await pe.insertCreateWrappedNativeAccount({connection:i.connection,owner:a,payer:i.payer,instructions:i.frontInstructions,instructionsType:i.frontInstructionsType,signers:i.signers,amount:(d=i.amount)!=null?d:0});((m=i.endInstructions)!=null?m:[]).push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:y,owner:a,payer:i.payer,instructionsType:(f=i.endInstructionsType)!=null?f:[]})),i.amount&&i.frontInstructions.push(pe.makeTransferInstruction({programId:_,source:y,destination:c,owner:a,amount:i.amount,instructionsType:i.frontInstructionsType}))}return((w=i.endInstructions)!=null?w:[]).push(pe.makeCloseAccountInstruction({programId:u,tokenAccount:c,owner:a,payer:i.payer,instructionsType:(g=i.endInstructionsType)!=null?g:[]})),c}else if(t.equals(F.WSOL.mint)){const T=await pe.insertCreateWrappedNativeAccount({connection:i.connection,owner:a,payer:i.payer,instructions:i.frontInstructions,instructionsType:i.frontInstructionsType,signers:i.signers,amount:(h=i.amount)!=null?h:0});return((p=i.endInstructions)!=null?p:[]).push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:T,owner:a,payer:i.payer,instructionsType:(A=i.endInstructionsType)!=null?A:[]})),T}else{const T=Ln({fromPublicKey:a,programId:u}),y=await i.connection.getMinimumBalanceForRentExemption(Ft.span),I=Ht.createAccountWithSeed({fromPubkey:a,basePubkey:a,seed:T.seed,newAccountPubkey:T.publicKey,lamports:y,space:Ft.span,programId:u}),E=pe.createInitAccountInstruction(u,t,T.publicKey,a);return i.frontInstructions.push(I,E),i.frontInstructionsType.push(Q.createAccount,Q.initAccount),((k=i.endInstructions)!=null?k:[]).push(pe.makeCloseAccountInstruction({programId:u,tokenAccount:T.publicKey,owner:a,payer:i.payer,instructionsType:(S=i.endInstructionsType)!=null?S:[]})),T.publicKey}}}function Ln({fromPublicKey:r,programId:e=_}){const t=tr.generate().publicKey.toBase58().slice(0,32);return{publicKey:Zc(r,t,e),seed:t}}function Zc(r,e,t){const n=N.concat([r.toBuffer(),N.from(e),t.toBuffer()]),i=uo(n);return new P(i)}const jc={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new nr({key:new P("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:nr.deserialize(N.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};async function Kc({connection:r,makeTxVersion:e,payer:t,innerTransactions:n,recentBlockhash:i,addLookupTableInfo:s}){var u;if(e!==pt.V0&&e!==pt.LEGACY)throw Error(" make tx version args error");const a=i!=null?i:(await r.getLatestBlockhash()).blockhash,o=[];for(const c of n)o.push(Jc({makeTxVersion:e,instructions:c.instructions,payer:t,recentBlockhash:a,signers:c.signers,lookupTableInfos:Object.values({...s!=null?s:{},...(u=c.lookupTableAddress)!=null?u:{}})}));return o}function Jc({makeTxVersion:r,instructions:e,payer:t,recentBlockhash:n,signers:i,lookupTableInfos:s}){if(r===pt.LEGACY){const a=new er;return a.add(...e),a.feePayer=t,a.recentBlockhash=n,i.length>0&&a.sign(...i),a}else if(r===pt.V0){const a=new Es({payerKey:t,recentBlockhash:n,instructions:e}),o=new lo(a.compileToV0Message(s));return o.sign(i),o}else throw Error(" make tx version check error ")}const An=1e4;function We(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};const i=t.epoch<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,s=new B(i.maximumFee.toString()),a=t.epoch<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(i.transferFeeBasisPoints===An){const o=new B(i.maximumFee.toString());return{amount:r.add(o),fee:o,expirationTime:a}}else{const o=Zn(r.mul(new B(An)),new B(An-i.transferFeeBasisPoints)),u=new B(i.maximumFee.toString()),c=o.sub(r).gt(u)?r.add(u):o,l=Zn(c.mul(new B(i.transferFeeBasisPoints)),new B(An)),d=l.gt(s)?s:l;return{amount:c,fee:d,expirationTime:a}}else{const o=Zn(r.mul(new B(i.transferFeeBasisPoints)),new B(An)),u=o.gt(s)?s:o;return{amount:r,fee:u,expirationTime:a}}}function Er(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}async function ji({connection:r,mints:e}){var i,s;if(e.length===0)return{};const t=await sr(r,e.map(a=>({pubkey:a}))),n={};for(const a of t){const o=Do(a.pubkey,a.accountInfo,(i=a.accountInfo)==null?void 0:i.owner);n[a.pubkey.toString()]={...o,feeConfig:(s=zo(o))!=null?s:void 0}}return n}function Zn(r,e){const{div:t,mod:n}=r.divmod(e);return n.gt($)?t.add(Te):t}const Cn={voterStakeRegistryCreateVoter:N.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:N.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:N.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:N.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:N.from([45,185,3,36,109,190,115,169])};function eu(r,e,t,n,i,s){const a=W([V("ins")]),o=[R(e,!1),R(t,!1),O(s,!1),R(n,!1),O(i,!0),R(Ce,!1)],u=N.alloc(a.span);return a.encode({ins:23},u),new ne({keys:o,programId:r,data:u})}function tu(r,e,t,n,i,s,a,o){const u=W([V("voterBump"),V("voterWeightRecordBump")]),c=[R(e,!1),O(t,!1),R(i,!0),O(n,!1),O(s,!0),R(Ce,!1),R(en,!1),R(ii,!1)],l=N.alloc(u.span);u.encode({voterBump:a,voterWeightRecordBump:o},l);const d=N.from([...Cn.voterStakeRegistryCreateVoter,...l]);return new ne({keys:c,programId:r,data:d})}function nu(r,e,t,n,i,s,a,o,u,c,l,d){const m=W([V("depositEntryIndex"),V("kind"),V("option"),b("startTs"),He("periods"),st("allowClawback")]),f=[R(e,!1),O(t,!1),O(n,!1),R(i,!0),O(s,!0),R(a,!1),R(Ce,!1),R(_,!1),R(mn,!1),R(en,!1)],w=N.alloc(m.span);m.encode({depositEntryIndex:o,kind:u,option:c===void 0?0:1,startTs:c!=null?c:$,periods:l,allowClawback:d},w);const g=N.from([...Cn.voterStakeRegistryCreateDepositEntry,...w]);return new ne({keys:f,programId:r,data:g})}function ru(r,e,t,n,i,s,a,o,u,c,l,d,m){const f=W([V("depositEntryIndex"),b("amount")]),w=[R(e,!1),O(t,!1),O(n,!1),O(i,!1),R(s,!0),R(_,!1),O(a,!1),R(o,!1),O(u,!1),R(c,!1),R(l,!1),R(ii,!1)],g=N.alloc(f.span);f.encode({depositEntryIndex:d,amount:m},g);const h=N.from([...Cn.voterStakeRegistryDeposit,...g]);return new ne({keys:w,programId:r,data:h})}function iu(r,e,t,n){const i=W([]),s=[R(e,!1),R(t,!1),O(n,!1),R(Ce,!1)],a=N.alloc(i.span);i.encode({},a);const o=N.from([...Cn.voterStakeRegistryUpdateVoterWeightRecord,...a]);return new ne({keys:s,programId:r,data:o})}function su(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w){const g=W([V("depositEntryIndex"),b("amount")]),h=[R(e,!1),O(t,!1),R(n,!0),R(i,!1),O(s,!1),O(a,!1),O(o,!1),R(_,!1),O(u,!1),R(c,!1),O(l,!1),R(d,!1),R(m,!1),R(ii,!1)],p=N.alloc(g.span);g.encode({depositEntryIndex:f,amount:w},p);const A=N.from([...Cn.voterStakeRegistryWithdraw,...p]);return new ne({keys:h,programId:r,data:A})}const Zs=W([b("state"),b("nonce"),C("lpVault"),C("rewardVault"),C(),C(),b(),b(),b("totalReward"),K("perShareReward"),b("lastSlot"),b("perSlotReward")]),js=W([b("state"),b("nonce"),C("lpVault"),C("rewardVaultA"),b("totalRewardA"),K("perShareRewardA"),b("perSlotRewardA"),V("option"),C("rewardVaultB"),Oe(7),b("totalRewardB"),K("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),C()]),au=W([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),K("accRewardPerShare"),C("rewardVault"),C("rewardMint"),C("rewardSender"),b("rewardType"),Z(b(),15,"padding")]),ou=W([b(),b("state"),b("nonce"),b("validRewardTokenNum"),K("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),C("lpMint"),C("lpVault"),Z(au,5,"rewardInfos"),C("creator"),C(),Z(b(),32,"padding")]),cu=new Proxy(Zs,{get(r,e,t){return e==="decode"?(...n)=>{const i=r.decode(...n);return{...i,version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]}}:Reflect.get(r,e,t)}}),uu=new Proxy(js,{get(r,e,t){return e==="decode"?(...n)=>{const i=r.decode(...n);return{...i,version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]}}:Reflect.get(r,e,t)}}),kn=new Proxy(ou,{get(r,e,t){return e==="decode"?(...n)=>{const i=r.decode(...n);return{...i,version:6,rewardInfos:i.rewardInfos.map(s=>{var a;return{...s,rewardType:((a=Object.entries(sn).find(o=>String(o[1])===s.rewardType.toString()))!=null?a:["Standard SPL"])[0]}})}}:Reflect.get(r,e,t)}}),Ki=W([b("state"),C("id"),C("owner"),b("deposited"),Z(b(),1,"rewardDebts")]),jn=W([b("state"),C("id"),C("owner"),b("deposited"),Z(K(),1,"rewardDebts"),b(""),b("voteLockedBalance"),Z(b(),15)]),Ji=W([b("state"),C("id"),C("owner"),b("deposited"),Z(b(),2,"rewardDebts")]),Ks=W([b("state"),C("id"),C("owner"),b("deposited"),Z(K(),2,"rewardDebts"),Z(b(),17)]),lu=W([b(),b("state"),C("id"),C("owner"),b("deposited"),Z(K(),5,"rewardDebts"),Z(b(),16)]),du={3:cu,5:uu,6:kn},mu={3:jn,5:Ks,6:lu},fu=W([C("mint"),C("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),zc("digitShift"),Z(V(),7,"reserved1"),Z(b(),7,"reserved2")]),pu=W([Oe(8),C("governanceProgramId"),C("realm"),C("realmGoverningTokenMint"),C("realmAuthority"),Z(V(),32,"reserved1"),Z(fu,4,"votingMints"),Vr("timeOffset"),V("bump"),Z(V(),7,"reserved2"),Z(b(),11,"reserved3")]),gu=W([Vr("startTime"),Vr("endTime"),V("kind"),Z(V(),15,"reserved")]),wu=W([Z(gu,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),st("isUsed"),st("allowClawback"),V("votingMintConfigIdx"),Z(V(),29,"reserved")]),Au=W([Oe(8),C("voterAuthority"),C("registrar"),Z(wu,32,"deposits"),V("voterBump"),V("voterWweightRecordBump"),Z(V(),94,"reserved")]);function es(r,e,t){return de([e.toBuffer(),N.from("registrar","utf8"),t.toBuffer()],r)}function ts(r,e){return de([e.toBuffer(),N.from("voting_mint_seed","utf8")],r)}function ns(r,e){return de([e.toBuffer()],r)}function rs(r,e,t){return de([e.toBuffer(),N.from("voter","utf8"),t.toBuffer()],r)}function is(r,e,t){return de([e.toBuffer(),N.from("voter-weight-record","utf8"),t.toBuffer()],r)}function ss(r,e,t,n){return de([N.from("governance","utf8"),e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}const ie=se.from("Farm"),sn={"Standard SPL":0,"Option tokens":1};class Ve extends Ar{static getStateLayout(e){const t=du[e];return ie.assertArgument(!!t,"invalid version","version",e),t}static getLedgerLayout(e){const t=mu[e];return ie.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e),ledger:this.getLedgerLayout(e)}}static getAssociatedAuthority({programId:e,poolId:t}){return de([t.toBuffer()],e)}static getAssociatedLedgerAccount({programId:e,poolId:t,owner:n,version:i}){const{publicKey:s}=de([t.toBuffer(),n.toBuffer(),N.from(i===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return s}static getAssociatedLedgerPoolAccount({programId:e,poolId:t,mint:n,type:i}){const{publicKey:s}=de([t.toBuffer(),n.toBuffer(),N.from(i==="lpVault"?"lp_vault_associated_seed":i==="rewardVault"?"reward_vault_associated_seed":"","utf-8")],e);return s}static makeDepositInstruction(e){const{poolKeys:t}=e,{version:n}=t;return n===3?this.makeDepositInstructionV3(e):n===5?this.makeDepositInstructionV5(e):n===6?this.makeDepositInstructionV6(e):ie.throwArgumentError("invalid version","poolKeys.version",n)}static makeDepositInstructionV3({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(e.rewardInfos.length===1,"lengths not equal 1","poolKeys.rewardInfos",e.rewardInfos),ie.assertArgument(t.rewardTokenAccounts.length===1,"lengths not equal 1","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:10,amount:z(n)},s);const a=[O(e.id,!1),R(e.authority,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1),O(e.lpVault,!1),O(t.rewardTokenAccounts[0],!1),O(e.rewardInfos[0].rewardVault,!1),R(Un,!1),R(_,!1)];if(t.auxiliaryLedgers)for(const o of t.auxiliaryLedgers)a.push(O(o,!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV3Deposit]}}}static makeDepositInstructionV5({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:11,amount:z(n)},s);const a=[O(e.id,!1),R(e.authority,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1),O(e.lpVault,!1),O(t.rewardTokenAccounts[0],!1),O(e.rewardInfos[0].rewardVault,!1),R(Un,!1),R(_,!1)];for(let o=1;o<e.rewardInfos.length;o++)a.push(O(t.rewardTokenAccounts[o],!1)),a.push(O(e.rewardInfos[o].rewardVault,!1));if(t.auxiliaryLedgers)for(const o of t.auxiliaryLedgers)a.push(O(o,!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV5Deposit]}}}static makeDepositInstructionV6({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(t.rewardTokenAccounts.length!==0,"lengths equal zero","userKeys.rewardTokenAccounts",t.rewardTokenAccounts),ie.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:1,amount:z(n)},s);const a=[R(_,!1),R(Ce,!1),O(e.id,!1),R(e.authority,!1),O(e.lpVault,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1)];for(let o=0;o<e.rewardInfos.length;o++)a.push(O(e.rewardInfos[o].rewardVault,!1)),a.push(O(t.rewardTokenAccounts[o],!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV6Deposit]}}}static makeWithdrawInstruction(e){const{poolKeys:t}=e,{version:n}=t;return n===3?this.makeWithdrawInstructionV3(e):n===5?this.makeWithdrawInstructionV5(e):n===6?this.makeWithdrawInstructionV6(e):ie.throwArgumentError("invalid version","poolKeys.version",n)}static makeWithdrawInstructionV3({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(e.rewardInfos.length===1,"lengths not equal 1","poolKeys.rewardInfos",e.rewardInfos),ie.assertArgument(t.rewardTokenAccounts.length===1,"lengths not equal 1","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:11,amount:z(n)},s);const a=[O(e.id,!1),R(e.authority,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1),O(e.lpVault,!1),O(t.rewardTokenAccounts[0],!1),O(e.rewardInfos[0].rewardVault,!1),R(Un,!1),R(_,!1)];if(t.auxiliaryLedgers)for(const o of t.auxiliaryLedgers)a.push(O(o,!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV5Deposit]}}}static makeWithdrawInstructionV5({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with params.poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:12,amount:z(n)},s);const a=[O(e.id,!1),R(e.authority,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1),O(e.lpVault,!1),O(t.rewardTokenAccounts[0],!1),O(e.rewardInfos[0].rewardVault,!1),R(Un,!1),R(_,!1)];for(let o=1;o<e.rewardInfos.length;o++)a.push(O(t.rewardTokenAccounts[o],!1)),a.push(O(e.rewardInfos[o].rewardVault,!1));if(t.auxiliaryLedgers)for(const o of t.auxiliaryLedgers)a.push(O(o,!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV5Withdraw]}}}static makeWithdrawInstructionV6({poolKeys:e,userKeys:t,amount:n}){ie.assertArgument(t.rewardTokenAccounts.length!==0,"lengths equal zero","userKeys.rewardTokenAccounts",t.rewardTokenAccounts),ie.assertArgument(t.rewardTokenAccounts.length===e.rewardInfos.length,"lengths not equal with params.poolKeys.rewardInfos","userKeys.rewardTokenAccounts",t.rewardTokenAccounts);const i=W([V("instruction"),b("amount")]),s=N.alloc(i.span);i.encode({instruction:2,amount:z(n)},s);const a=[R(_,!1),O(e.id,!1),R(e.authority,!1),O(e.lpVault,!1),O(t.ledger,!1),R(t.owner,!0),O(t.lpTokenAccount,!1)];for(let o=0;o<e.rewardInfos.length;o++)a.push(O(e.rewardInfos[o].rewardVault,!1)),a.push(O(t.rewardTokenAccounts[o],!1));return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:a,data:s})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV6Withdraw]}}}static makeCreateAssociatedLedgerAccountInstruction(e){const{poolKeys:t}=e,{version:n}=t;return n===3?this.makeCreateAssociatedLedgerAccountInstructionV3(e):n===5?this.makeCreateAssociatedLedgerAccountInstructionV5(e):ie.throwArgumentError("invalid version","poolKeys.version",n)}static makeCreateAssociatedLedgerAccountInstructionV3({poolKeys:e,userKeys:t}){const n=W([V("instruction")]),i=N.alloc(n.span);n.encode({instruction:9},i);const s=[O(e.id,!1),O(t.ledger,!1),R(t.owner,!0),R(Ce,!1),R(Et,!1)];return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:s,data:i})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV3CreateLedger]}}}static makeCreateAssociatedLedgerAccountInstructionV5({poolKeys:e,userKeys:t}){const n=W([V("instruction")]),i=N.alloc(n.span);n.encode({instruction:10},i);const s=[O(e.id,!1),O(t.ledger,!1),R(t.owner,!0),R(Ce,!1),R(Et,!1)];return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:s,data:i})],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV5CreateLedger]}}}static makeCreateFarmInstruction({connection:e,userKeys:t,poolInfo:n}){const{version:i}=n;return i===6?this.makeCreateFarmInstructionV6({connection:e,userKeys:t,poolInfo:n}):ie.throwArgumentError("invalid version","version",i)}static async makeCreateFarmInstructionV6({connection:e,userKeys:t,poolInfo:n}){var I,E,v;const i=(I=t.payer)!=null?I:t.owner,s=Ln({fromPublicKey:i,programId:n.programId}),a=await e.getMinimumBalanceForRentExemption(kn.span),o=[],u=[],c=[],l=[],d=[];o.push(Ht.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:s.seed,newAccountPubkey:s.publicKey,lamports:a,space:kn.span,programId:n.programId}));const{publicKey:m,nonce:f}=Ve.getAssociatedAuthority({programId:n.programId,poolId:s.publicKey}),w=Ve.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:s.publicKey,mint:n.lpMint,type:"lpVault"}),g=[],h=[];for(const L of n.rewardInfos){ie.assertArgument(L.rewardOpenTime<L.rewardEndTime,"start time error","rewardInfo.rewardOpenTime",L.rewardOpenTime),ie.assertArgument(sn[L.rewardType]!==void 0,"reward type error","rewardInfo.rewardType",L.rewardType),ie.assertArgument(z(L.rewardPerSecond).gt($),"rewardPerSecond error","rewardInfo.rewardPerSecond",L.rewardPerSecond),g.push({isSet:new B(1),rewardPerSecond:z(L.rewardPerSecond),rewardOpenTime:z(L.rewardOpenTime),rewardEndTime:z(L.rewardEndTime),rewardType:z(sn[L.rewardType])});let x;L.rewardMint.equals(P.default)?(x=await pe.insertCreateWrappedNativeAccount({connection:e,owner:t.owner,payer:(E=t.payer)!=null?E:t.owner,instructions:o,signers:d,amount:z(L.rewardEndTime).sub(z(L.rewardOpenTime)).mul(z(L.rewardPerSecond)),instructionsType:c}),u.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:x,owner:t.owner,payer:(v=t.payer)!=null?v:t.owner,instructionsType:l}))):x=this._selectTokenAccount({programId:_,tokenAccounts:t.tokenAccounts,mint:L.rewardMint,owner:t.owner,config:{associatedOnly:!1}}),ie.assertArgument(x!==null,"cannot found target token accounts","tokenAccounts",t.tokenAccounts);const q=L.rewardMint.equals(P.default)?F.WSOL.mint:L.rewardMint;h.push({rewardMint:q,rewardVault:Ve.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:s.publicKey,mint:q,type:"rewardVault"}),userRewardToken:x})}const p=this._selectTokenAccount({programId:_,tokenAccounts:t.tokenAccounts,mint:n.lockInfo.lockMint,owner:t.owner,config:{associatedOnly:!1}});ie.assertArgument(p!==null,"cannot found lock vault","tokenAccounts",t.tokenAccounts);const A=W([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),k=W([V("instruction"),b("nonce"),Z(A,5,"rewardTimeInfo")]),S=N.alloc(k.span);k.encode({instruction:0,nonce:new B(f),rewardTimeInfo:g},S);const T=[R(_,!1),R(Ce,!1),R(Et,!1),O(s.publicKey,!1),R(m,!1),O(w,!1),R(n.lpMint,!1),O(n.lockInfo.lockVault,!1),R(n.lockInfo.lockMint,!1),O(p!=null?p:P.default,!1),R(t.owner,!0)];for(const L of h)T.push({pubkey:L.rewardMint,isSigner:!1,isWritable:!1},{pubkey:L.rewardVault,isSigner:!1,isWritable:!0},{pubkey:L.userRewardToken,isSigner:!1,isWritable:!0});const y=new ne({programId:n.programId,keys:T,data:S});return{address:{farmId:s.publicKey},innerTransaction:{instructions:[...o,y,...u],signers:d,lookupTableAddress:[],instructionTypes:[...c,Q.farmV6Create,...l]}}}static makeCreatorWithdrawFarmRewardInstruction(e){const{poolKeys:t}=e,{version:n}=t;return n===6?this.makeCreatorWithdrawFarmRewardInstructionV6(e):ie.throwArgumentError("invalid version","version",n)}static makeCreatorWithdrawFarmRewardInstructionV6({poolKeys:e,userKeys:t,withdrawMint:n}){var l;const i=e.rewardInfos.find(d=>d.rewardMint.equals(n.equals(P.default)?F.WSOL.mint:n));ie.assertArgument(i!==void 0,"withdraw mint error","poolKeys.rewardInfos",e.rewardInfos);const s=(l=i==null?void 0:i.rewardVault)!=null?l:P.default,a=W([V("instruction")]),o=N.alloc(a.span);a.encode({instruction:5},o);const u=[R(_,!1),O(e.id,!1),R(e.authority,!1),R(e.lpVault,!1),O(s,!1),O(t.userRewardToken,!1),R(t.owner,!0)],c=new ne({programId:e.programId,keys:u,data:o});return{address:{},innerTransaction:{instructions:[c],signers:[],lookupTableAddress:[],instructionTypes:[Q.farmV6CreatorWithdraw]}}}static async fetchMultipleInfoAndUpdate({connection:e,pools:t,owner:n,config:i,chainTime:s}){let a=!1,o=!1;const u=[],c={};for(const f of t)c[f.id.toString()]=f,f.version===6?o=!0:a=!0,u.push({pubkey:f.id,version:f.version,key:"state",poolId:f.id}),u.push({pubkey:f.lpVault,version:f.version,key:"lpVault",poolId:f.id}),n&&u.push({pubkey:this.getAssociatedLedgerAccount({programId:f.programId,poolId:f.id,owner:n,version:f.version}),version:f.version,key:"ledger",poolId:f.id});const l={},d=await sr(e,u,i);for(const{pubkey:f,version:w,key:g,poolId:h,accountInfo:p}of d){const A=h.toBase58();if(g==="state"){const k=this.getStateLayout(w);if(!p||!p.data||p.data.length!==k.span)return ie.throwArgumentError("invalid farm state account info","pools.id",f);l[A]={...l[A],apiPoolInfo:c[A],state:k.decode(p.data)}}else if(g==="lpVault"){if(!p||!p.data||p.data.length!==tt.span)return ie.throwArgumentError("invalid farm lp vault account info","pools.lpVault",f);l[A]={...l[A],lpVault:tt.decode(p.data)}}else if(g==="ledger"){const k=this.getLedgerLayout(w);p&&p.data&&(ie.assertArgument(p.data.length===k.span,"invalid farm ledger account info","ledger",f),l[A]={...l[A],ledger:k.decode(p.data)})}}const m=o||a?await e.getSlot():0;for(const f of Object.keys(l))l[f]!==void 0&&(l[f].state=Ve.updatePoolInfo(l[f].state,l[f].lpVault,m,s));for(const[f,{state:w,ledger:g}]of Object.entries(l))if(g){let h;w.version===6?h=w.rewardMultiplier:h=w.rewardInfos.length===1?ar.pow(new B(9)):ar.pow(new B(15));const p=w.rewardInfos.map((A,k)=>{const S=g.rewardDebts[k];return g.deposited.mul(w.version===6?A.accRewardPerShare:A.perShareReward).div(h).sub(S)});l[f].wrapped={...l[f].wrapped,pendingRewards:p}}return l}static updatePoolInfo(e,t,n,i){if(e.version===3||e.version===5){if(e.lastSlot.gte(new B(n)))return e;const s=new B(n).sub(e.lastSlot);e.lastSlot=new B(n);for(const a of e.rewardInfos){if(t.amount.eq(new B(0)))continue;const o=a.perSlotReward.mul(s);a.perShareReward=a.perShareReward.add(o.mul(new B(10).pow(new B(e.version===3?9:15))).div(t.amount)),a.totalReward=a.totalReward.add(o)}}else if(e.version===6)for(const s of e.rewardInfos){if(s.rewardState.eq(new B(0)))continue;const a=B.min(new B(i),s.rewardEndTime);if(s.rewardOpenTime.gte(a))continue;let u=a.sub(s.rewardLastUpdateTime).mul(s.rewardPerSecond);const c=s.totalReward.sub(s.totalRewardEmissioned);c.lt(u)?(u=c,s.rewardLastUpdateTime=s.rewardLastUpdateTime.add(c.div(s.rewardPerSecond))):s.rewardLastUpdateTime=a,!t.amount.eq(new B(0))&&(s.accRewardPerShare=s.accRewardPerShare.add(u.mul(e.rewardMultiplier).div(t.amount)),s.totalRewardEmissioned=s.totalRewardEmissioned.add(u))}return e}static makeCreatorWithdrawFarmRewardInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return n===6?this.makeCreatorWithdrawFarmRewardInstructionV6Simple(e):ie.throwArgumentError("invalid version","version",n)}static async makeCreatorWithdrawFarmRewardInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,withdrawMint:i,makeTxVersion:s,lookupTableCache:a,computeBudgetConfig:o}){var g,h,p,A;const u=[],c=[],l=[],d=[],m=[];let f;if(i.equals(P.default))f=await pe.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:(g=n.payer)!=null?g:n.owner,instructions:u,signers:m,amount:0,instructionsType:l}),c.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:f,owner:n.owner,payer:(h=n.payer)!=null?h:n.owner,instructionsType:d}));else{const k=this._selectTokenAccount({programId:_,tokenAccounts:n.tokenAccounts,mint:i,owner:n.owner});k===null?(f=Ee(n.owner,i,_).publicKey,u.push(pe.makeCreateAssociatedTokenAccountInstruction({programId:_,mint:i,associatedAccount:f,owner:n.owner,payer:(p=n.payer)!=null?p:n.owner,instructionsType:l}))):f=k}const w=this.makeCreatorWithdrawFarmRewardInstructionV6({poolKeys:t,userKeys:{userRewardToken:f,owner:n.owner,payer:n.payer},withdrawMint:i});return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:s,computeBudgetConfig:o,payer:(A=n.payer)!=null?A:n.owner,innerTransaction:[{instructionTypes:l,instructions:u,signers:m},w.innerTransaction,{instructionTypes:d,instructions:c,signers:[]}],lookupTableCache:a})}}static makeCreateFarmInstructionSimple(e){const{version:t}=e.poolInfo;return t===6?this.makeCreateFarmInstructionV6Simple(e):ie.throwArgumentError("invalid version","version",t)}static async makeCreateFarmInstructionV6Simple({connection:e,userKeys:t,poolInfo:n,makeTxVersion:i,lookupTableCache:s,computeBudgetConfig:a}){var L,x,q,X;const o=(L=t.payer)!=null?L:t.owner,u=Ln({fromPublicKey:o,programId:n.programId}),c=await e.getMinimumBalanceForRentExemption(kn.span),l=[],d=[],m=[],f=[],w=[];l.push(Ht.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c,space:kn.span,programId:n.programId}));const{publicKey:g,nonce:h}=Ve.getAssociatedAuthority({programId:n.programId,poolId:u.publicKey}),p=Ve.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:u.publicKey,mint:n.lpMint,type:"lpVault"}),A=[],k=[];for(const U of n.rewardInfos){ie.assertArgument(U.rewardOpenTime<U.rewardEndTime,"start time error","rewardInfo.rewardOpenTime",U.rewardOpenTime),ie.assertArgument(sn[U.rewardType]!==void 0,"reward type error","rewardInfo.rewardType",U.rewardType),ie.assertArgument(z(U.rewardPerSecond).gt($),"rewardPerSecond error","rewardInfo.rewardPerSecond",U.rewardPerSecond),A.push({isSet:new B(1),rewardPerSecond:z(U.rewardPerSecond),rewardOpenTime:z(U.rewardOpenTime),rewardEndTime:z(U.rewardEndTime),rewardType:z(sn[U.rewardType])});let re;if(U.rewardMint.equals(P.default)?(re=await pe.insertCreateWrappedNativeAccount({connection:e,owner:t.owner,payer:(x=t.payer)!=null?x:t.owner,instructions:l,signers:w,amount:z(U.rewardEndTime).sub(z(U.rewardOpenTime)).mul(z(U.rewardPerSecond)),instructionsType:m}),d.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:re,owner:t.owner,payer:(q=t.payer)!=null?q:t.owner,instructionsType:f}))):re=this._selectTokenAccount({programId:_,tokenAccounts:t.tokenAccounts,mint:U.rewardMint,owner:t.owner,config:{associatedOnly:!1}}),ie.assertArgument(re!==null,"cannot found target token accounts","tokenAccounts",t.tokenAccounts),re===null)throw Error("cannot found target token accounts");const J=U.rewardMint.equals(P.default)?F.WSOL.mint:U.rewardMint;k.push({rewardMint:J,rewardVault:Ve.getAssociatedLedgerPoolAccount({programId:n.programId,poolId:u.publicKey,mint:J,type:"rewardVault"}),userRewardToken:re})}const S=this._selectTokenAccount({programId:_,tokenAccounts:t.tokenAccounts,mint:n.lockInfo.lockMint,owner:t.owner,config:{associatedOnly:!1}});ie.assertArgument(S!==null,"cannot found lock vault","tokenAccounts",t.tokenAccounts);const T=W([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),y=W([V("instruction"),b("nonce"),Z(T,5,"rewardTimeInfo")]),I=N.alloc(y.span);y.encode({instruction:0,nonce:new B(h),rewardTimeInfo:A},I);const E=[R(_,!1),R(Ce,!1),R(Et,!1),O(u.publicKey,!1),R(g,!1),O(p,!1),R(n.lpMint,!1),O(n.lockInfo.lockVault,!1),R(n.lockInfo.lockMint,!1),O(S!=null?S:P.default,!1),R(t.owner,!0)];for(const U of k)E.push({pubkey:U.rewardMint,isSigner:!1,isWritable:!1},{pubkey:U.rewardVault,isSigner:!1,isWritable:!0},{pubkey:U.userRewardToken,isSigner:!1,isWritable:!0});const v=new ne({programId:n.programId,keys:E,data:I});return{address:{farmId:u.publicKey},innerTransactions:await ue({connection:e,makeTxVersion:i,computeBudgetConfig:a,payer:(X=t.payer)!=null?X:t.owner,innerTransaction:[{instructionTypes:m,instructions:l,signers:w},{instructionTypes:[Q.farmV6Create],instructions:[v],signers:[]},{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:s})}}static makeRestartFarmInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return n===6?this.makeRestartFarmInstructionV6Simple(e):ie.throwArgumentError("invalid version","version",n)}static async makeRestartFarmInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,newRewardInfo:i,makeTxVersion:s,lookupTableCache:a,computeBudgetConfig:o}){var T,y,I,E;ie.assertArgument(i.rewardOpenTime<i.rewardEndTime,"start time error","newRewardInfo",i);const u=i.rewardMint.equals(P.default)?F.WSOL.mint:i.rewardMint,c=t.rewardInfos.find(v=>v.rewardMint.equals(u));ie.assertArgument(c,"configuration does not exist","rewardInfo",c);const l=(T=c==null?void 0:c.rewardVault)!=null?T:P.default,d=[],m=[],f=[],w=[],g=[];let h;if(i.rewardMint.equals(P.default)?(h=await pe.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:(y=n.payer)!=null?y:n.owner,instructions:d,signers:g,amount:z(i.rewardEndTime).sub(z(i.rewardOpenTime)).mul(z(i.rewardPerSecond)),instructionsType:f}),m.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:h,owner:n.owner,payer:(I=n.payer)!=null?I:n.owner,instructionsType:w}))):h=this._selectTokenAccount({programId:_,tokenAccounts:n.tokenAccounts,mint:i.rewardMint,owner:n.owner,config:{associatedOnly:!1}}),ie.assertArgument(h!==null,"cannot found target token accounts","tokenAccounts",n.tokenAccounts),h===null)throw Error("cannot found target token accounts");const p=W([V("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),A=N.alloc(p.span);p.encode({instruction:3,rewardReopenTime:z(i.rewardOpenTime),rewardEndTime:z(i.rewardEndTime),rewardPerSecond:z(i.rewardPerSecond)},A);const k=[R(_,!1),O(t.id,!1),R(t.lpVault,!1),O(l,!1),O(h,!1),R(n.owner,!0)],S=new ne({programId:t.programId,keys:k,data:A});return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:s,computeBudgetConfig:o,payer:(E=n.payer)!=null?E:n.owner,innerTransaction:[{instructionTypes:f,instructions:d,signers:g},{instructionTypes:[Q.farmV6Restart],instructions:[S],signers:[]},{instructionTypes:w,instructions:m,signers:[]}],lookupTableCache:a})}}static makeFarmCreatorAddRewardTokenInstructionSimple(e){const{poolKeys:t}=e,{version:n}=t;return n===6?this.makeFarmCreatorAddRewardTokenInstructionV6Simple(e):ie.throwArgumentError("invalid version","version",n)}static async makeFarmCreatorAddRewardTokenInstructionV6Simple({connection:e,poolKeys:t,userKeys:n,newRewardInfo:i,makeTxVersion:s,lookupTableCache:a,computeBudgetConfig:o}){var S,T,y;const u=Ve.getAssociatedLedgerPoolAccount({programId:t.programId,poolId:t.id,mint:i.rewardMint.equals(P.default)?F.WSOL.mint:i.rewardMint,type:"rewardVault"}),c=[],l=[],d=[],m=[],f=[];let w;if(i.rewardMint.equals(P.default)?(w=await pe.insertCreateWrappedNativeAccount({connection:e,owner:n.owner,payer:(S=n.payer)!=null?S:n.owner,instructions:c,signers:f,amount:z(i.rewardEndTime).sub(z(i.rewardOpenTime)).mul(z(i.rewardPerSecond)),instructionsType:d}),l.push(pe.makeCloseAccountInstruction({programId:_,tokenAccount:w,owner:n.owner,payer:(T=n.payer)!=null?T:n.owner,instructionsType:m}))):w=this._selectTokenAccount({programId:_,tokenAccounts:n.tokenAccounts,mint:i.rewardMint,owner:n.owner,config:{associatedOnly:!1}}),ie.assertArgument(w!==null,"cannot found target token accounts","tokenAccounts",n.tokenAccounts),w===null)throw Error("cannot found target token accounts");const g=i.rewardMint.equals(P.default)?F.WSOL.mint:i.rewardMint,h=W([V("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),p=N.alloc(h.span);h.encode({instruction:4,isSet:new B(1),rewardPerSecond:z(i.rewardPerSecond),rewardOpenTime:z(i.rewardOpenTime),rewardEndTime:z(i.rewardEndTime),rewardType:z(sn[i.rewardType])},p);const A=[R(_,!1),R(Ce,!1),R(Et,!1),O(t.id,!1),R(t.authority,!1),R(g,!1),O(u,!1),O(w,!1),R(n.owner,!0)],k=new ne({programId:t.programId,keys:A,data:p});return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:s,computeBudgetConfig:o,payer:(y=n.payer)!=null?y:n.owner,innerTransaction:[{instructionTypes:d,instructions:c,signers:f},{instructionTypes:[Q.farmV6CreatorAddReward],instructions:[k],signers:[]},{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:a})}}static async makeDepositInstructionSimple({connection:e,poolKeys:t,fetchPoolInfo:n,ownerInfo:i,amount:s,associatedOnly:a=!0,checkCreateATAOwner:o=!1,makeTxVersion:u,lookupTableCache:c,computeBudgetConfig:l}){var v;const d={};for(const L of i.tokenAccounts)a?Ee(i.wallet,L.accountInfo.mint,L.programId).publicKey.equals(L.pubkey)&&(d[L.accountInfo.mint.toString()]=L.pubkey):d[L.accountInfo.mint.toString()]=L.pubkey;const m=[],f=[],w=[],g=[],h=[],{lpVault:p,apiPoolInfo:A,ledger:k}=n,S=p.mint,T=d[S.toString()];ie.assertArgument(T,"you don't have any lp","lp zero",d);const y=[];for(const L of A.rewardInfos){const x=i.useSOLBalance&&L.rewardMint.equals(F.WSOL.mint),q=(v=d[L.rewardMint.toString()])!=null?v:await this._selectOrCreateTokenAccount({programId:_,mint:L.rewardMint,tokenAccounts:x?[]:i.tokenAccounts,owner:i.wallet,createInfo:{connection:e,payer:i.feePayer,amount:0,frontInstructions:m,frontInstructionsType:w,endInstructions:x?f:[],endInstructionsType:x?g:[],signers:h},associatedOnly:x?!1:a,checkCreateATAOwner:o});d[L.rewardMint.toString()]=q,y.push(q)}const I=await Ve.getAssociatedLedgerAccount({programId:new P(A.programId),poolId:new P(A.id),owner:i.wallet,version:A.version});if(A.version<6&&!k){const L=Ve.makeCreateAssociatedLedgerAccountInstruction({poolKeys:t,userKeys:{owner:i.wallet,ledger:I}});m.push(...L.innerTransaction.instructions),w.push(...L.innerTransaction.instructionTypes)}const E=Ve.makeDepositInstruction({poolKeys:t,userKeys:{ledger:I,lpTokenAccount:T,owner:i.wallet,rewardTokenAccounts:y},amount:s});return{address:E.address,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:l,payer:i.feePayer,innerTransaction:[{instructionTypes:w,instructions:m,signers:h},E.innerTransaction,{instructionTypes:g,instructions:f,signers:[]}],lookupTableCache:c})}}static async makeWithdrawInstructionSimple({connection:e,fetchPoolInfo:t,ownerInfo:n,amount:i,associatedOnly:s=!0,checkCreateATAOwner:a=!1,makeTxVersion:o,lookupTableCache:u,computeBudgetConfig:c}){var L,x;const l={};for(const q of n.tokenAccounts)s?Ee(n.wallet,q.accountInfo.mint,q.programId).publicKey.equals(q.pubkey)&&(l[q.accountInfo.mint.toString()]=q.pubkey):l[q.accountInfo.mint.toString()]=q.pubkey;const d=[],m=[],f=[],w=[],g=[],h=[],p=[],{lpVault:A,wrapped:k,apiPoolInfo:S}=t;if(k===void 0)throw Error("no lp");const T=A.mint,y=n.useSOLBalance&&T.equals(F.WSOL.mint),I=(L=l[T.toString()])!=null?L:await this._selectOrCreateTokenAccount({programId:_,mint:T,tokenAccounts:y?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:d,frontInstructionsType:f,signers:p},associatedOnly:y?!1:s,checkCreateATAOwner:a});l[T.toString()]=I;const E=[];for(const q of S.rewardInfos){const X=n.useSOLBalance&&q.rewardMint.equals(F.WSOL.mint),U=(x=l[q.rewardMint.toString()])!=null?x:await this._selectOrCreateTokenAccount({programId:_,mint:q.rewardMint,tokenAccounts:X?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:d,frontInstructionsType:f,endInstructions:X?m:[],endInstructionsType:X?w:[],signers:p},associatedOnly:X?!1:s,checkCreateATAOwner:a});l[q.rewardMint.toString()]=U,E.push(U)}const v=this.makeWithdrawInstruction({poolKeys:S,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:S.programId,poolId:S.id,owner:n.wallet,version:S.version}),lpTokenAccount:I,rewardTokenAccounts:E,owner:n.wallet},amount:i});return g.push(...v.innerTransaction.instructions),h.push(...v.innerTransaction.instructionTypes),{address:{},innerTransactions:await ue({connection:e,makeTxVersion:o,computeBudgetConfig:c,payer:n.feePayer,innerTransaction:[{instructionTypes:f,instructions:d,signers:p},{instructionTypes:h,instructions:g,signers:[]},{instructionTypes:w,instructions:m,signers:[]}],lookupTableCache:u})}}static async makeHarvestAllRewardInstructionSimple({connection:e,fetchPoolInfos:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:s=!1,makeTxVersion:a,lookupTableCache:o,computeBudgetConfig:u}){var h,p;const c={};for(const A of n.tokenAccounts)i?Ee(n.wallet,A.accountInfo.mint,A.programId).publicKey.equals(A.pubkey)&&(c[A.accountInfo.mint.toString()]=A.pubkey):c[A.accountInfo.mint.toString()]=A.pubkey;const l=[],d=[],m=[],f=[],w=[],g=[];for(const{lpVault:A,wrapped:k,apiPoolInfo:S,ledger:T}of Object.values(t)){if(k===void 0||T===void 0||!(k.pendingRewards.find(x=>x.gt($))!==void 0||T.deposited.isZero()))continue;const y=A.mint,I=n.useSOLBalance&&y.equals(F.WSOL.mint),E=(h=c[y.toString()])!=null?h:await this._selectOrCreateTokenAccount({programId:_,mint:y,tokenAccounts:I?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,frontInstructionsType:m,signers:g},associatedOnly:I?!1:i,checkCreateATAOwner:s});c[y.toString()]=E;const v=[];for(const x of S.rewardInfos){const q=n.useSOLBalance&&x.rewardMint.equals(F.WSOL.mint),X=(p=c[x.rewardMint.toString()])!=null?p:await this._selectOrCreateTokenAccount({programId:_,mint:x.rewardMint,tokenAccounts:q?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,frontInstructionsType:m,endInstructions:q?d:[],endInstructionsType:q?f:[],signers:g},associatedOnly:q?!1:i,checkCreateATAOwner:s});c[x.rewardMint.toString()]=X,v.push(X)}const L=this.makeWithdrawInstruction({poolKeys:S,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:S.programId,poolId:S.id,owner:n.wallet,version:S.version}),lpTokenAccount:E,rewardTokenAccounts:v,owner:n.wallet},amount:0});w.push(L.innerTransaction)}return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:a,computeBudgetConfig:u,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:g},...w,{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:o})}}static async makeV1InfoToV2PdaAndHarvestSimple({connection:e,wallet:t,tokenAccounts:n,programIdV3:i,programIdV5:s,makeTxVersion:a,lookupTableCache:o,computeBudgetConfig:u}){const c={};for(const y of n){const I=y.accountInfo.mint,E=Ee(t,I,y.programId).publicKey;E.equals(y.pubkey)&&(c[I.toString()]=E),c[I.toString()]===void 0&&(c[I.toString()]=y.pubkey)}const l=await e.getProgramAccounts(i,{filters:[{memcmp:{offset:40,bytes:t.toString()}}]}),d=await e.getProgramAccounts(s,{filters:[{memcmp:{offset:40,bytes:t.toString()}}]}),m={},f={};for(const y of l){const E=(y.account.data.length===Ki.span?Ki:jn).decode(y.account.data),v=E.id.toString(),L=this.getAssociatedLedgerAccount({programId:i,poolId:E.id,owner:t,version:3});m[v]===void 0&&(m[v]={pda:void 0,other:[]}),L.equals(y.pubkey)?m[v].pda=y.pubkey:m[v].other.push(y.pubkey)}for(const y of d){const E=(y.account.data.length===Ji.span?Ji:Ks).decode(y.account.data),v=E.id.toString(),L=this.getAssociatedLedgerAccount({programId:s,poolId:E.id,owner:t,version:5});f[v]===void 0&&(f[v]={pda:void 0,other:[]}),L.equals(y.pubkey)?f[v].pda=y.pubkey:f[v].other.push(y.pubkey)}const w=[...Object.entries(m).filter(y=>y[1].other.length>0).map(y=>y[0]),...Object.entries(f).filter(y=>y[1].other.length>0).map(y=>y[0])],g=await e.getMultipleAccountsInfo(w.map(y=>new P(y))),h={};for(let y=0;y<w.length;y++){const I=w[y],E=g[y];E!==null&&(h[I]=E.data)}const p=[],A=[],k=[],S=[],T=[];for(const[y,I]of Object.entries(m)){if(I.other.length===0||h[y]===void 0)continue;const E=Zs.decode(h[y]),[v,L]=await e.getMultipleAccountsInfo([E.lpVault,E.rewardVault]);if(v===null||L===null)throw Error("get lp and reward info error");const x=tt.decode(v.data),q=tt.decode(L.data);let X=c[x.mint.toString()];X===void 0&&(X=await this._selectOrCreateTokenAccount({programId:v.owner,mint:x.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:p,frontInstructionsType:A,endInstructions:[],endInstructionsType:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[x.mint.toString()]=X);let U=c[q.mint.toString()];if(U===void 0&&(U=await this._selectOrCreateTokenAccount({programId:L.owner,mint:q.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:p,frontInstructionsType:A,endInstructions:q.mint.toString()===kt.mint?S:[],endInstructionsType:q.mint.toString()===kt.mint?T:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[q.mint.toString()]=U),I.pda===void 0){const J=this.makeCreateAssociatedLedgerAccountInstructionV3({poolKeys:{programId:i,id:new P(y)},userKeys:{ledger:this.getAssociatedLedgerAccount({programId:i,poolId:new P(y),owner:t,version:3}),owner:t}});k.push(J.innerTransaction)}const re=this.makeDepositInstructionV3({amount:0,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:i,poolId:new P(y),owner:t,version:3}),owner:t,lpTokenAccount:X,rewardTokenAccounts:[U],auxiliaryLedgers:I.other},poolKeys:{programId:i,id:new P(y),authority:this.getAssociatedAuthority({programId:i,poolId:new P(y)}).publicKey,lpVault:E.lpVault,rewardInfos:[{rewardVault:E.rewardVault}]}});k.push(re.innerTransaction)}for(const[y,I]of Object.entries(f)){if(I.other.length===0||h[y]===void 0)continue;const E=js.decode(h[y]),[v,L,x]=await e.getMultipleAccountsInfo([E.lpVault,E.rewardVaultA,E.rewardVaultB]);if(v===null||L===null||x===null)throw Error("get lp and reward A / B info error");const q=tt.decode(v.data),X=tt.decode(L.data),U=tt.decode(x.data);let re=c[q.mint.toString()];re===void 0&&(re=await this._selectOrCreateTokenAccount({programId:v.owner,mint:q.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:p,frontInstructionsType:A,endInstructions:[],endInstructionsType:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[q.mint.toString()]=re);let J=c[X.mint.toString()];J===void 0&&(J=await this._selectOrCreateTokenAccount({programId:L.owner,mint:X.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:p,frontInstructionsType:A,endInstructions:X.mint.toString()===kt.mint?S:[],endInstructionsType:X.mint.toString()===kt.mint?T:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[X.mint.toString()]=J);let ve=c[U.mint.toString()];if(ve===void 0&&(ve=await this._selectOrCreateTokenAccount({programId:x.owner,mint:U.mint,tokenAccounts:[],owner:t,createInfo:{connection:e,payer:t,amount:0,frontInstructions:p,frontInstructionsType:A,endInstructions:U.mint.toString()===kt.mint?S:[],endInstructionsType:U.mint.toString()===kt.mint?T:[],signers:[]},associatedOnly:!0,checkCreateATAOwner:!0}),c[U.mint.toString()]=ve),I.pda===void 0){const At=this.makeCreateAssociatedLedgerAccountInstructionV5({poolKeys:{programId:s,id:new P(y)},userKeys:{ledger:this.getAssociatedLedgerAccount({programId:s,poolId:new P(y),owner:t,version:5}),owner:t}});k.push(At.innerTransaction)}const wt=this.makeDepositInstructionV5({amount:0,userKeys:{ledger:this.getAssociatedLedgerAccount({programId:s,poolId:new P(y),owner:t,version:5}),owner:t,lpTokenAccount:re,rewardTokenAccounts:[J,ve],auxiliaryLedgers:I.other},poolKeys:{programId:s,id:new P(y),authority:this.getAssociatedAuthority({programId:s,poolId:new P(y)}).publicKey,lpVault:E.lpVault,rewardInfos:[{rewardVault:E.rewardVaultA},{rewardVault:E.rewardVaultB}]}});k.push(wt.innerTransaction)}return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:a,computeBudgetConfig:u,payer:t,innerTransaction:[{instructionTypes:A.slice(0,10),instructions:p.slice(0,10),signers:[]},...p.length>10?[{instructionTypes:A.slice(10),instructions:p.slice(10),signers:[]}]:[],...k,{instructionTypes:T,instructions:S,signers:[]}],lookupTableCache:o})}}static async makeDepositTokenInstruction({connection:e,programId:t,governanceProgramId:n,voteWeightAddinProgramId:i,realm:s,communityTokenMint:a,owner:o,poolId:u}){const c=es(i,s,a).publicKey,l=this.getAssociatedLedgerAccount({programId:t,poolId:u,owner:o,version:3}),d=await e.getAccountInfo(l);if(d===null)throw Error("user is not staker");const m=jn.decode(d.data),f=m.deposited.sub(m.voteLockedBalance);if(f.eq($))throw Error("user do not has new stake amount");const w=ts(t,u).publicKey,g=ns(t,u).publicKey,{publicKey:h,nonce:p}=rs(i,c,o),A=Ee(h,w,_).publicKey,{publicKey:k,nonce:S}=is(i,c,o),T=ss(n,s,a,o).publicKey,y=[],I=Ee(o,w,_).publicKey;if(await e.getAccountInfo(I)===null&&y.push(pe.makeCreateAssociatedTokenAccountInstruction({programId:_,mint:w,associatedAccount:I,owner:o,payer:o,instructionsType:[]})),await e.getAccountInfo(h)===null){const q=eu(n,s,o,a,o,T);y.push(q,tu(i,c,h,k,o,o,p,S))}const{index:L,isInit:x}=await as(e,c,h,w);return x||y.push(nu(i,c,h,A,o,o,w,L,0,void 0,0,!1)),y.push(ru(i,c,h,A,I,o,l,u,w,g,t,L,f),iu(i,c,h,k)),{address:{},innerTransaction:{instructions:y,signers:[],lookupTableAddress:[],instructionTypes:Array(y.length).fill(Q.test)}}}static async makeWithdrawTokenInstruction({connection:e,programId:t,governanceProgramId:n,voteWeightAddinProgramId:i,realm:s,communityTokenMint:a,owner:o,poolId:u}){const c=es(i,s,a).publicKey,l=this.getAssociatedLedgerAccount({programId:t,poolId:u,owner:o,version:3}),d=await e.getAccountInfo(l);if(d===null)throw Error("user is not staker");const m=jn.decode(d.data);if(m.voteLockedBalance.eq($))throw Error("user has vote locked balance = 0");const f=ts(t,u).publicKey,w=ns(t,u).publicKey,{publicKey:g}=rs(i,c,o),h=Ee(g,f,_).publicKey,{publicKey:p}=is(i,c,o),A=ss(n,s,a,o).publicKey,k=[],{index:S,isInit:T}=await as(e,c,g,f);if(!T)throw Error("deposit entry index check error");return k.push(su(i,c,g,o,A,p,h,Ee(o,f,_).publicKey,l,u,f,w,t,S,m.voteLockedBalance)),{address:{},innerTransaction:{instructions:k,signers:[],lookupTableAddress:[],instructionTypes:Array(k.length).fill(Q.test)}}}}async function as(r,e,t,n){const i=await r.getAccountInfo(e);if(i===null)throw Error("registrar info check error");const a=pu.decode(i.data).votingMints.findIndex(l=>l.mint.equals(n));if(a===-1)throw Error("find voter mint error");const o=await r.getAccountInfo(t);if(o===null)return{index:a,isInit:!1};const c=Au.decode(o.data).deposits.findIndex(l=>l.isUsed&&l.votingMintConfigIdx===a);return c===-1?{index:a,isInit:!1}:{index:c,isInit:!0}}const Js=W([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),K("swapBaseInAmount"),K("swapQuoteOutAmount"),b("swapBase2QuoteFee"),K("swapQuoteInAmount"),K("swapBaseOutAmount"),b("swapQuote2BaseFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("withdrawQueue"),C("lpVault"),C("owner"),b("lpReserve"),Z(b(),3,"padding")]),hu=W([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),K("swapBaseInAmount"),K("swapQuoteOutAmount"),K("swapQuoteInAmount"),K("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),C("baseVault"),C("quoteVault"),C("baseMint"),C("quoteMint"),C("lpMint"),C("modelDataAccount"),C("openOrders"),C("marketId"),C("marketProgramId"),C("targetOrders"),C("owner"),Z(b(),64,"padding")]),os={4:Js,5:hu};/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var an=9e15,Mt=1e9,Dr="0123456789abcdef",cr="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ur="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Ur={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-an,maxE:an,crypto:!1},ea,Tt,ee=!0,hr="[DecimalError] ",_t=hr+"Invalid argument: ",ta=hr+"Precision limit exceeded",na=hr+"crypto unavailable",ra="[object Decimal]",qe=Math.floor,Le=Math.pow,ku=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,bu=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Tu=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ia=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,rt=1e7,j=7,yu=9007199254740991,Su=cr.length-1,Gr=ur.length-1,M={toStringTag:ra};M.absoluteValue=M.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),Y(r)};M.ceil=function(){return Y(new this.constructor(this),this.e+1,2)};M.clampedTo=M.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(_t+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};M.comparedTo=M.cmp=function(r){var e,t,n,i,s=this,a=s.d,o=(r=new s.constructor(r)).d,u=s.s,c=r.s;if(!a||!o)return!u||!c?NaN:u!==c?u:a===o?0:!a^u<0?1:-1;if(!a[0]||!o[0])return a[0]?u:o[0]?-c:0;if(u!==c)return u;if(s.e!==r.e)return s.e>r.e^u<0?1:-1;for(n=a.length,i=o.length,e=0,t=n<i?n:i;e<t;++e)if(a[e]!==o[e])return a[e]>o[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};M.cosine=M.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+j,n.rounding=1,t=Iu(n,ua(n,t)),n.precision=r,n.rounding=e,Y(Tt==2||Tt==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};M.cubeRoot=M.cbrt=function(){var r,e,t,n,i,s,a,o,u,c,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(ee=!1,s=l.s*Le(l.s*l,1/3),!s||Math.abs(s)==1/0?(t=Ne(l.d),r=l.e,(s=(r-t.length+1)%3)&&(t+=s==1||s==-2?"0":"00"),s=Le(t,1/3),r=qe((r+1)/3)-(r%3==(r<0?-1:2)),s==1/0?t="5e"+r:(t=s.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new d(t),n.s=l.s):n=new d(s.toString()),a=(r=d.precision)+3;;)if(o=n,u=o.times(o).times(o),c=u.plus(l),n=Ae(c.plus(l).times(o),c.plus(u),a+2,1),Ne(o.d).slice(0,a)===(t=Ne(n.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!i&&t=="4999"){if(!i&&(Y(o,r+1,0),o.times(o).times(o).eq(l))){n=o;break}a+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(Y(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return ee=!0,Y(n,r,d.rounding,e)};M.decimalPlaces=M.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-qe(this.e/j))*j,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};M.dividedBy=M.div=function(r){return Ae(this,new this.constructor(r))};M.dividedToIntegerBy=M.divToInt=function(r){var e=this,t=e.constructor;return Y(Ae(e,new t(r),0,1,1),t.precision,t.rounding)};M.equals=M.eq=function(r){return this.cmp(r)===0};M.floor=function(){return Y(new this.constructor(this),this.e+1,3)};M.greaterThan=M.gt=function(r){return this.cmp(r)>0};M.greaterThanOrEqualTo=M.gte=function(r){var e=this.cmp(r);return e==1||e===0};M.hyperbolicCosine=M.cosh=function(){var r,e,t,n,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;t=a.precision,n=a.rounding,a.precision=t+Math.max(s.e,s.sd())+4,a.rounding=1,i=s.d.length,i<32?(r=Math.ceil(i/3),e=(1/br(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),s=ln(a,1,s.times(e),new a(1),!0);for(var u,c=r,l=new a(8);c--;)u=s.times(s),s=o.minus(u.times(l.minus(u.times(l))));return Y(s,a.precision=t,a.rounding=n,!0)};M.hyperbolicSine=M.sinh=function(){var r,e,t,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(e=s.precision,t=s.rounding,s.precision=e+Math.max(i.e,i.sd())+4,s.rounding=1,n=i.d.length,n<3)i=ln(s,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/br(5,r)),i=ln(s,2,i,i,!0);for(var a,o=new s(5),u=new s(16),c=new s(20);r--;)a=i.times(i),i=i.times(o.plus(a.times(u.times(a).plus(c))))}return s.precision=e,s.rounding=t,Y(i,e,t,!0)};M.hyperbolicTangent=M.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,Ae(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};M.inverseCosine=M.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,s=t.rounding;return n!==-1?n===0?e.isNeg()?nt(t,i,s):new t(0):new t(NaN):e.isZero()?nt(t,i+4,s).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=nt(t,i+4,s).times(.5),t.precision=i,t.rounding=s,r.minus(e))};M.inverseHyperbolicCosine=M.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,ee=!1,t=t.times(t).minus(1).sqrt().plus(t),ee=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};M.inverseHyperbolicSine=M.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,ee=!1,t=t.times(t).plus(1).sqrt().plus(t),ee=!0,n.precision=r,n.rounding=e,t.ln())};M.inverseHyperbolicTangent=M.atanh=function(){var r,e,t,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=s.precision,e=s.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?Y(new s(i),r,e,!0):(s.precision=t=n-i.e,i=Ae(i.plus(1),new s(1).minus(i),t+r,1),s.precision=r+4,s.rounding=1,i=i.ln(),s.precision=r,s.rounding=e,i.times(.5))):new s(NaN)};M.inverseSine=M.asin=function(){var r,e,t,n,i=this,s=i.constructor;return i.isZero()?new s(i):(e=i.abs().cmp(1),t=s.precision,n=s.rounding,e!==-1?e===0?(r=nt(s,t+4,n).times(.5),r.s=i.s,r):new s(NaN):(s.precision=t+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=t,s.rounding=n,i.times(2)))};M.inverseTangent=M.atan=function(){var r,e,t,n,i,s,a,o,u,c=this,l=c.constructor,d=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&d+4<=Gr)return a=nt(l,d+4,m).times(.25),a.s=c.s,a}else{if(!c.s)return new l(NaN);if(d+4<=Gr)return a=nt(l,d+4,m).times(.5),a.s=c.s,a}for(l.precision=o=d+10,l.rounding=1,t=Math.min(28,o/j+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(ee=!1,e=Math.ceil(o/j),n=1,u=c.times(c),a=new l(c),i=c;r!==-1;)if(i=i.times(u),s=a.minus(i.div(n+=2)),i=i.times(u),a=s.plus(i.div(n+=2)),a.d[e]!==void 0)for(r=e;a.d[r]===s.d[r]&&r--;);return t&&(a=a.times(2<<t-1)),ee=!0,Y(a,l.precision=d,l.rounding=m,!0)};M.isFinite=function(){return!!this.d};M.isInteger=M.isInt=function(){return!!this.d&&qe(this.e/j)>this.d.length-2};M.isNaN=function(){return!this.s};M.isNegative=M.isNeg=function(){return this.s<0};M.isPositive=M.isPos=function(){return this.s>0};M.isZero=function(){return!!this.d&&this.d[0]===0};M.lessThan=M.lt=function(r){return this.cmp(r)<0};M.lessThanOrEqualTo=M.lte=function(r){return this.cmp(r)<1};M.logarithm=M.log=function(r){var e,t,n,i,s,a,o,u,c=this,l=c.constructor,d=l.precision,m=l.rounding,f=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)s=!0;else{for(i=t[0];i%10===0;)i/=10;s=i!==1}if(ee=!1,o=d+f,a=Rt(c,o),n=e?lr(l,o+10):Rt(r,o),u=Ae(a,n,o,1),Rn(u.d,i=d,m))do if(o+=10,a=Rt(c,o),n=e?lr(l,o+10):Rt(r,o),u=Ae(a,n,o,1),!s){+Ne(u.d).slice(i+1,i+15)+1==1e14&&(u=Y(u,d+1,0));break}while(Rn(u.d,i+=10,m));return ee=!0,Y(u,d,m)};M.minus=M.sub=function(r){var e,t,n,i,s,a,o,u,c,l,d,m,f=this,w=f.constructor;if(r=new w(r),!f.d||!r.d)return!f.s||!r.s?r=new w(NaN):f.d?r.s=-r.s:r=new w(r.d||f.s!==r.s?f:NaN),r;if(f.s!=r.s)return r.s=-r.s,f.plus(r);if(c=f.d,m=r.d,o=w.precision,u=w.rounding,!c[0]||!m[0]){if(m[0])r.s=-r.s;else if(c[0])r=new w(f);else return new w(u===3?-0:0);return ee?Y(r,o,u):r}if(t=qe(r.e/j),l=qe(f.e/j),c=c.slice(),s=l-t,s){for(d=s<0,d?(e=c,s=-s,a=m.length):(e=m,t=l,a=c.length),n=Math.max(Math.ceil(o/j),a)+2,s>n&&(s=n,e.length=1),e.reverse(),n=s;n--;)e.push(0);e.reverse()}else{for(n=c.length,a=m.length,d=n<a,d&&(a=n),n=0;n<a;n++)if(c[n]!=m[n]){d=c[n]<m[n];break}s=0}for(d&&(e=c,c=m,m=e,r.s=-r.s),a=c.length,n=m.length-a;n>0;--n)c[a++]=0;for(n=m.length;n>s;){if(c[--n]<m[n]){for(i=n;i&&c[--i]===0;)c[i]=rt-1;--c[i],c[n]+=rt}c[n]-=m[n]}for(;c[--a]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=kr(c,t),ee?Y(r,o,u):r):new w(u===3?-0:0)};M.modulo=M.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?Y(new n(t),n.precision,n.rounding):(ee=!1,n.modulo==9?(e=Ae(t,r.abs(),0,3,1),e.s*=r.s):e=Ae(t,r,0,n.modulo,1),e=e.times(r),ee=!0,t.minus(e))};M.naturalExponential=M.exp=function(){return zr(this)};M.naturalLogarithm=M.ln=function(){return Rt(this)};M.negated=M.neg=function(){var r=new this.constructor(this);return r.s=-r.s,Y(r)};M.plus=M.add=function(r){var e,t,n,i,s,a,o,u,c,l,d=this,m=d.constructor;if(r=new m(r),!d.d||!r.d)return!d.s||!r.s?r=new m(NaN):d.d||(r=new m(r.d||d.s===r.s?d:NaN)),r;if(d.s!=r.s)return r.s=-r.s,d.minus(r);if(c=d.d,l=r.d,o=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(r=new m(d)),ee?Y(r,o,u):r;if(s=qe(d.e/j),n=qe(r.e/j),c=c.slice(),i=s-n,i){for(i<0?(t=c,i=-i,a=l.length):(t=l,n=s,a=c.length),s=Math.ceil(o/j),a=s>a?s+1:a+1,i>a&&(i=a,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(a=c.length,i=l.length,a-i<0&&(i=a,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/rt|0,c[i]%=rt;for(e&&(c.unshift(e),++n),a=c.length;c[--a]==0;)c.pop();return r.d=c,r.e=kr(c,n),ee?Y(r,o,u):r};M.precision=M.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(_t+r);return t.d?(e=sa(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};M.round=function(){var r=this,e=r.constructor;return Y(new e(r),r.e+1,e.rounding)};M.sine=M.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+j,n.rounding=1,t=Bu(n,ua(n,t)),n.precision=r,n.rounding=e,Y(Tt>2?t.neg():t,r,e,!0)):new n(NaN)};M.squareRoot=M.sqrt=function(){var r,e,t,n,i,s,a=this,o=a.d,u=a.e,c=a.s,l=a.constructor;if(c!==1||!o||!o[0])return new l(!c||c<0&&(!o||o[0])?NaN:o?a:1/0);for(ee=!1,c=Math.sqrt(+a),c==0||c==1/0?(e=Ne(o),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=qe((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(s=n,n=s.plus(Ae(a,s,t+2,1)).times(.5),Ne(s.d).slice(0,t)===(e=Ne(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(Y(s,u+1,0),s.times(s).eq(a))){n=s;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(Y(n,u+1,1),r=!n.times(n).eq(a));break}return ee=!0,Y(n,u,l.rounding,r)};M.tangent=M.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=Ae(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,Y(Tt==2||Tt==4?t.neg():t,r,e,!0)):new n(NaN)};M.times=M.mul=function(r){var e,t,n,i,s,a,o,u,c,l=this,d=l.constructor,m=l.d,f=(r=new d(r)).d;if(r.s*=l.s,!m||!m[0]||!f||!f[0])return new d(!r.s||m&&!m[0]&&!f||f&&!f[0]&&!m?NaN:!m||!f?r.s/0:r.s*0);for(t=qe(l.e/j)+qe(r.e/j),u=m.length,c=f.length,u<c&&(s=m,m=f,f=s,a=u,u=c,c=a),s=[],a=u+c,n=a;n--;)s.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)o=s[i]+f[n]*m[i-n-1]+e,s[i--]=o%rt|0,e=o/rt|0;s[i]=(s[i]+e)%rt|0}for(;!s[--a];)s.pop();return e?++t:s.shift(),r.d=s,r.e=kr(s,t),ee?Y(r,d.precision,d.rounding):r};M.toBinary=function(r,e){return ui(this,2,r,e)};M.toDecimalPlaces=M.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Ue(r,0,Mt),e===void 0?e=n.rounding:Ue(e,0,8),Y(t,r+t.e+1,e))};M.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=gt(n,!0):(Ue(r,0,Mt),e===void 0?e=i.rounding:Ue(e,0,8),n=Y(new i(n),r+1,e),t=gt(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};M.toFixed=function(r,e){var t,n,i=this,s=i.constructor;return r===void 0?t=gt(i):(Ue(r,0,Mt),e===void 0?e=s.rounding:Ue(e,0,8),n=Y(new s(i),r+i.e+1,e),t=gt(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};M.toFraction=function(r){var e,t,n,i,s,a,o,u,c,l,d,m,f=this,w=f.d,g=f.constructor;if(!w)return new g(f);if(c=t=new g(1),n=u=new g(0),e=new g(n),s=e.e=sa(w)-f.e-1,a=s%j,e.d[0]=Le(10,a<0?j+a:a),r==null)r=s>0?e:c;else{if(o=new g(r),!o.isInt()||o.lt(c))throw Error(_t+o);r=o.gt(e)?s>0?e:c:o}for(ee=!1,o=new g(Ne(w)),l=g.precision,g.precision=s=w.length*j*2;d=Ae(o,e,0,1,1),i=t.plus(d.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(d.times(i)),u=i,i=e,e=o.minus(d.times(i)),o=i;return i=Ae(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=f.s,m=Ae(c,n,s,1).minus(f).abs().cmp(Ae(u,t,s,1).minus(f).abs())<1?[c,n]:[u,t],g.precision=l,ee=!0,m};M.toHexadecimal=M.toHex=function(r,e){return ui(this,16,r,e)};M.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Ue(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(ee=!1,t=Ae(t,r,0,e,1).times(r),ee=!0,Y(t)):(r.s=t.s,t=r),t};M.toNumber=function(){return+this};M.toOctal=function(r,e){return ui(this,8,r,e)};M.toPower=M.pow=function(r){var e,t,n,i,s,a,o=this,u=o.constructor,c=+(r=new u(r));if(!o.d||!r.d||!o.d[0]||!r.d[0])return new u(Le(+o,c));if(o=new u(o),o.eq(1))return o;if(n=u.precision,s=u.rounding,r.eq(1))return Y(o,n,s);if(e=qe(r.e/j),e>=r.d.length-1&&(t=c<0?-c:c)<=yu)return i=aa(u,o,t,n),r.s<0?new u(1).div(i):Y(i,n,s);if(a=o.s,a<0){if(e<r.d.length-1)return new u(NaN);if(r.d[e]&1||(a=1),o.e==0&&o.d[0]==1&&o.d.length==1)return o.s=a,o}return t=Le(+o,c),e=t==0||!isFinite(t)?qe(c*(Math.log("0."+Ne(o.d))/Math.LN10+o.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?a/0:0):(ee=!1,u.rounding=o.s=1,t=Math.min(12,(e+"").length),i=zr(r.times(Rt(o,n+t)),n),i.d&&(i=Y(i,n+5,1),Rn(i.d,n,s)&&(e=n+10,i=Y(zr(r.times(Rt(o,e+t)),e),e+5,1),+Ne(i.d).slice(n+1,n+15)+1==1e14&&(i=Y(i,n+1,0)))),i.s=a,ee=!0,u.rounding=s,Y(i,n,s))};M.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=gt(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Ue(r,1,Mt),e===void 0?e=i.rounding:Ue(e,0,8),n=Y(new i(n),r,e),t=gt(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};M.toSignificantDigits=M.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Ue(r,1,Mt),e===void 0?e=n.rounding:Ue(e,0,8)),Y(new n(t),r,e)};M.toString=function(){var r=this,e=r.constructor,t=gt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};M.truncated=M.trunc=function(){return Y(new this.constructor(this),this.e+1,1)};M.valueOf=M.toJSON=function(){var r=this,e=r.constructor,t=gt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function Ne(r){var e,t,n,i=r.length-1,s="",a=r[0];if(i>0){for(s+=a,e=1;e<i;e++)n=r[e]+"",t=j-n.length,t&&(s+=Ot(t)),s+=n;a=r[e],n=a+"",t=j-n.length,t&&(s+=Ot(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return s+a}function Ue(r,e,t){if(r!==~~r||r<e||r>t)throw Error(_t+r)}function Rn(r,e,t,n){var i,s,a,o;for(s=r[0];s>=10;s/=10)--e;return--e<0?(e+=j,i=0):(i=Math.ceil((e+1)/j),e%=j),s=Le(10,j-e),o=r[i]%s|0,n==null?e<3?(e==0?o=o/100|0:e==1&&(o=o/10|0),a=t<4&&o==99999||t>3&&o==49999||o==5e4||o==0):a=(t<4&&o+1==s||t>3&&o+1==s/2)&&(r[i+1]/s/100|0)==Le(10,e-2)-1||(o==s/2||o==0)&&(r[i+1]/s/100|0)==0:e<4?(e==0?o=o/1e3|0:e==1?o=o/100|0:e==2&&(o=o/10|0),a=(n||t<4)&&o==9999||!n&&t>3&&o==4999):a=((n||t<4)&&o+1==s||!n&&t>3&&o+1==s/2)&&(r[i+1]/s/1e3|0)==Le(10,e-3)-1,a}function Kn(r,e,t){for(var n,i=[0],s,a=0,o=r.length;a<o;){for(s=i.length;s--;)i[s]*=e;for(i[0]+=Dr.indexOf(r.charAt(a++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Iu(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/br(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=ln(r,1,e.times(i),new r(1));for(var s=t;s--;){var a=e.times(e);e=a.times(a).minus(a).times(8).plus(1)}return r.precision-=t,e}var Ae=function(){function r(n,i,s){var a,o=0,u=n.length;for(n=n.slice();u--;)a=n[u]*i+o,n[u]=a%s|0,o=a/s|0;return o&&n.unshift(o),n}function e(n,i,s,a){var o,u;if(s!=a)u=s>a?1:-1;else for(o=u=0;o<s;o++)if(n[o]!=i[o]){u=n[o]>i[o]?1:-1;break}return u}function t(n,i,s,a){for(var o=0;s--;)n[s]-=o,o=n[s]<i[s]?1:0,n[s]=o*a+n[s]-i[s];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,s,a,o,u){var c,l,d,m,f,w,g,h,p,A,k,S,T,y,I,E,v,L,x,q,X=n.constructor,U=n.s==i.s?1:-1,re=n.d,J=i.d;if(!re||!re[0]||!J||!J[0])return new X(!n.s||!i.s||(re?J&&re[0]==J[0]:!J)?NaN:re&&re[0]==0||!J?U*0:U/0);for(u?(f=1,l=n.e-i.e):(u=rt,f=j,l=qe(n.e/f)-qe(i.e/f)),x=J.length,v=re.length,p=new X(U),A=p.d=[],d=0;J[d]==(re[d]||0);d++);if(J[d]>(re[d]||0)&&l--,s==null?(y=s=X.precision,a=X.rounding):o?y=s+(n.e-i.e)+1:y=s,y<0)A.push(1),w=!0;else{if(y=y/f+2|0,d=0,x==1){for(m=0,J=J[0],y++;(d<v||m)&&y--;d++)I=m*u+(re[d]||0),A[d]=I/J|0,m=I%J|0;w=m||d<v}else{for(m=u/(J[0]+1)|0,m>1&&(J=r(J,m,u),re=r(re,m,u),x=J.length,v=re.length),E=x,k=re.slice(0,x),S=k.length;S<x;)k[S++]=0;q=J.slice(),q.unshift(0),L=J[0],J[1]>=u/2&&++L;do m=0,c=e(J,k,x,S),c<0?(T=k[0],x!=S&&(T=T*u+(k[1]||0)),m=T/L|0,m>1?(m>=u&&(m=u-1),g=r(J,m,u),h=g.length,S=k.length,c=e(g,k,h,S),c==1&&(m--,t(g,x<h?q:J,h,u))):(m==0&&(c=m=1),g=J.slice()),h=g.length,h<S&&g.unshift(0),t(k,g,S,u),c==-1&&(S=k.length,c=e(J,k,x,S),c<1&&(m++,t(k,x<S?q:J,S,u))),S=k.length):c===0&&(m++,k=[0]),A[d++]=m,c&&k[0]?k[S++]=re[E]||0:(k=[re[E]],S=1);while((E++<v||k[0]!==void 0)&&y--);w=k[0]!==void 0}A[0]||A.shift()}if(f==1)p.e=l,ea=w;else{for(d=1,m=A[0];m>=10;m/=10)d++;p.e=d+l*f-1,Y(p,o?s+p.e+1:s,a,w)}return p}}();function Y(r,e,t,n){var i,s,a,o,u,c,l,d,m,f=r.constructor;e:if(e!=null){if(d=r.d,!d)return r;for(i=1,o=d[0];o>=10;o/=10)i++;if(s=e-i,s<0)s+=j,a=e,l=d[m=0],u=l/Le(10,i-a-1)%10|0;else if(m=Math.ceil((s+1)/j),o=d.length,m>=o)if(n){for(;o++<=m;)d.push(0);l=u=0,i=1,s%=j,a=s-j+1}else break e;else{for(l=o=d[m],i=1;o>=10;o/=10)i++;s%=j,a=s-j+i,u=a<0?0:l/Le(10,i-a-1)%10|0}if(n=n||e<0||d[m+1]!==void 0||(a<0?l:l%Le(10,i-a-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(s>0?a>0?l/Le(10,i-a):0:d[m-1])%10&1||t==(r.s<0?8:7)),e<1||!d[0])return d.length=0,c?(e-=r.e+1,d[0]=Le(10,(j-e%j)%j),r.e=-e||0):d[0]=r.e=0,r;if(s==0?(d.length=m,o=1,m--):(d.length=m+1,o=Le(10,j-s),d[m]=a>0?(l/Le(10,i-a)%Le(10,a)|0)*o:0),c)for(;;)if(m==0){for(s=1,a=d[0];a>=10;a/=10)s++;for(a=d[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(r.e++,d[0]==rt&&(d[0]=1));break}else{if(d[m]+=o,d[m]!=rt)break;d[m--]=0,o=1}for(s=d.length;d[--s]===0;)d.pop()}return ee&&(r.e>f.maxE?(r.d=null,r.e=NaN):r.e<f.minE&&(r.e=0,r.d=[0])),r}function gt(r,e,t){if(!r.isFinite())return ca(r);var n,i=r.e,s=Ne(r.d),a=s.length;return e?(t&&(n=t-a)>0?s=s.charAt(0)+"."+s.slice(1)+Ot(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(r.e<0?"e":"e+")+r.e):i<0?(s="0."+Ot(-i-1)+s,t&&(n=t-a)>0&&(s+=Ot(n))):i>=a?(s+=Ot(i+1-a),t&&(n=t-i-1)>0&&(s=s+"."+Ot(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),t&&(n=t-a)>0&&(i+1===a&&(s+="."),s+=Ot(n))),s}function kr(r,e){var t=r[0];for(e*=j;t>=10;t/=10)e++;return e}function lr(r,e,t){if(e>Su)throw ee=!0,t&&(r.precision=t),Error(ta);return Y(new r(cr),e,1,!0)}function nt(r,e,t){if(e>Gr)throw Error(ta);return Y(new r(ur),e,t,!0)}function sa(r){var e=r.length-1,t=e*j+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function Ot(r){for(var e="";r--;)e+="0";return e}function aa(r,e,t,n){var i,s=new r(1),a=Math.ceil(n/j+4);for(ee=!1;;){if(t%2&&(s=s.times(e),us(s.d,a)&&(i=!0)),t=qe(t/2),t===0){t=s.d.length-1,i&&s.d[t]===0&&++s.d[t];break}e=e.times(e),us(e.d,a)}return ee=!0,s}function cs(r){return r.d[r.d.length-1]&1}function oa(r,e,t){for(var n,i=new r(e[0]),s=0;++s<e.length;)if(n=new r(e[s]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function zr(r,e){var t,n,i,s,a,o,u,c=0,l=0,d=0,m=r.constructor,f=m.rounding,w=m.precision;if(!r.d||!r.d[0]||r.e>17)return new m(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:NaN);for(e==null?(ee=!1,u=w):u=e,o=new m(.03125);r.e>-2;)r=r.times(o),d+=5;for(n=Math.log(Le(2,d))/Math.LN10*2+5|0,u+=n,t=s=a=new m(1),m.precision=u;;){if(s=Y(s.times(r),u,1),t=t.times(++l),o=a.plus(Ae(s,t,u,1)),Ne(o.d).slice(0,u)===Ne(a.d).slice(0,u)){for(i=d;i--;)a=Y(a.times(a),u,1);if(e==null)if(c<3&&Rn(a.d,u-n,f,c))m.precision=u+=10,t=s=o=new m(1),l=0,c++;else return Y(a,m.precision=w,f,ee=!0);else return m.precision=w,a}a=o}}function Rt(r,e){var t,n,i,s,a,o,u,c,l,d,m,f=1,w=10,g=r,h=g.d,p=g.constructor,A=p.rounding,k=p.precision;if(g.s<0||!h||!h[0]||!g.e&&h[0]==1&&h.length==1)return new p(h&&!h[0]?-1/0:g.s!=1?NaN:h?0:g);if(e==null?(ee=!1,l=k):l=e,p.precision=l+=w,t=Ne(h),n=t.charAt(0),Math.abs(s=g.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)g=g.times(r),t=Ne(g.d),n=t.charAt(0),f++;s=g.e,n>1?(g=new p("0."+t),s++):g=new p(n+"."+t.slice(1))}else return c=lr(p,l+2,k).times(s+""),g=Rt(new p(n+"."+t.slice(1)),l-w).plus(c),p.precision=k,e==null?Y(g,k,A,ee=!0):g;for(d=g,u=a=g=Ae(g.minus(1),g.plus(1),l,1),m=Y(g.times(g),l,1),i=3;;){if(a=Y(a.times(m),l,1),c=u.plus(Ae(a,new p(i),l,1)),Ne(c.d).slice(0,l)===Ne(u.d).slice(0,l))if(u=u.times(2),s!==0&&(u=u.plus(lr(p,l+2,k).times(s+""))),u=Ae(u,new p(f),l,1),e==null)if(Rn(u.d,l-w,A,o))p.precision=l+=w,c=a=g=Ae(d.minus(1),d.plus(1),l,1),m=Y(g.times(g),l,1),i=o=1;else return Y(u,p.precision=k,A,ee=!0);else return p.precision=k,u;u=c,i+=2}}function ca(r){return String(r.s*r.s/0)}function Xr(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%j,t<0&&(n+=j),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=j;n<i;)r.d.push(+e.slice(n,n+=j));e=e.slice(n),n=j-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),ee&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function vu(r,e){var t,n,i,s,a,o,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ia.test(e))return Xr(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(bu.test(e))t=16,e=e.toLowerCase();else if(ku.test(e))t=2;else if(Tu.test(e))t=8;else throw Error(_t+e);for(s=e.search(/p/i),s>0?(u=+e.slice(s+1),e=e.substring(2,s)):e=e.slice(2),s=e.indexOf("."),a=s>=0,n=r.constructor,a&&(e=e.replace(".",""),o=e.length,s=o-s,i=aa(n,new n(t),s,s*2)),c=Kn(e,t,rt),l=c.length-1,s=l;c[s]===0;--s)c.pop();return s<0?new n(r.s*0):(r.e=kr(c,l),r.d=c,ee=!1,a&&(r=Ae(r,i,o*4)),u&&(r=r.times(Math.abs(u)<54?Le(2,u):H.pow(2,u))),ee=!0,r)}function Bu(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:ln(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/br(5,t)),e=ln(r,2,e,e);for(var i,s=new r(5),a=new r(16),o=new r(20);t--;)i=e.times(e),e=e.times(s.plus(i.times(a.times(i).minus(o))));return e}function ln(r,e,t,n,i){var s,a,o,u,c=r.precision,l=Math.ceil(c/j);for(ee=!1,u=t.times(t),o=new r(n);;){if(a=Ae(o.times(u),new r(e++*e++),c,1),o=i?n.plus(a):n.minus(a),n=Ae(a.times(u),new r(e++*e++),c,1),a=o.plus(n),a.d[l]!==void 0){for(s=l;a.d[s]===o.d[s]&&s--;);if(s==-1)break}s=o,o=n,n=a,a=s}return ee=!0,a.d.length=l+1,a}function br(r,e){for(var t=r;--e;)t*=r;return t}function ua(r,e){var t,n=e.s<0,i=nt(r,r.precision,1),s=i.times(.5);if(e=e.abs(),e.lte(s))return Tt=n?4:1,e;if(t=e.divToInt(i),t.isZero())Tt=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(s))return Tt=cs(t)?n?2:3:n?4:1,e;Tt=cs(t)?n?1:4:n?3:2}return e.minus(i).abs()}function ui(r,e,t,n){var i,s,a,o,u,c,l,d,m,f=r.constructor,w=t!==void 0;if(w?(Ue(t,1,Mt),n===void 0?n=f.rounding:Ue(n,0,8)):(t=f.precision,n=f.rounding),!r.isFinite())l=ca(r);else{for(l=gt(r),a=l.indexOf("."),w?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,a>=0&&(l=l.replace(".",""),m=new f(1),m.e=l.length-a,m.d=Kn(gt(m),10,i),m.e=m.d.length),d=Kn(l,10,i),s=u=d.length;d[--u]==0;)d.pop();if(!d[0])l=w?"0p+0":"0";else{if(a<0?s--:(r=new f(r),r.d=d,r.e=s,r=Ae(r,m,t,n,0,i),d=r.d,s=r.e,c=ea),a=d[t],o=i/2,c=c||d[t+1]!==void 0,c=n<4?(a!==void 0||c)&&(n===0||n===(r.s<0?3:2)):a>o||a===o&&(n===4||c||n===6&&d[t-1]&1||n===(r.s<0?8:7)),d.length=t,c)for(;++d[--t]>i-1;)d[t]=0,t||(++s,d.unshift(1));for(u=d.length;!d[u-1];--u);for(a=0,l="";a<u;a++)l+=Dr.charAt(d[a]);if(w){if(u>1)if(e==16||e==8){for(a=e==16?4:3,--u;u%a;u++)l+="0";for(d=Kn(l,i,e),u=d.length;!d[u-1];--u);for(a=1,l="1.";a<u;a++)l+=Dr.charAt(d[a])}else l=l.charAt(0)+"."+l.slice(1);l=l+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)l="0"+l;l="0."+l}else if(++s>u)for(s-=u;s--;)l+="0";else s<u&&(l=l.slice(0,s)+"."+l.slice(s))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function us(r,e){if(r.length>e)return r.length=e,!0}function Ou(r){return new this(r).abs()}function Eu(r){return new this(r).acos()}function Lu(r){return new this(r).acosh()}function Ru(r,e){return new this(r).plus(e)}function Pu(r){return new this(r).asin()}function xu(r){return new this(r).asinh()}function _u(r){return new this(r).atan()}function Nu(r){return new this(r).atanh()}function Mu(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,s=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=nt(this,s,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?nt(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=nt(this,s,1).times(.5),t.s=r.s):e.s<0?(this.precision=s,this.rounding=1,t=this.atan(Ae(r,e,s,1)),e=nt(this,s,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(Ae(r,e,s,1)),t}function Cu(r){return new this(r).cbrt()}function qu(r){return Y(r=new this(r),r.e+1,2)}function Fu(r,e,t){return new this(r).clamp(e,t)}function Wu(r){if(!r||typeof r!="object")throw Error(hr+"Object expected");var e,t,n,i=r.defaults===!0,s=["precision",1,Mt,"rounding",0,8,"toExpNeg",-an,0,"toExpPos",0,an,"maxE",0,an,"minE",-an,0,"modulo",0,9];for(e=0;e<s.length;e+=3)if(t=s[e],i&&(this[t]=Ur[t]),(n=r[t])!==void 0)if(qe(n)===n&&n>=s[e+1]&&n<=s[e+2])this[t]=n;else throw Error(_t+t+": "+n);if(t="crypto",i&&(this[t]=Ur[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(na);else this[t]=!1;else throw Error(_t+t+": "+n);return this}function Vu(r){return new this(r).cos()}function Du(r){return new this(r).cosh()}function la(r){var e,t,n;function i(s){var a,o,u,c=this;if(!(c instanceof i))return new i(s);if(c.constructor=i,ls(s)){c.s=s.s,ee?!s.d||s.e>i.maxE?(c.e=NaN,c.d=null):s.e<i.minE?(c.e=0,c.d=[0]):(c.e=s.e,c.d=s.d.slice()):(c.e=s.e,c.d=s.d?s.d.slice():s.d);return}if(u=typeof s,u==="number"){if(s===0){c.s=1/s<0?-1:1,c.e=0,c.d=[0];return}if(s<0?(s=-s,c.s=-1):c.s=1,s===~~s&&s<1e7){for(a=0,o=s;o>=10;o/=10)a++;ee?a>i.maxE?(c.e=NaN,c.d=null):a<i.minE?(c.e=0,c.d=[0]):(c.e=a,c.d=[s]):(c.e=a,c.d=[s]);return}else if(s*0!==0){s||(c.s=NaN),c.e=NaN,c.d=null;return}return Xr(c,s.toString())}else if(u!=="string")throw Error(_t+s);return(o=s.charCodeAt(0))===45?(s=s.slice(1),c.s=-1):(o===43&&(s=s.slice(1)),c.s=1),ia.test(s)?Xr(c,s):vu(c,s)}if(i.prototype=M,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Wu,i.clone=la,i.isDecimal=ls,i.abs=Ou,i.acos=Eu,i.acosh=Lu,i.add=Ru,i.asin=Pu,i.asinh=xu,i.atan=_u,i.atanh=Nu,i.atan2=Mu,i.cbrt=Cu,i.ceil=qu,i.clamp=Fu,i.cos=Vu,i.cosh=Du,i.div=Uu,i.exp=Gu,i.floor=zu,i.hypot=Xu,i.ln=$u,i.log=Yu,i.log10=Qu,i.log2=Hu,i.max=Zu,i.min=ju,i.mod=Ku,i.mul=Ju,i.pow=el,i.random=tl,i.round=nl,i.sign=rl,i.sin=il,i.sinh=sl,i.sqrt=al,i.sub=ol,i.sum=cl,i.tan=ul,i.tanh=ll,i.trunc=dl,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Uu(r,e){return new this(r).div(e)}function Gu(r){return new this(r).exp()}function zu(r){return Y(r=new this(r),r.e+1,3)}function Xu(){var r,e,t=new this(0);for(ee=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return ee=!0,new this(1/0);t=e}return ee=!0,t.sqrt()}function ls(r){return r instanceof H||r&&r.toStringTag===ra||!1}function $u(r){return new this(r).ln()}function Yu(r,e){return new this(r).log(e)}function Hu(r){return new this(r).log(2)}function Qu(r){return new this(r).log(10)}function Zu(){return oa(this,arguments,"lt")}function ju(){return oa(this,arguments,"gt")}function Ku(r,e){return new this(r).mod(e)}function Ju(r,e){return new this(r).mul(e)}function el(r,e){return new this(r).pow(e)}function tl(r){var e,t,n,i,s=0,a=new this(1),o=[];if(r===void 0?r=this.precision:Ue(r,1,Mt),n=Math.ceil(r/j),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));s<n;)i=e[s],i>=429e7?e[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);s<n;)i=e[s]+(e[s+1]<<8)+(e[s+2]<<16)+((e[s+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,s):(o.push(i%1e7),s+=4);s=n/4}else throw Error(na);else for(;s<n;)o[s++]=Math.random()*1e7|0;for(n=o[--s],r%=j,n&&r&&(i=Le(10,j-r),o[s]=(n/i|0)*i);o[s]===0;s--)o.pop();if(s<0)t=0,o=[0];else{for(t=-1;o[0]===0;t-=j)o.shift();for(n=1,i=o[0];i>=10;i/=10)n++;n<j&&(t-=j-n)}return a.e=t,a.d=o,a}function nl(r){return Y(r=new this(r),r.e+1,this.rounding)}function rl(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function il(r){return new this(r).sin()}function sl(r){return new this(r).sinh()}function al(r){return new this(r).sqrt()}function ol(r,e){return new this(r).sub(e)}function cl(){var r=0,e=arguments,t=new this(e[r]);for(ee=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return ee=!0,Y(t,this.precision,this.rounding)}function ul(r){return new this(r).tan()}function ll(r){return new this(r).tanh()}function dl(r){return Y(r=new this(r),r.e+1,1)}M[Symbol.for("nodejs.util.inspect.custom")]=M.toString;M[Symbol.toStringTag]="Decimal";var H=M.constructor=la(Ur);cr=new H(cr);ur=new H(ur);const ot={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]};function ml(r,e,t,n,i,s,a,o,u,c,l,d,m,f){const w=W([K("sqrtPriceX64"),b("startTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1}],h=N.alloc(w.span);w.encode({sqrtPriceX64:m,startTime:f},h);const p=N.from([...ot.createPool,...h]);return new ne({keys:g,programId:r,data:p})}function fl(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h,p,A,k,S,T,y,I,E,v){const L=W([Fe("tickLowerIndex"),Fe("tickUpperIndex"),Fe("tickArrayLowerStartIndex"),Fe("tickArrayUpperStartIndex"),K("liquidity"),b("amountMaxA"),b("amountMaxB"),st("withMetadata"),V("optionBaseFlag"),st("baseFlag")]),x=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[]],q=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mn,isSigner:!1,isWritable:!1},{pubkey:rr,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...x],X=N.alloc(L.span);L.encode({tickLowerIndex:p,tickUpperIndex:A,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:S,liquidity:T,amountMaxA:y,amountMaxB:I,withMetadata:E==="create",baseFlag:!1,optionBaseFlag:0},X);const U=N.from([...ot.openPosition,...X]);return new ne({keys:q,programId:r,data:U})}function pl(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h,p,A,k,S,T,y,I,E,v){const L=W([Fe("tickLowerIndex"),Fe("tickUpperIndex"),Fe("tickArrayLowerStartIndex"),Fe("tickArrayUpperStartIndex"),K("liquidity"),b("amountMaxA"),b("amountMaxB"),st("withMetadata"),V("optionBaseFlag"),st("baseFlag")]),x=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[]],q=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mn,isSigner:!1,isWritable:!1},{pubkey:rr,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...x],X=N.alloc(L.span);L.encode({tickLowerIndex:p,tickUpperIndex:A,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:S,liquidity:$,amountMaxA:y==="MintA"?I:E,amountMaxB:y==="MintA"?E:I,withMetadata:T==="create",baseFlag:y==="MintA",optionBaseFlag:1},X);const U=N.from([...ot.openPosition,...X]);return new ne({keys:q,programId:r,data:U})}function gl(r,e,t,n,i){const s=W([]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:_,isSigner:!1,isWritable:!1}],o=N.alloc(s.span);s.encode({},o);const u=N.from([...ot.closePosition,...o]);return new ne({keys:a,programId:r,data:u})}function wl(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h,p){const A=W([K("liquidity"),b("amountMaxA"),b("amountMaxB"),V("optionBaseFlag"),st("baseFlag")]),k=[...p?[{pubkey:p,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...k],T=N.alloc(A.span);A.encode({liquidity:w,amountMaxA:g,amountMaxB:h,optionBaseFlag:0,baseFlag:!1},T);const y=N.from([...ot.increaseLiquidity,...T]);return new ne({keys:S,programId:r,data:y})}function Al(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h,p){const A=W([K("liquidity"),b("amountMaxA"),b("amountMaxB"),V("optionBaseFlag"),st("baseFlag")]),k=[...p?[{pubkey:p,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...k],T=N.alloc(A.span);A.encode({liquidity:$,amountMaxA:w==="MintA"?g:h,amountMaxB:w==="MintA"?h:g,baseFlag:w==="MintA",optionBaseFlag:1},T);const y=N.from([...ot.increaseLiquidity,...T]);return new ne({keys:S,programId:r,data:y})}function hl(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h,p,A){const k=W([K("liquidity"),b("amountMinA"),b("amountMinB")]),S=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...w.map(E=>[{pubkey:E.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:E.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:E.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ri,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...S],y=N.alloc(k.span);k.encode({liquidity:g,amountMinA:h,amountMinB:p},y);const I=N.from([...ot.decreaseLiquidity,...y]);return new ne({keys:T,programId:r,data:I})}function ds(r,e,t,n,i,s,a,o,u,c,l,d,m,f,w,g,h){const p=W([b("amount"),b("otherAmountThreshold"),K("sqrtPriceLimitX64"),st("isBaseInput")]),A=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...l.map(y=>({pubkey:y,isSigner:!1,isWritable:!0}))],k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ri,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...A],S=N.alloc(p.span);p.encode({amount:m,otherAmountThreshold:f,sqrtPriceLimitX64:w,isBaseInput:g},S);const T=N.from([...ot.swap,...S]);return new ne({keys:k,programId:r,data:T})}function kl(r,e,t,n,i,s,a,o,u,c,l,d){const m=W([b("openTime"),b("endTime"),K("emissionsPerSecondX64")]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1}],w=N.alloc(m.span);m.encode({openTime:z(c),endTime:z(l),emissionsPerSecondX64:d},w);const g=N.from([...ot.initReward,...w]);return new ne({keys:f,programId:r,data:g})}function bl(r,e,t,n,i,s,a,o,u,c,l,d){const m=W([V("rewardIndex"),K("emissionsPerSecondX64"),b("openTime"),b("endTime")]),f=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0}],w=N.alloc(m.span);m.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:z(c),endTime:z(l)},w);const g=N.from([...ot.setRewardEmissions,...w]);return new ne({keys:f,programId:r,data:g})}function Tl(r,e,t,n,i,s,a){const o=W([V("rewardIndex")]),u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ri,isSigner:!1,isWritable:!1}],c=N.alloc(o.span);o.encode({rewardIndex:a},c);const l=N.from([...ot.collectReward,...c]);return new ne({keys:u,programId:r,data:l})}const Vt=new B(-1),$t=new B(1).shln(64),$r=new B(1).shln(128),ms=$t.sub(Te),dr=64,yl=$r.subn(1),Ze=-443636,it=-Ze,Gt=new B("4295048016"),zt=new B("79226673521066979257578248091"),Sl=16,Il="59543866431248",vl="184467440737095516",Bl="15793534762490258745",Lr=new B(10).pow(new B(6));var In;(function(r){r[r.rate_500=500]="rate_500",r[r.rate_3000=3e3]="rate_3000",r[r.rate_10000=1e4]="rate_10000"})(In||(In={}));In.rate_500+"",In.rate_3000+"",In.rate_10000+"";const Rr=new B("18446744073700000000");function Yr(r){const e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function da(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function ma(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function mr(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function Ol(r,e){return mr(r,e)?null:da(r,e)}function El(r,e){return mr(r,e)?null:ma(r,e)}N.from("amm_config","utf8");const Ll=N.from("pool","utf8"),Rl=N.from("pool_vault","utf8"),Pl=N.from("pool_reward_vault","utf8"),fa=N.from("position","utf8"),xl=N.from("tick_array","utf8"),_l=N.from("operation","utf8"),Nl=N.from("pool_tick_array_bitmap_extension","utf8");function Ml(r,e,t,n){return de([Ll,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function fs(r,e,t){return de([Rl,e.toBuffer(),t.toBuffer()],r)}function Cl(r,e,t){return de([Pl,e.toBuffer(),t.toBuffer()],r)}function Se(r,e,t){return de([xl,e.toBuffer(),Yr(t)],r)}function hn(r,e,t,n){return de([fa,e.toBuffer(),Yr(t),Yr(n)],r)}function qt(r,e){return de([fa,e.toBuffer()],r)}function ps(r){return de([N.from("metadata","utf8"),rr.toBuffer(),r.toBuffer()],rr)}function Pr(r){return de([_l],r)}function ht(r,e){return de([Nl,e.toBuffer()],r)}const ql=15;class ge{static async getTickArrays(e,t,n,i,s,a,o){const u=[],c=te.getTickArrayStartIndexByTick(i,s),l=te.getInitializedTickArrayInRange(a,o,s,c,Math.floor(ql/2));for(let f=0;f<l.length;f++){const{publicKey:w}=Se(t,n,l[f]);u.push(w)}const d=(await bt(e,u)).map(f=>f!==null?Hr.decode(f.data):null),m={};for(let f=0;f<u.length;f++){const w=d[f];w!==null&&(m[w.startTickIndex]={...w,address:u[f]})}return m}static nextInitializedTick(e,t,n,i,s,a){let{initializedTick:o,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,s,a);for(;o==null||o.liquidityGross.lten(0);){if(c=te.getNextTickArrayStartIndex(c,s,a),this.checkIsValidStartIndex(c,s))throw new Error("No enough initialized tickArray");const l=n[c];if(l===void 0)continue;const{nextTick:d,tickArrayAddress:m,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,a);[o,u,c]=[d,m,f]}if(o==null)throw new Error("No invaild tickArray cache");return{nextTick:o,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,s){const a=Math.floor(e/ge.tickCount(t)),o=n?te.searchLowBitFromStart(i,s,a-1,1,t):te.searchHightBitFromStart(i,s,a+1,1,t);return o.length>0?{isExist:!0,nextStartIndex:o[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let s;if(i){let o=Me-1;for(;o>=0;){const u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o-1}}else{let o=0;for(;o<Me;){const u=n.ticks[o];if(u.liquidityGross.gtn(0)){s=u;break}o=o+1}}const{publicKey:a}=Se(e,t,n.startTickIndex);return{nextTick:s,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,s,a){const o=te.getTickArrayStartIndexByTick(i,s);let u=Math.floor((i-o)/s);const c=n[o];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:o};let l;if(a)for(;u>=0;){const m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u-1}else for(u=u+1;u<Me;){const m=c.ticks[u];if(m.liquidityGross.gtn(0)){l=m;break}u=u+1}const{publicKey:d}=Se(e,t,o);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){const n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(te.checkIsOutOfBoundary(e)){if(e>it)return!1;const n=te.getTickArrayStartIndexByTick(Ze,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Me*e}}const Me=60,Pn=512;class te{static getTickArrayAddressByTick(e,t,n,i){const s=te.getTickArrayStartIndexByTick(n,i),{publicKey:a}=Se(e,t,s);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");const n=te.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Me)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){const n=ge.tickCount(t);let i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ge.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){const n=t*Me,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){const i=n*Me,s=Math.floor(t/i)+512,a=Math.abs(s);return{isInitialized:e.testn(a),startIndex:(a-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Me:e+t*Me}static mergeTickArrayBitmap(e){let t=new B(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,s){const a=Math.floor(i/(n*Me));return[...te.searchLowBitFromStart(e,t,a-1,s,n),...te.searchHightBitFromStart(e,t,a,s,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return te.searchHightBitFromStart(e,t,0,Pn,n)}static getAllInitializedTickArrayInfo(e,t,n,i,s){const a=[],o=te.getAllInitializedTickArrayStartIndex(n,i,s);for(const u of o){const{publicKey:c}=Se(e,t,u);a.push({tickArrayStartIndex:u,tickArrayAddress:c})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,s){const a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>te.mergeTickArrayBitmap(c)),o=[];for(;n>=-7680;){const c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&o.push(n),n--,o.length===i)break}const u=ge.tickCount(s);return o.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,s){const a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>te.mergeTickArrayBitmap(c)),o=[];for(;n<7680;){const c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&o.push(n),n++,o.length===i)break}const u=ge.tickCount(s);return o.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ze||e>it}static nextInitTick(e,t,n,i,s){if(ge.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let o=Math.floor((t-e.startTickIndex)/n);if(i)for(;o>=0;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o-1}else for(s||(o=o+1);o<Me;){if(e.ticks[o].liquidityGross.gtn(0))return e.ticks[o];o=o+1}return null}static firstInitializedTick(e,t){if(t){let n=Me-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Me;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error("firstInitializedTick check error: ".concat(e," - ").concat(t))}}const fr=14;class on{static maxTickInTickarrayBitmap(e){return e*Me*Pn}static getBitmapTickBoundary(e,t){const n=this.maxTickInTickarrayBitmap(t);let i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);const s=n*i;return e<0?{minValue:-s,maxValue:-s+n}:{minValue:s,maxValue:s+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!ge.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");const s=this.maxTickInTickarrayBitmap(n),a=i?t-ge.tickCount(n):t+ge.tickCount(n);if(a<-s||a>=s)return{isInit:!1,tickIndex:t};const o=n*Me;let u=a/o+512;a<0&&a%o!=0&&u--;const c=Math.abs(u);if(i){const l=e.shln(1024-c-1),d=Ol(1024,l);return d!==null?{isInit:!0,tickIndex:(c-d-512)*o}:{isInit:!1,tickIndex:-s}}else{const l=e.shrn(c),d=El(1024,l);return d!==null?{isInit:!0,tickIndex:(c+d-512)*o}:{isInit:!1,tickIndex:s-ge.tickCount(n)}}}}class gs{static getBitmapOffset(e,t){if(!ge.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);const n=on.maxTickInTickarrayBitmap(t);let i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){const i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){const{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){const t=on.maxTickInTickarrayBitmap(e),n=-t;if(it<=t)throw Error("extensionTickBoundary check error: ".concat(it,", ").concat(t));if(n<=Ze)throw Error("extensionTickBoundary check error: ".concat(n,", ").concat(Ze));return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){const{tickarrayBitmap:i}=this.getBitmap(e,t,n),s=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:te.mergeTickArrayBitmap(i).testn(s),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){const s=ge.tickCount(t),a=n?e-s:e+s,o=ge.getArrayStartIndex(Ze,t),u=ge.getArrayStartIndex(it,t);if(a<o||a>u)return{isInit:!1,tickIndex:a};const{tickarrayBitmap:c}=this.getBitmap(a,t,i);return this.nextInitializedTickArrayInBitmap(c,a,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){const{minValue:s,maxValue:a}=on.getBitmapTickBoundary(t,n),o=this.tickArrayOffsetInBitmap(t,n);if(i){const u=te.mergeTickArrayBitmap(e).shln(Pn-1-o),c=mr(512,u)?null:da(512,u);return c!==null?{isInit:!0,tickIndex:t-c*ge.tickCount(n)}:{isInit:!1,tickIndex:s}}else{const u=te.mergeTickArrayBitmap(e).shrn(o),c=mr(512,u)?null:ma(512,u);return c!==null?{isInit:!0,tickIndex:t+c*ge.tickCount(n)}:{isInit:!1,tickIndex:a-ge.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){const n=Math.abs(e)%on.maxTickInTickarrayBitmap(t);let i=Math.floor(n/ge.tickCount(t));return e<0&&n!=0&&(i=Pn-i),i}}W([Oe(8),V("bump"),Sn("index"),C(""),He("protocolFeeRate"),He("tradeFeeRate"),Sn("tickSpacing"),He("fundFeeRate"),Z(He(),1,"padding"),C("fundOwner"),Z(b(),3,"padding")]);const Fl=W([He("blockTimestamp"),K("sqrtPriceX64"),K("cumulativeTimePriceX64"),Z(K(),1,"")]),ws=W([Oe(8),st("initialized"),C("poolId"),Z(Fl,1e3,"observations"),Z(K(),5,"")]),Wl=W([V("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),K("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),C("tokenMint"),C("tokenVault"),C("creator"),K("rewardGrowthGlobalX64")]),Vl=W([Oe(8),V("bump"),C("ammConfig"),C("creator"),C("mintA"),C("mintB"),C("vaultA"),C("vaultB"),C("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),Sn("tickSpacing"),K("liquidity"),K("sqrtPriceX64"),Fe("tickCurrent"),Sn("observationIndex"),Sn("observationUpdateDuration"),K("feeGrowthGlobalX64A"),K("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),K("swapInAmountTokenA"),K("swapOutAmountTokenB"),K("swapInAmountTokenB"),K("swapOutAmountTokenA"),V("status"),Z(V(),7,""),Z(Wl,3,"rewardInfos"),Z(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),Z(b(),15*4-3,"padding")]),Dl=W([K("growthInsideLastX64"),b("rewardAmountOwed")]),Ul=W([Oe(8),V("bump"),C("nftMint"),C("poolId"),Fe("tickLower"),Fe("tickUpper"),K("liquidity"),K("feeGrowthInsideLastX64A"),K("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),Z(Dl,3,"rewardInfos"),Z(b(),8,"")]);W([Oe(8),V("bump"),C("poolId"),Fe("tickLowerIndex"),Fe("tickUpperIndex"),K("liquidity"),K("feeGrowthInsideLastX64A"),K("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),Z(K(),3,"rewardGrowthInside"),Z(b(),8,"")]);const Gl=W([Fe("tick"),Xc("liquidityNet"),K("liquidityGross"),K("feeGrowthOutsideX64A"),K("feeGrowthOutsideX64B"),Z(K(),3,"rewardGrowthsOutsideX64"),Z(He(),13,"")]),Hr=W([Oe(8),C("poolId"),Fe("startTickIndex"),Z(Gl,Me,"ticks"),V("initializedTickCount"),Z(V(),115,"")]),zl=W([Oe(329),Z(C(),100,"whitelistMints")]),Xl=W([Oe(8),C("poolId"),Z(Z(b(),8),fr,"positiveTickArrayBitmap"),Z(Z(b(),8),fr,"negativeTickArrayBitmap")]);class et{static getOutputAmountAndRemainAccounts(e,t,n,i,s,a=!1){const o=n.equals(e.mintA.mint),u=[],{isExist:c,startIndex:l,nextAccountMeta:d}=this.getFirstInitializedTickArray(e,o);if(!c||l===void 0||!d)throw new Error("Invalid tick array");try{const A=this.preInitializedTickArrayStartIndex(e,o);if(A.isExist){const{publicKey:k}=Se(e.programId,e.id,A.nextStartIndex);u.push(k)}}catch(A){}u.push(d);const{allTrade:m,amountSpecifiedRemaining:f,amountCalculated:w,accounts:g,sqrtPriceX64:h,feeAmount:p}=pr.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,o,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,s,a);return u.push(...g),{allTrade:m,realTradeAmountIn:i.sub(f),expectedAmountOut:w.mul(Vt),remainingAccounts:u,executionPrice:h,feeAmount:p}}static getInputAmountAndRemainAccounts(e,t,n,i,s){const a=n.equals(e.mintB.mint),o=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{const g=this.preInitializedTickArrayStartIndex(e,a);if(g.isExist){const{publicKey:h}=Se(e.programId,e.id,g.nextStartIndex);o.push(h)}}catch(g){}o.push(l);const{amountCalculated:d,accounts:m,sqrtPriceX64:f,feeAmount:w}=pr.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(Vt),c,s);return o.push(...m),{expectedAmountIn:d,remainingAccounts:o,executionPrice:f,feeAmount:w}}static getFirstInitializedTickArray(e,t){const{isInitialized:n,startIndex:i}=et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?gs.checkTickArrayIsInit(ge.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):te.checkTickArrayIsInitialized(te.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){const{publicKey:o}=Se(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:o}}const{isExist:s,nextStartIndex:a}=this.nextInitializedTickArrayStartIndex(e,ge.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(s){const{publicKey:o}=Se(e.programId,e.id,a);return{isExist:!0,startIndex:a,nextAccountMeta:o}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){const n=Math.floor(e.tickCurrent/ge.tickCount(e.tickSpacing)),i=t?te.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):te.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ge.getArrayStartIndex(t,e.tickSpacing);;){const{isInit:i,tickIndex:s}=on.nextInitializedTickArrayStartIndex(te.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:s};t=s;const{isInit:a,tickIndex:o}=gs.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(a)return{isExist:!0,nextStartIndex:o};if(t=o,t<Ze||t>it)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:s}){var o,u,c;const a=[];for(let l=0;l<s.length;l++){const d=s[l],m=(c=(o=t.rewardInfos[l])==null?void 0:o.programId)!=null?c:(u=await e.getAccountInfo(d.tokenMint))==null?void 0:u.owner;if(m===void 0)throw Error("get new reward mint info error");const f={...d,perSecond:oe.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new P(m)};if(f.tokenMint.equals(P.default))continue;if(n<=f.openTime.toNumber()||i.eq($)){a.push(f);continue}const w=new B(Math.min(f.endTime.toNumber(),n)),g=w.sub(f.lastUpdateTime),h=oe.mulDivFloor(g,f.emissionsPerSecondX64,i),p=f.rewardGrowthGlobalX64.add(h),A=oe.mulDivFloor(g,f.emissionsPerSecondX64,$t),k=f.rewardTotalEmissioned.add(A);a.push({...f,rewardGrowthGlobalX64:p,rewardTotalEmissioned:k,lastUpdateTime:w})}return a}static isOverflowDefaultTickarrayBitmap(e,t){const{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(const s of t){const a=te.getTickArrayStartIndexByTick(s,e);if(a>=n||a<i)return!0}return!1}static tickRange(e){let t=on.maxTickInTickarrayBitmap(e),n=-t;return t>it&&(t=it),n<Ze&&(n=Ze),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ge.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ge.tickCount(t)*Pn}}class oe{static mulDivRoundingUp(e,t,n){const i=e.mul(t);let s=i.div(n);return i.mod(n).eq($)||(s=s.add(Te)),s}static mulDivFloor(e,t,n){if(n.eq($))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq($))throw new Error("division by 0");return e.mul(t).add(n.sub(Te)).div(n)}static x64ToDecimal(e,t){return new H(e.toString()).div(H.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new B(e.mul(H.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add($r).sub(t).mod($r)}}function xe(r,e){return Qr(r.mul(e),64,256)}function $l(r,e,t){const n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Qr(r,e,t){const n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}class ce{static sqrtPriceX64ToPrice(e,t,n){return oe.x64ToDecimal(e).pow(2).mul(H.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return oe.decimalToX64(e.mul(H.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt($))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt($))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt($))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt($))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq($))return e;const s=t.shln(dr);if(i){const a=s,o=s.add(n.mul(e));return o.gte(a)?oe.mulDivCeil(a,e,o):oe.mulDivRoundingUp(a,Te,a.div(e).add(n))}else{const a=n.mul(e);if(!s.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");const o=s.sub(a);return oe.mulDivCeil(s,e,o)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){const s=n.shln(dr);if(i)return e.add(s.div(t));{const a=oe.mulDivRoundingUp(s,Te,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ze||e>it)throw new Error("tick must be in MIN_TICK and MAX_TICK");const t=e<0?e*-1:e;let n=t&1?new B("18445821805675395072"):new B("18446744073709551616");return t&2&&(n=xe(n,new B("18444899583751176192"))),t&4&&(n=xe(n,new B("18443055278223355904"))),t&8&&(n=xe(n,new B("18439367220385607680"))),t&16&&(n=xe(n,new B("18431993317065453568"))),t&32&&(n=xe(n,new B("18417254355718170624"))),t&64&&(n=xe(n,new B("18387811781193609216"))),t&128&&(n=xe(n,new B("18329067761203558400"))),t&256&&(n=xe(n,new B("18212142134806163456"))),t&512&&(n=xe(n,new B("17980523815641700352"))),t&1024&&(n=xe(n,new B("17526086738831433728"))),t&2048&&(n=xe(n,new B("16651378430235570176"))),t&4096&&(n=xe(n,new B("15030750278694412288"))),t&8192&&(n=xe(n,new B("12247334978884435968"))),t&16384&&(n=xe(n,new B("8131365268886854656"))),t&32768&&(n=xe(n,new B("3584323654725218816"))),t&65536&&(n=xe(n,new B("696457651848324352"))),t&131072&&(n=xe(n,new B("26294789957507116"))),t&262144&&(n=xe(n,new B("37481735321082"))),e>0&&(n=yl.div(n)),n}static getTickFromPrice(e,t,n){return ce.getTickFromSqrtPriceX64(ce.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(zt)||e.lt(Gt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");const t=e.bitLength()-1,n=new B(t-64),i=$l(n,32,128);let s=new B("8000000000000000","hex"),a=0,o=new B(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;s.gt(new B(0))&&a<Sl;){u=u.mul(u);const w=u.shrn(127);u=u.shrn(63+w.toNumber()),o=o.add(s.mul(w)),s=s.shrn(1),a+=1}const c=o.shrn(32),d=i.add(c).mul(new B(Il)),m=Qr(d.sub(new B(vl)),64,128).toNumber(),f=Qr(d.add(new B(Bl)),64,128).toNumber();return m==f?m:ce.getSqrtPriceX64FromTick(f).lte(e)?f:m}}class li{static getTickWithPriceAndTickspacing(e,t,n,i){let a=ce.getTickFromSqrtPriceX64(ce.priceToSqrtPriceX64(e,n,i))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,i){const s=li.getTickWithPriceAndTickspacing(e,t,n,i),a=ce.getSqrtPriceX64FromTick(s);return ce.sqrtPriceX64ToPrice(a,n,i)}}class fe{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt($))throw new Error("sqrtPriceX64A must greater than 0");const s=n.ushln(dr),a=t.sub(e);return i?oe.mulDivRoundingUp(oe.mulDivCeil(s,a,t),Te,e):oe.mulDivFloor(s,a,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt($))throw new Error("sqrtPriceX64A must greater than 0");return i?oe.mulDivCeil(n,t.sub(e),$t):oe.mulDivFloor(n,t.sub(e),$t)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);const s=n.mul(e).mul(t),a=t.sub(e),o=s.div(a);return i?oe.mulDivRoundingUp(o,Te,ms):o.shrn(dr)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),oe.mulDivFloor(n,ms,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return fe.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){const a=fe.getLiquidityFromTokenAmountA(e,n,i,!1),o=fe.getLiquidityFromTokenAmountB(t,e,s);return a.lt(o)?a:o}else return fe.getLiquidityFromTokenAmountB(t,n,s)}static getAmountsFromLiquidity(e,t,n,i,s){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:fe.getTokenAmountAFromLiquidity(t,n,i,s),amountB:new B(0)};if(e.lt(n)){const a=fe.getTokenAmountAFromLiquidity(e,n,i,s),o=fe.getTokenAmountBFromLiquidity(t,e,i,s);return{amountA:a,amountB:o}}else return{amountA:new B(0),amountB:fe.getTokenAmountBFromLiquidity(t,n,i,s)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,s,a,o){const{amountA:u,amountB:c}=fe.getAmountsFromLiquidity(e,t,n,i,a),l=s?1+o:1-o,d=new B(new H(u.toString()).mul(l).toFixed(0)),m=new B(new H(c.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:m}}}class pr{static swapCompute(e,t,n,i,s,a,o,u,c,l,d,m,f,w,g=!1){if(m.eq($))throw new Error("amountSpecified must not be 0");if(w||(w=a?Gt.add(Te):zt.sub(Te)),a){if(w.lt(Gt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(w.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(w.gt(zt))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(w.lte(d))throw new Error("sqrtPriceX64 must greater than current")}const h=m.gt($),p={amountSpecifiedRemaining:m,amountCalculated:$,sqrtPriceX64:d,tick:c>f?Math.min(f+ge.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new B(0)};let A=f,k=n[f],S=!a&&k.startTickIndex===p.tick;for(;!p.amountSpecifiedRemaining.eq($)&&!p.sqrtPriceX64.eq(w);){const T={};T.sqrtPriceStartX64=p.sqrtPriceX64;const y=te.nextInitTick(k,p.tick,l,a,S);let I=y||null,E=null;if(!(I!=null&&I.liquidityGross.gtn(0))){const L=et.nextInitializedTickArrayStartIndex({tickCurrent:p.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:s},A,a);if(!L.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:p.amountSpecifiedRemaining,amountCalculated:p.amountCalculated,feeAmount:p.feeAmount,sqrtPriceX64:p.sqrtPriceX64,liquidity:p.liquidity,tickCurrent:p.tick,accounts:p.accounts};throw Error("swapCompute LiquidityInsufficient")}A=L.nextStartIndex;const{publicKey:x}=Se(e,t,A);E=x,k=n[A];try{I=te.firstInitializedTick(k,a)}catch(q){throw Error("not found next tick info")}}T.tickNext=I.tick,T.initialized=I.liquidityGross.gtn(0),f!==A&&E&&(p.accounts.push(E),f=A),T.tickNext<Ze?T.tickNext=Ze:T.tickNext>it&&(T.tickNext=it),T.sqrtPriceNextX64=ce.getSqrtPriceX64FromTick(T.tickNext);let v;if(a&&T.sqrtPriceNextX64.lt(w)||!a&&T.sqrtPriceNextX64.gt(w)?v=w:v=T.sqrtPriceNextX64,[p.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=pr.swapStepCompute(p.sqrtPriceX64,v,p.liquidity,p.amountSpecifiedRemaining,o),p.feeAmount=p.feeAmount.add(T.feeAmount),h?(p.amountSpecifiedRemaining=p.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),p.amountCalculated=p.amountCalculated.sub(T.amountOut)):(p.amountSpecifiedRemaining=p.amountSpecifiedRemaining.add(T.amountOut),p.amountCalculated=p.amountCalculated.add(T.amountIn.add(T.feeAmount))),p.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let L=I.liquidityNet;a&&(L=L.mul(Vt)),p.liquidity=fe.addDelta(p.liquidity,L)}S=T.tickNext!=p.tick&&!a&&k.startTickIndex===T.tickNext,p.tick=a?T.tickNext-1:T.tickNext}else if(p.sqrtPriceX64!=T.sqrtPriceStartX64){const L=ce.getTickFromSqrtPriceX64(p.sqrtPriceX64);S=L!=p.tick&&!a&&k.startTickIndex===L,p.tick=L}}try{const{nextStartIndex:T,isExist:y}=ge.nextInitializedTickArray(p.tick,l,a,i,s);y&&f!==T&&(p.accounts.push(Se(e,t,T).publicKey),f=T)}catch(T){}return{allTrade:!0,amountSpecifiedRemaining:$,amountCalculated:p.amountCalculated,feeAmount:p.feeAmount,sqrtPriceX64:p.sqrtPriceX64,liquidity:p.liquidity,tickCurrent:p.tick,accounts:p.accounts}}static swapStepCompute(e,t,n,i,s){const a={sqrtPriceX64Next:new B(0),amountIn:new B(0),amountOut:new B(0),feeAmount:new B(0)},o=e.gte(t),u=i.gte($);if(u){const l=oe.mulDivFloor(i,Lr.sub(new B(s.toString())),Lr);a.amountIn=o?fe.getTokenAmountAFromLiquidity(t,e,n,!0):fe.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(a.amountIn)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=ce.getNextSqrtPriceX64FromInput(e,n,l,o)}else a.amountOut=o?fe.getTokenAmountBFromLiquidity(t,e,n,!1):fe.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(Vt).gte(a.amountOut)?a.sqrtPriceX64Next=t:a.sqrtPriceX64Next=ce.getNextSqrtPriceX64FromOutput(e,n,i.mul(Vt),o);const c=t.eq(a.sqrtPriceX64Next);return o?(c&&u||(a.amountIn=fe.getTokenAmountAFromLiquidity(a.sqrtPriceX64Next,e,n,!0)),c&&!u||(a.amountOut=fe.getTokenAmountBFromLiquidity(a.sqrtPriceX64Next,e,n,!1))):(a.amountIn=c&&u?a.amountIn:fe.getTokenAmountBFromLiquidity(e,a.sqrtPriceX64Next,n,!0),a.amountOut=c&&!u?a.amountOut:fe.getTokenAmountAFromLiquidity(e,a.sqrtPriceX64Next,n,!1)),!u&&a.amountOut.gt(i.mul(Vt))&&(a.amountOut=i.mul(Vt)),u&&!a.sqrtPriceX64Next.eq(t)?a.feeAmount=i.sub(a.amountIn):a.feeAmount=oe.mulDivCeil(a.amountIn,new B(s),Lr.sub(new B(s))),[a.sqrtPriceX64Next,a.amountIn,a.amountOut,a.feeAmount]}}class As{static getfeeGrowthInside(e,t,n){let i=new B(0),s=new B(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,s=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let a=new B(0),o=new B(0);e.tickCurrent<n.tick?(a=n.feeGrowthOutsideX64A,o=n.feeGrowthOutsideX64B):(a=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));const u=oe.wrappingSubU128(oe.wrappingSubU128(e.feeGrowthGlobalX64A,i),a),c=oe.wrappingSubU128(oe.wrappingSubU128(e.feeGrowthGlobalX64B,s),o);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){const{feeGrowthInsideX64A:s,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,i),o=oe.mulDivFloor(oe.wrappingSubU128(s,t.feeGrowthInsideLastX64A),t.liquidity,$t),u=t.tokenFeesOwedA.add(o),c=oe.mulDivFloor(oe.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,$t),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewards(e,t,n,i){const s=[],a=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let o=0;o<a.length;o++){const u=a[o],c=t.rewardInfos[o],l=oe.wrappingSubU128(u,c.growthInsideLastX64),d=oe.mulDivFloor(l,t.liquidity,$t),m=c.rewardAmountOwed.add(d);s.push(m)}return s}static getRewardGrowthInside(e,t,n,i){const s=[];for(let a=0;a<i.length;a++){let o=new B(0);t.liquidityGross.eqn(0)?o=i[a].rewardGrowthGlobalX64:e<t.tick?o=i[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):o=t.rewardGrowthsOutsideX64[a];let u=new B(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=i[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),s.push(oe.wrappingSubU128(oe.wrappingSubU128(i[a].rewardGrowthGlobalX64,o),u))}return s}}const ye=se.from("Clmm");class Yl extends Ar{static makeMockPoolInfo({programId:e,mint1:t,mint2:n,ammConfig:i,createPoolInstructionSimpleAddress:s,initialPrice:a,startTime:o,owner:u}){const[c,l,d]=new B(t.mint.toBuffer()).gt(new B(n.mint.toBuffer()))?[n,t,new H(1).div(a)]:[t,n,a],m=ce.priceToSqrtPriceX64(d,c.decimals,l.decimals);return{id:s.poolId,mintA:{programId:s.mintProgramIdA,mint:s.mintA,vault:s.mintAVault,decimals:c.decimals},mintB:{programId:s.mintProgramIdB,mint:s.mintB,vault:s.mintBVault,decimals:l.decimals},ammConfig:i,observationId:s.observationId,creator:u,programId:e,version:6,tickSpacing:i.tickSpacing,liquidity:$,sqrtPriceX64:m,currentPrice:d,tickCurrent:0,observationIndex:0,observationUpdateDuration:0,feeGrowthGlobalX64A:$,feeGrowthGlobalX64B:$,protocolFeesTokenA:$,protocolFeesTokenB:$,swapInAmountTokenA:$,swapOutAmountTokenB:$,swapInAmountTokenB:$,swapOutAmountTokenA:$,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0,lookupTableAccount:P.default,startTime:o.toNumber(),exBitmapInfo:{poolId:s.poolId,positiveTickArrayBitmap:Array.from({length:fr},()=>Array.from({length:8},()=>new B(0))),negativeTickArrayBitmap:Array.from({length:fr},()=>Array.from({length:8},()=>new B(0)))}}}static async makeCreatePoolInstructionSimple({makeTxVersion:e,connection:t,programId:n,owner:i,payer:s,mint1:a,mint2:o,ammConfig:u,initialPrice:c,startTime:l,computeBudgetConfig:d,lookupTableCache:m}){const[f,w,g]=new B(a.mint.toBuffer()).gt(new B(o.mint.toBuffer()))?[o,a,new H(1).div(c)]:[a,o,c],h=ce.priceToSqrtPriceX64(g,f.decimals,w.decimals),p=await this.makeCreatePoolInstructions({connection:t,programId:n,owner:i,mintA:f,mintB:w,ammConfigId:u.id,initialPriceX64:h,startTime:l});return{address:{...p.address,mintA:f.mint,mintB:w.mint,mintProgramIdA:f.programId,mintProgramIdB:w.programId},innerTransactions:await ue({connection:t,makeTxVersion:e,computeBudgetConfig:d,payer:s,innerTransaction:[p.innerTransaction],lookupTableCache:m})}}static async makeOpenPositionFromLiquidityInstructionSimple({makeTxVersion:e,connection:t,poolInfo:n,ownerInfo:i,amountMaxA:s,amountMaxB:a,tickLower:o,tickUpper:u,liquidity:c,associatedOnly:l=!0,checkCreateATAOwner:d=!1,withMetadata:m="create",getEphemeralSigners:f,computeBudgetConfig:w,lookupTableCache:g}){const h=[],p=[],A=[],k=[],S=[],T=i.useSOLBalance&&n.mintA.mint.equals(F.WSOL.mint),y=i.useSOLBalance&&n.mintB.mint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:n.mintA.programId,mint:n.mintA.mint,tokenAccounts:T?[]:i.tokenAccounts,owner:i.wallet,createInfo:T||s.eq($)?{connection:t,payer:i.feePayer,amount:s,frontInstructions:h,endInstructions:p,frontInstructionsType:A,endInstructionsType:k,signers:S}:void 0,associatedOnly:T?!1:l,checkCreateATAOwner:d}),E=await this._selectOrCreateTokenAccount({programId:n.mintB.programId,mint:n.mintB.mint,tokenAccounts:y?[]:i.tokenAccounts,owner:i.wallet,createInfo:y||a.eq($)?{connection:t,payer:i.feePayer,amount:a,frontInstructions:h,endInstructions:p,frontInstructionsType:A,endInstructionsType:k,signers:S}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:d});ye.assertArgument(I!==void 0&&E!==void 0,"cannot found target token accounts","tokenAccounts",i.tokenAccounts);const v=await this.makeOpenPositionFromLiquidityInstructions({poolInfo:n,ownerInfo:{...i,tokenAccountA:I,tokenAccountB:E},tickLower:o,tickUpper:u,liquidity:c,amountMaxA:s,amountMaxB:a,withMetadata:m,getEphemeralSigners:f});return{address:v.address,innerTransactions:await ue({connection:t,makeTxVersion:e,computeBudgetConfig:w,payer:i.feePayer,innerTransaction:[{instructionTypes:A,instructions:h,signers:S},v.innerTransaction,{instructionTypes:k,instructions:p,signers:[]}],lookupTableCache:g})}}static async makeOpenPositionFromBaseInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,tickLower:i,tickUpper:s,base:a,baseAmount:o,otherAmountMax:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:d,withMetadata:m="create",makeTxVersion:f,lookupTableCache:w,getEphemeralSigners:g}){const h=[],p=[],A=[],k=[],S=[],T=n.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),y=n.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:T?[]:n.tokenAccounts,owner:n.wallet,createInfo:T?{connection:e,payer:n.feePayer,amount:a==="MintA"?o:u,frontInstructions:h,endInstructions:p,frontInstructionsType:A,endInstructionsType:k,signers:S}:void 0,associatedOnly:T?!1:c,checkCreateATAOwner:l}),E=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:y?[]:n.tokenAccounts,owner:n.wallet,createInfo:y?{connection:e,payer:n.feePayer,amount:a==="MintA"?u:o,frontInstructions:h,endInstructions:p,frontInstructionsType:A,endInstructionsType:k,signers:S}:void 0,associatedOnly:y?!1:c,checkCreateATAOwner:l});ye.assertArgument(I!==void 0&&E!==void 0,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=await this.makeOpenPositionFromBaseInstructions({poolInfo:t,ownerInfo:{...n,tokenAccountA:I,tokenAccountB:E},tickLower:i,tickUpper:s,base:a,baseAmount:o,otherAmountMax:u,withMetadata:m,getEphemeralSigners:g});return{address:v.address,innerTransactions:await ue({connection:e,makeTxVersion:f,computeBudgetConfig:d,payer:n.feePayer,innerTransaction:[{instructionTypes:A,instructions:h,signers:S},v.innerTransaction,{instructionTypes:k,instructions:p,signers:[]}],lookupTableCache:w})}}static async makeIncreasePositionFromLiquidityInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:i,amountMaxA:s,amountMaxB:a,liquidity:o,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,makeTxVersion:d,lookupTableCache:m}){const f=[],w=[],g=[],h=[],p=[],A=i.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),k=i.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),S=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:i.tokenAccounts,owner:i.wallet,createInfo:A?{connection:e,payer:i.feePayer,amount:s,frontInstructions:f,endInstructions:w,frontInstructionsType:g,endInstructionsType:h,signers:p}:void 0,associatedOnly:A?!1:u,checkCreateATAOwner:c}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:i.tokenAccounts,owner:i.wallet,createInfo:k?{connection:e,payer:i.feePayer,amount:a,frontInstructions:f,endInstructions:w,frontInstructionsType:g,endInstructionsType:h,signers:p}:void 0,associatedOnly:k?!1:u,checkCreateATAOwner:c});ye.assertArgument(!!S||!!T,"cannot found target token accounts","tokenAccounts",i.tokenAccounts);const y=this.makeIncreasePositionFromLiquidityInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:i.wallet,tokenAccountA:S,tokenAccountB:T},liquidity:o,amountMaxA:s,amountMaxB:a});return{address:y.address,innerTransactions:await ue({connection:e,makeTxVersion:d,computeBudgetConfig:l,payer:i.feePayer,innerTransaction:[{instructionTypes:g,instructions:f,signers:p},y.innerTransaction,{instructionTypes:h,instructions:w,signers:[]}],lookupTableCache:m})}}static async makeIncreasePositionFromBaseInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:i,base:s,baseAmount:a,otherAmountMax:o,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,makeTxVersion:d,lookupTableCache:m}){const f=[],w=[],g=[],h=[],p=[],A=i.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),k=i.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),S=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:i.tokenAccounts,owner:i.wallet,createInfo:A?{connection:e,payer:i.feePayer,amount:s==="MintA"?a:o,frontInstructions:f,endInstructions:w,frontInstructionsType:g,endInstructionsType:h,signers:p}:void 0,associatedOnly:A?!1:u,checkCreateATAOwner:c}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:i.tokenAccounts,owner:i.wallet,createInfo:k?{connection:e,payer:i.feePayer,amount:s==="MintA"?o:a,frontInstructions:f,endInstructions:w,frontInstructionsType:g,endInstructionsType:h,signers:p}:void 0,associatedOnly:k?!1:u,checkCreateATAOwner:c});ye.assertArgument(!!S||!!T,"cannot found target token accounts","tokenAccounts",i.tokenAccounts);const y=this.makeIncreasePositionFromBaseInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:i.wallet,tokenAccountA:S,tokenAccountB:T},base:s,baseAmount:a,otherAmountMax:o});return{address:y.address,innerTransactions:await ue({connection:e,makeTxVersion:d,computeBudgetConfig:l,payer:i.feePayer,innerTransaction:[{instructionTypes:g,instructions:f,signers:p},y.innerTransaction,{instructionTypes:h,instructions:w,signers:[]}],lookupTableCache:m})}}static async makeDecreaseLiquidityInstructionSimple({connection:e,poolInfo:t,ownerPosition:n,ownerInfo:i,liquidity:s,amountMinA:a,amountMinB:o,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,makeTxVersion:d,lookupTableCache:m}){const f=[],w=[],g=[],h=[],p=[],A=i.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),k=i.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),S=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:A?[]:i.tokenAccounts,owner:i.wallet,createInfo:{connection:e,payer:i.feePayer,amount:0,frontInstructions:f,frontInstructionsType:g,endInstructions:A?w:[],endInstructionsType:A?h:[],signers:p},associatedOnly:A?!1:u,checkCreateATAOwner:c}),T=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:k?[]:i.tokenAccounts,owner:i.wallet,createInfo:{connection:e,payer:i.feePayer,amount:0,frontInstructions:f,frontInstructionsType:g,endInstructions:k?w:[],endInstructionsType:k?h:[],signers:p},associatedOnly:k?!1:u,checkCreateATAOwner:c}),y=[];for(const v of t.rewardInfos){const L=i.useSOLBalance&&v.tokenMint.equals(F.WSOL.mint),x=v.tokenMint.equals(t.mintA.mint)?S:v.tokenMint.equals(t.mintB.mint)?T:await this._selectOrCreateTokenAccount({programId:v.tokenProgramId,mint:v.tokenMint,tokenAccounts:L?[]:i.tokenAccounts,owner:i.wallet,createInfo:{connection:e,payer:i.feePayer,amount:0,frontInstructions:f,frontInstructionsType:g,endInstructions:L?w:[],endInstructionsType:L?h:[],signers:p},associatedOnly:L?!1:u,checkCreateATAOwner:c});y.push(x)}ye.assertArgument(!!S||!!T,"cannot found target token accounts","tokenAccounts",i.tokenAccounts);const I=this.makeDecreaseLiquidityInstructions({poolInfo:t,ownerPosition:n,ownerInfo:{wallet:i.wallet,tokenAccountA:S,tokenAccountB:T,rewardAccounts:y},liquidity:s,amountMinA:a,amountMinB:o}),E=i.closePosition?this.makeClosePositionInstructions({poolInfo:t,ownerInfo:i,ownerPosition:n}):{address:{},innerTransaction:{instructions:[],signers:[],instructionTypes:[]}};return{address:I.address,innerTransactions:await ue({connection:e,makeTxVersion:d,computeBudgetConfig:l,payer:i.feePayer,innerTransaction:[{instructionTypes:g,instructions:f,signers:p},I.innerTransaction,{instructionTypes:h,instructions:w,signers:[]},E.innerTransaction],lookupTableCache:m})}}static async makeSwapBaseInInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,inputMint:i,amountIn:s,amountOutMin:a,priceLimit:o,remainingAccounts:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:d,makeTxVersion:m,lookupTableCache:f}){const w=[],g=[],h=[],p=[],A=[];let k;!o||o.equals(new H(0))?k=i.equals(t.mintA.mint)?Gt.add(Te):zt.sub(Te):k=ce.priceToSqrtPriceX64(o,t.mintA.decimals,t.mintB.decimals);const S=t.mintA.mint.equals(i),T=n.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),y=n.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:T?[]:n.tokenAccounts,owner:n.wallet,createInfo:T||!S?{connection:e,payer:n.feePayer,amount:S?s:0,frontInstructions:w,endInstructions:g,frontInstructionsType:h,endInstructionsType:p,signers:A}:void 0,associatedOnly:T?!1:c,checkCreateATAOwner:l}),E=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:y?[]:n.tokenAccounts,owner:n.wallet,createInfo:y||S?{connection:e,payer:n.feePayer,amount:S?0:s,frontInstructions:w,endInstructions:g,frontInstructionsType:h,endInstructionsType:p,signers:A}:void 0,associatedOnly:y?!1:c,checkCreateATAOwner:l});ye.assertArgument(!!I||!!E,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=this.makeSwapBaseInInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccountA:I,tokenAccountB:E},inputMint:i,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:k,remainingAccounts:u});return{address:v.address,innerTransactions:await ue({connection:e,makeTxVersion:m,computeBudgetConfig:d,payer:n.feePayer,innerTransaction:[{instructionTypes:h,instructions:w,signers:A},v.innerTransaction,{instructionTypes:p,instructions:g,signers:[]}],lookupTableCache:f})}}static async makeSwapBaseOutInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,outputMint:i,amountOut:s,amountInMax:a,priceLimit:o,remainingAccounts:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:d,makeTxVersion:m,lookupTableCache:f}){const w=[],g=[],h=[],p=[],A=[];let k;!o||o.equals(new H(0))?k=i.equals(t.mintB.mint)?Gt.add(Te):zt.sub(Te):k=ce.priceToSqrtPriceX64(o,t.mintA.decimals,t.mintB.decimals);const S=t.mintA.mint.equals(i),T=n.useSOLBalance&&t.mintA.mint.equals(F.WSOL.mint),y=n.useSOLBalance&&t.mintB.mint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:t.mintA.programId,mint:t.mintA.mint,tokenAccounts:T?[]:n.tokenAccounts,owner:n.wallet,createInfo:T||!S?{connection:e,payer:n.feePayer,amount:S?a:0,frontInstructions:w,endInstructions:g,frontInstructionsType:h,endInstructionsType:p,signers:A}:void 0,associatedOnly:T?!1:c,checkCreateATAOwner:l}),E=await this._selectOrCreateTokenAccount({programId:t.mintB.programId,mint:t.mintB.mint,tokenAccounts:y?[]:n.tokenAccounts,owner:n.wallet,createInfo:y||S?{connection:e,payer:n.feePayer,amount:S?0:a,frontInstructions:w,endInstructions:g,frontInstructionsType:h,endInstructionsType:p,signers:A}:void 0,associatedOnly:y?!1:c,checkCreateATAOwner:l});ye.assertArgument(!!I||!!E,"cannot found target token accounts","tokenAccounts",n.tokenAccounts);const v=this.makeSwapBaseOutInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccountA:I,tokenAccountB:E},outputMint:i,amountOut:s,amountInMax:a,sqrtPriceLimitX64:k,remainingAccounts:u});return{address:v.address,innerTransactions:await ue({connection:e,makeTxVersion:m,computeBudgetConfig:d,payer:n.feePayer,innerTransaction:[{instructionTypes:h,instructions:w,signers:A},v.innerTransaction,{instructionTypes:p,instructions:g,signers:[]}],lookupTableCache:f})}}static async makeCLosePositionInstructionSimple({poolInfo:e,ownerPosition:t,ownerInfo:n,makeTxVersion:i,lookupTableCache:s,connection:a}){const o=this.makeClosePositionInstructions({poolInfo:e,ownerInfo:n,ownerPosition:t});return{address:o.address,innerTransactions:await ue({connection:a,makeTxVersion:i,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[o.innerTransaction],lookupTableCache:s})}}static async makeInitRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfo:i,chainTime:s,associatedOnly:a=!0,checkCreateATAOwner:o=!1,makeTxVersion:u,lookupTableCache:c}){ye.assertArgument(i.endTime>i.openTime,"reward time error","rewardInfo",i),ye.assertArgument(i.openTime>s,"reward must be paid later","rewardInfo",i);const l=[],d=[],m=[],f=[],w=[],g=n.useSOLBalance&&i.mint.equals(F.WSOL.mint),h=i.perSecond.mul(i.endTime-i.openTime),p=await this._selectOrCreateTokenAccount({programId:i.programId,mint:i.mint,tokenAccounts:g?[]:n.tokenAccounts,owner:n.wallet,createInfo:g?{connection:e,payer:n.feePayer,amount:new B(new H(h.toFixed(0)).gte(h)?h.toFixed(0):h.add(1).toFixed(0)),frontInstructions:l,endInstructions:d,frontInstructionsType:m,endInstructionsType:f,signers:w}:void 0,associatedOnly:g?!1:a,checkCreateATAOwner:o});ye.assertArgument(p,"no money","ownerRewardAccount",n.tokenAccounts);const A=this.makeInitRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:p},rewardInfo:{programId:i.programId,mint:i.mint,openTime:i.openTime,endTime:i.endTime,emissionsPerSecondX64:oe.decimalToX64(i.perSecond)}});return{address:A.address,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:w},A.innerTransaction,{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:c})}}static async makeInitRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfos:i,associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:o,makeTxVersion:u,lookupTableCache:c}){for(const p of i)ye.assertArgument(p.endTime>p.openTime,"reward time error","rewardInfo",p);const l=[],d=[],m=[],f=[],w=[],g=[];for(const p of i){const A=n.useSOLBalance&&p.mint.equals(F.WSOL.mint),k=p.perSecond.mul(p.endTime-p.openTime),S=await this._selectOrCreateTokenAccount({programId:p.programId,mint:p.mint,tokenAccounts:A?[]:n.tokenAccounts,owner:n.wallet,createInfo:A?{connection:e,payer:n.feePayer,amount:new B(new H(k.toFixed(0)).gte(k)?k.toFixed(0):k.add(1).toFixed(0)),frontInstructions:l,endInstructions:d,frontInstructionsType:m,endInstructionsType:f,signers:g}:void 0,associatedOnly:A?!1:s,checkCreateATAOwner:a});ye.assertArgument(S,"no money","ownerRewardAccount",n.tokenAccounts),w.push(this.makeInitRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:S},rewardInfo:{programId:p.programId,mint:p.mint,openTime:p.openTime,endTime:p.endTime,emissionsPerSecondX64:oe.decimalToX64(p.perSecond)}}))}let h={};for(const p of w)h={...h,...p.address};return{address:h,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:o,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:g},...w.map(p=>p.innerTransaction),{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:c})}}static async makeSetRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfo:i,chainTime:s,associatedOnly:a=!0,checkCreateATAOwner:o=!1,makeTxVersion:u,lookupTableCache:c}){ye.assertArgument(i.endTime>i.openTime,"reward time error","rewardInfo",i),ye.assertArgument(i.openTime>s,"reward must be paid later","rewardInfo",i);const l=[],d=[],m=[],f=[],w=[],g=n.useSOLBalance&&i.mint.equals(F.WSOL.mint),h=await this._selectOrCreateTokenAccount({programId:i.programId,mint:i.mint,tokenAccounts:g?[]:n.tokenAccounts,owner:n.wallet,createInfo:g?{connection:e,payer:n.feePayer,amount:new B(new H(i.perSecond.sub(i.endTime-i.openTime).toFixed(0)).gte(i.perSecond.sub(i.endTime-i.openTime))?i.perSecond.sub(i.endTime-i.openTime).toFixed(0):i.perSecond.sub(i.endTime-i.openTime).add(1).toFixed(0)),frontInstructions:l,endInstructions:d,frontInstructionsType:m,endInstructionsType:f,signers:w}:void 0,associatedOnly:g?!1:a,checkCreateATAOwner:o});ye.assertArgument(h,"no money","ownerRewardAccount",n.tokenAccounts);const p=this.makeSetRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:h},rewardInfo:{mint:i.mint,openTime:i.openTime,endTime:i.endTime,emissionsPerSecondX64:oe.decimalToX64(i.perSecond)}});return{address:p.address,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:w},p.innerTransaction,{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:c})}}static async makeSetRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardInfos:i,chainTime:s,associatedOnly:a=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:u,makeTxVersion:c,lookupTableCache:l}){const d=[],m=[],f=[],w=[],g=[],h=[];for(const A of i){ye.assertArgument(A.endTime>A.openTime,"reward time error","rewardInfo",A),ye.assertArgument(A.openTime>s,"reward must be paid later","rewardInfo",A);const k=n.useSOLBalance&&A.mint.equals(F.WSOL.mint),S=await this._selectOrCreateTokenAccount({programId:A.programId,mint:A.mint,tokenAccounts:k?[]:n.tokenAccounts,owner:n.wallet,createInfo:k?{connection:e,payer:n.feePayer,amount:new B(new H(A.perSecond.sub(A.endTime-A.openTime).toFixed(0)).gte(A.perSecond.sub(A.endTime-A.openTime))?A.perSecond.sub(A.endTime-A.openTime).toFixed(0):A.perSecond.sub(A.endTime-A.openTime).add(1).toFixed(0)),frontInstructions:d,endInstructions:m,frontInstructionsType:f,endInstructionsType:w,signers:h}:void 0,associatedOnly:k?!1:a,checkCreateATAOwner:o});ye.assertArgument(S,"no money","ownerRewardAccount",n.tokenAccounts),g.push(this.makeSetRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:S},rewardInfo:{mint:A.mint,openTime:A.openTime,endTime:A.endTime,emissionsPerSecondX64:oe.decimalToX64(A.perSecond)}}))}let p={};for(const A of g)p={...p,...A.address};return{address:p,innerTransactions:await ue({connection:e,makeTxVersion:c,computeBudgetConfig:u,payer:n.feePayer,innerTransaction:[{instructionTypes:f,instructions:d,signers:h},...g.map(A=>A.innerTransaction),{instructionTypes:w,instructions:m,signers:[]}],lookupTableCache:l})}}static async makeCollectRewardInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardMint:i,associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:o,makeTxVersion:u,lookupTableCache:c}){const l=[],d=[],m=[],f=[],w=[],g=t.rewardInfos.find(k=>k.tokenMint.equals(i));if(ye.assertArgument(g!==void 0,"reward mint error","not found reward mint",i),g===void 0)throw Error("reward mint error");const h=n.useSOLBalance&&i.equals(F.WSOL.mint),p=await this._selectOrCreateTokenAccount({programId:g.tokenProgramId,mint:i,tokenAccounts:h?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,endInstructions:h?d:[],frontInstructionsType:m,endInstructionsType:f,signers:w},associatedOnly:h?!1:s,checkCreateATAOwner:a});ye.assertArgument(p,"no money","ownerRewardAccount",n.tokenAccounts);const A=this.makeCollectRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:p},rewardMint:i});return{address:A.address,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:o,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:w},A.innerTransaction,{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:c})}}static async makeCollectRewardsInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,rewardMints:i,associatedOnly:s=!0,checkCreateATAOwner:a=!1,computeBudgetConfig:o,makeTxVersion:u,lookupTableCache:c}){const l=[],d=[],m=[],f=[],w=[],g=[];for(const p of i){const A=t.rewardInfos.find(T=>T.tokenMint.equals(p));if(ye.assertArgument(A!==void 0,"reward mint error","not found reward mint",p),A===void 0)throw Error("reward mint error");const k=n.useSOLBalance&&p.equals(F.WSOL.mint),S=await this._selectOrCreateTokenAccount({programId:A.tokenProgramId,mint:p,tokenAccounts:k?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:l,endInstructions:k?d:[],signers:g,frontInstructionsType:m,endInstructionsType:f},associatedOnly:k?!1:s,checkCreateATAOwner:a});ye.assertArgument(S,"no money","ownerRewardAccount",n.tokenAccounts),w.push(this.makeCollectRewardInstructions({poolInfo:t,ownerInfo:{wallet:n.wallet,tokenAccount:S},rewardMint:p}))}let h={};for(const p of w)h={...h,...p.address};return{address:h,innerTransactions:await ue({connection:e,makeTxVersion:u,computeBudgetConfig:o,payer:n.feePayer,innerTransaction:[{instructionTypes:m,instructions:l,signers:g},...w.map(p=>p.innerTransaction),{instructionTypes:f,instructions:d,signers:[]}],lookupTableCache:c})}}static async makeHarvestAllRewardInstructionSimple({connection:e,fetchPoolInfos:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:s=!1,makeTxVersion:a,lookupTableCache:o}){var g,h,p;const u={};for(const A of n.tokenAccounts)i?Ee(n.wallet,A.accountInfo.mint,A.programId).publicKey.equals(A.pubkey)&&(u[A.accountInfo.mint.toString()]=A.pubkey):u[A.accountInfo.mint.toString()]=A.pubkey;const c=[],l=[],d=[],m=[],f=[],w=[];for(const A of Object.values(t)){if(A.positionAccount===void 0||!A.positionAccount.find(v=>!v.tokenFeeAmountA.isZero()||!v.tokenFeeAmountB.isZero()||v.rewardInfos.find(L=>!L.pendingReward.isZero())))continue;const k=A.state,S=n.useSOLBalance&&k.mintA.mint.equals(F.WSOL.mint),T=n.useSOLBalance&&k.mintB.mint.equals(F.WSOL.mint),y=(g=u[k.mintA.mint.toString()])!=null?g:await this._selectOrCreateTokenAccount({programId:k.mintA.programId,mint:k.mintA.mint,tokenAccounts:S?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,frontInstructionsType:d,endInstructions:S?l:[],endInstructionsType:S?m:[],signers:w},associatedOnly:S?!1:i,checkCreateATAOwner:s}),I=(h=u[k.mintB.mint.toString()])!=null?h:await this._selectOrCreateTokenAccount({programId:k.mintB.programId,mint:k.mintB.mint,tokenAccounts:T?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,frontInstructionsType:d,endInstructions:T?l:[],endInstructionsType:T?m:[],signers:w},associatedOnly:T?!1:i,checkCreateATAOwner:s});u[k.mintA.mint.toString()]=y,u[k.mintB.mint.toString()]=I;const E=[];for(const v of k.rewardInfos){const L=n.useSOLBalance&&v.tokenMint.equals(F.WSOL.mint),x=(p=u[v.tokenMint.toString()])!=null?p:await this._selectOrCreateTokenAccount({programId:v.tokenProgramId,mint:v.tokenMint,tokenAccounts:L?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.feePayer,amount:0,frontInstructions:c,endInstructions:L?l:[],frontInstructionsType:d,endInstructionsType:m,signers:w},associatedOnly:L?!1:i,checkCreateATAOwner:s});u[v.tokenMint.toString()]=x,E.push(x)}for(const v of A.positionAccount)f.push(this.makeDecreaseLiquidityInstructions({poolInfo:k,ownerPosition:v,ownerInfo:{wallet:n.wallet,tokenAccountA:y,tokenAccountB:I,rewardAccounts:E},liquidity:$,amountMinA:$,amountMinB:$}))}return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:a,computeBudgetConfig:void 0,payer:n.feePayer,innerTransaction:[{instructionTypes:d,instructions:c,signers:w},...f.map(A=>A.innerTransaction),{instructionTypes:m,instructions:l,signers:[]}],lookupTableCache:o})}}static async makeCreatePoolInstructions({connection:e,programId:t,owner:n,mintA:i,mintB:s,ammConfigId:a,initialPriceX64:o,startTime:u}){const c=Ln({fromPublicKey:n,programId:t}),l=Ml(t,a,i.mint,s.mint).publicKey,d=fs(t,l,i.mint).publicKey,m=fs(t,l,s.mint).publicKey,f=[Ht.createAccountWithSeed({fromPubkey:n,basePubkey:n,seed:c.seed,newAccountPubkey:c.publicKey,lamports:await e.getMinimumBalanceForRentExemption(ws.span),space:ws.span,programId:t}),ml(t,l,n,a,c.publicKey,i.mint,d,i.programId,s.mint,m,s.programId,ht(t,l).publicKey,o,u)];return{address:{observationId:c.publicKey,poolId:l,mintAVault:d,mintBVault:m},innerTransaction:{instructions:f,signers:[],instructionTypes:[Q.createAccount,Q.clmmCreatePool],lookupTableAddress:[]}}}static async makeOpenPositionFromLiquidityInstructions({poolInfo:e,ownerInfo:t,tickLower:n,tickUpper:i,liquidity:s,amountMaxA:a,amountMaxB:o,withMetadata:u,getEphemeralSigners:c}){const l=[];let d;if(c)d=new P((await c(1))[0]);else{const T=tr.generate();l.push(T),d=T.publicKey}const m=te.getTickArrayStartIndexByTick(n,e.ammConfig.tickSpacing),f=te.getTickArrayStartIndexByTick(i,e.ammConfig.tickSpacing),{publicKey:w}=Se(e.programId,e.id,m),{publicKey:g}=Se(e.programId,e.id,f),{publicKey:h}=Ee(t.wallet,d,_),{publicKey:p}=ps(d),{publicKey:A}=qt(e.programId,d),{publicKey:k}=hn(e.programId,e.id,n,i),S=fl(e.programId,t.feePayer,e.id,t.wallet,d,h,p,k,w,g,A,t.tokenAccountA,t.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,n,i,m,f,s,a,o,u,et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[m,f])?ht(e.programId,e.id).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:w,tickArrayUpper:g,positionNftAccount:h,metadataAccount:p,personalPosition:A,protocolPosition:k},innerTransaction:{instructions:[S],signers:l,instructionTypes:[Q.clmmOpenPosition],lookupTableAddress:[e.lookupTableAccount].filter(T=>T&&!T.equals(P.default))}}}static async makeOpenPositionFromBaseInstructions({poolInfo:e,ownerInfo:t,tickLower:n,tickUpper:i,base:s,baseAmount:a,otherAmountMax:o,withMetadata:u,getEphemeralSigners:c}){const l=[];let d;if(c)d=new P((await c(1))[0]);else{const T=tr.generate();l.push(T),d=T.publicKey}const m=te.getTickArrayStartIndexByTick(n,e.ammConfig.tickSpacing),f=te.getTickArrayStartIndexByTick(i,e.ammConfig.tickSpacing),{publicKey:w}=Se(e.programId,e.id,m),{publicKey:g}=Se(e.programId,e.id,f),{publicKey:h}=Ee(t.wallet,d,_),{publicKey:p}=ps(d),{publicKey:A}=qt(e.programId,d),{publicKey:k}=hn(e.programId,e.id,n,i),S=pl(e.programId,t.feePayer,e.id,t.wallet,d,h,p,k,w,g,A,t.tokenAccountA,t.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,n,i,m,f,u,s,a,o,et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[m,f])?ht(e.programId,e.id).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:w,tickArrayUpper:g,positionNftAccount:h,metadataAccount:p,personalPosition:A,protocolPosition:k},innerTransaction:{instructions:[S],signers:l,instructionTypes:[Q.clmmOpenPosition],lookupTableAddress:[e.lookupTableAccount].filter(T=>T&&!T.equals(P.default))}}}static makeIncreasePositionFromLiquidityInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,liquidity:i,amountMaxA:s,amountMaxB:a}){const o=te.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),u=te.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Se(e.programId,e.id,o),{publicKey:l}=Se(e.programId,e.id,u),{publicKey:d}=Ee(n.wallet,t.nftMint,_),{publicKey:m}=qt(e.programId,t.nftMint),{publicKey:f}=hn(e.programId,e.id,t.tickLower,t.tickUpper);return{address:{tickArrayLower:c,tickArrayUpper:l,positionNftAccount:d,personalPosition:m,protocolPosition:f},innerTransaction:{instructions:[wl(e.programId,n.wallet,d,m,e.id,f,c,l,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,i,s,a,et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[o,u])?ht(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[Q.clmmIncreasePosition],lookupTableAddress:[e.lookupTableAccount].filter(w=>w&&!w.equals(P.default))}}}static makeIncreasePositionFromBaseInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,base:i,baseAmount:s,otherAmountMax:a}){const o=te.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),u=te.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Se(e.programId,e.id,o),{publicKey:l}=Se(e.programId,e.id,u),{publicKey:d}=Ee(n.wallet,t.nftMint,_),{publicKey:m}=qt(e.programId,t.nftMint),{publicKey:f}=hn(e.programId,e.id,t.tickLower,t.tickUpper);return{address:{tickArrayLower:c,tickArrayUpper:l,positionNftAccount:d,personalPosition:m,protocolPosition:f},innerTransaction:{instructions:[Al(e.programId,n.wallet,d,m,e.id,f,c,l,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,i,s,a,et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[o,u])?ht(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[Q.clmmIncreasePosition],lookupTableAddress:[e.lookupTableAccount].filter(w=>w&&!w.equals(P.default))}}}static makeDecreaseLiquidityInstructions({poolInfo:e,ownerPosition:t,ownerInfo:n,liquidity:i,amountMinA:s,amountMinB:a}){const o=te.getTickArrayStartIndexByTick(t.tickLower,e.ammConfig.tickSpacing),u=te.getTickArrayStartIndexByTick(t.tickUpper,e.ammConfig.tickSpacing),{publicKey:c}=Se(e.programId,e.id,o),{publicKey:l}=Se(e.programId,e.id,u),{publicKey:d}=Ee(n.wallet,t.nftMint,_),{publicKey:m}=qt(e.programId,t.nftMint),{publicKey:f}=hn(e.programId,e.id,t.tickLower,t.tickUpper),w=[];for(let g=0;g<e.rewardInfos.length;g++)w.push({poolRewardVault:e.rewardInfos[g].tokenVault,ownerRewardVault:n.rewardAccounts[g],rewardMint:e.rewardInfos[g].tokenMint});return{address:{tickArrayLower:c,tickArrayUpper:l,positionNftAccount:d,personalPosition:m,protocolPosition:f},innerTransaction:{instructions:[hl(e.programId,n.wallet,d,m,e.id,f,c,l,n.tokenAccountA,n.tokenAccountB,e.mintA.vault,e.mintB.vault,e.mintA.mint,e.mintB.mint,w,i,s,a,et.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[o,u])?ht(e.programId,e.id).publicKey:void 0)],signers:[],instructionTypes:[Q.clmmDecreasePosition],lookupTableAddress:[e.lookupTableAccount].filter(g=>g&&!g.equals(P.default))}}}static makeClosePositionInstructions({poolInfo:e,ownerInfo:t,ownerPosition:n}){const{publicKey:i}=Ee(t.wallet,n.nftMint,_),{publicKey:s}=qt(e.programId,n.nftMint);return{address:{positionNftAccount:i,personalPosition:s},innerTransaction:{instructions:[gl(e.programId,t.wallet,n.nftMint,i,s)],signers:[],instructionTypes:[Q.clmmClosePosition],lookupTableAddress:[e.lookupTableAccount].filter(a=>a&&!a.equals(P.default))}}}static makeSwapBaseInInstructions({poolInfo:e,ownerInfo:t,inputMint:n,amountIn:i,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:o}){const u=e.mintA.mint.equals(n);return{address:{},innerTransaction:{instructions:[ds(e.programId,t.wallet,e.id,e.ammConfig.id,u?t.tokenAccountA:t.tokenAccountB,u?t.tokenAccountB:t.tokenAccountA,u?e.mintA.vault:e.mintB.vault,u?e.mintB.vault:e.mintA.vault,u?e.mintA.mint:e.mintB.mint,u?e.mintB.mint:e.mintA.mint,o,e.observationId,i,s,a,!0,ht(e.programId,e.id).publicKey)],signers:[],lookupTableAddress:[e.lookupTableAccount].filter(c=>c&&!c.equals(P.default)),instructionTypes:[Q.clmmSwapBaseIn]}}}static makeSwapBaseOutInstructions({poolInfo:e,ownerInfo:t,outputMint:n,amountOut:i,amountInMax:s,sqrtPriceLimitX64:a,remainingAccounts:o}){const u=e.mintA.mint.equals(n);return{address:{},innerTransaction:{instructions:[ds(e.programId,t.wallet,e.id,e.ammConfig.id,u?t.tokenAccountB:t.tokenAccountA,u?t.tokenAccountA:t.tokenAccountB,u?e.mintB.vault:e.mintA.vault,u?e.mintA.vault:e.mintB.vault,u?e.mintB.mint:e.mintA.mint,u?e.mintA.mint:e.mintB.mint,o,e.observationId,i,s,a,!1,ht(e.programId,e.id).publicKey)],signers:[],lookupTableAddress:[e.lookupTableAccount].filter(c=>c&&!c.equals(P.default)),instructionTypes:[Q.clmmSwapBaseOut]}}}static makeInitRewardInstructions({poolInfo:e,ownerInfo:t,rewardInfo:n}){const i=Cl(e.programId,e.id,n.mint).publicKey,s=Pr(e.programId).publicKey;return{address:{poolRewardVault:i,operationId:s},innerTransaction:{instructions:[kl(e.programId,t.wallet,e.id,s,e.ammConfig.id,t.tokenAccount,n.programId,n.mint,i,n.openTime,n.endTime,n.emissionsPerSecondX64)],signers:[],instructionTypes:[Q.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter(a=>a&&!a.equals(P.default))}}}static makeSetRewardInstructions({poolInfo:e,ownerInfo:t,rewardInfo:n}){let i,s,a;for(let u=0;u<e.rewardInfos.length;u++)e.rewardInfos[u].tokenMint.equals(n.mint)&&(i=u,s=e.rewardInfos[u].tokenVault,a=e.rewardInfos[u].tokenMint);if(i===void 0||s===void 0||a===void 0)throw Error("reward mint check error");const o=Pr(e.programId).publicKey;return{address:{rewardVault:s,operationId:o},innerTransaction:{instructions:[bl(e.programId,t.wallet,e.id,o,e.ammConfig.id,t.tokenAccount,s,a,i,n.openTime,n.endTime,n.emissionsPerSecondX64)],signers:[],instructionTypes:[Q.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter(u=>u&&!u.equals(P.default))}}}static makeCollectRewardInstructions({poolInfo:e,ownerInfo:t,rewardMint:n}){let i,s;for(let a=0;a<e.rewardInfos.length;a++)e.rewardInfos[a].tokenMint.equals(n)&&(i=a,s=e.rewardInfos[a].tokenVault);if(i===void 0||s===void 0)throw Error("reward mint check error");return{address:{rewardVault:s},innerTransaction:{instructions:[Tl(e.programId,t.wallet,e.id,t.tokenAccount,s,n,i)],signers:[],instructionTypes:[Q.clmmInitReward],lookupTableAddress:[e.lookupTableAccount].filter(a=>a&&!a.equals(P.default))}}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:s,slippage:a,add:o,token2022Infos:u,epochInfo:c,amountHasFee:l}){var A,k;const d=e.sqrtPriceX64,m=ce.getSqrtPriceX64FromTick(n),f=ce.getSqrtPriceX64FromTick(i),w=o?1-a:1+a,g=We(s,(A=u[t?e.mintA.mint.toString():e.mintB.mint.toString()])==null?void 0:A.feeConfig,c,!l),h=new B(new H(g.amount.sub((k=g.fee)!=null?k:$).toString()).mul(w).toFixed(0));let p;if(d.lte(m))p=t?fe.getLiquidityFromTokenAmountA(m,f,h,!o):new B(0);else if(d.lte(f)){const S=fe.getLiquidityFromTokenAmountA(d,f,h,!o),T=fe.getLiquidityFromTokenAmountB(m,d,h);p=t?S:T}else p=t?new B(0):fe.getLiquidityFromTokenAmountB(m,f,h);return this.getAmountsFromLiquidity({poolInfo:e,tickLower:n,tickUpper:i,liquidity:p,slippage:a,add:o,token2022Infos:u,epochInfo:c,amountAddFee:l})}static getLiquidityFromAmounts({poolInfo:e,tickLower:t,tickUpper:n,amountA:i,amountB:s,slippage:a,add:o,token2022Infos:u,epochInfo:c,amountHasFee:l}){var T,y,I,E;const[d,m,f,w]=t<n?[t,n,i,s]:[n,t,s,i],g=e.sqrtPriceX64,h=ce.getSqrtPriceX64FromTick(d),p=ce.getSqrtPriceX64FromTick(m),[A,k]=[We(f,(T=u[e.mintA.mint.toString()])==null?void 0:T.feeConfig,c,!l),We(w,(y=u[e.mintB.mint.toString()])==null?void 0:y.feeConfig,c,!l)],S=fe.getLiquidityFromTokenAmounts(g,h,p,A.amount.sub((I=A.fee)!=null?I:$),k.amount.sub((E=k.fee)!=null?E:$));return this.getAmountsFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:S,slippage:a,add:o,token2022Infos:u,epochInfo:c,amountAddFee:!l})}static getAmountsFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:s,add:a,token2022Infos:o,epochInfo:u,amountAddFee:c}){var A,k,S,T;const l=ce.getSqrtPriceX64FromTick(t),d=ce.getSqrtPriceX64FromTick(n),m=a?1+s:1-s,f=fe.getAmountsFromLiquidity(e.sqrtPriceX64,l,d,i,a),[w,g]=[We(f.amountA,(A=o[e.mintA.mint.toString()])==null?void 0:A.feeConfig,u,c),We(f.amountB,(k=o[e.mintB.mint.toString()])==null?void 0:k.feeConfig,u,c)],[h,p]=[We(new B(new H(f.amountA.toString()).mul(m).toFixed(0)),(S=o[e.mintA.mint.toString()])==null?void 0:S.feeConfig,u,c),We(new B(new H(f.amountB.toString()).mul(m).toFixed(0)),(T=o[e.mintB.mint.toString()])==null?void 0:T.feeConfig,u,c)];return{liquidity:i,amountA:w,amountB:g,amountSlippageA:h,amountSlippageB:p,expirationTime:Er(w.expirationTime,g.expirationTime)}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){const i=n?t:new H(1).div(t),s=li.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=ce.getSqrtPriceX64FromTick(s),o=ce.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:s,price:o}:{tick:s,price:new H(1).div(o)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){const i=ce.getSqrtPriceX64FromTick(t),s=ce.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:s,tickSqrtPriceX64:i}:{tick:t,price:new H(1).div(s),tickSqrtPriceX64:i}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,token2022Infos:n,epochInfo:i,amountIn:s,currencyOut:a,slippage:o,catchLiquidityInsufficient:u=!1}){const c=s instanceof le,l=(c?s.token:F.WSOL).mint,d=s.raw,m=o.numerator.toNumber()/o.denominator.toNumber(),{allTrade:f,realAmountIn:w,amountOut:g,minAmountOut:h,expirationTime:p,currentPrice:A,executionPrice:k,priceImpact:S,fee:T,remainingAccounts:y}=this.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:l,amountIn:d,slippage:m,token2022Infos:n,epochInfo:i,catchLiquidityInsufficient:u}),I={...w,amount:c?new le(s.token,w.amount):new Re(St.SOL,w.amount),fee:w.fee===void 0?void 0:c?new le(s.token,w.fee):new Re(St.SOL,w.fee)},E={...g,amount:a instanceof F?new le(a,g.amount):new Re(a,g.amount),fee:g.fee===void 0?void 0:a instanceof F?new le(a,g.fee):new Re(a,g.fee)},v={...h,amount:a instanceof F?new le(a,h.amount):new Re(a,h.amount),fee:h.fee===void 0?void 0:a instanceof F?new le(a,h.fee):new Re(a,h.fee)},L=new De(c?s.token:s.currency,new B(10).pow(new B(20+(c?s.token:s.currency).decimals)),a instanceof F?a:F.WSOL,A.mul(new H(10**(20+(a instanceof F?a:F.WSOL).decimals))).toFixed(0)),x=new De(c?s.token:s.currency,new B(10).pow(new B(20+(c?s.token:s.currency).decimals)),a instanceof F?a:F.WSOL,k.mul(new H(10**(20+(a instanceof F?a:F.WSOL).decimals))).toFixed(0)),q=c?new le(s.token,T):new Re(s.currency,T);return{allTrade:f,realAmountIn:I,amountOut:E,minAmountOut:v,expirationTime:p,currentPrice:L,executionPrice:x,priceImpact:S,fee:q,remainingAccounts:y}}static async computeAmountOutAndCheckToken({connection:e,poolInfo:t,tickArrayCache:n,baseMint:i,amountIn:s,slippage:a,priceLimit:o=new H(0),catchLiquidityInsufficient:u=!1}){const c=await e.getEpochInfo(),l=await ji({connection:e,mints:[t.mintA,t.mintB].filter(d=>d.programId.equals(mt)).map(d=>d.mint)});return this.computeAmountOut({poolInfo:t,tickArrayCache:n,baseMint:i,amountIn:s,slippage:a,priceLimit:o,token2022Infos:l,epochInfo:c,catchLiquidityInsufficient:u})}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:s,amountIn:a,slippage:o,priceLimit:u=new H(0),catchLiquidityInsufficient:c=!1}){var X,U,re,J,ve;let l;u.equals(new H(0))?l=n.equals(e.mintA.mint)?Gt.add(Te):zt.sub(Te):l=ce.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);const d=We(a,(X=i[n.toString()])==null?void 0:X.feeConfig,s,!1),{allTrade:m,realTradeAmountIn:f,expectedAmountOut:w,remainingAccounts:g,executionPrice:h,feeAmount:p}=et.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((U=d.fee)!=null?U:$),l,c),A=We(f,(re=i[n.toString()])==null?void 0:re.feeConfig,s,!0),k=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,S=We(w,(J=i[k.toString()])==null?void 0:J.feeConfig,s,!1),T=ce.sqrtPriceX64ToPrice(h,e.mintA.decimals,e.mintB.decimals),y=n.equals(e.mintA.mint)?T:new H(1).div(T),I=w.mul(new B(Math.floor((1-o)*1e10))).div(new B(1e10)),E=We(I,(ve=i[k.toString()])==null?void 0:ve.feeConfig,s,!1),v=e.mintA.mint.equals(n)?e.currentPrice:new H(1).div(e.currentPrice),L=new H(y).sub(v).abs(),x=v,q=new xt(new H(L).mul(10**15).toFixed(0),new H(x).mul(10**15).toFixed(0));return{allTrade:m,realAmountIn:A,amountOut:S,minAmountOut:E,expirationTime:Er(A.expirationTime,S.expirationTime),currentPrice:e.currentPrice,executionPrice:y,priceImpact:q,fee:p,remainingAccounts:g}}static async computeAmountInAndCheckToken({connection:e,poolInfo:t,tickArrayCache:n,baseMint:i,amountOut:s,slippage:a,priceLimit:o=new H(0)}){const u=await e.getEpochInfo(),c=await ji({connection:e,mints:[t.mintA,t.mintB].filter(l=>l.programId.equals(mt)).map(l=>l.mint)});return this.computeAmountIn({poolInfo:t,tickArrayCache:n,baseMint:i,amountOut:s,slippage:a,priceLimit:o,token2022Infos:c,epochInfo:u})}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,token2022Infos:i,epochInfo:s,amountOut:a,slippage:o,priceLimit:u=new H(0)}){var v,L,x,q;let c;u.equals(new H(0))?c=n.equals(e.mintB.mint)?Gt.add(Te):zt.sub(Te):c=ce.priceToSqrtPriceX64(u,e.mintA.decimals,e.mintB.decimals);const l=We(a,(v=i[n.toString()])==null?void 0:v.feeConfig,s,!0),{expectedAmountIn:d,remainingAccounts:m,executionPrice:f,feeAmount:w}=et.getInputAmountAndRemainAccounts(e,t,n,l.amount.sub((L=l.fee)!=null?L:$),c),g=e.mintA.mint.equals(n)?e.mintB.mint:e.mintA.mint,h=We(d,(x=i[g.toString()])==null?void 0:x.feeConfig,s,!0),p=ce.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),A=n.equals(e.mintA.mint)?p:new H(1).div(p),k=d.mul(new B(Math.floor((1+o)*1e10))).div(new B(1e10)),S=We(k,(q=i[g.toString()])==null?void 0:q.feeConfig,s,!0),T=e.mintA.mint.equals(n)?e.currentPrice:new H(1).div(e.currentPrice),y=new H(A).sub(T).abs(),I=T,E=new xt(new H(y).mul(10**15).toFixed(0),new H(I).mul(10**15).toFixed(0));return{amountIn:h,maxAmountIn:S,realAmountOut:l,expirationTime:Er(h.expirationTime,l.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:E,fee:w,remainingAccounts:m}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){const s=e[t],a=this.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),o=this.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(a,s.priceMin),l=Math.min(o,s.priceMax)-u,d=o-a,m=s.priceMax-s.priceMin;let f;return l<=0?f=0:d===l?f=m/l:m===l?f=l/d:f=l/m*(l/d),{feeApr:s.feeApr*f,rewardsApr:[s.rewardApr.A*f,s.rewardApr.B*f,s.rewardApr.C*f],apr:s.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,aprType:t,mintPrice:n,rewardMintDecimals:i,liquidity:s,positionTickLowerIndex:a,positionTickUpperIndex:o,chainTime:u}){const c=t==="day"?1:t==="week"?7:t==="month"?30:0,l=e[t],d=n[e.mintA.mint.toString()],m=n[e.mintB.mint.toString()],f=e.mintA.decimals,w=e.mintB.decimals;if(!l||!d||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};const g=ce.getSqrtPriceX64FromTick(a),h=ce.getSqrtPriceX64FromTick(o),{amountSlippageA:p,amountSlippageB:A}=fe.getAmountsFromLiquidityWithSlippage(e.sqrtPriceX64,g,h,e.liquidity,!1,!1,0),{amountSlippageA:k,amountSlippageB:S}=fe.getAmountsFromLiquidityWithSlippage(e.sqrtPriceX64,g,h,s,!1,!1,0),T=new H(p.toString()).div(new H(10).pow(f)).mul(d.toFixed(f)).add(new H(A.toString()).div(new H(10).pow(w)).mul(m.toFixed(w))),y=new H(k.toString()).div(new H(10).pow(f)).mul(d.toFixed(f)).add(new H(S.toString()).div(new H(10).pow(w)).mul(m.toFixed(w))),I=y.div(T.add(y)).div(y),v=new H(l.volumeFee).mul(365).div(c).mul(I).mul(100).toNumber(),L=3600*24*365,x=e.rewardInfos.map(q=>{const X=i[q.tokenMint.toString()],U=n[q.tokenMint.toString()];return u<q.openTime.toNumber()||u>q.endTime.toNumber()||q.perSecond.equals(0)||!U||X===void 0?0:new H(U.toFixed(X)).mul(q.perSecond.mul(L)).div(new H(10).pow(X)).mul(I).mul(100).toNumber()});return{feeApr:v,rewardsApr:x,apr:v+x.reduce((q,X)=>q+X,0)}}static async fetchMultiplePoolInfos({connection:e,poolKeys:t,ownerInfo:n,chainTime:i,batchRequest:s=!1,updateOwnerRewardAndFee:a=!0}){var f;const o=await bt(e,t.map(w=>new P(w.id)),{batchRequest:s}),u={};for(let w=0;w<t.length;w++){const g=t[w],h=o[w];h!==null&&(u[g.id]=ht(h.owner,new P(g.id)).publicKey)}const c=await this.fetchExBitmaps({connection:e,exBitmapAddress:Object.values(u),batchRequest:s}),l=[],d={},m=[];for(let w=0;w<t.length;w++){const g=t[w],h=o[w],p=c[u[g.id].toString()];if(h===null)continue;const A=Vl.decode(h.data);d[g.id]={state:{id:new P(g.id),mintA:{programId:new P(g.mintProgramIdA),mint:A.mintA,vault:A.vaultA,decimals:A.mintDecimalsA},mintB:{programId:new P(g.mintProgramIdB),mint:A.mintB,vault:A.vaultB,decimals:A.mintDecimalsB},observationId:A.observationId,ammConfig:{...g.ammConfig,id:new P(g.ammConfig.id)},creator:A.creator,programId:h.owner,version:6,tickSpacing:A.tickSpacing,liquidity:A.liquidity,sqrtPriceX64:A.sqrtPriceX64,currentPrice:ce.sqrtPriceX64ToPrice(A.sqrtPriceX64,A.mintDecimalsA,A.mintDecimalsB),tickCurrent:A.tickCurrent,observationIndex:A.observationIndex,observationUpdateDuration:A.observationUpdateDuration,feeGrowthGlobalX64A:A.feeGrowthGlobalX64A,feeGrowthGlobalX64B:A.feeGrowthGlobalX64B,protocolFeesTokenA:A.protocolFeesTokenA,protocolFeesTokenB:A.protocolFeesTokenB,swapInAmountTokenA:A.swapInAmountTokenA,swapOutAmountTokenB:A.swapOutAmountTokenB,swapInAmountTokenB:A.swapInAmountTokenB,swapOutAmountTokenA:A.swapOutAmountTokenA,tickArrayBitmap:A.tickArrayBitmap,rewardInfos:await et.updatePoolRewardInfos({connection:e,apiPoolInfo:g,chainTime:i,poolLiquidity:A.liquidity,rewardInfos:A.rewardInfos.filter(k=>!k.tokenMint.equals(P.default))}),day:g.day,week:g.week,month:g.month,tvl:g.tvl,lookupTableAccount:g.lookupTableAccount?new P(g.lookupTableAccount):P.default,startTime:A.startTime.toNumber(),exBitmapInfo:p}},n&&m.push(...d[g.id].state.rewardInfos.filter(k=>k.creator.equals(n.wallet))),l.find(k=>k.equals(h.owner))||l.push(h.owner)}if(n){const w=n.tokenAccounts.filter(A=>A.accountInfo.amount.eq(new B(1))).map(A=>A.accountInfo.mint),g=[];for(const A of w)for(const k of l)g.push(qt(k,A).publicKey);const h=await bt(e,g,{batchRequest:s}),p={};for(const A of h){if(A===null)continue;const k=Ul.decode(A.data),S=k.poolId.toString(),T=d[S];if(T===void 0)continue;const y=T.state,I=this.getTickPrice({poolInfo:y,tick:k.tickLower,baseIn:!0}),E=this.getTickPrice({poolInfo:y,tick:k.tickUpper,baseIn:!0}),{amountA:v,amountB:L}=fe.getAmountsFromLiquidity(y.sqrtPriceX64,I.tickSqrtPriceX64,E.tickSqrtPriceX64,k.liquidity,!1),x=1/(1-Math.sqrt(Math.sqrt(I.price.div(E.price).toNumber())));d[S].positionAccount=[...(f=d[S].positionAccount)!=null?f:[],{poolId:k.poolId,nftMint:k.nftMint,priceLower:I.price,priceUpper:E.price,amountA:v,amountB:L,tickLower:k.tickLower,tickUpper:k.tickUpper,liquidity:k.liquidity,feeGrowthInsideLastX64A:k.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:k.feeGrowthInsideLastX64B,tokenFeesOwedA:k.tokenFeesOwedA,tokenFeesOwedB:k.tokenFeesOwedB,rewardInfos:k.rewardInfos.map(U=>({...U,pendingReward:new B(0)})),leverage:x,tokenFeeAmountA:new B(0),tokenFeeAmountB:new B(0)}];const q=te.getTickArrayAddressByTick(d[S].state.programId,k.poolId,k.tickLower,d[S].state.tickSpacing),X=te.getTickArrayAddressByTick(d[S].state.programId,k.poolId,k.tickUpper,d[S].state.tickSpacing);p["".concat(d[S].state.programId.toString(),"-").concat(k.poolId.toString(),"-").concat(k.tickLower)]=q,p["".concat(d[S].state.programId.toString(),"-").concat(k.poolId.toString(),"-").concat(k.tickUpper)]=X}if(a){const A=Object.values(p),k=await bt(e,A,{batchRequest:s}),S={};for(let T=0;T<A.length;T++){const y=k[T];if(y===null)continue;const I=A[T];S[I.toString()]={address:I,...Hr.decode(y.data)}}for(const{state:T,positionAccount:y}of Object.values(d))if(y)for(const I of y){const E="".concat(T.programId.toString(),"-").concat(T.id.toString(),"-").concat(I.tickLower),v="".concat(T.programId.toString(),"-").concat(T.id.toString(),"-").concat(I.tickUpper),L=S[p[E].toString()],x=S[p[v].toString()],q=L.ticks[te.getTickOffsetInArray(I.tickLower,T.tickSpacing)],X=x.ticks[te.getTickOffsetInArray(I.tickUpper,T.tickSpacing)],{tokenFeeAmountA:U,tokenFeeAmountB:re}=As.GetPositionFees(T,I,q,X),J=As.GetPositionRewards(T,I,q,X);I.tokenFeeAmountA=U.gte($)&&U.lt(Rr)?U:$,I.tokenFeeAmountB=re.gte($)&&U.lt(Rr)?re:$;for(let ve=0;ve<J.length;ve++)I.rewardInfos[ve].pendingReward=J[ve].gte($)&&J[ve].lt(Rr)?J[ve]:$}}}if(m.length>0){const w=m.map(p=>p.tokenVault),g=await bt(e,w,{batchRequest:s}),h={};for(let p=0;p<w.length;p++){const A=w[p].toString(),k=g[p];if(k===null)continue;const S=tt.decode(k.data);h[A]=S.amount}for(const p of m){const A=h[p.tokenVault.toString()];p.remainingRewards=A!==void 0?A.sub(p.rewardTotalEmissioned.sub(p.rewardClaimed)):$}}return d}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){const i={},s=[];for(const u of t){const c=te.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=te.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(const d of l){const{publicKey:m}=Se(u.programId,u.id,d);s.push({pubkey:m}),i[m.toString()]=u.id}}const a=await sr(e,s,{batchRequest:n}),o={};for(const u of a){if(!u.accountInfo)continue;const c=i[u.pubkey.toString()];if(!c)continue;o[c.toString()]===void 0&&(o[c.toString()]={});const l=Hr.decode(u.accountInfo.data);o[c.toString()][l.startTickIndex]={...l,address:u.pubkey}}return o}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){const i=await sr(e,t.map(a=>({pubkey:a})),{batchRequest:n}),s={};for(const a of i)a.accountInfo!==null&&(s[a.pubkey.toString()]=Xl.decode(a.accountInfo.data));return s}static async getWhiteListMint({connection:e,programId:t}){const n=await e.getAccountInfo(Pr(t).publicKey);return n?zl.decode(n.data).whitelistMints.filter(s=>!s.equals(P.default)):[]}}const pa="9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin",Hl=new P(pa),Ql={[pa]:3},Zl={3:Hl},di=W([Oe(5),Oe(8),C("ownAddress"),b("vaultSignerNonce"),C("baseMint"),C("quoteMint"),C("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),C("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),C("requestQueue"),C("eventQueue"),C("bids"),C("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),Oe(7)]),jl={3:di},Hn=se.from("Serum");class Zr{static getProgramId(e){const t=Zl[e];return Hn.assertArgument(!!t,"invalid version","version",e),t}static getVersion(e){const t=e.toBase58(),n=Ql[t];return Hn.assertArgument(!!n,"invalid program id","programId",t),n}static getStateLayout(e){const t=jl[e];return Hn.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){const n=[t.toBuffer()];let i=0,s;for(;i<100;){try{const a=n.concat(N.from([i]),N.alloc(7));s=P.createProgramAddressSync(a,e)}catch(a){if(a instanceof TypeError)throw a;i++;continue}return{publicKey:s,nonce:i}}return Hn.throwArgumentError("unable to find a viable program address nonce","params",{programId:e,marketId:t})}}const bn=new P("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),tn=5e4,Kl=W([b("x"),b("y"),b("price")]),Jl=W([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),Z(Kl,tn,"DataElement")]);function ed(r,e){return[0,tn-2]}function td(r){return[0,tn-2]}function nd(r){return[0,tn-2]}function rd(r,e,t){const[n,i]=ed();let s=n,a=i,o=0;const u=e*r.multiplier/t;for(;s<=a;){if(o=Math.floor((a+s)/2),o===0||o>=tn-2)return[o,o,!1];const c=r.DataElement[o].x*r.multiplier/r.DataElement[o].y,l=r.DataElement[o-1].x*r.multiplier/r.DataElement[o-1].y,d=r.DataElement[o+1].x*r.multiplier/r.DataElement[o+1].y;if(u===c)return[o,o,!0];if(u===l)return[o-1,o-1,!0];if(u===d)return[o+1,o+1,!0];if(u<l)a=o-1;else{if(u>l&&u<c)return[o-1,o,!0];if(u>c&&u<d)return[o,o+1,!0];s=o+1}}return[o,o,!1]}function mi(r,e,t){const[n,i,s]=rd(r,e,t);if(!s)return 0;if(n===i){const a=r.DataElement[n].x;return e*r.multiplier/a}else{const a=r.DataElement[n].x,o=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*o-a*c),d=a*l,m=(u-a)*(e*o-a*t)*c,f=d+m;return e*r.multiplier*l/f}}function Yt(r,e,t){return e*r.multiplier/t}function ga(r,e,t){return e*t/r.multiplier}function id(r,e){const[t,n]=td();let i=t,s=n,a=0;const o=e;for(;i<s;){if(a=Math.floor((s+i)/2),a<=0||a>tn-2)return[a,a,!1];const u=r.DataElement[a].x,c=r.DataElement[a-1].x,l=r.DataElement[a+1].x;if(o===u)return[a,a,!0];if(o===c)return[a-1,a-1,!0];if(o===l)return[a+1,a+1,!0];if(o<c)s=a-1;else{if(o>c&&o<u)return[a-1,a,!0];if(o>u&&o<l)return[a,a+1,!0];i=a+1}}return[a,a,!1]}function sd(r,e){const[t,n]=nd();let i=t,s=n,a=0;const o=e;for(;i<=s;){if(a=Math.floor((s+i)/2),a<=0||a>=tn-2)return[a,a,!1];const u=r.DataElement[a].y,c=r.DataElement[a-1].y,l=r.DataElement[a+1].y;if(o===u)return[a,a,!0];if(o===c)return[a-1,a-1,!0];if(o===l)return[a+1,a+1,!0];if(o<l)i=a+1;else{if(o<c&&o>u)return[a-1,a,!0];if(o<u&&o>l)return[a,a+1,!0];s=a-1}}return[a,a,!1]}function wa(r,e,t,n){const i=n?e+t:e-t,[s,a,o]=id(r,i);if(!o)return[0,0,!1,o];if(s===a)return[r.DataElement[a].price,r.DataElement[a].y,!1,o];{const u=r.DataElement[s].x,c=r.DataElement[a].x,l=r.DataElement[s].price,d=r.DataElement[a].price,m=r.DataElement[s].y,f=r.DataElement[a].y;if(e>=u&&e<=c)return n?[d,f,!0,o]:[l,m,!0,o];{let w,g;return n?(w=l+(d-l)*(e-u)/(c-u),g=m-(i-u)*r.multiplier/d):(w=l+(d-l)*(e-u)/(c-u),g=f+(c-i)*r.multiplier/l),[w,g,!1,o]}}}function ad(r,e,t,n){const i=n?e-t:e+t,[s,a,o]=sd(r,i);if(!o)return[0,0,!1,o];if(s===a)return[r.DataElement[a].price,r.DataElement[a].x,!1,o];{const u=r.DataElement[s].x,c=r.DataElement[a].x,l=r.DataElement[s].price,d=r.DataElement[a].price,m=r.DataElement[s].y,f=r.DataElement[a].y;if(e>=f&&e<=m)return n?[d,c,!0,o]:[l,u,!0,o];{let w,g;return n?(w=l+(d-l)*(m-e)/(m-f),g=u+d*(m-i)/r.multiplier):(w=l+(d-l)*(m-e)/(m-f),g=c-l*(i-f)/r.multiplier),[w,g,!1,o]}}}function od(r,e){const t=wa(r,e,0,!1);return t[3]?t[0]:0}function cd(r,e,t,n){const i=mi(r,e,t),s=Yt(r,e,i),a=Yt(r,t,i),o=Yt(r,n,i),u=!0,[c,l,d,m]=wa(r,s,o,u);if(!m)return 0;if(d)return n*r.multiplier/c;{const f=a-l;return ga(r,f,i)}}function ud(r,e,t,n){const i=mi(r,e,t),s=Yt(r,e,i),a=Yt(r,t,i),o=Yt(r,n,i),u=!1,[c,l,d,m]=ad(r,a,o,u);if(!m)return 0;if(d)return n*c/r.multiplier;{const f=s-l;return ga(r,f,i)}}function ld(r){const e=Jl.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function dd(r,e,t,n){const i=od(r,Yt(r,e,mi(r,e,t)))/r.multiplier;return n?i:1/i}var vn;const G=se.from("Liquidity");let Bn={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};async function md(r){if(Bn.validDataCount===0&&r){const e=await r.getAccountInfo(bn);e&&(Bn=ld(e==null?void 0:e.data))}}var ct;(function(r){r[r.Uninitialized=0]="Uninitialized",r[r.Initialized=1]="Initialized",r[r.Disabled=2]="Disabled",r[r.RemoveLiquidityOnly=3]="RemoveLiquidityOnly",r[r.LiquidityOnly=4]="LiquidityOnly",r[r.OrderBook=5]="OrderBook",r[r.Swap=6]="Swap",r[r.WaitingForStart=7]="WaitingForStart"})(ct||(ct={}));const Aa=new B(25),jr=new B(1e4);class fi extends Ar{static getStateLayout(e){const t=os[e];return G.assertArgument(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedId({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("amm_associated_seed","utf-8")],e);return n}static getAssociatedAuthority({programId:e}){return de([N.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],e)}static getAssociatedBaseVault({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("coin_vault_associated_seed","utf-8")],e);return n}static getAssociatedQuoteVault({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("pc_vault_associated_seed","utf-8")],e);return n}static getAssociatedLpMint({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("lp_mint_associated_seed","utf-8")],e);return n}static getAssociatedLpVault({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("temp_lp_token_associated_seed","utf-8")],e);return n}static getAssociatedTargetOrders({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("target_associated_seed","utf-8")],e);return n}static getAssociatedWithdrawQueue({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("withdraw_associated_seed","utf-8")],e);return n}static getAssociatedOpenOrders({programId:e,marketId:t}){const{publicKey:n}=de([e.toBuffer(),t.toBuffer(),N.from("open_order_associated_seed","utf-8")],e);return n}static getAssociatedConfigId({programId:e}){const{publicKey:t}=de([N.from("amm_config_account_seed","utf-8")],e);return t}static getAssociatedPoolKeys({version:e,marketVersion:t,marketId:n,baseMint:i,quoteMint:s,baseDecimals:a,quoteDecimals:o,programId:u,marketProgramId:c}){const l=this.getAssociatedId({programId:u,marketId:n}),d=this.getAssociatedLpMint({programId:u,marketId:n}),{publicKey:m,nonce:f}=this.getAssociatedAuthority({programId:u}),w=this.getAssociatedBaseVault({programId:u,marketId:n}),g=this.getAssociatedQuoteVault({programId:u,marketId:n}),h=this.getAssociatedLpVault({programId:u,marketId:n}),p=this.getAssociatedOpenOrders({programId:u,marketId:n}),A=this.getAssociatedTargetOrders({programId:u,marketId:n}),k=this.getAssociatedWithdrawQueue({programId:u,marketId:n}),{publicKey:S}=Zr.getAssociatedAuthority({programId:c,marketId:n});return{id:l,baseMint:i,quoteMint:s,lpMint:d,baseDecimals:a,quoteDecimals:o,lpDecimals:a,version:e,programId:u,authority:m,nonce:f,baseVault:w,quoteVault:g,lpVault:h,openOrders:p,targetOrders:A,withdrawQueue:k,marketVersion:t,marketProgramId:c,marketId:n,marketAuthority:S,lookupTableAccount:P.default,configId:this.getAssociatedConfigId({programId:u})}}static async getCreatePoolFee({connection:e,programId:t}){const n=this.getAssociatedConfigId({programId:t}),i=W([b("fee")]),s=await e.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(s===null)throw Error("get config account error");return i.decode(s.data).fee}static makeAddLiquidityInstruction(e){const{poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:s,fixedSide:a}=e,{version:o}=t;if(o===4||o===5){const u=W([V("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide")]),c=N.alloc(u.span);u.encode({instruction:3,baseAmountIn:z(i),quoteAmountIn:z(s),fixedSide:z(a==="base"?0:1)},c);const l=[R(_,!1),O(t.id,!1),R(t.authority,!1),R(t.openOrders,!1),O(t.targetOrders,!1),O(t.lpMint,!1),O(t.baseVault,!1),O(t.quoteVault,!1)];return o===5&&l.push(O(bn,!1)),l.push(R(t.marketId,!1),O(n.baseTokenAccount,!1),O(n.quoteTokenAccount,!1),O(n.lpTokenAccount,!1),R(n.owner,!0),R(t.marketEventQueue,!1)),{address:{},innerTransaction:{instructions:[new ne({programId:t.programId,keys:l,data:c})],signers:[],lookupTableAddress:[t.lookupTableAccount].filter(d=>d&&!d.equals(P.default)),instructionTypes:[o===4?Q.ammV4AddLiquidity:Q.ammV5AddLiquidity]}}}return G.throwArgumentError("invalid version","poolKeys.version",o)}static async makeAddLiquidityInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:i,amountInA:s,amountInB:a,fixedSide:o,config:u,makeTxVersion:c,lookupTableCache:l,computeBudgetConfig:d}=e,{lpMint:m}=n,{tokenAccounts:f,owner:w,payer:g=w}=i;G.debug("amountInA:",s),G.debug("amountInB:",a),G.assertArgument(!s.isZero()&&!a.isZero(),"amounts must greater than zero","amountInA & amountInB",{amountInA:s.toFixed(),amountInB:a.toFixed()});const{bypassAssociatedCheck:h,checkCreateATAOwner:p}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...u},A=s instanceof le?s.token:F.WSOL,k=a instanceof le?a.token:F.WSOL,S=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:A.mint,owner:w,config:{associatedOnly:!1}}),T=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:k.mint,owner:w,config:{associatedOnly:!1}});G.assertArgument(!!S||!!T,"cannot found target token accounts","tokenAccounts",f);const y=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:m,owner:w}),I=[A,k],E=[S,T],v=[s.raw,a.raw],[L]=this._getAmountsSide(s,a,n);let x="base";if(L==="quote")if(I.reverse(),E.reverse(),v.reverse(),o==="a")x="quote";else if(o==="b")x="base";else return G.throwArgumentError("invalid fixedSide","fixedSide",o);else if(L==="base")if(o==="a")x="base";else if(o==="b")x="quote";else return G.throwArgumentError("invalid fixedSide","fixedSide",o);else return G.throwArgumentError("invalid fixedSide","fixedSide",o);const[q,X]=I,[U,re]=E,[J,ve]=v,wt=[],At=[],Ct=[],Ge=[],It=[],qn=await this._handleTokenAccount({programId:_,connection:t,side:"in",amount:J,mint:q.mint,tokenAccount:U,owner:w,payer:g,frontInstructions:wt,endInstructions:At,signers:It,bypassAssociatedCheck:h,frontInstructionsType:Ct,endInstructionsType:Ge,checkCreateATAOwner:p}),ha=await this._handleTokenAccount({programId:_,connection:t,side:"in",amount:ve,mint:X.mint,tokenAccount:re,owner:w,payer:g,frontInstructions:wt,endInstructions:At,signers:It,bypassAssociatedCheck:h,frontInstructionsType:Ct,endInstructionsType:Ge,checkCreateATAOwner:p}),gi=await this._handleTokenAccount({programId:_,connection:t,side:"out",amount:0,mint:m,tokenAccount:y,owner:w,payer:g,frontInstructions:wt,endInstructions:At,signers:It,bypassAssociatedCheck:h,frontInstructionsType:Ct,endInstructionsType:Ge,checkCreateATAOwner:p}),ka=this.makeAddLiquidityInstruction({poolKeys:n,userKeys:{baseTokenAccount:qn,quoteTokenAccount:ha,lpTokenAccount:gi,owner:w},baseAmountIn:J,quoteAmountIn:ve,fixedSide:x});return{address:{lpTokenAccount:gi},innerTransactions:await ue({connection:t,makeTxVersion:c,computeBudgetConfig:d,payer:g,innerTransaction:[{instructionTypes:Ct,instructions:wt,signers:It},ka.innerTransaction,{instructionTypes:Ge,instructions:At,signers:[]}],lookupTableCache:l})}}static makeRemoveLiquidityInstruction(e){const{poolKeys:t,userKeys:n,amountIn:i}=e,{version:s}=t;if(s===4||s===5){const a=W([V("instruction"),b("amountIn")]),o=N.alloc(a.span);a.encode({instruction:4,amountIn:z(i)},o);const u=[R(_,!1),O(t.id,!1),R(t.authority,!1),O(t.openOrders,!1),O(t.targetOrders,!1),O(t.lpMint,!1),O(t.baseVault,!1),O(t.quoteVault,!1)];return s===5?u.push(O(bn,!1)):(u.push(O(t.withdrawQueue,!1)),u.push(O(t.lpVault,!1))),u.push(R(t.marketProgramId,!1),O(t.marketId,!1),O(t.marketBaseVault,!1),O(t.marketQuoteVault,!1),R(t.marketAuthority,!1),O(n.lpTokenAccount,!1),O(n.baseTokenAccount,!1),O(n.quoteTokenAccount,!1),R(n.owner,!0),O(t.marketEventQueue,!1),O(t.marketBids,!1),O(t.marketAsks,!1)),{address:{},innerTransaction:{instructions:[new ne({programId:t.programId,keys:u,data:o})],signers:[],lookupTableAddress:[t.lookupTableAccount].filter(c=>c&&!c.equals(P.default)),instructionTypes:[s===4?Q.ammV4RemoveLiquidity:Q.ammV5RemoveLiquidity]}}}return G.throwArgumentError("invalid version","poolKeys.version",s)}static async makeRemoveLiquidityInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:i,amountIn:s,config:a,makeTxVersion:o,lookupTableCache:u,computeBudgetConfig:c}=e,{baseMint:l,quoteMint:d,lpMint:m}=n,{tokenAccounts:f,owner:w,payer:g=w}=i;G.debug("amountIn:",s),G.assertArgument(!s.isZero(),"amount must greater than zero","amountIn",s.toFixed()),G.assertArgument(s instanceof le&&s.token.mint.equals(m),"amountIn's token not match lpMint","amountIn",s);const h=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:m,owner:w,config:{associatedOnly:!1}});if(!h)return G.throwArgumentError("cannot found lpTokenAccount","tokenAccounts",f);const p=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:l,owner:w}),A=this._selectTokenAccount({programId:_,tokenAccounts:f,mint:d,owner:w}),{bypassAssociatedCheck:k,checkCreateATAOwner:S}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...a},T=[],y=[],I=[],E=[],v=[],L=h,x=await this._handleTokenAccount({programId:_,connection:t,side:"out",amount:0,mint:l,tokenAccount:p,owner:w,payer:g,frontInstructions:T,endInstructions:y,signers:v,bypassAssociatedCheck:k,frontInstructionsType:I,checkCreateATAOwner:S}),q=await this._handleTokenAccount({programId:_,connection:t,side:"out",amount:0,mint:d,tokenAccount:A,owner:w,payer:g,frontInstructions:T,endInstructions:y,signers:v,bypassAssociatedCheck:k,frontInstructionsType:I,checkCreateATAOwner:S}),X=this.makeRemoveLiquidityInstruction({poolKeys:n,userKeys:{lpTokenAccount:L,baseTokenAccount:x,quoteTokenAccount:q,owner:w},amountIn:s.raw});return{address:{lpTokenAccount:L},innerTransactions:await ue({connection:t,makeTxVersion:o,computeBudgetConfig:c,payer:g,innerTransaction:[{instructionTypes:I,instructions:T,signers:v},X.innerTransaction,{instructionTypes:E,instructions:y,signers:[]}],lookupTableCache:u})}}static makeSwapInstruction(e){const{poolKeys:t,userKeys:n,amountIn:i,amountOut:s,fixedSide:a}=e,{version:o}=t;return o===4||o===5?a==="in"?this.makeSwapFixedInInstruction({poolKeys:t,userKeys:n,amountIn:i,minAmountOut:s},o):a==="out"?this.makeSwapFixedOutInstruction({poolKeys:t,userKeys:n,maxAmountIn:i,amountOut:s},o):G.throwArgumentError("invalid params","params",e):G.throwArgumentError("invalid version","poolKeys.version",o)}static makeSwapFixedInInstruction({poolKeys:e,userKeys:t,amountIn:n,minAmountOut:i},s){const a=W([V("instruction"),b("amountIn"),b("minAmountOut")]),o=N.alloc(a.span);a.encode({instruction:9,amountIn:z(n),minAmountOut:z(i)},o);const u=[R(_,!1),O(e.id,!1),R(e.authority,!1),O(e.openOrders,!1)];return s===4&&u.push(O(e.targetOrders,!1)),u.push(O(e.baseVault,!1),O(e.quoteVault,!1)),s===5&&u.push(O(bn,!1)),u.push(R(e.marketProgramId,!1),O(e.marketId,!1),O(e.marketBids,!1),O(e.marketAsks,!1),O(e.marketEventQueue,!1),O(e.marketBaseVault,!1),O(e.marketQuoteVault,!1),R(e.marketAuthority,!1),O(t.tokenAccountIn,!1),O(t.tokenAccountOut,!1),R(t.owner,!0)),{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:u,data:o})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter(c=>c&&!c.equals(P.default)),instructionTypes:[s===4?Q.ammV4SwapBaseIn:Q.ammV5SwapBaseIn]}}}static makeSwapFixedOutInstruction({poolKeys:e,userKeys:t,maxAmountIn:n,amountOut:i},s){const a=W([V("instruction"),b("maxAmountIn"),b("amountOut")]),o=N.alloc(a.span);a.encode({instruction:11,maxAmountIn:z(n),amountOut:z(i)},o);const u=[R(_,!1),O(e.id,!1),R(e.authority,!1),O(e.openOrders,!1),O(e.targetOrders,!1),O(e.baseVault,!1),O(e.quoteVault,!1)];return s===5&&u.push(O(bn,!1)),u.push(R(e.marketProgramId,!1),O(e.marketId,!1),O(e.marketBids,!1),O(e.marketAsks,!1),O(e.marketEventQueue,!1),O(e.marketBaseVault,!1),O(e.marketQuoteVault,!1),R(e.marketAuthority,!1),O(t.tokenAccountIn,!1),O(t.tokenAccountOut,!1),R(t.owner,!0)),{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:u,data:o})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter(c=>c&&!c.equals(P.default)),instructionTypes:[s===4?Q.ammV4SwapBaseOut:Q.ammV5SwapBaseOut]}}}static async makeSwapInstructionSimple(e){const{connection:t,poolKeys:n,userKeys:i,amountIn:s,amountOut:a,fixedSide:o,config:u,makeTxVersion:c,lookupTableCache:l,computeBudgetConfig:d}=e,{tokenAccounts:m,owner:f,payer:w=f}=i;G.debug("amountIn:",s),G.debug("amountOut:",a),G.assertArgument(!s.isZero()&&!a.isZero(),"amounts must greater than zero","currencyAmounts",{amountIn:s.toFixed(),amountOut:a.toFixed()});const{bypassAssociatedCheck:g,checkCreateATAOwner:h}={bypassAssociatedCheck:!1,checkCreateATAOwner:!1,...u},p=s instanceof le?s.token:F.WSOL,A=a instanceof le?a.token:F.WSOL,k=this._selectTokenAccount({programId:_,tokenAccounts:m,mint:p.mint,owner:f,config:{associatedOnly:!1}}),S=this._selectTokenAccount({programId:_,tokenAccounts:m,mint:A.mint,owner:f}),[T,y]=[s.raw,a.raw],I=[],E=[],v=[],L=[],x=[],q=await this._handleTokenAccount({programId:_,connection:t,side:"in",amount:T,mint:p.mint,tokenAccount:k,owner:f,payer:w,frontInstructions:I,endInstructions:E,signers:x,bypassAssociatedCheck:g,frontInstructionsType:v,checkCreateATAOwner:h}),X=await this._handleTokenAccount({programId:_,connection:t,side:"out",amount:0,mint:A.mint,tokenAccount:S,owner:f,payer:w,frontInstructions:I,endInstructions:E,signers:x,bypassAssociatedCheck:g,frontInstructionsType:v,checkCreateATAOwner:h}),U=this.makeSwapInstruction({poolKeys:n,userKeys:{tokenAccountIn:q,tokenAccountOut:X,owner:f},amountIn:T,amountOut:y,fixedSide:o});return{address:{},innerTransactions:await ue({connection:t,makeTxVersion:c,computeBudgetConfig:d,payer:w,innerTransaction:[{instructionTypes:v,instructions:I,signers:x},U.innerTransaction,{instructionTypes:L,instructions:E,signers:[]}],lookupTableCache:l})}}static makeSimulatePoolInfoInstruction({poolKeys:e}){const t=W([V("instruction"),V("simulateType")]),n=N.alloc(t.span);t.encode({instruction:12,simulateType:0},n);const i=[R(e.id,!1),R(e.authority,!1),R(e.openOrders,!1),R(e.baseVault,!1),R(e.quoteVault,!1),R(e.lpMint,!1),R(e.marketId,!1),R(e.marketEventQueue,!1)];return{address:{},innerTransaction:{instructions:[new ne({programId:e.programId,keys:i,data:n})],signers:[],lookupTableAddress:[e.lookupTableAccount].filter(s=>s&&!s.equals(P.default)),instructionTypes:[e.version===4?Q.ammV4SimulatePoolInfo:Q.ammV5SimulatePoolInfo]}}}static isV4(e){return e.withdrawQueue!==void 0}static async makeCreatePoolV4InstructionV2Simple({connection:e,programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:s,baseAmount:a,quoteAmount:o,startTime:u,ownerInfo:c,associatedOnly:l=!1,computeBudgetConfig:d,checkCreateATAOwner:m=!1,makeTxVersion:f,lookupTableCache:w,feeDestinationId:g}){const h=[],p=[],A=[],k=[],S=[],T=c.useSOLBalance&&i.mint.equals(F.WSOL.mint),y=c.useSOLBalance&&s.mint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:_,mint:i.mint,tokenAccounts:T?[]:c.tokenAccounts,owner:c.wallet,createInfo:T?{connection:e,payer:c.feePayer,amount:a,frontInstructions:h,frontInstructionsType:A,endInstructions:T?p:[],endInstructionsType:T?k:[],signers:S}:void 0,associatedOnly:T?!1:l,checkCreateATAOwner:m}),E=await this._selectOrCreateTokenAccount({programId:_,mint:s.mint,tokenAccounts:y?[]:c.tokenAccounts,owner:c.wallet,createInfo:y?{connection:e,payer:c.feePayer,amount:o,frontInstructions:h,frontInstructionsType:A,endInstructions:y?p:[],endInstructionsType:y?k:[],signers:S}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});if(I===void 0||E===void 0)throw Error("you don't has some token account");const v=vn.getAssociatedPoolKeys({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:s.mint,baseDecimals:i.decimals,quoteDecimals:s.decimals,programId:t,marketProgramId:n.programId}),L=this.makeCreatePoolV4InstructionV2({programId:t,ammId:v.id,ammAuthority:v.authority,ammOpenOrders:v.openOrders,lpMint:v.lpMint,coinMint:v.baseMint,pcMint:v.quoteMint,coinVault:v.baseVault,pcVault:v.quoteVault,ammTargetOrders:v.targetOrders,marketProgramId:v.marketProgramId,marketId:v.marketId,userWallet:c.wallet,userCoinVault:I,userPcVault:E,userLpVault:Ee(c.wallet,v.lpMint,_).publicKey,ammConfigId:v.configId,feeDestinationId:g,nonce:v.nonce,openTime:u,coinAmount:a,pcAmount:o}).innerTransaction;return{address:{programId:t,ammId:v.id,ammAuthority:v.authority,ammOpenOrders:v.openOrders,lpMint:v.lpMint,coinMint:v.baseMint,pcMint:v.quoteMint,coinVault:v.baseVault,pcVault:v.quoteVault,withdrawQueue:v.withdrawQueue,ammTargetOrders:v.targetOrders,poolTempLp:v.lpVault,marketProgramId:v.marketProgramId,marketId:v.marketId},innerTransactions:await ue({connection:e,makeTxVersion:f,computeBudgetConfig:d,payer:c.feePayer,innerTransaction:[{instructionTypes:A,instructions:h,signers:S},L,{instructionTypes:k,instructions:p,signers:[]}],lookupTableCache:w})}}static makeCreatePoolV4InstructionV2({programId:e,ammId:t,ammAuthority:n,ammOpenOrders:i,lpMint:s,coinMint:a,pcMint:o,coinVault:u,pcVault:c,ammTargetOrders:l,marketProgramId:d,marketId:m,userWallet:f,userCoinVault:w,userPcVault:g,userLpVault:h,nonce:p,openTime:A,coinAmount:k,pcAmount:S,lookupTableAddress:T,ammConfigId:y,feeDestinationId:I}){const E=W([V("instruction"),V("nonce"),b("openTime"),b("pcAmount"),b("coinAmount")]),v=[{pubkey:_,isSigner:!1,isWritable:!1},{pubkey:mn,isSigner:!1,isWritable:!1},{pubkey:Ce,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:I,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!0,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0}],L=N.alloc(E.span);E.encode({instruction:1,nonce:p,openTime:A,coinAmount:k,pcAmount:S},L);const x=new ne({keys:v,programId:e,data:L});return{address:{},innerTransaction:{instructions:[x],signers:[],lookupTableAddress:T?[T]:void 0,instructionTypes:[Q.ammV4CreatePoolV2]}}}static async makeRemoveAllLpAndCreateClmmPosition({connection:e,poolKeys:t,removeLpAmount:n,userKeys:i,clmmPoolKeys:s,createPositionInfo:a,farmInfo:o,computeBudgetConfig:u,checkCreateATAOwner:c=!1,getEphemeralSigners:l,makeTxVersion:d,lookupTableCache:m}){var U,re,J,ve,wt,At,Ct;if(!(t.baseMint.equals(s.mintA.mint)||t.baseMint.equals(s.mintB.mint))||!(t.quoteMint.equals(s.mintA.mint)||t.quoteMint.equals(s.mintB.mint)))throw Error("mint check error");const f=[],w=[],g=[],h=[],p=[],A={};for(const Ge of i.tokenAccounts)(A[Ge.accountInfo.mint.toString()]===void 0||Ee(i.owner,Ge.accountInfo.mint,_).publicKey.equals(Ge.pubkey))&&(A[Ge.accountInfo.mint.toString()]=Ge.pubkey);const k=A[t.lpMint.toString()];if(k===void 0)throw Error("find lp account error in trade accounts");const S=n.add((U=o==null?void 0:o.amount)!=null?U:new B(0)),T=t.baseMint.equals(F.WSOL.mint),y=t.quoteMint.equals(F.WSOL.mint),I=await this._selectOrCreateTokenAccount({programId:_,mint:t.baseMint,tokenAccounts:i.tokenAccounts,owner:i.owner,createInfo:{connection:e,payer:(re=i.payer)!=null?re:i.owner,frontInstructions:f,frontInstructionsType:g,endInstructions:T?w:[],endInstructionsType:T?h:[],signers:p},associatedOnly:!0,checkCreateATAOwner:c}),E=await this._selectOrCreateTokenAccount({programId:_,mint:t.quoteMint,tokenAccounts:i.tokenAccounts,owner:i.owner,createInfo:{connection:e,payer:(J=i.payer)!=null?J:i.owner,amount:0,frontInstructions:f,frontInstructionsType:g,endInstructions:y?w:[],endInstructionsType:y?h:[],signers:p},associatedOnly:!0,checkCreateATAOwner:c});A[t.baseMint.toString()]=I,A[t.quoteMint.toString()]=E;const v=this.makeRemoveLiquidityInstruction({poolKeys:t,userKeys:{lpTokenAccount:k,baseTokenAccount:I,quoteTokenAccount:E,owner:i.owner},amountIn:S}),[L,x]=t.baseMint.equals(s.mintA.mint)?[I,E]:[E,I],q=await Yl.makeOpenPositionFromLiquidityInstructions({poolInfo:s,ownerInfo:{feePayer:(ve=i.payer)!=null?ve:i.owner,wallet:i.owner,tokenAccountA:L,tokenAccountB:x},withMetadata:"create",...a,getEphemeralSigners:l});let X={instructions:[],signers:[],instructionTypes:[]};if(o!==void 0){const Ge=[];for(const It of o.poolKeys.rewardInfos){const qn=It.rewardMint.equals(F.WSOL.mint);Ge.push((At=A[It.rewardMint.toString()])!=null?At:await this._selectOrCreateTokenAccount({programId:_,mint:It.rewardMint,tokenAccounts:i.tokenAccounts,owner:i.owner,createInfo:{connection:e,payer:(wt=i.payer)!=null?wt:i.owner,frontInstructions:f,frontInstructionsType:g,endInstructions:qn?w:[],endInstructionsType:qn?h:[],signers:p},associatedOnly:!0,checkCreateATAOwner:c}))}X=Ve.makeWithdrawInstruction({poolKeys:o.poolKeys,amount:o.amount,userKeys:{ledger:Ve.getAssociatedLedgerAccount({programId:o.poolKeys.programId,poolId:o.poolKeys.id,owner:i.owner,version:o.poolKeys.version}),lpTokenAccount:k,rewardTokenAccounts:Ge,owner:i.owner}}).innerTransaction}return{address:{...v.address,...q.address},innerTransactions:await ue({connection:e,makeTxVersion:d,computeBudgetConfig:u,payer:(Ct=i.payer)!=null?Ct:i.owner,innerTransaction:[{instructionTypes:g,instructions:f,signers:p},X,v.innerTransaction,q.innerTransaction,{instructionTypes:h,instructions:w,signers:[]}],lookupTableCache:m})}}static async fetchAllPoolKeys(e,t,n){const i=(await Promise.all(Object.entries(os).map(([c,l])=>{try{return e.getProgramAccounts(t[Number(c)],{filters:[{dataSize:l.span}]}).then(d=>d.map(m=>({id:m.pubkey,version:Number(c),programId:t[Number(c)],...l.decode(m.account.data)})))}catch(d){if(d instanceof Error)return G.throwError("failed to fetch pool info",se.errors.RPC_ERROR,{message:d.message})}}))).flat(),s=i.map(c=>c.marketId),a={};try{const c=await bt(e,s,n);for(const l of c){if(l===null)continue;const d={programId:l.owner,...di.decode(l.data)};a[d.ownAddress.toString()]=d}}catch(c){if(c instanceof Error)return G.throwError("failed to fetch markets",se.errors.RPC_ERROR,{message:c.message})}const o={};for(const[c,l]of Object.entries(t))o[c]=this.getAssociatedAuthority({programId:l}).publicKey;const u=[];for(const c of i){if(c===void 0||c.baseMint.equals(P.default))continue;const l=a[c.marketId.toString()],d=l.programId;u.push({id:c.id,baseMint:c.baseMint,quoteMint:c.quoteMint,lpMint:c.lpMint,baseDecimals:c.baseDecimal.toNumber(),quoteDecimals:c.quoteDecimal.toNumber(),lpDecimals:c.id.toString()==="6kmMMacvoCKBkBrqssLEdFuEZu2wqtLdNQxh9VjtzfwT"?5:c.baseDecimal.toNumber(),version:c.version,programId:c.programId,authority:o[c.version],openOrders:c.openOrders,targetOrders:c.targetOrders,baseVault:c.baseVault,quoteVault:c.quoteVault,marketVersion:3,marketProgramId:d,marketId:l.ownAddress,marketAuthority:Zr.getAssociatedAuthority({programId:d,marketId:l.ownAddress}).publicKey,marketBaseVault:l.baseVault,marketQuoteVault:l.quoteVault,marketBids:l.bids,marketAsks:l.asks,marketEventQueue:l.eventQueue,...c.version===5?{modelDataAccount:c.modelDataAccount,withdrawQueue:P.default,lpVault:P.default}:{withdrawQueue:c.withdrawQueue,lpVault:c.lpVault},lookupTableAccount:P.default})}return u}static async fetchInfo({connection:e,poolKeys:t}){const n=await this.fetchMultipleInfo({connection:e,pools:[t]});return G.assertArgument(n.length===1,"fetchInfo failed, ".concat(n.length," pools found"),"poolKeys.id",t.id),n[0]}static async fetchMultipleInfo({connection:e,pools:t,config:n}){await md(e);const i=t.map(o=>this.makeSimulatePoolInfoInstruction({poolKeys:o}));return(await Sc(e,i.map(o=>o.innerTransaction.instructions).flat(),"GetPoolData")).map(o=>{const u=Ic(o,"GetPoolData"),c=new B(vt(u,"status")),l=Number(vt(u,"coin_decimals")),d=Number(vt(u,"pc_decimals")),m=Number(vt(u,"lp_decimals")),f=new B(vt(u,"pool_coin_amount")),w=new B(vt(u,"pool_pc_amount")),g=new B(vt(u,"pool_lp_supply"));let h="0";try{h=vt(u,"pool_open_time")}catch(p){}return{status:c,baseDecimals:l,quoteDecimals:d,lpDecimals:m,baseReserve:f,quoteReserve:w,lpSupply:g,startTime:new B(h)}})}static getEnabledFeatures(e){const{status:t}=e,n=t.toNumber();if(n===ct.Uninitialized)return{swap:!1,addLiquidity:!1,removeLiquidity:!1};if(n===ct.Initialized)return{swap:!0,addLiquidity:!0,removeLiquidity:!0};if(n===ct.Disabled)return{swap:!1,addLiquidity:!1,removeLiquidity:!1};if(n===ct.RemoveLiquidityOnly)return{swap:!1,addLiquidity:!1,removeLiquidity:!0};if(n===ct.LiquidityOnly)return{swap:!1,addLiquidity:!0,removeLiquidity:!0};if(n===ct.OrderBook)return{swap:!1,addLiquidity:!0,removeLiquidity:!0};if(n===ct.Swap)return{swap:!0,addLiquidity:!0,removeLiquidity:!0};if(n===ct.WaitingForStart){const{startTime:i}=e;return Date.now()/1e3<i.toNumber()?{swap:!1,addLiquidity:!0,removeLiquidity:!0}:{swap:!0,addLiquidity:!0,removeLiquidity:!0}}else return{swap:!1,addLiquidity:!1,removeLiquidity:!1}}static includesToken(e,t){const{baseMint:n,quoteMint:i}=t;return e.mint.equals(n)||e.mint.equals(i)}static _getTokenSide(e,t){const{baseMint:n,quoteMint:i}=t;return e.mint.equals(n)?"base":e.mint.equals(i)?"quote":G.throwArgumentError("token not match with pool","params",{token:e.mint,baseMint:n,quoteMint:i})}static _getTokensSide(e,t,n){const{baseMint:i,quoteMint:s}=n,a=this._getTokenSide(e,n),o=this._getTokenSide(t,n);return G.assertArgument(a!==o,"tokens not match with pool","params",{tokenA:e.mint,tokenB:t.mint,baseMint:i,quoteMint:s}),[a,o]}static _getAmountSide(e,t){const n=e instanceof le?e.token:F.WSOL;return this._getTokenSide(n,t)}static _getAmountsSide(e,t,n){const i=e instanceof le?e.token:F.WSOL,s=t instanceof le?t.token:F.WSOL;return this._getTokensSide(i,s,n)}static computeAnotherAmount({poolKeys:e,poolInfo:t,amount:n,anotherCurrency:i,slippage:s}){const{baseReserve:a,quoteReserve:o}=t;G.debug("baseReserve:",a.toString()),G.debug("quoteReserve:",o.toString());const u=n instanceof le?n.token:n.currency;G.debug("currencyIn:",u),G.debug("amount:",n.toFixed()),G.debug("anotherCurrency:",i),G.debug("slippage:","".concat(s.toSignificant(),"%"));const c=this._getAmountSide(n,e);G.debug("input side:",c);let l=$;n.isZero()||(l=c==="base"?Br(n.raw.mul(o),a):Br(n.raw.mul(a),o));const d=Br(n.raw.mul(t.lpSupply),c==="base"?t.baseReserve:t.quoteReserve),f=new xt(Te).add(s).mul(l).quotient,w=i instanceof F?new le(i,l):new Re(i,l),g=i instanceof F?new le(i,f):new Re(i,f);return G.debug("anotheAmount:",w.toFixed()),G.debug("maxAnotheAmount:",g.toFixed()),{anotherAmount:w,maxAnotherAmount:g,liquidity:d}}static _computePriceImpact(e,t,n){const i=e.raw.mul(t),s=i.sub(n).div(i);return new xt(s.numerator,s.denominator)}static getRate(e){const{baseReserve:t,quoteReserve:n,baseDecimals:i,quoteDecimals:s}=e;return new De(new St(i),t,new St(s),n)}static computeAmountIn({poolKeys:e,poolInfo:t,amountOut:n,currencyIn:i,slippage:s}){const{baseReserve:a,quoteReserve:o}=t;G.debug("baseReserve:",a.toString()),G.debug("quoteReserve:",o.toString());const u=n instanceof le?n.token:n.currency;G.debug("currencyOut:",u),G.debug("amountOut:",n.toFixed()),G.debug("currencyIn:",i),G.debug("slippage:","".concat(s.toSignificant(),"%"));const c=[a,o],l=this._getAmountSide(n,e);l==="base"&&c.reverse(),G.debug("output side:",l);const[d,m]=c,f=new De(i,d,u,m);G.debug("currentPrice:","1 ".concat(i.symbol," ≈ ").concat(f.toFixed()," ").concat(u.symbol)),G.debug("currentPrice invert:","1 ".concat(u.symbol," ≈ ").concat(f.invert().toFixed()," ").concat(i.symbol));let w=$,g=n.raw;if(!g.isZero()){g.gt(m)&&(g=m.sub(Te));const y=m.sub(g);w=d.mul(g).div(y).mul(jr).div(jr.sub(Aa))}const p=new xt(Te).add(s).mul(w).quotient,A=i instanceof F?new le(i,w):new Re(i,w),k=i instanceof F?new le(i,p):new Re(i,p);G.debug("amountIn:",A.toFixed()),G.debug("maxAmountIn:",k.toFixed());let S=null;!w.isZero()&&!g.isZero()&&(S=new De(i,w,u,g),G.debug("executionPrice:","1 ".concat(i.symbol," ≈ ").concat(S.toFixed()," ").concat(u.symbol)),G.debug("executionPrice invert:","1 ".concat(u.symbol," ≈ ").concat(S.invert().toFixed()," ").concat(i.symbol)));const T=this._computePriceImpact(f,w,g);return G.debug("priceImpact:","".concat(T.toSignificant(),"%")),{amountIn:A,maxAmountIn:k,currentPrice:f,executionPrice:S,priceImpact:T}}}vn=fi;fi.computeAmountOut=({poolKeys:r,poolInfo:e,amountIn:t,currencyOut:n,slippage:i})=>{const s=t instanceof le?t.token:F.WSOL,a=n instanceof F?n:F.WSOL;G.assertArgument(vn.includesToken(s,r)&&vn.includesToken(a,r),"token not match with pool","poolKeys",{poolKeys:r,tokenIn:s,tokenOut:a});const{baseReserve:o,quoteReserve:u}=e;G.debug("baseReserve:",o.toString()),G.debug("quoteReserve:",u.toString());const c=t instanceof le?t.token:t.currency;G.debug("currencyIn:",c),G.debug("amountIn:",t.toFixed()),G.debug("currencyOut:",n),G.debug("slippage:","".concat(i.toSignificant(),"%"));const l=[o,u],d=vn._getAmountSide(t,r);d==="quote"&&l.reverse(),G.debug("input side:",d);const[m,f]=l;let w;if(r.version===4)w=new De(c,m,n,f);else{const x=dd(Bn,o.toNumber(),u.toNumber(),!1);d==="quote"?w=new De(c,new B(x*1e6),n,new B(1e6)):w=new De(c,new B(1e6),n,new B(x*1e6))}G.debug("currentPrice:","1 ".concat(c.symbol," ≈ ").concat(w.toFixed()," ").concat(n.symbol)),G.debug("currentPrice invert:","1 ".concat(n.symbol," ≈ ").concat(w.invert().toFixed()," ").concat(c.symbol));const g=t.raw;let h=$,p=$;if(!g.isZero())if(r.version===4){p=Zn(g.mul(Aa),jr);const x=g.sub(p),q=m.add(x);h=f.mul(x).div(q)}else{p=g.mul(new B(2)).div(new B(1e4));const x=g.sub(p);d==="quote"?h=new B(cd(Bn,u.toNumber(),o.toNumber(),x.toNumber())):h=new B(ud(Bn,u.toNumber(),o.toNumber(),x.toNumber()))}const k=new xt(Te).add(i).invert().mul(h).quotient,S=n instanceof F?new le(n,h):new Re(n,h),T=n instanceof F?new le(n,k):new Re(n,k);G.debug("amountOut:",S.toFixed()),G.debug("minAmountOut:",T.toFixed());let y=new De(c,g.sub(p),n,h);!g.isZero()&&!h.isZero()&&(y=new De(c,g.sub(p),n,h),G.debug("executionPrice:","1 ".concat(c.symbol," ≈ ").concat(y.toFixed()," ").concat(n.symbol)),G.debug("executionPrice invert:","1 ".concat(n.symbol," ≈ ").concat(y.invert().toFixed()," ").concat(c.symbol)));const I=y.denominator.mul(w.numerator),E=y.numerator.mul(w.denominator).sub(I).abs(),v=new xt(E,I);G.debug("priceImpact:","".concat(v.toSignificant(),"%"));const L=c instanceof F?new le(c,p):new Re(c,p);return{amountOut:S,minAmountOut:T,currentPrice:w,executionPrice:y,priceImpact:v,fee:L}};new P("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),new P("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),new P("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),new P("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),new P("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),new P("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),new P("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),new P("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),new P("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),new P("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS");P.default,new P("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),P.default,new P("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),new P("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),new P("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),new P("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),new P("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),new P("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),new P("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU");function fd(r="accountFlags"){const e=new Gc(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}W([Oe(5),fd("accountFlags"),C("ownAddress"),b("vaultSignerNonce"),C("baseMint"),C("quoteMint"),C("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),C("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),C("requestQueue"),C("eventQueue"),C("bids"),C("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),Oe(7)]);var pi;class nn extends Ar{static getPdaPoolId(e,t){return de([this.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,i){return de([this.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),N.from(new B(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:i,chainTime:s}){if(n.length===0)return[];const a=n.map(l=>this.getPdaPoolId(t,l).publicKey),o=[];for(let l=0;l<this.VERSION_PROJECT.length;l++)o.push(...a.map(d=>this.getPdaOwnerId(t,d,i,l).publicKey));const u=await bt(e,[...a,...o]),c=[];for(let l=0;l<u.length;l++){const d=Math.floor(l/n.length),m=l%n.length,f=a[m],w=o[l],g=u[m],h=u[n.length+l];if(!(g&&h)||g.data.length!==this.POOL_LAYOUT.span||h.data.length!==this.OWNER_LAYOUT.span)continue;const p=this.POOL_LAYOUT.decode(g.data),A=this.OWNER_LAYOUT.decode(h.data),k=p.openTime.toNumber(),S=p.endTime.toNumber(),T=A.tokenInfo.map(E=>E.debtAmount.gt(new B(0))).filter(E=>!E).length!==3,y=s>k&&s<S&&p.status===1,I=T&&y;c.push({programId:t,poolId:f,ammId:p.ammId,ownerAccountId:w,snapshotLpAmount:A.lpAmount,project:this.VERSION_PROJECT[d],openTime:k,endTime:S,canClaim:I,canClaimErrorType:T?y?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:p.tokenInfo.map((E,v)=>({programId:_,mintAddress:E.mintAddress,mintVault:E.mintVault,mintDecimals:E.mintDecimals,perLpLoss:E.perLpLoss,debtAmount:A.tokenInfo[v].debtAmount.add(A.tokenInfo[v].claimedAmount)}))})}return c}static async makeClaimInstructionSimple({connection:e,poolInfo:t,ownerInfo:n,makeTxVersion:i,lookupTableCache:s}){const a=[],o=[],u=[],c=[],l=[],d=[],m=[],f=[];for(const w of t.tokenInfo)f.push(await this._selectOrCreateTokenAccount({programId:w.programId,mint:w.mintAddress,tokenAccounts:w.mintAddress.equals(F.WSOL.mint)?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.wallet,amount:0,frontInstructions:a,endInstructions:w.mintAddress.equals(F.WSOL.mint)?u:[],frontInstructionsType:o,endInstructionsType:c,signers:m},associatedOnly:w.mintAddress.equals(F.WSOL.mint)?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner}));return l.push(this.makeClaimInstruction({programId:t.programId,poolInfo:t,ownerInfo:{wallet:n.wallet,ownerPda:t.ownerAccountId,claimAddress:f}})),d.push(Q.util1216OwnerClaim),{address:{},innerTransactions:await ue({connection:e,makeTxVersion:i,computeBudgetConfig:void 0,payer:n.wallet,innerTransaction:[{instructionTypes:o,instructions:a,signers:m},{instructionTypes:d,instructions:l,signers:[]},{instructionTypes:c,instructions:u,signers:[]}],lookupTableCache:s})}}static async makeClaimAllInstructionSimple({connection:e,poolInfos:t,ownerInfo:n,makeTxVersion:i,lookupTableCache:s}){var w;const a=[],o=[],u=[],c=[],l=[],d=[],m=[],f={};for(const g of t){const h=[];for(const p of g.tokenInfo){const A=(w=f[p.mintAddress.toString()])!=null?w:await this._selectOrCreateTokenAccount({programId:p.programId,mint:p.mintAddress,tokenAccounts:p.mintAddress.equals(F.WSOL.mint)?[]:n.tokenAccounts,owner:n.wallet,createInfo:{connection:e,payer:n.wallet,amount:0,frontInstructions:a,endInstructions:p.mintAddress.equals(F.WSOL.mint)?u:[],frontInstructionsType:o,endInstructionsType:c,signers:m},associatedOnly:p.mintAddress.equals(F.WSOL.mint)?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});f[p.mintAddress.toString()]=A,h.push(A)}l.push(this.makeClaimInstruction({programId:g.programId,poolInfo:g,ownerInfo:{wallet:n.wallet,ownerPda:g.ownerAccountId,claimAddress:h}})),d.push(Q.util1216OwnerClaim)}return{address:{},innerTransactions:await ue({connection:e,makeTxVersion:i,computeBudgetConfig:void 0,payer:n.wallet,innerTransaction:[{instructionTypes:o,instructions:a,signers:m},{instructionTypes:d,instructions:l,signers:[]},{instructionTypes:c,instructions:u,signers:[]}],lookupTableCache:s})}}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){const i=W([]),s=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(u=>({pubkey:u,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:u})=>({pubkey:u,isSigner:!1,isWritable:!0})),{pubkey:_,isSigner:!1,isWritable:!1}],a=N.alloc(i.span);i.encode({},a);const o=N.from([10,66,208,184,161,6,191,98,...a]);return new ne({keys:s,programId:e,data:o})}}pi=nn;nn.CLAIMED_NUM=3;nn.POOL_LAYOUT=W([Oe(8),V("bump"),V("status"),b("openTime"),b("endTime"),C("ammId"),Z(W([V("mintDecimals"),C("mintAddress"),C("mintVault"),b("perLpLoss"),b("totalClaimedAmount")]),pi.CLAIMED_NUM,"tokenInfo"),Z(b(),10,"padding")]);nn.OWNER_LAYOUT=W([Oe(8),V("bump"),V("version"),C("poolId"),C("owner"),b("lpAmount"),Z(W([C("mintAddress"),b("debtAmount"),b("claimedAmount")]),pi.CLAIMED_NUM,"tokenInfo"),Z(b(),4,"padding")]);nn.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(r=>new P(r));nn.SEED_CONFIG={pool:{id:N.from("pool_seed","utf8")},owner:{id:N.from("user_claim_seed","utf8")}};nn.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];const pd=pt.V0,gd=jc;new St(9,"SOL","SOL"),new F(_,new P("So11111111111111111111111111111111111111112"),9,"WSOL","WSOL"),new F(_,new P("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),6,"USDC","USDC"),new F(_,new P("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),6,"USDT","USDT"),new F(_,new P("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),6,"RAY","RAY"),new F(_,new P("FGYXP4vBkMEtKhxrmEBcWN8VNmXX8qNgEJpENKDETZ4Y"),6,"RAY-USDC","RAY-USDC");async function bd(r){const e=await Qn.getAccountInfo(new P(r));if(e===null)throw Error(" get id info error ");const t=Js.decode(e.data),n=t.marketId,i=await Qn.getAccountInfo(n);if(i===null)throw Error(" get market info error");const s=di.decode(i.data),a=t.lpMint,o=await Qn.getAccountInfo(a);if(o===null)throw Error(" get lp mint info error");const u=Qc.decode(o.data);return{id:r,baseMint:t.baseMint.toString(),quoteMint:t.quoteMint.toString(),lpMint:t.lpMint.toString(),baseDecimals:t.baseDecimal.toNumber(),quoteDecimals:t.quoteDecimal.toNumber(),lpDecimals:u.decimals,version:4,programId:e.owner.toString(),authority:fi.getAssociatedAuthority({programId:e.owner}).publicKey.toString(),openOrders:t.openOrders.toString(),targetOrders:t.targetOrders.toString(),baseVault:t.baseVault.toString(),quoteVault:t.quoteVault.toString(),withdrawQueue:t.withdrawQueue.toString(),lpVault:t.lpVault.toString(),marketVersion:3,marketProgramId:t.marketProgramId.toString(),marketId:t.marketId.toString(),marketAuthority:Zr.getAssociatedAuthority({programId:t.marketProgramId,marketId:t.marketId}).publicKey.toString(),marketBaseVault:s.baseVault.toString(),marketQuoteVault:s.quoteVault.toString(),marketBids:s.bids.toString(),marketAsks:s.asks.toString(),marketEventQueue:s.eventQueue.toString(),lookupTableAccount:P.default.toString()}}async function Td(r,e){return(await r.getTokenAccountsByOwner(e,{programId:_})).value.map(n=>({pubkey:n.pubkey,programId:n.account.owner,accountInfo:tt.decode(n.account.data)}))}async function yd(r,e){let t=mo().solanaWallet;const n=await Kc({connection:Qn,makeTxVersion:pd,payer:t==null?void 0:t.publicKey,innerTransactions:r,addLookupTableInfo:gd});return console.log("willSendTx",n),n}export{Ad as A,H as D,fi as L,hd as N,xt as P,kd as S,F as T,le as a,yd as b,bd as f,Td as g,Di as j,pd as m};
